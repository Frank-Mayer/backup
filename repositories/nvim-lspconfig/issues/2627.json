{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Language server\n\nlua-language-server\n\n### Requested feature\n\nIn my source tree have some Lua files that require one version of Lua, and others that require another.  But when I configure lua-language-server via nvim-lspconfig I can only call `setup` once, whereas I would like to be able to configure the same language server differently depending on the file path of the file being opened.  Ideally I'd have a scenario where I can have nvim-lspconfig launch two instances of the language server, one handling all of the Lua 5.1 files and the other handling all of the Lua 5.4 files.\r\n\r\nAny way to do this and/or add this feature?\n\n### Other clients which have this feature\n\n_No response_",
    "closed_at": "2023-05-21T01:20:45Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "lua_ls support lua5.1 - lua 5.4 check lua_ls wiki for `runtime`",
            "created_at": "2023-05-21T01:20:45Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2627#issuecomment-1556057757",
            "id": 1556057757,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627",
            "node_id": "IC_kwDODTQC185cv46d",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1556057757/reactions"
            },
            "updated_at": "2023-05-21T01:20:45Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1556057757",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "@glepnir I am aware that lua_ls supports multiple language versions, but the version can only be specified during the `setup` call.  However, nvim-lspconfig does not seem to allow per-buffer setup calls, so I cannot set a separate Lua version per buffer, and that is my feature request.  I think you might have misunderstood the question -- can we reopen?",
            "created_at": "2023-05-21T14:18:14Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2627#issuecomment-1556191450",
            "id": 1556191450,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627",
            "node_id": "IC_kwDODTQC185cwZja",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1556191450/reactions"
            },
            "updated_at": "2023-05-21T14:18:14Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1556191450",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8852457?v=4",
                "events_url": "https://api.github.com/users/no-more-secrets/events{/privacy}",
                "followers_url": "https://api.github.com/users/no-more-secrets/followers",
                "following_url": "https://api.github.com/users/no-more-secrets/following{/other_user}",
                "gists_url": "https://api.github.com/users/no-more-secrets/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/no-more-secrets",
                "id": 8852457,
                "login": "no-more-secrets",
                "node_id": "MDQ6VXNlcjg4NTI0NTc=",
                "organizations_url": "https://api.github.com/users/no-more-secrets/orgs",
                "received_events_url": "https://api.github.com/users/no-more-secrets/received_events",
                "repos_url": "https://api.github.com/users/no-more-secrets/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/no-more-secrets/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/no-more-secrets/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/no-more-secrets"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@no-more-secrets I haven't looked at the Lua config in detail, but I think in the default configuration, nvim-lspconfig will start a separate lang server instance for each root directory. Therefore you should be able to change the Lua version inside the `on_new_config` callback.\r\n\r\nI think you should be able to do something like this:\r\n\r\n```lua\r\nif vim.fn.executable(\"lua-ls-wrapper.sh\") ~= 0 then\r\n  lspconfig.lua_ls.setup({\r\n\r\n    on_new_config = function(new_config, root_dir)\r\n      local lua_version = \"Lua 5.4\"\r\n      if ____ then  -- Whatever condition you want here\r\n        lua_version = \"LuaJIT\"\r\n      end\r\n\r\n      new_config.settings = {\r\n        Lua = { runtime = { version = lua_version } },\r\n      }\r\n    end\r\n\r\n  })\r\nend\r\n```\r\n\r\nFor example, you can put a `.lua-version` file in the root directory of the project, and you can look for that file in `root_dir` and read its contents to get the required project version. The point is that you can do whatever you want and apply whatever settings you want by modifying `new_config.settings` in the `on_new_config` callback.\r\n\r\nYou can similarly customize the `root_dir` itself to ensure that it's set correctly before being passed to the `on_new_config` callback.\r\n\r\nHere's a simple-ish example from my dotfiles using custom callbacks for both `root_dir` and `on_new_config`: https://git.sr.ht/~wintershadows/dotfiles/tree/master/item/.config/nvim/lua/plugin-config/nvim-lspconfig.lua#L288-319\r\n\r\nAnd here's my fairly sophisticated setup for Python projects, if you want a detailed example: https://git.sr.ht/~wintershadows/dotfiles/tree/master/item/.config/nvim/lua/plugin-config/nvim-lspconfig.lua#L622-940",
            "created_at": "2023-06-06T16:31:30Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2627#issuecomment-1579094673",
            "id": 1579094673,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627",
            "node_id": "IC_kwDODTQC185eHxKR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1579094673/reactions"
            },
            "updated_at": "2023-06-06T16:35:14Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1579094673",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5758789?v=4",
                "events_url": "https://api.github.com/users/gwerbin/events{/privacy}",
                "followers_url": "https://api.github.com/users/gwerbin/followers",
                "following_url": "https://api.github.com/users/gwerbin/following{/other_user}",
                "gists_url": "https://api.github.com/users/gwerbin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gwerbin",
                "id": 5758789,
                "login": "gwerbin",
                "node_id": "MDQ6VXNlcjU3NTg3ODk=",
                "organizations_url": "https://api.github.com/users/gwerbin/orgs",
                "received_events_url": "https://api.github.com/users/gwerbin/received_events",
                "repos_url": "https://api.github.com/users/gwerbin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gwerbin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gwerbin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gwerbin"
            }
        },
        {
            "author_association": "NONE",
            "body": "@gwerbin Thanks; what I ended doing was just dropping some `.luarc.json` files in each root folder which contain the Lua version (and other things as well), and the nvim-lspconfig for lua-language-server is already configured to look for those to define root folders.  The lua-language-server seems also to search for and respect those files and allows them to override what is specified in that one-time configuration in the Lua code.  Overall, that seems to work for me (modulo one bug that I raised in the lua-language-server repo).\r\n\r\nFYI, something that I observed is that I can open a single editor session containing multiple Lua files of different versions (specified in the .luarc.json files) but there is only one instance (process) of lua-language-server running, which I guess is even better if it supports that, which apparently it does.",
            "created_at": "2023-06-19T11:37:24Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2627#issuecomment-1597028067",
            "id": 1597028067,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627",
            "node_id": "IC_kwDODTQC185fMLbj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1597028067/reactions"
            },
            "updated_at": "2023-06-19T11:37:24Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1597028067",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8852457?v=4",
                "events_url": "https://api.github.com/users/no-more-secrets/events{/privacy}",
                "followers_url": "https://api.github.com/users/no-more-secrets/followers",
                "following_url": "https://api.github.com/users/no-more-secrets/following{/other_user}",
                "gists_url": "https://api.github.com/users/no-more-secrets/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/no-more-secrets",
                "id": 8852457,
                "login": "no-more-secrets",
                "node_id": "MDQ6VXNlcjg4NTI0NTc=",
                "organizations_url": "https://api.github.com/users/no-more-secrets/orgs",
                "received_events_url": "https://api.github.com/users/no-more-secrets/received_events",
                "repos_url": "https://api.github.com/users/no-more-secrets/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/no-more-secrets/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/no-more-secrets/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/no-more-secrets"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627/comments",
    "created_at": "2023-05-20T18:03:10Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2627",
    "id": 1718243387,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "New feature or request",
            "id": 1674892767,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzY3",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC185malA7",
    "number": 2627,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627/timeline",
    "title": "Allow per-buffer setup for each language server.",
    "updated_at": "2023-06-19T11:37:24Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2627",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8852457?v=4",
        "events_url": "https://api.github.com/users/no-more-secrets/events{/privacy}",
        "followers_url": "https://api.github.com/users/no-more-secrets/followers",
        "following_url": "https://api.github.com/users/no-more-secrets/following{/other_user}",
        "gists_url": "https://api.github.com/users/no-more-secrets/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/no-more-secrets",
        "id": 8852457,
        "login": "no-more-secrets",
        "node_id": "MDQ6VXNlcjg4NTI0NTc=",
        "organizations_url": "https://api.github.com/users/no-more-secrets/orgs",
        "received_events_url": "https://api.github.com/users/no-more-secrets/received_events",
        "repos_url": "https://api.github.com/users/no-more-secrets/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/no-more-secrets/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/no-more-secrets/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/no-more-secrets"
    }
}