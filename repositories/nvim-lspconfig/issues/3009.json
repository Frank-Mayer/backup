{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\r\n\r\nThis is the definition of `commands` in `nvim-lspconfig`:\r\n\r\nhttps://github.com/neovim/nvim-lspconfig/blob/ae91a303a2258cb9cd9501e9d20c2dc92792d362/doc/lspconfig.txt#L281-L284\r\n\r\nCompared to nvim, where the mapped value is just a function, not a table:\r\n\r\nhttps://github.com/neovim/neovim/blob/ce5a9bfe7e537c81d34bd4a27fc6638f20114e67/runtime/doc/lsp.txt#L995-L1000\r\n\r\nThe collision here worked fine in the previous version of nvim, but incurred problem since https://github.com/neovim/neovim/commit/597ecf751603cde2d5f58021d503ae20a12eb2f2, which adds the native definition of `commands` to `client.config`, and causes error at https://github.com/neovim/nvim-lspconfig/blob/ae91a303a2258cb9cd9501e9d20c2dc92792d362/lua/lspconfig/configs.lua#L283-L285.\r\n\r\nA simple validation of the problem:\r\n```lua\r\n\r\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\r\nif not vim.loop.fs_stat(lazypath) then\r\n\tvim.fn.system({\r\n\t\t\"git\",\r\n\t\t\"clone\",\r\n\t\t\"--filter=blob:none\",\r\n\t\t\"https://github.com/folke/lazy.nvim.git\",\r\n\t\t\"--branch=stable\", -- latest stable release\r\n\t\tlazypath,\r\n\t})\r\nend\r\nvim.opt.rtp:prepend(lazypath)\r\nrequire(\"lazy\").setup({\r\n\t{\r\n\t\t\"neovim/nvim-lspconfig\",\r\n\t\tconfig = function()\r\n\t\t\trequire(\"lspconfig\").vtsls.setup({\r\n\t\t\t\ton_attach = function(client)\r\n\t\t\t\t\tclient.commands[\"command\"] = function() end\r\n\t\t\t\tend,\r\n\t\t\t})\r\n\t\tend,\r\n\t},\r\n}, {})\r\n```\r\nOpen a random TypeScript file to start server, we will see the error message:\r\n\r\n`LSP[vtsls]: Error ON_ATTACH_ERROR: \"...are/nvim_test/lazy/nvim-lspconfig/lua/lspconfig/util.lua:71: bad argument #1 to 'pairs' (table expected, got function)\"`\r\n\r\nI think we need to deprecate the `commands` field in `nvim-lspconfig`.",
    "closed_at": "2024-02-14T05:25:22Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "try the latest commit build",
            "created_at": "2024-02-14T05:25:22Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3009#issuecomment-1943104384",
            "id": 1943104384,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009",
            "node_id": "IC_kwDODTQC185z0WuA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1943104384/reactions"
            },
            "updated_at": "2024-02-14T05:25:22Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1943104384",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009/comments",
    "created_at": "2024-02-13T13:29:53Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3009",
    "id": 2132328887,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC185_GMG3",
    "number": 3009,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009/timeline",
    "title": "Custom commands field collide with `vim.lsp.client` definition on nvim nightly",
    "updated_at": "2024-02-14T05:25:23Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3009",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/65551246?v=4",
        "events_url": "https://api.github.com/users/yioneko/events{/privacy}",
        "followers_url": "https://api.github.com/users/yioneko/followers",
        "following_url": "https://api.github.com/users/yioneko/following{/other_user}",
        "gists_url": "https://api.github.com/users/yioneko/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/yioneko",
        "id": 65551246,
        "login": "yioneko",
        "node_id": "MDQ6VXNlcjY1NTUxMjQ2",
        "organizations_url": "https://api.github.com/users/yioneko/orgs",
        "received_events_url": "https://api.github.com/users/yioneko/received_events",
        "repos_url": "https://api.github.com/users/yioneko/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/yioneko/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yioneko/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/yioneko"
    }
}