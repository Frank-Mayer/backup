{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Description\n\nWhen active buffer is outside of `root_dir` `LspInfo` reports root directory as `Running in single file mode`.\r\n\r\n# Steps to reproduce\r\n\r\n`minimal_init.lua`:\r\n```lua\r\nlocal lspconfig = require(\"lspconfig\")\r\n\r\nlspconfig.lua_ls.setup({\r\n  -- Use dirname as root_dir\r\n  root_dir = vim.fs.dirname,\r\n})\r\n\r\n-- Set up lspconfig commands\r\nvim.cmd.runtime(\"plugin/lspconfig.lua\")\r\n\r\n-- Make tmpdir\r\nlocal tmpdir = assert(vim.uv.fs_mkdtemp(vim.fs.joinpath(vim.uv.os_tmpdir(), \"lspinfo_repro.XXXXXX\")))\r\n\r\n-- Open file in tmpdir\r\nvim.schedule(function()\r\n  vim.cmd.edit(vim.fs.joinpath(tmpdir, \"file.lua\"))\r\nend)\r\n\r\n-- Remove tmpdir after vim exit. It won't work if test files were saved there\r\nvim.api.nvim_create_autocmd(\"VimLeave\", {\r\n  callback = function()\r\n    vim.uv.fs_rmdir(tmpdir)\r\n  end,\r\n})\r\n```\r\n\r\n1. Run neovim: `nvim --clean --noplugin -u minimal_init.lua`. One buffer is active.\r\n2. Run command: `:LspInfo`. Root directory:  `/tmp/lspinfo_repro.9qkBbS`.\r\n3. Edit any file outside of root dir: `:edit /tmp/lspinfo_repro`.\r\n4. `:LspInfo`. Root directory:  `Running in single file mode`.\r\n5. Switch buffer back: `:buffer #`.\r\n6. `:LspInfo`. Root directory:  `/tmp/lspinfo_repro.9qkBbS`.\r\n7. Edit any file inside of root dir (change `9qkBbS` to your case): `:e /tmp/lspinfo_repro.9qkBbS/1234`.\r\n8. `:LspInfo`. Root directory:  `/tmp/lspinfo_repro.9qkBbS`.\r\n9. When switching to buffer created in 3. `LspInfo` again reports root directory as single file.",
    "closed_at": "2024-05-21T12:38:43Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "it outside of the root then it run in single file mode what's the problem ?",
            "created_at": "2024-05-21T12:38:43Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3167#issuecomment-2122542397",
            "id": 2122542397,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167",
            "node_id": "IC_kwDODTQC185-g209",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122542397/reactions"
            },
            "updated_at": "2024-05-21T12:39:01Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122542397",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> it outside of the root then it run in single file mode what's the problem ?\r\n\r\nClient itself is _not_ outside of the root dir, but it's wrongly reported as such. The problem is wrong info reported by `LspInfo`. Maybe a screenshot would help to understand what's the problem?\r\n\r\n![image](https://github.com/neovim/nvim-lspconfig/assets/1353637/5a79a05e-6309-4d4a-aed5-70cd48545213)\r\n\r\nAll those servers are **not** running in single file mode. They all have its own root_dir. So it's strange to report it like this.\r\n\r\nCompare it to this:\r\n\r\n![image](https://github.com/neovim/nvim-lspconfig/assets/1353637/530ea913-72f7-4b4d-9bfa-ab0a1c14e912)\r\n\r\nI just switched buffer, nothing else changed. Now `lua_ls` is reported as single file mode, but for `nil_ls` root directory is displayed correctly.\r\n\r\nCheckhealth (all clients has root_dir):\r\n\r\n```\r\nvim.lsp: Active Clients ~\r\n- nil_ls (id=1, root_dir=/nix/store/dpplx09mq0jpkm8b149xjc1brpky7503-source, attached_to=[1,280])\r\n- nil_ls (id=2, root_dir=/nix/store/7v74bj8chscad3xcb03bvi474q9mv2g0-source, attached_to=[297,540,569,324,266,37])\r\n- null-ls (id=4, root_dir=/nix/store/lqdsr7qjrzm1q20zxiwlv5nhv2ap4a0s-vimplugin-nvim-lspconfig-2024-05-16, attached_to=[783,586,211,806,640,637])\r\n- nil_ls (id=6, root_dir=/nix/store/zyzhqfys86byv201frlpiyipzzw38p02-source/lib, attached_to=[554])\r\n- lua_ls (id=7, root_dir=/nix/store/mv069f2y146dpijxgnwd5nddjv9qkcci-neovim-patched-0.10.1-dev/share/nvim/runtime, attached_to=[783,586,211,806,640,637])\r\n```",
            "created_at": "2024-05-21T12:44:28Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3167#issuecomment-2122554183",
            "id": 2122554183,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167",
            "node_id": "IC_kwDODTQC185-g5tH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122554183/reactions"
            },
            "updated_at": "2024-05-21T12:53:05Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122554183",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1353637?v=4",
                "events_url": "https://api.github.com/users/stasjok/events{/privacy}",
                "followers_url": "https://api.github.com/users/stasjok/followers",
                "following_url": "https://api.github.com/users/stasjok/following{/other_user}",
                "gists_url": "https://api.github.com/users/stasjok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stasjok",
                "id": 1353637,
                "login": "stasjok",
                "node_id": "MDQ6VXNlcjEzNTM2Mzc=",
                "organizations_url": "https://api.github.com/users/stasjok/orgs",
                "received_events_url": "https://api.github.com/users/stasjok/received_events",
                "repos_url": "https://api.github.com/users/stasjok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stasjok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stasjok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stasjok"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I remeber there has a problem after i add workspace relate stuff see https://github.com/neovim/nvim-lspconfig/pull/2648 I will check it later.",
            "created_at": "2024-05-21T12:52:38Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3167#issuecomment-2122568919",
            "id": 2122568919,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167",
            "node_id": "IC_kwDODTQC185-g9TX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122568919/reactions"
            },
            "updated_at": "2024-05-21T12:52:38Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122568919",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Could you reopen for the time being? It's not urgent, but so that it's not forgotten completely.",
            "created_at": "2024-05-21T13:18:04Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3167#issuecomment-2122619593",
            "id": 2122619593,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167",
            "node_id": "IC_kwDODTQC185-hJrJ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122619593/reactions"
            },
            "updated_at": "2024-05-21T13:18:04Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2122619593",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1353637?v=4",
                "events_url": "https://api.github.com/users/stasjok/events{/privacy}",
                "followers_url": "https://api.github.com/users/stasjok/followers",
                "following_url": "https://api.github.com/users/stasjok/following{/other_user}",
                "gists_url": "https://api.github.com/users/stasjok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/stasjok",
                "id": 1353637,
                "login": "stasjok",
                "node_id": "MDQ6VXNlcjEzNTM2Mzc=",
                "organizations_url": "https://api.github.com/users/stasjok/orgs",
                "received_events_url": "https://api.github.com/users/stasjok/received_events",
                "repos_url": "https://api.github.com/users/stasjok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/stasjok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/stasjok/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/stasjok"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167/comments",
    "created_at": "2024-05-21T12:24:19Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3167",
    "id": 2308180227,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC186JlAkD",
    "number": 3167,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167/timeline",
    "title": "LspInfo reports `Running in single file mode` when current buffer is not in `root_dir`",
    "updated_at": "2024-05-21T13:18:05Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3167",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1353637?v=4",
        "events_url": "https://api.github.com/users/stasjok/events{/privacy}",
        "followers_url": "https://api.github.com/users/stasjok/followers",
        "following_url": "https://api.github.com/users/stasjok/following{/other_user}",
        "gists_url": "https://api.github.com/users/stasjok/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/stasjok",
        "id": 1353637,
        "login": "stasjok",
        "node_id": "MDQ6VXNlcjEzNTM2Mzc=",
        "organizations_url": "https://api.github.com/users/stasjok/orgs",
        "received_events_url": "https://api.github.com/users/stasjok/received_events",
        "repos_url": "https://api.github.com/users/stasjok/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/stasjok/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/stasjok/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/stasjok"
    }
}