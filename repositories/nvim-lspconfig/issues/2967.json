{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Language server\r\n\r\n_No response_\r\n\r\n### Requested feature\r\n\r\nThe docs for the `root_dir` setting say:\r\n\r\n```\r\n- {root_dir}\r\n\r\n    `function(filename, bufnr)`\r\n\r\n    Returns either a filepath (string) or nil. The language server will only\r\n    start if the function returns a filepath.\r\n\r\n    If a root directory (string) is returned which is unique from any\r\n    previously returned root_dir, a new server will be spawned with that\r\n    root directory. See |lspconfig-root-detection| for more details\r\n```\r\n\r\nAFAICT this is wrong. I believe what lspconfig does is check for \"workspace folders\" support on the server. If it's supported then lspconfig adds the new root directory as a new workspace folder to an existing server instance. It only launches a new instance if workspace folders isn't supported.\r\n\r\nBecause not all servers implement workspace folders support perfectly, this behavior is not always desirable. It would be better to grant the user control here over whether to create a new server instance or add to workspace folders of an existing instance.\r\n\r\n(Aside: I am running into a problem specifically with `lua_ls`-- anyone know a workaround to prevent adding to workspace folders for this specific server?)\r\n\r\n### Other clients which have this feature\r\n\r\n_No response_",
    "closed_at": "2024-01-13T15:57:43Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thanks for your report. This repo is just a collection of configs, it has nothing to do with \"starting a new server\".\r\n\r\nIf you found a bug in the _core_ Nvim  `vim.lsp` module (not part of this repo), the best way to get it fixed is to [report to Nvim](https://github.com/neovim/neovim) (not nvim-lspconfig) with:\r\n- steps to reproduce it without the particular LSP server and other factors particular to your environment\r\n- (optional, but very helpful): by adding a failing test case to [lsp_spec.lua](https://github.com/neovim/neovim/blob/master/test/functional/plugin/lsp_spec.lua), which has code to setup a fake LSP server to simulate various scenarios",
            "created_at": "2024-01-13T15:57:44Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2967#issuecomment-1890536992",
            "id": 1890536992,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967",
            "node_id": "IC_kwDODTQC185wr04g",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1890536992/reactions"
            },
            "updated_at": "2024-01-13T15:57:44Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1890536992",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": ">This repo is just a collection of configs, it has nothing to do with \"starting a new server\".\r\n\r\n?\r\n\r\n`lspconfig.manager` contains logic that determines whether to spawn a new client (which IIUC starts a new server process). This is invoked by the autocommands defined by any call to `require('lspconfig').<client-name>.setup(...)`.\r\n\r\nThe specific logic I'm talking about, where the decision to spawn a new client is conditioned on whether the server backing an existing client has \"workspace folders\" support, can be found right [here](https://github.com/neovim/nvim-lspconfig/blob/master/lua/lspconfig/manager.lua#L159-L175):\r\n\r\n```\r\n--- @private\r\n--- @param bufnr integer\r\n--- @param new_config lspconfig.Config\r\n--- @param root_dir string\r\n--- @param client lsp.Client\r\n--- @param single_file boolean\r\nfunction M:_attach_or_spawn(bufnr, new_config, root_dir, client, single_file)\r\n  if check_in_workspace(client, root_dir) then\r\n    return self:_attach_and_cache(bufnr, root_dir, client.id)\r\n  end\r\n\r\n  local supported = vim.tbl_get(client, 'server_capabilities', 'workspace', 'workspaceFolders', 'supported')\r\n  if supported then\r\n    return self:_register_workspace_folders(bufnr, root_dir, client)\r\n  end\r\n  self:_start_new_client(bufnr, new_config, root_dir, single_file)\r\nend\r\n```",
            "created_at": "2024-01-15T00:49:42Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2967#issuecomment-1891141600",
            "id": 1891141600,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967",
            "node_id": "IC_kwDODTQC185wuIfg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1891141600/reactions"
            },
            "updated_at": "2024-01-15T01:02:23Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1891141600",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1531373?v=4",
                "events_url": "https://api.github.com/users/smackesey/events{/privacy}",
                "followers_url": "https://api.github.com/users/smackesey/followers",
                "following_url": "https://api.github.com/users/smackesey/following{/other_user}",
                "gists_url": "https://api.github.com/users/smackesey/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/smackesey",
                "id": 1531373,
                "login": "smackesey",
                "node_id": "MDQ6VXNlcjE1MzEzNzM=",
                "organizations_url": "https://api.github.com/users/smackesey/orgs",
                "received_events_url": "https://api.github.com/users/smackesey/received_events",
                "repos_url": "https://api.github.com/users/smackesey/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/smackesey/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/smackesey/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/smackesey"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk In light of the above, can we reopen this issue? I would be willing to provide a PR.",
            "created_at": "2024-01-22T19:58:30Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2967#issuecomment-1904710272",
            "id": 1904710272,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967",
            "node_id": "IC_kwDODTQC185xh5KA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1904710272/reactions"
            },
            "updated_at": "2024-01-22T19:58:30Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1904710272",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1531373?v=4",
                "events_url": "https://api.github.com/users/smackesey/events{/privacy}",
                "followers_url": "https://api.github.com/users/smackesey/followers",
                "following_url": "https://api.github.com/users/smackesey/following{/other_user}",
                "gists_url": "https://api.github.com/users/smackesey/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/smackesey",
                "id": 1531373,
                "login": "smackesey",
                "node_id": "MDQ6VXNlcjE1MzEzNzM=",
                "organizations_url": "https://api.github.com/users/smackesey/orgs",
                "received_events_url": "https://api.github.com/users/smackesey/received_events",
                "repos_url": "https://api.github.com/users/smackesey/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/smackesey/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/smackesey/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/smackesey"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967/comments",
    "created_at": "2024-01-12T13:05:32Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2967",
    "id": 2078814907,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "New feature or request",
            "id": 1674892767,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzY3",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC18576DK7",
    "number": 2967,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967/timeline",
    "title": "Option to spawn new instance instead of appending to workspace folders (also wrong `root_dir` docs)",
    "updated_at": "2024-01-22T19:58:31Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2967",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1531373?v=4",
        "events_url": "https://api.github.com/users/smackesey/events{/privacy}",
        "followers_url": "https://api.github.com/users/smackesey/followers",
        "following_url": "https://api.github.com/users/smackesey/following{/other_user}",
        "gists_url": "https://api.github.com/users/smackesey/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/smackesey",
        "id": 1531373,
        "login": "smackesey",
        "node_id": "MDQ6VXNlcjE1MzEzNzM=",
        "organizations_url": "https://api.github.com/users/smackesey/orgs",
        "received_events_url": "https://api.github.com/users/smackesey/received_events",
        "repos_url": "https://api.github.com/users/smackesey/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/smackesey/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/smackesey/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/smackesey"
    }
}