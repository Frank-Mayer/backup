{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n\nhttps://github.com/nwolverson/purescript-language-server/issues/176#issuecomment-1048831911\n\n### Neovim version\n\nNVIM v0.6.1\r\nBuild type: Release\r\nLuaJIT 2.1.0-beta3\r\nCompiled by void-buildslave@a-fsn-de\r\n\r\nFeatures: +acl +iconv +tui\r\nSee \":help feature-compile\"\r\n\r\n   system vimrc file: \"$VIM/sysinit.vim\"\r\n  fall-back for $VIM: \"/usr/share/nvim\"\r\n\r\nRun :checkhealth for more info\r\n\r\n\r\nnvim-lsp-installer: require(\"nvim-lsp-installer.health\").check()                                                                                                                                  \r\n========================================================================                                                                                                                          \r\n## nvim-lsp-installer report                                                                                                                                                                      \r\n- OK: neovim version >= 0.6.0                                                                                                                                                                   \r\n- OK: tar: `tar (GNU tar) 1.34`                                                                                                                                                                 \r\n- OK: gzip: `gzip 1.11`                                                                                                                                                                         \r\n- OK: curl: `curl 7.81.0 (x86_64-unknown-linux-gnu) libcurl/7.81.0 OpenSSL/1.1.1l zlib/1.2.11 zstd/1.5.2 libssh2/1.9.0 ghttp2/1.46.0`                                                          \r\n- OK: wget: `GNU Wget 1.21.2 built on linux-gnu.`                                                                                                                                               - OK: python3: `Python 3.10.2`                                                                                                                                                                  \r\n- OK: node: `v17.2.0`                                                                                                                                                                           \r\n- OK: Ruby: `ruby 3.0.3p157 (2021-11-24 revision 3fb7d2cadc) [x86_64-linux]`                                                                                                                    \r\n- OK: Go: `go version go1.17.6 linux/amd64`                                                                                                                                                     \r\n- OK: sh: `Ok`                                                                                                                                                                                  \r\n- OK: bash: `GNU bash, version 5.1.16(1)-release (x86_64-unknown-linux-gnu)`                                                                                                                    \r\n- OK: PHP: `PHP 7.4.27 (cli) (built: Jan 16 2022 20:13:08) ( NTS )`                                                                                                                             \r\n- OK: Composer: `Composer version 2.2.4 2022-01-08 12:30:42`                                                                                                                                    \r\n- OK: julia: `julia version 1.6.1`                                                                                                                                                              \r\n- OK: java: `Ok`                                                                                                                                                                                \r\n- OK: RubyGem: `3.2.32`                                                                                                                                                                         \r\n- OK: npm: `8.3.0`                                                                                                                                                                              \r\n- OK: javac: `Ok`                                                                                                                                                                               \r\n- OK: pip3: `pip 22.0.3 from /usr/lib/python3.10/site-packages/pip (python 3.10)`          \n\n### Nvim-lspconfig version\n\nec7119b166b16e681f663fcbf16b7139b38172ae\n\n### Operating system and version\n\nVoid Linux\n\n### Affected language servers\n\nPureScript\n\n### Steps to reproduce\n\n1. git clone https://github.com/mkohlhaas/qqqq\r\n2. cd qqqq\r\n3. nvim src/Main.purs\r\n4. Goto definition for function 'log'\n\n### Actual behavior\n\nError Message:\r\n\r\n```\r\nOutput directory does not exist at '/home/schmidh/Gitrepos/qqqq/.spago/console/v5.0.0/output'. Ensure project is built, or check configuration of output directory and build command..                  \r\n                                                                                                                                                                                                        \r\nEnsure project is built with the same purs version as the IDE server is using                                                                                                                           \r\n                                                                                                                                                                                                        \r\nRequest Actions:                                                                                                                                                                                        \r\n1. Build project                                                                                                                                                                                        \r\nType number and <Enter> or click with the mouse (q or empty cancels):\r\n```\r\nNote: it searches for output directory.\r\n\r\nNo further code navigation with e.g. `goto definition` is possible.\r\n\r\nIn the background an additional language server is started!\r\n\r\nFor good measure the language server in `.local/share/nvim/lsp_servers/purescript/node_modules/.bin/` is started, not the one which I installed part of the project and can be started from the command line.\r\n\r\nIf I create a project without a purescript-language-server I will get an error message stating that the language server could not be started. Actually the one which comes with the plugin is started (.local/share/nvim/lsp_servers/purescript/node_modules/.bin/purescript-language-server).\r\n\r\nThe problem is that the root_dir is not correctly determined. The spago files are PureScript projects itself. So several language servers are started. This solves the problem in my case:\r\nroot_dir = util.root_pattern('output')\r\n(See also the links to my config files below in the section 'Minimal config'.)\r\n\r\nSee also: [Language Server Issue: Neovim configuration](https://github.com/nwolverson/purescript-language-server/issues/176#issuecomment-1048683976)\n\n### Expected behavior\n\nDon't start several language servers.\n\n### Minimal config\n\n```Lua\nSee my lsp config:https://github.com/mkohlhaas/Dotfiles/blob/925642a717d50ea9b6cf9116a451358e5649a4fe/nvim/.config/nvim/lua/lsp/init.lua#L37\r\n\r\nThis line solves the problem: https://github.com/mkohlhaas/Dotfiles/blob/925642a717d50ea9b6cf9116a451358e5649a4fe/nvim/.config/nvim/lua/lsp/init.lua#L52\n```\n\n\n### LSP log\n\nhttps://gist.github.com/mkohlhaas/6f7efdf602cbbae6273c815d13124946",
    "closed_at": "2023-09-07T02:12:27Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Is the summary of this issue report, that the root pattern results in multiple servers started per project, and we should make the root pattern more restrictive?",
            "created_at": "2022-02-23T15:17:52Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1048892209",
            "id": 1048892209,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC184-hNMx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1048892209/reactions"
            },
            "updated_at": "2022-02-23T15:17:52Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1048892209",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "NONE",
            "body": "The essence of the problem is that dependencies are fetched from git and stored in a directory within the project, so any local file pattern for a file indicating a project (or a traversal to the first matching ancestor) will match inside those dependencies as well as the top level. As you indicate, this means multiple servers started per project, and those ones for nested directories will have the wrong context.\r\n\r\nNot sure I can suggest the best approach starting from a given source file rather than a root directory/project initially - naively either the topmost such config file or one not nested in a path matching some ignorable pattern \r\n",
            "created_at": "2022-02-23T16:19:48Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1048958713",
            "id": 1048958713,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC184-hdb5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1048958713/reactions"
            },
            "updated_at": "2022-02-23T16:19:48Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1048958713",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2770891?v=4",
                "events_url": "https://api.github.com/users/nwolverson/events{/privacy}",
                "followers_url": "https://api.github.com/users/nwolverson/followers",
                "following_url": "https://api.github.com/users/nwolverson/following{/other_user}",
                "gists_url": "https://api.github.com/users/nwolverson/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nwolverson",
                "id": 2770891,
                "login": "nwolverson",
                "node_id": "MDQ6VXNlcjI3NzA4OTE=",
                "organizations_url": "https://api.github.com/users/nwolverson/orgs",
                "received_events_url": "https://api.github.com/users/nwolverson/received_events",
                "repos_url": "https://api.github.com/users/nwolverson/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nwolverson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nwolverson/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nwolverson"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "does this problem still exists?",
            "created_at": "2022-09-05T11:58:26Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1236907546",
            "id": 1236907546,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC185JubYa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1236907546/reactions"
            },
            "updated_at": "2022-09-05T11:58:26Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1236907546",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "@glepnir Yes. I am trying to change `root_dir` in such a way that it returns `false` when there's a parent directory called `./spago` but my Lua is failing me.",
            "created_at": "2022-11-11T12:01:20Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1311611500",
            "id": 1311611500,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC185OLZps",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1311611500/reactions"
            },
            "updated_at": "2022-11-11T12:01:20Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1311611500",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1588055?v=4",
                "events_url": "https://api.github.com/users/i-am-the-slime/events{/privacy}",
                "followers_url": "https://api.github.com/users/i-am-the-slime/followers",
                "following_url": "https://api.github.com/users/i-am-the-slime/following{/other_user}",
                "gists_url": "https://api.github.com/users/i-am-the-slime/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/i-am-the-slime",
                "id": 1588055,
                "login": "i-am-the-slime",
                "node_id": "MDQ6VXNlcjE1ODgwNTU=",
                "organizations_url": "https://api.github.com/users/i-am-the-slime/orgs",
                "received_events_url": "https://api.github.com/users/i-am-the-slime/received_events",
                "repos_url": "https://api.github.com/users/i-am-the-slime/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/i-am-the-slime/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/i-am-the-slime/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/i-am-the-slime"
            }
        },
        {
            "author_association": "NONE",
            "body": "I think this works:\r\n```\r\n              root_dir = function(path)  \r\n                local util = require('lspconfig.util')\r\n                if path:match('/.spago/') then\r\n                  return nil\r\n                end\r\n                return util.root_pattern('bower.json', 'psc-package.json', 'spago.dhall', 'flake.nix', 'shell.nix')(path);\r\n              end,\r\n```",
            "created_at": "2022-11-11T17:35:05Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1311979287",
            "id": 1311979287,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC185OMzcX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1311979287/reactions"
            },
            "updated_at": "2022-11-11T17:35:05Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1311979287",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1588055?v=4",
                "events_url": "https://api.github.com/users/i-am-the-slime/events{/privacy}",
                "followers_url": "https://api.github.com/users/i-am-the-slime/followers",
                "following_url": "https://api.github.com/users/i-am-the-slime/following{/other_user}",
                "gists_url": "https://api.github.com/users/i-am-the-slime/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/i-am-the-slime",
                "id": 1588055,
                "login": "i-am-the-slime",
                "node_id": "MDQ6VXNlcjE1ODgwNTU=",
                "organizations_url": "https://api.github.com/users/i-am-the-slime/orgs",
                "received_events_url": "https://api.github.com/users/i-am-the-slime/received_events",
                "repos_url": "https://api.github.com/users/i-am-the-slime/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/i-am-the-slime/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/i-am-the-slime/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/i-am-the-slime"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I think this works:\r\n> \r\n> ```\r\n>               root_dir = function(path)  \r\n>                 local util = require('lspconfig.util')\r\n>                 if path:match('/.spago/') then\r\n>                   return nil\r\n>                 end\r\n>                 return util.root_pattern('bower.json', 'psc-package.json', 'spago.dhall', 'flake.nix', 'shell.nix')(path);\r\n>               end,\r\n> ```\r\n\r\ndon't hardcode the path sep will be better should check iswindows. do you want to make a pr for this?",
            "created_at": "2022-11-12T00:41:26Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1312288921",
            "id": 1312288921,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC185ON_CZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1312288921/reactions"
            },
            "updated_at": "2022-11-12T00:41:48Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1312288921",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "I assumed `/` was the start of the regex. I can make a PR one day, I think.",
            "created_at": "2022-11-24T09:19:08Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736#issuecomment-1326166867",
            "id": 1326166867,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
            "node_id": "IC_kwDODTQC185PC7NT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1326166867/reactions"
            },
            "updated_at": "2022-11-24T09:19:08Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1326166867",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1588055?v=4",
                "events_url": "https://api.github.com/users/i-am-the-slime/events{/privacy}",
                "followers_url": "https://api.github.com/users/i-am-the-slime/followers",
                "following_url": "https://api.github.com/users/i-am-the-slime/following{/other_user}",
                "gists_url": "https://api.github.com/users/i-am-the-slime/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/i-am-the-slime",
                "id": 1588055,
                "login": "i-am-the-slime",
                "node_id": "MDQ6VXNlcjE1ODgwNTU=",
                "organizations_url": "https://api.github.com/users/i-am-the-slime/orgs",
                "received_events_url": "https://api.github.com/users/i-am-the-slime/received_events",
                "repos_url": "https://api.github.com/users/i-am-the-slime/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/i-am-the-slime/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/i-am-the-slime/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/i-am-the-slime"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736/comments",
    "created_at": "2022-02-23T14:58:31Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/1736",
    "id": 1148203394,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC185EcDGC",
    "number": 1736,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736/timeline",
    "title": "PureScript & Spago",
    "updated_at": "2023-09-07T02:12:27Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/1736",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/62170092?v=4",
        "events_url": "https://api.github.com/users/mkohlhaas/events{/privacy}",
        "followers_url": "https://api.github.com/users/mkohlhaas/followers",
        "following_url": "https://api.github.com/users/mkohlhaas/following{/other_user}",
        "gists_url": "https://api.github.com/users/mkohlhaas/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mkohlhaas",
        "id": 62170092,
        "login": "mkohlhaas",
        "node_id": "MDQ6VXNlcjYyMTcwMDky",
        "organizations_url": "https://api.github.com/users/mkohlhaas/orgs",
        "received_events_url": "https://api.github.com/users/mkohlhaas/received_events",
        "repos_url": "https://api.github.com/users/mkohlhaas/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mkohlhaas/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mkohlhaas/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mkohlhaas"
    }
}