{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n\nWhen writing code, lsp stops working periodically\r\nFor example, I want to import a library from cmp hints\r\nHere's an example\r\n<img width=\"1366\" alt=\"image\" src=\"https://github.com/neovim/nvim-lspconfig/assets/48452376/5a4ef18f-5f73-4d3d-85c8-1589ed335688\">\r\nEverything works as it should\r\nBut if I work with the code for a while, it stops working.\r\n<img width=\"608\" alt=\"image\" src=\"https://github.com/neovim/nvim-lspconfig/assets/48452376/d4633acb-dcf8-46e9-be51-d9a0eab4861b\">\r\nIf I run the :LspStop command and then :LspStrat, everything starts working again\r\nand :LspLog has errors\r\n```\r\n[START][2023-08-22 18:34:47] LSP logging initiated\r\n[ERROR][2023-08-22 18:34:47] ...lsp/handlers.lua:535\t\"[tsserver] Exited. Code: null. Signal: SIGABRT\"\r\n[ERROR][2023-08-22 19:28:40] ...lsp/handlers.lua:535\t\"Notification handler 'textDocument/didChange' failed with message: TS client not created. Did you forget to send the \\\"initialize\\\" request?\"\r\n[ERROR][2023-08-22 19:28:43] ...lsp/handlers.lua:535\t\"Notification handler 'textDocument/didChange' failed with message: TS client not created. Did you forget to send the \\\"initialize\\\" request?\"\r\n```\r\nTried different lsp settings but nothing helps. Although on another computer everything works as it should.\r\n\n\n### Neovim version\n\nNVIM v0.9.1\r\nBuild type: Release\r\nLuaJIT 2.1.0-beta3\r\n\n\n### Nvim-lspconfig version\n\n_No response_\n\n### Operating system and version\n\nmacOS 13.4.1\n\n### Affected language servers\n\ntsserver\n\n### Steps to reproduce\n\nHere are my configs\r\n**_lsp.lua_**\r\n```\r\nlocal capabilities = vim.lsp.protocol.make_client_capabilities()\r\ncapabilities = require(\"cmp_nvim_lsp\").default_capabilities(capabilities)\r\n-- Sntup language servers.\r\nlocal lspconfig = require(\"lspconfig\")\r\n-- lspconfig.pyright.setup {}\r\nlspconfig.tsserver.setup({})\r\nlspconfig.prismals.setup({})\r\nlspconfig.cssls.setup({capabilities = capabilities})\r\n\r\n-- lspconfig.golangci_lint_ls.setup {}\r\n\r\n-- Global mappings.\r\n-- See `:help vim.diagnostic.*` for documentation on any of the below functions\r\nvim.keymap.set(\"n\", \"<leader>lD\", vim.diagnostic.open_float)\r\nvim.keymap.set(\"n\", \"[d\", vim.diagnostic.goto_prev)\r\nvim.keymap.set(\"n\", \"]d\", vim.diagnostic.goto_next)\r\nvim.keymap.set(\"n\", \"<leader>ld\", vim.diagnostic.setloclist)\r\n\r\n-- Use LspAttach autocommand to only map the following keys\r\n-- after the language server attaches to the current buffer\r\nvim.api.nvim_create_autocmd(\"LspAttach\", {\r\n    group = vim.api.nvim_create_augroup(\"UserLspConfig\", {}),\r\n    callback = function(ev)\r\n        -- Enable completion triggered by <c-x><c-o>\r\n        vim.bo[ev.buf].omnifunc = \"v:lua.vim.lsp.omnifunc\"\r\n\r\n        local opts = {buffer = ev.buf}\r\n        vim.keymap.set(\"n\", \"gD\", vim.lsp.buf.declaration, opts)\r\n        vim.keymap.set(\"n\", \"gk\", vim.lsp.buf.hover, opts)\r\n        vim.keymap.set(\"n\", \"gs\", function()\r\n            vim.diagnostic.open_float(0, {scope = \"line\"})\r\n        end, opts)\r\n        vim.keymap.set(\"n\", \"gi\", vim.lsp.buf.implementation, opts)\r\n        vim.keymap.set(\"n\", \"<C-k>\", vim.lsp.buf.signature_help, opts)\r\n        vim.keymap.set(\"n\", \"<M-CR>\", require(\"actions-preview\").code_actions)\r\n        -- vim.keymap\r\n        --     .set('n', '<Leader>sa', vim.lsp.buf.add_workspace_folder, opts)\r\n        -- vim.keymap.set('n', '<Leader>sr', vim.lsp.buf.remove_workspace_folder,\r\n        --                opts)\r\n        -- vim.keymap.set('n', '<Leader>sl', function()\r\n        --     print(vim.inspect(vim.lsp.buf.list_workspace_folders()))\r\n        -- end, opts)\r\n        -- vim.keymap.set('n', '<Leader>D', vim.lsp.buf.type_definition, opts)\r\n        vim.keymap.set(\"n\", \"<Leader>lr\", vim.lsp.buf.rename, opts)\r\n        -- vim.keymap.set({ \"n\", \"v\" }, \"<Leader>la\", vim.lsp.buf.code_action, opts)\r\n        -- vim.keymap.set('n', 'gr', vim.lsp.buf.references, opts)\r\n        vim.keymap.set(\"n\", \"<Leader>lf\",\r\n                       function() vim.lsp.buf.format({async = true}) end, opts)\r\n        vim.keymap.set(\"n\", \"<leader>li\", function()\r\n            local params = {\r\n                command = \"_typescript.organizeImports\",\r\n                arguments = {vim.api.nvim_buf_get_name(0)},\r\n                title = \"\"\r\n            }\r\n            vim.lsp.buf.execute_command(params)\r\n        end, opts)\r\n    end\r\n})\r\n```\r\n**_cmp.lua_**\r\n\r\n```\r\nlocal cmp = require 'cmp'\r\n\r\ncmp.setup({\r\n    snippet = {\r\n        -- REQUIRED - you must specify a snippet engine\r\n        expand = function(args)\r\n            vim.fn[\"vsnip#anonymous\"](args.body) -- For `vsnip` users.\r\n            -- require('luasnip').lsp_expand(args.body) -- For `luasnip` users.\r\n            -- require('snippy').expand_snippet(args.body) -- For `snippy` users.\r\n            -- vim.fn[\"UltiSnips#Anon\"](args.body) -- For `ultisnips` users.\r\n        end\r\n    },\r\n    window = {\r\n        completion = cmp.config.window.bordered(),\r\n        documentation = cmp.config.window.bordered()\r\n    },\r\n    mapping = cmp.mapping.preset.insert({\r\n        ['<C-b>'] = cmp.mapping.scroll_docs(-4),\r\n        ['<C-f>'] = cmp.mapping.scroll_docs(4),\r\n        ['<C-Space>'] = cmp.mapping.complete(),\r\n        ['<C-e>'] = cmp.mapping.abort(),\r\n        ['<CR>'] = cmp.mapping.confirm({select = true}),\r\n        [\"<Tab>\"] = cmp.mapping(function(fallback)\r\n            if cmp.visible() then\r\n                cmp.select_next_item()\r\n            else\r\n                fallback()\r\n            end\r\n        end, {\"i\", \"s\"}),\r\n        [\"<S-Tab>\"] = cmp.mapping(function(fallback)\r\n            if cmp.visible() then\r\n                cmp.select_prev_item()\r\n            else\r\n                fallback()\r\n            end\r\n        end, {\"i\", \"s\"})\r\n    }),\r\n    sources = cmp.config.sources({\r\n        {name = 'nvim_lsp'}, {name = 'vsnip'} -- For vsnip users.\r\n    }, {{name = 'buffer'}, {name = 'nvim_lsp_signature_help'}})\r\n})\r\n\r\n-- Set configuration for specific filetype.\r\ncmp.setup.filetype('gitcommit', {\r\n    sources = cmp.config.sources({\r\n        {name = 'cmp_git'} -- You can specify the `cmp_git` source if you were installed it.\r\n    }, {{name = 'buffer'}})\r\n})\r\n\r\n-- Use buffer source for `/` and `?` (if you enabled `native_menu`, this won't work anymore).\r\ncmp.setup.cmdline({'/', '?'}, {\r\n    mapping = cmp.mapping.preset.cmdline(),\r\n    sources = {{name = 'buffer'}}\r\n})\r\n\r\n-- Use cmdline & path source for ':' (if you enabled `native_menu`, this won't work anymore).\r\ncmp.setup.cmdline(':', {\r\n    mapping = cmp.mapping.preset.cmdline(),\r\n    sources = cmp.config.sources({{name = 'path'}}, {{name = 'cmdline'}})\r\n})\r\n\r\n-- Set up lspconfig.\r\nlocal capabilities = require('cmp_nvim_lsp').default_capabilities()\r\nrequire('lspconfig')['tsserver'].setup {capabilities = capabilities}\r\n\r\n```\n\n### Actual behavior\n\nThe lsp server drops all the time\n\n### Expected behavior\n\n_No response_\n\n### Minimal config\n\n```Lua\nI tried different configs and came to the conclusion that it doesn't depend on the config\n```\n\n\n### LSP log\n\nhttps://gist.github.com/mr-scrpt/1f780d2cf365a3e51ae1bd928bdad365#file-lsp-log",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I can't reproduce and please try the min config that we provide ",
            "created_at": "2023-08-23T05:58:35Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2777#issuecomment-1689326518",
            "id": 1689326518,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777",
            "node_id": "IC_kwDODTQC185ksRO2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689326518/reactions"
            },
            "updated_at": "2023-08-23T05:58:35Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689326518",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I can't reproduce and please try the min config that we provide\r\n\r\nThank you for your response. You will not be helped by my config, I tried it on two other devices and everything works there without any problems. I just can't understand what exactly is breaking, I'm not good with vim and don't know how to properly debug the whole process to find the cause of this behavior. Perhaps you could suggest how to debug properly to localize the problem? \r\nI think it's about third-party packages - maybe node.js or something else.",
            "created_at": "2023-08-23T06:38:50Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2777#issuecomment-1689366796",
            "id": 1689366796,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777",
            "node_id": "IC_kwDODTQC185ksbEM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689366796/reactions"
            },
            "updated_at": "2023-08-23T06:38:50Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689366796",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48452376?v=4",
                "events_url": "https://api.github.com/users/mr-scrpt/events{/privacy}",
                "followers_url": "https://api.github.com/users/mr-scrpt/followers",
                "following_url": "https://api.github.com/users/mr-scrpt/following{/other_user}",
                "gists_url": "https://api.github.com/users/mr-scrpt/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mr-scrpt",
                "id": 48452376,
                "login": "mr-scrpt",
                "node_id": "MDQ6VXNlcjQ4NDUyMzc2",
                "organizations_url": "https://api.github.com/users/mr-scrpt/orgs",
                "received_events_url": "https://api.github.com/users/mr-scrpt/received_events",
                "repos_url": "https://api.github.com/users/mr-scrpt/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mr-scrpt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mr-scrpt/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mr-scrpt"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I can't reproduce and please try the min config that we provide\r\n\r\nHere I have built a config from scratch and it is showing this problem\r\nhttps://github.com/mr-scrpt/dotfile_mac/tree/minimal_conf/nvim\r\nAlso I checked the project in vscode on which the problem is observed and in vscode everything works fine. So I conclude that it is still on the side of vim and its plugins",
            "created_at": "2023-08-23T07:57:44Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2777#issuecomment-1689472129",
            "id": 1689472129,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777",
            "node_id": "IC_kwDODTQC185ks0yB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689472129/reactions"
            },
            "updated_at": "2023-08-23T07:57:44Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689472129",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48452376?v=4",
                "events_url": "https://api.github.com/users/mr-scrpt/events{/privacy}",
                "followers_url": "https://api.github.com/users/mr-scrpt/followers",
                "following_url": "https://api.github.com/users/mr-scrpt/following{/other_user}",
                "gists_url": "https://api.github.com/users/mr-scrpt/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mr-scrpt",
                "id": 48452376,
                "login": "mr-scrpt",
                "node_id": "MDQ6VXNlcjQ4NDUyMzc2",
                "organizations_url": "https://api.github.com/users/mr-scrpt/orgs",
                "received_events_url": "https://api.github.com/users/mr-scrpt/received_events",
                "repos_url": "https://api.github.com/users/mr-scrpt/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mr-scrpt/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mr-scrpt/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mr-scrpt"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "there has min config https://github.com/neovim/nvim-lspconfig/blob/master/test/minimal_init.lua",
            "created_at": "2023-08-23T08:13:14Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2777#issuecomment-1689493886",
            "id": 1689493886,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777",
            "node_id": "IC_kwDODTQC185ks6F-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689493886/reactions"
            },
            "updated_at": "2023-08-23T08:13:14Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1689493886",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777/comments",
    "created_at": "2023-08-22T17:09:20Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2777",
    "id": 1861875601,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC185u-feR",
    "number": 2777,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777/timeline",
    "title": "LSP Stop working",
    "updated_at": "2023-08-23T08:13:15Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2777",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/48452376?v=4",
        "events_url": "https://api.github.com/users/mr-scrpt/events{/privacy}",
        "followers_url": "https://api.github.com/users/mr-scrpt/followers",
        "following_url": "https://api.github.com/users/mr-scrpt/following{/other_user}",
        "gists_url": "https://api.github.com/users/mr-scrpt/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mr-scrpt",
        "id": 48452376,
        "login": "mr-scrpt",
        "node_id": "MDQ6VXNlcjQ4NDUyMzc2",
        "organizations_url": "https://api.github.com/users/mr-scrpt/orgs",
        "received_events_url": "https://api.github.com/users/mr-scrpt/received_events",
        "repos_url": "https://api.github.com/users/mr-scrpt/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mr-scrpt/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mr-scrpt/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mr-scrpt"
    }
}