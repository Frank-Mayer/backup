{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\r\n\r\nAccording to details shared on https://github.com/clangd/vscode-clangd/issues/393#issuecomment-1279843259, the expectation is that I can specify the `g++` path within `CompileFlags::Compiler`. \r\nThis enables the use of header files from `gcc` while leveraging `clangd` as my language server. \r\nRegrettably, this capability does not seem to function when `clangd` is called by `neovim`.\r\n\r\n### Neovim version\r\n\r\nNVIM v0.9.4-dev-d772f69\r\nBuild type: Release\r\nLuaJIT 2.1.0-beta3\r\n\r\n\r\n### Nvim-lspconfig version\r\n\r\n37457f268af5cd6765e589b0dcd7cbd192d8da00\r\n\r\n### Operating system and version\r\n\r\nlinux\r\n\r\n### Affected language servers\r\n\r\nclangd\r\n\r\n### Steps to reproduce\r\n\r\n1. `echo \"#include <bits/stdc++.h>\" > tmp.cpp`\r\n2. `echo \"CompileFlags:\\n  Compiler: /nix/store/3hbxw05vfs6m1155xa6pvribs3bv777n-gcc-wrapper-12.2.0/bin/g++\" > .clangd`\r\n3. `nvim -nu minimal_init.lua tmp.cpp`\r\n\r\n\r\n### Actual behavior\r\n\r\nDisplaying an LSP diagnostic for the error `■ 'bits/stdc++.h' file not found`.\r\n\r\n### Expected behavior\r\n\r\nNo errors should be present.\r\nThe expected result is comparable to the following:\r\n\r\n```\r\nclangd --check=tmp.cpp --query-driver=\"/nix/store/*gcc-wrapper*/bin/g++\"\r\n```\r\nThis command should run without any errors.\r\n\r\n```\r\n❯ clangd --check=tmp.cpp --query-driver=\"/nix/store/*gcc-wrapper*/bin/g++\"\r\nI[20:07:16.149] clangd version 16.0.6\r\nI[20:07:16.149] Features: linux\r\nI[20:07:16.149] PID: 303694\r\nI[20:07:16.149] Working directory: /home/william/issue/clangd\r\nI[20:07:16.149] argv[0]: clangd\r\nI[20:07:16.149] argv[1]: --check=tmp.cpp\r\nI[20:07:16.149] argv[2]: --query-driver=/nix/store/*gcc-wrapper*/bin/g++\r\nI[20:07:16.149] Entering check mode (no LSP server)\r\nI[20:07:16.149] Testing on source file /home/william/issue/clangd/tmp.cpp\r\nI[20:07:16.150] Loading compilation database...\r\nI[20:07:16.151] Failed to find compilation database for /home/william/issue/clangd/tmp.cpp\r\nI[20:07:16.172] System includes extractor: successfully executed /nix/store/3hbxw05vfs6m1155xa6pvribs3bv777n-gcc-wrapper-12.2.0/bin/g++\r\n        got includes: \"/nix/store/c89rn6faf7ikz2ify50nxiibq3mhny7v-compiler-rt-libc-16.0.6-dev/include, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/x86_64-unknown-linux-gnu, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/backward, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/include, /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include-fixed, /nix/store/linb70pgp53f0kygxm5wk163dx22d681-glibc-2.37-45-dev/include\"\r\n        got target: \"x86_64-unknown-linux-gnu\"\r\nI[20:07:16.172] Generic fallback command is: /nix/store/3hbxw05vfs6m1155xa6pvribs3bv777n-gcc-wrapper-12.2.0/bin/g++ -isystem /nix/store/c89rn6faf7ikz2ify50nxiibq3mhny7v-compiler-rt-libc-16.0.6-dev/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0 -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/x86_64-unknown-linux-gnu -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/backward -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include-fixed -isystem /nix/store/linb70pgp53f0kygxm5wk163dx22d681-glibc-2.37-45-dev/include --target=x86_64-unknown-linux-gnu -resource-dir=/nix/store/lg5brzwm3qljk1panwf08crqjycimb2f-clang-16.0.6/lib/clang/16 -- /home/william/issue/clangd/tmp.cpp\r\nI[20:07:16.172] Parsing command...\r\nI[20:07:16.174] internal (cc1) args are: -cc1 -triple x86_64-unknown-linux-gnu -fsyntax-only -disable-free -clear-ast-before-backend -disable-llvm-verifier -discard-value-names -main-file-name tmp.cpp -mrelocation-model pic -pic-level 2 -pic-is-pie -mframe-pointer=all -fmath-errno -ffp-contract=on -fno-rounding-math -mconstructor-aliases -funwind-tables=2 -target-cpu x86-64 -tune-cpu generic -mllvm -treat-scalable-fixed-error-as-warning -debugger-tuning=gdb -fcoverage-compilation-dir=/home/william/issue/clangd -nostdsysteminc -resource-dir /nix/store/lg5brzwm3qljk1panwf08crqjycimb2f-clang-16.0.6/lib/clang/16 -isystem /nix/store/c89rn6faf7ikz2ify50nxiibq3mhny7v-compiler-rt-libc-16.0.6-dev/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0 -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/x86_64-unknown-linux-gnu -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/../../../../include/c++/12.2.0/backward -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/include -isystem /nix/store/jgdz5wfqc6q6qhy17lsqnfpbkfi1fcar-gcc-12.2.0/lib/gcc/x86_64-unknown-linux-gnu/12.2.0/include-fixed -isystem /nix/store/linb70pgp53f0kygxm5wk163dx22d681-glibc-2.37-45-dev/include -internal-isystem /nix/store/lg5brzwm3qljk1panwf08crqjycimb2f-clang-16.0.6/lib/clang/16/include -source-date-epoch 315532800 -fdeprecated-macro -fdebug-compilation-dir=/home/william/issue/clangd -ferror-limit 19 -fgnuc-version=4.2.1 -fcxx-exceptions -fexceptions -no-round-trip-args -faddrsig -D__GCC_HAVE_DWARF2_CFI_ASM=1 -x c++ /home/william/issue/clangd/tmp.cpp\r\nI[20:07:16.174] Building preamble...\r\nI[20:07:17.450] Indexing headers...\r\nI[20:07:17.753] Built preamble of size 13216844 for file /home/william/issue/clangd/tmp.cpp version null in 1.58 seconds\r\nI[20:07:17.754] Building AST...\r\nI[20:07:17.764] Indexing AST...\r\nI[20:07:17.764] Building inlay hints\r\nI[20:07:17.764] Building semantic highlighting\r\nI[20:07:17.764] Testing features at each token (may be slow in large files)\r\nI[20:07:17.764] All checks completed, 0 errors\r\n```\r\n\r\n### Minimal config\r\n\r\n```Lua\r\nlocal on_windows = vim.loop.os_uname().version:match 'Windows'\r\n\r\nlocal function join_paths(...)\r\n  local path_sep = on_windows and '\\\\' or '/'\r\n  local result = table.concat({ ... }, path_sep)\r\n  return result\r\nend\r\n\r\nvim.cmd [[set runtimepath=$VIMRUNTIME]]\r\n\r\nlocal temp_dir = vim.loop.os_getenv 'TEMP' or '/tmp'\r\n\r\nvim.cmd('set packpath=' .. join_paths(temp_dir, 'nvim', 'site'))\r\n\r\nlocal package_root = join_paths(temp_dir, 'nvim', 'site', 'pack')\r\nlocal lspconfig_path = join_paths(package_root, 'test', 'start', 'nvim-lspconfig')\r\n\r\nif vim.fn.isdirectory(lspconfig_path) ~= 1 then\r\n  vim.fn.system { 'git', 'clone', 'https://github.com/neovim/nvim-lspconfig', lspconfig_path }\r\nend\r\n\r\nvim.lsp.set_log_level 'trace'\r\nrequire('vim.lsp.log').set_format_func(vim.inspect)\r\nlocal nvim_lsp = require 'lspconfig'\r\nlocal on_attach = function(_, bufnr)\r\n  local function buf_set_option(...)\r\n    vim.api.nvim_buf_set_option(bufnr, ...)\r\n  end\r\n\r\n  buf_set_option('omnifunc', 'v:lua.vim.lsp.omnifunc')\r\n\r\n  -- Mappings.\r\n  local opts = { buffer = bufnr, noremap = true, silent = true }\r\n  vim.keymap.set('n', 'gD', vim.lsp.buf.declaration, opts)\r\n  vim.keymap.set('n', 'gd', vim.lsp.buf.definition, opts)\r\n  vim.keymap.set('n', 'K', vim.lsp.buf.hover, opts)\r\n  vim.keymap.set('n', 'gi', vim.lsp.buf.implementation, opts)\r\n  vim.keymap.set('n', '<C-k>', vim.lsp.buf.signature_help, opts)\r\n  vim.keymap.set('n', '<space>wa', vim.lsp.buf.add_workspace_folder, opts)\r\n  vim.keymap.set('n', '<space>wr', vim.lsp.buf.remove_workspace_folder, opts)\r\n  vim.keymap.set('n', '<space>wl', function()\r\n    print(vim.inspect(vim.lsp.buf.list_workspace_folders()))\r\n  end, opts)\r\n  vim.keymap.set('n', '<space>D', vim.lsp.buf.type_definition, opts)\r\n  vim.keymap.set('n', '<space>rn', vim.lsp.buf.rename, opts)\r\n  vim.keymap.set('n', 'gr', vim.lsp.buf.references, opts)\r\n  vim.keymap.set('n', '<space>e', vim.diagnostic.open_float, opts)\r\n  vim.keymap.set('n', '[d', vim.diagnostic.goto_prev, opts)\r\n  vim.keymap.set('n', ']d', vim.diagnostic.goto_next, opts)\r\n  vim.keymap.set('n', '<space>q', vim.diagnostic.setloclist, opts)\r\nend\r\n\r\n-- Add the server that troubles you here\r\nlocal name = 'clangd'\r\nlocal cmd = { name, '--query-driver=\"/nix/store/*gcc-wrapper*/bin/g++\"' } -- needed for elixirls, lua_ls, omnisharp\r\nif not name then\r\n  print 'You have not defined a server name, please edit minimal_init.lua'\r\nend\r\nif not nvim_lsp[name].document_config.default_config.cmd and not cmd then\r\n  print [[You have not defined a server default cmd for a server\r\n    that requires it please edit minimal_init.lua]]\r\nend\r\n\r\nnvim_lsp[name].setup {\r\n  cmd = cmd,\r\n  on_attach = on_attach,\r\n}\r\n\r\nprint [[You can find your log at $HOME/.cache/nvim/lsp.log. Please paste in a github issue under a details tag as described in the issue template.]]\r\n```\r\n\r\n\r\n### LSP log\r\n\r\nhttps://gist.github.com/WilliamHsieh/74703a2e9bd88194801514786124023a",
    "closed_at": "2023-12-13T02:34:33Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Turns out I don't need an extra double quote in `query-driver`.",
            "created_at": "2023-12-13T02:34:33Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2928#issuecomment-1853173101",
            "id": 1853173101,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928",
            "node_id": "IC_kwDODTQC185udS1t",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1853173101/reactions"
            },
            "updated_at": "2023-12-13T02:34:33Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/1853173101",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/23206205?v=4",
                "events_url": "https://api.github.com/users/WilliamHsieh/events{/privacy}",
                "followers_url": "https://api.github.com/users/WilliamHsieh/followers",
                "following_url": "https://api.github.com/users/WilliamHsieh/following{/other_user}",
                "gists_url": "https://api.github.com/users/WilliamHsieh/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/WilliamHsieh",
                "id": 23206205,
                "login": "WilliamHsieh",
                "node_id": "MDQ6VXNlcjIzMjA2MjA1",
                "organizations_url": "https://api.github.com/users/WilliamHsieh/orgs",
                "received_events_url": "https://api.github.com/users/WilliamHsieh/received_events",
                "repos_url": "https://api.github.com/users/WilliamHsieh/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/WilliamHsieh/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/WilliamHsieh/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/WilliamHsieh"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928/comments",
    "created_at": "2023-12-12T12:12:24Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2928",
    "id": 2037624767,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC1855c6-_",
    "number": 2928,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928/timeline",
    "title": "clangd within neovim is not finding include files correctly",
    "updated_at": "2023-12-13T02:34:33Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2928",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/23206205?v=4",
        "events_url": "https://api.github.com/users/WilliamHsieh/events{/privacy}",
        "followers_url": "https://api.github.com/users/WilliamHsieh/followers",
        "following_url": "https://api.github.com/users/WilliamHsieh/following{/other_user}",
        "gists_url": "https://api.github.com/users/WilliamHsieh/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/WilliamHsieh",
        "id": 23206205,
        "login": "WilliamHsieh",
        "node_id": "MDQ6VXNlcjIzMjA2MjA1",
        "organizations_url": "https://api.github.com/users/WilliamHsieh/orgs",
        "received_events_url": "https://api.github.com/users/WilliamHsieh/received_events",
        "repos_url": "https://api.github.com/users/WilliamHsieh/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/WilliamHsieh/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/WilliamHsieh/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/WilliamHsieh"
    }
}