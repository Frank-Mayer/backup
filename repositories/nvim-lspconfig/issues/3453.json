{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\n\nHi there,\n\nMy bashls wasn't running, so I ran `:LspInfo` inside of Neovim with a shell file open, and got this back as part of the info:\n\n```\nversion:           `?` (Failed to get version) Tried:\n  `â€¦/mason/bin/bash-language-server --version`\n  `â€¦/mason/bin/bash-language-server -version`\n  `â€¦/mason/bin/bash-language-server version`\n  `â€¦/mason/bin/bash-language-server --help`\n```\n\nI found it's because the recipient is reading STDERR output too, and if there's anything coming through on STDERR then it chokes:\n\n```\n$ ./mason/bin/bash-language-server --version\n5.4.2\n(node:51440) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.\n(Use `node --trace-deprecation ...` to show where the warning was created)\n```\n\n[This line](https://github.com/neovim/nvim-lspconfig/blob/dafd61d6533bd90ecf6e2a3a972298fdddc74d82/lua/lspconfig/configs/bashls.lua#L5) is where the server is started:\n\nI replaced:\n\n`    cmd = { 'bash-language-server', 'start' },`\n\nwith:\n\n`    cmd = { 'sh', '-c', 'bash-language-server start 2>/dev/null' },`\n\nand it's fixed.\n\nI'd put in a pull request but this is just a workaround and it'd probably be better if STDERR wasn't read (or was handled),  but I've no idea about this codebase and any further effects this may have, so this is an FYI.\n\nRegards,\niain\n",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "COLLABORATOR",
            "body": "This seems like a pretty safe change to me. To my knowledge, no command-line tool should output the version to stderr. It just doesn't make sense.\n\n```diff\ndiff --git a/lua/lspconfig/health.lua b/lua/lspconfig/health.lua\nindex 5f40b1a..826d530 100644\n--- a/lua/lspconfig/health.lua\n+++ b/lua/lspconfig/health.lua\n@@ -48,9 +48,7 @@ local function try_get_cmd_output(cmd)\n   local chanid = vim.fn.jobstart(cmd, {\n     -- cwd = ?,\n     stdout_buffered = true,\n-    stderr_buffered = true,\n     on_stdout = on_data,\n-    on_stderr = on_data,\n   })\n   local rv = vim.fn.jobwait({ chanid }, 300)\n   vim.fn.jobstop(chanid)\n```",
            "created_at": "2024-11-25T09:51:56Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3453#issuecomment-2497458812",
            "id": 2497458812,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453",
            "node_id": "IC_kwDODTQC186U3DJ8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497458812/reactions"
            },
            "updated_at": "2024-11-25T09:51:56Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497458812",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/177685?v=4",
                "events_url": "https://api.github.com/users/lithammer/events{/privacy}",
                "followers_url": "https://api.github.com/users/lithammer/followers",
                "following_url": "https://api.github.com/users/lithammer/following{/other_user}",
                "gists_url": "https://api.github.com/users/lithammer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lithammer",
                "id": 177685,
                "login": "lithammer",
                "node_id": "MDQ6VXNlcjE3NzY4NQ==",
                "organizations_url": "https://api.github.com/users/lithammer/orgs",
                "received_events_url": "https://api.github.com/users/lithammer/received_events",
                "repos_url": "https://api.github.com/users/lithammer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lithammer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lithammer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lithammer",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> This seems like a pretty safe change to me. To my knowledge, no command-line tool should output the version to stderr.\n\nCapture stderr is mostly to have something to show on failure. It shouldn't cause the logic to fail. If `5.4.2` is printed, this logic should see it and treat it as \"success\": https://github.com/neovim/nvim-lspconfig/blob/dafd61d6533bd90ecf6e2a3a972298fdddc74d82/lua/lspconfig/health.lua#L75-L78\n\nCan someone using bash-language-server troubleshoot that logic and find out why it's not captured `5.4.2` ?",
            "created_at": "2024-11-25T11:47:53Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3453#issuecomment-2497793321",
            "id": 2497793321,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453",
            "node_id": "IC_kwDODTQC186U4U0p",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497793321/reactions"
            },
            "updated_at": "2024-11-25T11:47:53Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497793321",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "Hmm, it seems to work just fine for me ðŸ¤” Maybe related to a specific version of Neovim?\n\n```console\n$ nvim --version\nNVIM v0.11.0-dev-1228+g9e7b0bcf51-Homebrew\nBuild type: Release\nLuaJIT 2.1.1731601260\nRun \"nvim -V1 -v\" for more info\n```\n\n```console\n$ bash-language-server --version\n5.4.2\n(node:97079) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.\n(Use `node --trace-deprecation ...` to show where the warning was created)\n```\n\n(copied the relevant code to its own script)\n\n```console\n$ cat bug.lua\nlocal function try_get_cmd_output(cmd)\n  local out = nil\n  local function on_data(_, data, _)\n    out = (out or '') .. table.concat(data, '\\n')\n  end\n  local chanid = vim.fn.jobstart(cmd, {\n    -- cwd = ?,\n    stdout_buffered = true,\n    stderr_buffered = true,\n    on_stdout = on_data,\n    on_stderr = on_data,\n  })\n  local rv = vim.fn.jobwait({ chanid }, 300)\n  vim.fn.jobstop(chanid)\n  return rv[1] == 0 and out or nil\nend\n\nlocal function try_fmt_version(prog)\n  local all = nil --- Collected output from all attempts.\n  local tried = '' --- Attempted commands.\n  for _, v_arg in ipairs { '--version', '-version', 'version', '--help' } do\n    local cmd = { prog, v_arg }\n    local out = try_get_cmd_output(cmd)\n    all = out and ('%s\\n%s'):format(all or '', out) or all\n    local v_line = out and out:match('[^\\r\\n]*%d+%.[0-9.]+[^\\r\\n]*') or nil\n    if v_line then\n      return ('`%s`'):format(vim.trim(v_line))\n    end\n    tried = tried .. ('`%s %s`\\n'):format(prog, v_arg)\n  end\n\n  all = all and vim.trim(all:sub(1, 80):gsub('[\\r\\n]', ' ')) .. 'â€¦' or '?'\n  return ('`%s` (Failed to get version) Tried:\\n%s'):format(all, tried)\nend\n\nprint(try_fmt_version('bash-language-server'))\n```\n\n```console\n$ nvim -l bug.lua\n`5.4.2`\n```",
            "created_at": "2024-11-25T12:45:21Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3453#issuecomment-2497926004",
            "id": 2497926004,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453",
            "node_id": "IC_kwDODTQC186U41N0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497926004/reactions"
            },
            "updated_at": "2024-11-25T13:02:53Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2497926004",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/177685?v=4",
                "events_url": "https://api.github.com/users/lithammer/events{/privacy}",
                "followers_url": "https://api.github.com/users/lithammer/followers",
                "following_url": "https://api.github.com/users/lithammer/following{/other_user}",
                "gists_url": "https://api.github.com/users/lithammer/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lithammer",
                "id": 177685,
                "login": "lithammer",
                "node_id": "MDQ6VXNlcjE3NzY4NQ==",
                "organizations_url": "https://api.github.com/users/lithammer/orgs",
                "received_events_url": "https://api.github.com/users/lithammer/received_events",
                "repos_url": "https://api.github.com/users/lithammer/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lithammer/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lithammer/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lithammer",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@yb66 what `nvim -v` are you using? And can you try the above script",
            "created_at": "2024-11-25T13:57:08Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3453#issuecomment-2498092105",
            "id": 2498092105,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453",
            "node_id": "IC_kwDODTQC186U5dxJ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2498092105/reactions"
            },
            "updated_at": "2024-11-25T13:57:08Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2498092105",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453/comments",
    "created_at": "2024-11-25T08:25:16Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3453",
    "id": 2689728306,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC186gUf8y",
    "number": 3453,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453/timeline",
    "title": "LspInfo: \"Failed to get version\" with bash-language-server",
    "updated_at": "2024-11-25T13:57:09Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3453",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/326444?v=4",
        "events_url": "https://api.github.com/users/yb66/events{/privacy}",
        "followers_url": "https://api.github.com/users/yb66/followers",
        "following_url": "https://api.github.com/users/yb66/following{/other_user}",
        "gists_url": "https://api.github.com/users/yb66/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/yb66",
        "id": 326444,
        "login": "yb66",
        "node_id": "MDQ6VXNlcjMyNjQ0NA==",
        "organizations_url": "https://api.github.com/users/yb66/orgs",
        "received_events_url": "https://api.github.com/users/yb66/received_events",
        "repos_url": "https://api.github.com/users/yb66/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/yb66/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yb66/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/yb66",
        "user_view_type": "public"
    }
}