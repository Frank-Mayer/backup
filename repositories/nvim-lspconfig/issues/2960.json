{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Language server\r\n\r\n_No response_\r\n\r\n### Requested feature\r\n\r\nConsider a project with the following structure:\r\n\r\n```\r\n.\r\n├── bar\r\n│   ├── bar.py\r\n│   └── pyproject.toml\r\n├── foo\r\n│   ├── foo.py\r\n│   └── pyproject.toml\r\n├── pyproject.toml\r\n└── root.py\r\n```\r\n\r\nEach pyproject.toml represents a different virtual environment, with different packages, and the `[tool.pyright]` section correctly reflects that as well. Pyright works with this pattern, since it has multiple workspace support. \r\n\r\nHowever, depending on the order that the files are opened up, the workspace may not be set up correctly. If I open up `root.py`, then `foo/foo.py` in a different buffer, `foo/foo.py` will be in the root workspace. \r\n\r\nIf you reverse the order, and open up `foo/foo.py` first, *then* open up `root.py`, they will both be in their own, appropriate workplaces. Similarly, if I was to open up `foo/foo.py` followed by `bar/bar.py`, the workspaces will be configured correctly as well. I believe the issue is around the following function, in `lspconfig/manager.lua`:\r\n\r\n```lua\r\nfunction M:_attach_or_spawn(bufnr, new_config, root_dir, client, single_file)\r\n  if check_in_workspace(client, root_dir) then\r\n    return self:_attach_and_cache(bufnr, root_dir, client.id)\r\n  end\r\n\r\n  local supported = vim.tbl_get(client, 'server_capabilities', 'workspace', 'workspaceFolders', 'supported')\r\n  if supported then\r\n    return self:_register_workspace_folders(bufnr, root_dir, client)\r\n  end\r\n  self:_start_new_client(bufnr, new_config, root_dir, single_file)\r\nend\r\n```\r\n\r\nIn the above example, `check_in_workspace` it would see that the root_dir `foo/` is in the workspace for `.`, so it would not create a new workspace. The code seems to be pretty intentionally written to behave this well as well, so I don't think it's necessarily a bug. Maybe for other language servers / project structures this behavior is desirable? That said, changing the behavior based on the order files are opened is definitely strange.\r\n\r\nIt would be great if there was some kind of callback that could configure this behavior. The root directory is correct, so even a way force each root directory to be their own workspace would work well in this case. \r\n\r\n### Other clients which have this feature\r\n\r\n_No response_",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960/comments",
    "created_at": "2024-01-09T02:44:06Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/2960",
    "id": 2071530259,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "New feature or request",
            "id": 1674892767,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzY3",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC1857eQsT",
    "number": 2960,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960/timeline",
    "title": "Add better support for nested projects / workspaces",
    "updated_at": "2024-01-09T03:16:48Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/2960",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11918820?v=4",
        "events_url": "https://api.github.com/users/ryanmeans/events{/privacy}",
        "followers_url": "https://api.github.com/users/ryanmeans/followers",
        "following_url": "https://api.github.com/users/ryanmeans/following{/other_user}",
        "gists_url": "https://api.github.com/users/ryanmeans/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ryanmeans",
        "id": 11918820,
        "login": "ryanmeans",
        "node_id": "MDQ6VXNlcjExOTE4ODIw",
        "organizations_url": "https://api.github.com/users/ryanmeans/orgs",
        "received_events_url": "https://api.github.com/users/ryanmeans/received_events",
        "repos_url": "https://api.github.com/users/ryanmeans/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ryanmeans/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ryanmeans/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ryanmeans"
    }
}