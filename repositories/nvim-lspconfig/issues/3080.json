{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Description\r\n\r\nIt seems that for some reason after this change it is required for a server to have single file support, otherwise it would short circuit and simply spawn new clients. Which imo, is a regression, i have no idea why single_file_support matters in this case.\r\n\r\n```\r\nfunction M:add(root_dir, single_file, bufnr)\r\n  root_dir = util.path.sanitize(root_dir)\r\n  local new_config = self.make_config(root_dir)\r\n  local client = get_client(self._clients, root_dir, new_config.name)\r\n\r\n  ---If single_file_mode is false then root_dir should match client otherwise start a new client\r\n  --- this regression here would simply keep spawning new clients even though they might support multi ws.\r\n  --- why does not having single file support imply forcibly spawning new instances ?\r\n  if not client or (not single_file and client.config.root_dir and client.config.root_dir ~= root_dir) then\r\n    return self:_start_new_client(bufnr, new_config, root_dir, single_file)\r\n  end\r\n\r\n  if self._clients[root_dir] or single_file then\r\n    lsp.buf_attach_client(bufnr, client.id)\r\n    return\r\n  end\r\n\r\n  -- make sure neovim had exchanged capabilities from language server\r\n  -- it's useful to check server support workspaceFolders or not\r\n  -- this is where the multi workspace support code branches off\r\n  if client.initialized and client.server_capabilities then\r\n    self:_attach_or_spawn(bufnr, new_config, root_dir, client, single_file)\r\n  else\r\n    self:_attach_after_client_initialized(bufnr, new_config, root_dir, client, single_file)\r\n  end\r\nend\r\n\r\n```\r\n\r\n@serranomorante ?",
    "closed_at": "2024-03-24T05:39:14Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "0a1a2aa5\r\n\r\n@serranomorante can you explain whether this is expected",
            "created_at": "2024-03-18T14:17:42Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080#issuecomment-2004043608",
            "id": 2004043608,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
            "node_id": "IC_kwDODTQC1853c0dY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004043608/reactions"
            },
            "updated_at": "2024-03-18T14:17:42Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004043608",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Forgot to mention this method is called several times from other places where explicit false is passed in for singe file support param. This means that even if you have it enabled in the lanf server config and set to true, this does not change the behavior of this method.",
            "created_at": "2024-03-18T14:22:54Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080#issuecomment-2004055794",
            "id": 2004055794,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
            "node_id": "IC_kwDODTQC1853c3by",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004055794/reactions"
            },
            "updated_at": "2024-03-18T14:22:54Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004055794",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15955811?v=4",
                "events_url": "https://api.github.com/users/asmodeus812/events{/privacy}",
                "followers_url": "https://api.github.com/users/asmodeus812/followers",
                "following_url": "https://api.github.com/users/asmodeus812/following{/other_user}",
                "gists_url": "https://api.github.com/users/asmodeus812/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/asmodeus812",
                "id": 15955811,
                "login": "asmodeus812",
                "node_id": "MDQ6VXNlcjE1OTU1ODEx",
                "organizations_url": "https://api.github.com/users/asmodeus812/orgs",
                "received_events_url": "https://api.github.com/users/asmodeus812/received_events",
                "repos_url": "https://api.github.com/users/asmodeus812/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/asmodeus812/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/asmodeus812/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/asmodeus812"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hello! There was an issue in which `:LspRestart` will spawn multiple new clients in single file mode (even when disabled) for no good reason. Imagine having 20 buffers opened on `:tcd apps/app1` and another 20 opened on `:tcd apps/app2` (across tabs in the same neovim instance). If the only condition for creating new clients is `if not client` then as soon as you do `:LspRestart` it will spawn 20 new clients in single file mode (from either the `apps/app1` dir or the `apps/apps2`) dir.\r\n\r\n~~Maybe doing `single_file == false` instead of `not single_file` could help?~~ `single_file_support` is always a `boolean` and never `nil`",
            "created_at": "2024-03-18T20:11:40Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080#issuecomment-2004866460",
            "id": 2004866460,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
            "node_id": "IC_kwDODTQC1853f9Wc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004866460/reactions"
            },
            "updated_at": "2024-03-18T21:24:45Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004866460",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/43413954?v=4",
                "events_url": "https://api.github.com/users/serranomorante/events{/privacy}",
                "followers_url": "https://api.github.com/users/serranomorante/followers",
                "following_url": "https://api.github.com/users/serranomorante/following{/other_user}",
                "gists_url": "https://api.github.com/users/serranomorante/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/serranomorante",
                "id": 43413954,
                "login": "serranomorante",
                "node_id": "MDQ6VXNlcjQzNDEzOTU0",
                "organizations_url": "https://api.github.com/users/serranomorante/orgs",
                "received_events_url": "https://api.github.com/users/serranomorante/received_events",
                "repos_url": "https://api.github.com/users/serranomorante/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/serranomorante/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/serranomorante/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/serranomorante"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'm sure there must be more effective ways of fixing my previous issue... back then I just tried to do the most minimal change I could think of (basically 1 line) to not cause any regression 😭",
            "created_at": "2024-03-18T20:19:02Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080#issuecomment-2004891679",
            "id": 2004891679,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
            "node_id": "IC_kwDODTQC1853gDgf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004891679/reactions"
            },
            "updated_at": "2024-03-18T20:19:02Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2004891679",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/43413954?v=4",
                "events_url": "https://api.github.com/users/serranomorante/events{/privacy}",
                "followers_url": "https://api.github.com/users/serranomorante/followers",
                "following_url": "https://api.github.com/users/serranomorante/following{/other_user}",
                "gists_url": "https://api.github.com/users/serranomorante/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/serranomorante",
                "id": 43413954,
                "login": "serranomorante",
                "node_id": "MDQ6VXNlcjQzNDEzOTU0",
                "organizations_url": "https://api.github.com/users/serranomorante/orgs",
                "received_events_url": "https://api.github.com/users/serranomorante/received_events",
                "repos_url": "https://api.github.com/users/serranomorante/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/serranomorante/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/serranomorante/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/serranomorante"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I think is best for now to just revert my changes. That will solve this issue here.\r\nMy original solution (that caused this regression) don't seem to be working anymore which is strange. Sorry for the inconvenience.",
            "created_at": "2024-03-23T17:36:59Z",
            "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080#issuecomment-2016556649",
            "id": 2016556649,
            "issue_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
            "node_id": "IC_kwDODTQC1854MjZp",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2016556649/reactions"
            },
            "updated_at": "2024-03-23T17:36:59Z",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/comments/2016556649",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/43413954?v=4",
                "events_url": "https://api.github.com/users/serranomorante/events{/privacy}",
                "followers_url": "https://api.github.com/users/serranomorante/followers",
                "following_url": "https://api.github.com/users/serranomorante/following{/other_user}",
                "gists_url": "https://api.github.com/users/serranomorante/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/serranomorante",
                "id": 43413954,
                "login": "serranomorante",
                "node_id": "MDQ6VXNlcjQzNDEzOTU0",
                "organizations_url": "https://api.github.com/users/serranomorante/orgs",
                "received_events_url": "https://api.github.com/users/serranomorante/received_events",
                "repos_url": "https://api.github.com/users/serranomorante/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/serranomorante/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/serranomorante/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/serranomorante"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080/comments",
    "created_at": "2024-03-18T04:27:22Z",
    "events_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080/events",
    "html_url": "https://github.com/neovim/nvim-lspconfig/issues/3080",
    "id": 2191203369,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "Something isn't working",
            "id": 1674892761,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxNjc0ODkyNzYx",
            "url": "https://api.github.com/repos/neovim/nvim-lspconfig/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODTQC186Cmxwp",
    "number": 3080,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 1,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/nvim-lspconfig",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080/timeline",
    "title": "Multi workspace support for language servers broken after 0a1a2aa5",
    "updated_at": "2024-03-24T05:39:14Z",
    "url": "https://api.github.com/repos/neovim/nvim-lspconfig/issues/3080",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/15955811?v=4",
        "events_url": "https://api.github.com/users/asmodeus812/events{/privacy}",
        "followers_url": "https://api.github.com/users/asmodeus812/followers",
        "following_url": "https://api.github.com/users/asmodeus812/following{/other_user}",
        "gists_url": "https://api.github.com/users/asmodeus812/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/asmodeus812",
        "id": 15955811,
        "login": "asmodeus812",
        "node_id": "MDQ6VXNlcjE1OTU1ODEx",
        "organizations_url": "https://api.github.com/users/asmodeus812/orgs",
        "received_events_url": "https://api.github.com/users/asmodeus812/received_events",
        "repos_url": "https://api.github.com/users/asmodeus812/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/asmodeus812/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/asmodeus812/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/asmodeus812"
    }
}