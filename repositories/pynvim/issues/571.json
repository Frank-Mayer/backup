{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "Hi,\r\n\r\nI'm trying to fix pynvim with Python 3.13 which is in Fedora Rawhide (upcoming 41). The failure I get is:\r\n\r\n```\r\n=================================== FAILURES ===================================\r\n_____________________________ test_python3_ex_eval _____________________________                                                                                                    \r\n                                                                                          \r\nvim = <pynvim.api.nvim.Nvim object at 0x7f2b5e068950>\r\n                                                                                          \r\n    def test_python3_ex_eval(vim: Nvim) -> None:                                \r\n        assert '42' == vim.command_output('python3 =42')                                                                                                                            \r\n        assert '42' == vim.command_output('python3 =   42     ')                \r\n        assert '42' == vim.command_output('py3=    42     ')                                                                                                                        \r\n        assert '42' == vim.command_output('py=42')\r\n                                     \r\n        # On syntax error or evaluation error, stacktrace information is printed\r\n        # Note: the pynvim API command_output() throws an exception on error\r\n        # because the Ex command :python will throw (wrapped with provider#python3#Call)\r\n        with pytest.raises(NvimError) as excinfo:        \r\n            vim.command('py3= 1/0')                                                       \r\n>       assert textwrap.dedent('''\\                                                       \r\n            Traceback (most recent call last):                                                                                                                                      \r\n              File \"<string>\", line 1, in <module>                                                                                                                                  \r\n            ZeroDivisionError: division by zero\r\n            ''').strip() in excinfo.value.args[0]                                                                                                                                   \r\nE       assert 'Traceback (most recent call last):\\n  File \"<string>\", line 1, in <module>\\nZeroDivisionError: division by zero' in 'function provider#python3#Call, line 1: Vim(ret\r\nurn):E5108: Error executing lua Vim:Error invoking \\'python_execute\\' on channel 3 (python3-script-host):\\nTraceback (most recent call last):\\n  File \"<string>\", line 1, in <module\r\n>\\n    import sys; sys.path = [p for p in sys.path if p != \"\"]; import neovim; neovim.start_host()\\n    ^^^\\nZeroDivisionError: division by zero\\nstack traceback:\\n\\t[C]: at 0x55bb\r\nfd9c11af'                                                                                                                                                                           \r\nE        +  where 'Traceback (most recent call last):\\n  File \"<string>\", line 1, in <module>\\nZeroDivisionError: division by zero' = <built-in method strip of str object at 0x7f2b\r\n5e0752f0>()\r\nE        +    where <built-in method strip of str object at 0x7f2b5e0752f0> = 'Traceback (most recent call last):\\n  File \"<string>\", line 1, in <module>\\nZeroDivisionError: divisi\r\non by zero\\n'.strip\r\nE        +      where 'Traceback (most recent call last):\\n  File \"<string>\", line 1, in <module>\\nZeroDivisionError: division by zero\\n' = <function dedent at 0x7f2b5f868ae0>('   \r\n     Traceback (most recent call last):\\n          File \"<string>\", line 1, in <module>\\n        ZeroDivisionError: division by zero\\n        ')\r\nE        +        where <function dedent at 0x7f2b5f868ae0> = textwrap.dedent\r\n\r\ntest/test_vim.py:233: AssertionError\r\n```\r\n\r\nThe traceback looks different now.\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n    import sys; sys.path = [p for p in sys.path if p != \"\"]; import neovim; neovim.start_host()\r\n    ^^^\r\nZeroDivisionError: division by zero\r\n```\r\n\r\nMy current fix is for Fedora is:\r\n\r\n```diff\r\nIndex: pynvim-0.5.0/test/test_vim.py\r\n===================================================================\r\n--- pynvim-0.5.0.orig/test/test_vim.py  2024-06-14 08:47:38.588584340 +0200\r\n+++ pynvim-0.5.0/test/test_vim.py       2024-06-14 09:00:22.910093156 +0200\r\n@@ -231,8 +231,6 @@ def test_python3_ex_eval(vim: Nvim) -> N\r\n     with pytest.raises(NvimError) as excinfo:\r\n         vim.command('py3= 1/0')\r\n     assert textwrap.dedent('''\\\r\n-        Traceback (most recent call last):\r\n-          File \"<string>\", line 1, in <module>\r\n         ZeroDivisionError: division by zero\r\n         ''').strip() in excinfo.value.args[0]\r\n \r\n@@ -240,9 +238,6 @@ def test_python3_ex_eval(vim: Nvim) -> N\r\n     with pytest.raises(NvimError) as excinfo:\r\n         vim.command_output('python3 =print(\"nooo\", raise_error())')\r\n     assert textwrap.dedent('''\\\r\n-        Traceback (most recent call last):\r\n-          File \"<string>\", line 1, in <module>\r\n-          File \"<string>\", line 1, in raise_error\r\n         RuntimeError: oops\r\n         ''').strip() in excinfo.value.args[0]\r\n     assert 'nooo' not in vim.command_output(':messages')\r\n```\r\n\r\nNot sure if this is how you would like to address this.",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/pynvim/issues/571/comments",
    "created_at": "2024-06-14T07:14:05Z",
    "events_url": "https://api.github.com/repos/neovim/pynvim/issues/571/events",
    "html_url": "https://github.com/neovim/pynvim/issues/571",
    "id": 2352696043,
    "labels": [],
    "labels_url": "https://api.github.com/repos/neovim/pynvim/issues/571/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOASpKTs6MO0rr",
    "number": 571,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/pynvim/issues/571/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/pynvim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/pynvim/issues/571/timeline",
    "title": "test_vim: Failure with Python 3.13",
    "updated_at": "2024-06-14T07:14:05Z",
    "url": "https://api.github.com/repos/neovim/pynvim/issues/571",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/545480?v=4",
        "events_url": "https://api.github.com/users/cryptomilk/events{/privacy}",
        "followers_url": "https://api.github.com/users/cryptomilk/followers",
        "following_url": "https://api.github.com/users/cryptomilk/following{/other_user}",
        "gists_url": "https://api.github.com/users/cryptomilk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cryptomilk",
        "id": 545480,
        "login": "cryptomilk",
        "node_id": "MDQ6VXNlcjU0NTQ4MA==",
        "organizations_url": "https://api.github.com/users/cryptomilk/orgs",
        "received_events_url": "https://api.github.com/users/cryptomilk/received_events",
        "repos_url": "https://api.github.com/users/cryptomilk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cryptomilk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cryptomilk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cryptomilk"
    }
}