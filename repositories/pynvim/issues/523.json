{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "Hi \r\n\r\nToday I cloned the repository and installed the package directly instead from PyPi.\r\n\r\nAfter reopening nvim I noticed that nvim was very laggy in all python files.\r\nI found out that the issue was with my snippet engine `Ultisnips`.\r\nDeleting the package and reinstalling it from PyPi made the lag go away.\r\n\r\nThe version on PyPi is 4.3 and so I went through the git history to check where something significant changed.\r\nI located the issue to be this PR #506. \r\nThis PR changes the `num_to_str` function to include a [boolean check](https://github.com/neovim/pynvim/blob/41edb05b035c53bc396bf11fb2815ab03f65a2fc/pynvim/plugin/script_host.py#L197).\r\nThe helper function is used in the `LegacyVim` object's `eval` function [here](https://github.com/neovim/pynvim/blob/41edb05b035c53bc396bf11fb2815ab03f65a2fc/pynvim/plugin/script_host.py#L203).\r\nBrowsing through the [Ultisnips](https://github.com/SirVer/ultisnips) source code reveals that it uses `vim.eval` at many places. \r\nThus, this change is non-trivial in terms of Ultisnips performance.\r\n\r\nI wonder what could be done to circument this issue?\r\n",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Thinking more about, I guess the #506 PR is not compliant with the `vim.eval` [documentation](https://neovim.io/doc/user/if_pyth.html#python-eval). \r\n\r\nThe documentation states\r\n\r\n> vim.eval(str)\t\t\t\t\t\tpython-eval\r\n\tEvaluates the expression str using the vim internal expression\r\n\tevaluator (see [expression](https://neovim.io/doc/user/eval.html#expression)).  Returns the expression result as:\r\n(1) a string if the Vim expression evaluates to a string or number\r\n(2) a list if the Vim expression evaluates to a Vim list\r\n(3) a dictionary if the Vim expression evaluates to a Vim dictionary Dictionaries and lists are recursively expanded. \r\n\r\nIn Python, booleans are implemented as a [subclass of integers](https://docs.python.org/3/c-api/bool.html#:~:text=Booleans%20in%20Python%20are%20implemented%20as%20a%20subclass%20of%20integers.).\r\nIn nvim, `v:true` and `v:false` evalutes to `true` and `false` (boolean values); for boolean values [vim uses numbers](https://neovim.io/doc/user/eval.html#Boolean).\r\nTherefore, by (1) and that booleans are integers in Python, `vim.eval('v:true')` should evaluate to the Python string `\"True\"` and not the boolean `True`.\r\nAnd therefore `:py3 print(type(vim.eval('v:true')))` should print out `<class 'str'>` and not `<class 'bool'>`.\r\nThus, the extra check in #506 is redundant, right?\r\n",
            "created_at": "2023-04-04T07:45:05Z",
            "html_url": "https://github.com/neovim/pynvim/issues/523#issuecomment-1495502011",
            "id": 1495502011,
            "issue_url": "https://api.github.com/repos/neovim/pynvim/issues/523",
            "node_id": "IC_kwDOASpKTs5ZI4y7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1495502011/reactions"
            },
            "updated_at": "2023-04-04T07:45:05Z",
            "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1495502011",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/49307119?v=4",
                "events_url": "https://api.github.com/users/jsr-p/events{/privacy}",
                "followers_url": "https://api.github.com/users/jsr-p/followers",
                "following_url": "https://api.github.com/users/jsr-p/following{/other_user}",
                "gists_url": "https://api.github.com/users/jsr-p/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jsr-p",
                "id": 49307119,
                "login": "jsr-p",
                "node_id": "MDQ6VXNlcjQ5MzA3MTE5",
                "organizations_url": "https://api.github.com/users/jsr-p/orgs",
                "received_events_url": "https://api.github.com/users/jsr-p/received_events",
                "repos_url": "https://api.github.com/users/jsr-p/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jsr-p/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jsr-p/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jsr-p"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@jsr-p If reverting https://github.com/neovim/pynvim/pull/506 fixes a performance issue, please send a PR reverting it, with an explanation. I don't think https://github.com/neovim/pynvim/pull/506 is worth slower performance.",
            "created_at": "2023-07-14T23:43:25Z",
            "html_url": "https://github.com/neovim/pynvim/issues/523#issuecomment-1636562720",
            "id": 1636562720,
            "issue_url": "https://api.github.com/repos/neovim/pynvim/issues/523",
            "node_id": "IC_kwDOASpKTs5hi_cg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1636562720/reactions"
            },
            "updated_at": "2023-07-14T23:43:25Z",
            "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1636562720",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "@justinmk I have switched to using [LuaSnip](https://github.com/L3MON4D3/LuaSnip) but thanks for considering my comment on the performance!",
            "created_at": "2023-10-20T13:51:12Z",
            "html_url": "https://github.com/neovim/pynvim/issues/523#issuecomment-1772779153",
            "id": 1772779153,
            "issue_url": "https://api.github.com/repos/neovim/pynvim/issues/523",
            "node_id": "IC_kwDOASpKTs5pqnaR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1772779153/reactions"
            },
            "updated_at": "2023-10-20T13:51:12Z",
            "url": "https://api.github.com/repos/neovim/pynvim/issues/comments/1772779153",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/49307119?v=4",
                "events_url": "https://api.github.com/users/jsr-p/events{/privacy}",
                "followers_url": "https://api.github.com/users/jsr-p/followers",
                "following_url": "https://api.github.com/users/jsr-p/following{/other_user}",
                "gists_url": "https://api.github.com/users/jsr-p/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jsr-p",
                "id": 49307119,
                "login": "jsr-p",
                "node_id": "MDQ6VXNlcjQ5MzA3MTE5",
                "organizations_url": "https://api.github.com/users/jsr-p/orgs",
                "received_events_url": "https://api.github.com/users/jsr-p/received_events",
                "repos_url": "https://api.github.com/users/jsr-p/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jsr-p/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jsr-p/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jsr-p"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/pynvim/issues/523/comments",
    "created_at": "2023-04-03T15:40:58Z",
    "events_url": "https://api.github.com/repos/neovim/pynvim/issues/523/events",
    "html_url": "https://github.com/neovim/pynvim/issues/523",
    "id": 1652314831,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "",
            "id": 5736936311,
            "name": "performance",
            "node_id": "LA_kwDOASpKTs8AAAABVfKzdw",
            "url": "https://api.github.com/repos/neovim/pynvim/labels/performance"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/pynvim/issues/523/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOASpKTs5ifFLP",
    "number": 523,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/pynvim/issues/523/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/pynvim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/pynvim/issues/523/timeline",
    "title": "`num_to_str` boolean check makes `Ultisnips` snippet engine laggy",
    "updated_at": "2023-10-20T13:51:12Z",
    "url": "https://api.github.com/repos/neovim/pynvim/issues/523",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/49307119?v=4",
        "events_url": "https://api.github.com/users/jsr-p/events{/privacy}",
        "followers_url": "https://api.github.com/users/jsr-p/followers",
        "following_url": "https://api.github.com/users/jsr-p/following{/other_user}",
        "gists_url": "https://api.github.com/users/jsr-p/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jsr-p",
        "id": 49307119,
        "login": "jsr-p",
        "node_id": "MDQ6VXNlcjQ5MzA3MTE5",
        "organizations_url": "https://api.github.com/users/jsr-p/orgs",
        "received_events_url": "https://api.github.com/users/jsr-p/received_events",
        "repos_url": "https://api.github.com/users/jsr-p/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jsr-p/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jsr-p/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jsr-p"
    }
}