{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/28914/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28914/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/28914"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/28914"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28914/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/93684a12aaab9fd4ad7c8216963a630c1dd7fead"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 5414,
            "forks_count": 5414,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1725,
            "open_issues_count": 1725,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2024-05-27T22:51:37Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 271477,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 78533,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2024-05-28T01:40:20Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 78533,
            "watchers_count": 78533,
            "web_commit_signoff_required": false
        },
        "sha": "5ac8db10f0428c976dfc9a4935a74d0fe160995c",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "body": "Fixes: https://github.com/neovim/neovim/issues/28575",
    "closed_at": "2024-05-23T13:17:53Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610433298"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610433298"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n    it('should not re-attach buffer if it was deleted in on_init #28575', function()\r\n```",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T18:07:11Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610433298",
            "id": 1610433298,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_UMS",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2071988847,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610433298/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T18:08:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610433298",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610434501"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610434501"
                }
            },
            "author_association": "MEMBER",
            "body": "I find the test does not fail without the patch on `vim.lsp.client`.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T18:08:14Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610434501",
            "id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_UfF",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2071992027,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610434501/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T18:08:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610434501",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610439115"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610439115"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I doubled checked this and it's failing without the client change for me.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T18:12:16Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610439115",
            "id": 1610439115,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_VnL",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072001148,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610439115/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T18:12:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610439115",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610474017"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610474017"
                }
            },
            "author_association": "MEMBER",
            "body": "~~I see. I also double checked, in my setup it does not fail. Is the execution order non-deterministic by any chance?~~ EDIT: I can now reproduce the failing tests, sorry. I must've done something wrong.\r\n\r\n    Error executing lua: .../vim/lsp/_changetracking.lua:154: Invalid buffer id: 2\r\n\r\nActually I don't find the logic of this test and the anticipated order of execution quite clear, we probably meant buffer was gone during `on_init` and expect fail somewhere (but where exactly? some comments will help for elaboration) It looks like `on_init` can be called asynchronously, not necessarily *before* re-attaching. It'd be also a good idea to ensure a certain execution order by assertions.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T18:36:14Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610474017",
            "id": 1610474017,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_eIh",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072068794,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610474017/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T18:40:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610474017",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610481572"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610481572"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "The test assumes that the `on_init` callback will be called twice:\r\n\r\n1. Before the `vim.lsp.start` returns (`bufnr` should be `nil`)\r\n2. After `client:initialise()` is called. (`bufnr` should be a valid buffer).\r\n\r\nThe error occurs after the second `on_init` call returns.\r\n\r\nThis only works because the test server synchronously invokes the initialize callback here https://github.com/neovim/neovim/blob/5d2647dcfc93b131c0e36c2a3bc9b0574cebeb8c/test/functional/plugin/lsp/testutil.lua#L45-L47",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T18:42:45Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610481572",
            "id": 1610481572,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_f-k",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072086069,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610481572/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T19:15:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610481572",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610524617"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610524617"
                }
            },
            "author_association": "MEMBER",
            "body": "Thanks, the tests look cleaner after the simplification. A bit off topic, but I was wondering: in which case and why `client:initialize` can be called twice? (it's not a public method, so not supposed to be called by user) `client:initialize` would have been called inside `vim.lsp.start()`. `on_init` is meant to be called only once.\r\n\r\nWhile I think this is a good (though contrived) repro for the bug #28575, what's more impacting is the race condition when the client responds too late, isn't it? Can we possibly come up with a more realistic scenario where #28575 or \"reattaching\" happens?",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T19:14:08Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610524617",
            "id": 1610524617,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_qfJ",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072157336,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610524617/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T19:17:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610524617",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610529029"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610529029"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "@wookayin ~~:LspRestart~~\r\n\r\n**Edit:** the test needs to call `client:initialize` because the test LSP server calls the `initialize` callback synchronously. Any real LSP will have a delay between `vim.lsp.start` returning and `on_init` being called where we could attach the client to a buffer.\r\n\r\n**Edit:** AFAIK, there's no race condition around a slow LSP initialization.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T19:18:28Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610529029",
            "id": 1610529029,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_rkF",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072164910,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610529029/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T19:29:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610529029",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610539828"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610539828"
                }
            },
            "author_association": "MEMBER",
            "body": "I meant: calling `client:initialize()` twice in a real-world, not for the tests. If we want to simulate a delay we will have to write a similar code so that the vim instance would wait until the asynchronous callback is scheduled and executed, rather than simply calling it from the main thread.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T19:28:29Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610539828",
            "id": 1610539828,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_uM0",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072183320,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610539828/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T19:31:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610539828",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610555864"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610555864"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I'm not sure what you're suggesting. Do you have an idea for a better way to test this?",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T19:42:47Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610555864",
            "id": 1610555864,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_yHY",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072210346,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610555864/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T19:42:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610555864",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610588440"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610588440"
                }
            },
            "author_association": "MEMBER",
            "body": "> I meant: calling client:initialize() twice in a real-world, not for the tests.\r\n\r\nI understood the real world scenario as:\r\n\r\n- Client starts\r\n- rpc.request(\"initialize\") fires\r\n- Client attaches one or more other buffers\r\n- Server responds to initialize\r\n- on_init fires and deletes a buffer\r\n\r\n\r\nTo mirror that scenario more closely in the test it would be necessary to override the `srv.request` of the `_create_server` and defer the `initialize` response until a second buffer is attached. But I think the current solution is also good enough.\r\n\r\n\r\n",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T20:12:54Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610588440",
            "id": 1610588440,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5f_6EY",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072266457,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610588440/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T20:12:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610588440",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610636758"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610636758"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I've updated the test, let me know what you think.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T20:54:49Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610636758",
            "id": 1610636758,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAF3W",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072347020,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610636758/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T20:54:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610636758",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610641625"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610641625"
                }
            },
            "author_association": "MEMBER",
            "body": "I think the scenario @mfussenegger describe is indeed a correct reason for #28575. To clarify, `client:initialize()` is called only once. The race condition is when the buffer is deleted before `on_attach(buf)` is called --- it could be during `on_init` (which sounds quite strange), or anytime until LSP initialization is done. I will write one test case for you.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T20:59:44Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610641625",
            "id": 1610641625,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAHDZ",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072359688,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610641625/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T21:01:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610641625",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610652292"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610652292"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "> or anytime until LSP initialization is done\r\n\r\nI don't think this is correct. You can delete the buffer in that window and it should be removed from the `client.attached_buffers` table.\r\n\r\nWhen the buffer is deleted:\r\nhttps://github.com/neovim/neovim/blob/f79e906442b77cfa4e5a02d51f5dcb2fb186afbc/runtime/lua/vim/lsp.lua#L585\r\n\r\nWhen the client is detached from the buffer:\r\nhttps://github.com/neovim/neovim/blob/f79e906442b77cfa4e5a02d51f5dcb2fb186afbc/runtime/lua/vim/lsp.lua#L678",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T21:08:53Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610652292",
            "id": 1610652292,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAJqE",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072373096,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610652292/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T21:11:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610652292",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610721297"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610721297"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Seems like this isn't working correctly in puc-lua. ",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T22:01:09Z",
            "diff_hunk": "@@ -39,8 +39,12 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          if debug.getinfo(handler, 'u').nparams == 3 then",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610721297",
            "id": 1610721297,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAagR",
            "original_commit_id": "b214d24d3f54ceb621ba66038fae2d7ccbbd02c4",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": null,
            "pull_request_review_id": 2072484464,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610721297/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T22:01:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610721297",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610739437"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610739437"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I updated all the handlers to be async.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T22:24:12Z",
            "diff_hunk": "@@ -39,8 +39,12 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          if debug.getinfo(handler, 'u').nparams == 3 then",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610739437",
            "id": 1610739437,
            "in_reply_to_id": 1610721297,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAe7t",
            "original_commit_id": "b214d24d3f54ceb621ba66038fae2d7ccbbd02c4",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": null,
            "pull_request_review_id": 2072510898,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610739437/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T22:24:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610739437",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610759014"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610759014"
                }
            },
            "author_association": "MEMBER",
            "body": "Not using such a hacky solution sounds great. But changing all the handlers to be async might be too much (to be precise, in your current patch they are not necessarily \"asynchronous\" because it's just calling the callback synchronously). I haven't tested this much in my environments so it might not be accurate yet, but how about something like:\r\n\r\n```diff\r\n        local handler = handlers[method]\r\n+       local delay = (opts.delay or {})[method] ---@type integer? (ms)\r\n+       if delay then -- simulate 'slow', asynchronous response from LSP\r\n+         local original_callback = callback\r\n+         callback = function(err, response)\r\n+           vim.defer_fn(function(),\r\n+             original_callback(err, response)\r\n+           end, delay)\r\n+         end\r\n+       end\r\n\r\n        if handler then\r\n          local response, err = handler(method, params)\r\n          callback(err, response)\r\n```\r\n\r\nso one can write like and avoid touching other handlers:\r\n```lua\r\n        local server = _create_server {\r\n          delay = {\r\n            ['initialize'] = 100, -- simulate LSP server is responding 100ms late\r\n          }\r\n        }\r\n```",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T22:45:16Z",
            "diff_hunk": "@@ -39,8 +39,12 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          if debug.getinfo(handler, 'u').nparams == 3 then",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610759014",
            "id": 1610759014,
            "in_reply_to_id": 1610721297,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAjtm",
            "original_commit_id": "b214d24d3f54ceb621ba66038fae2d7ccbbd02c4",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": null,
            "pull_request_review_id": 2072539231,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610759014/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T22:50:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610759014",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610760596"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610760596"
                }
            },
            "author_association": "MEMBER",
            "body": "Question: I get you are saying removal of a buffer will invalidate `attached_buffers[bufnr]` (either synchronously or asynchronously, not so sure), so they might not lead to the bug. But then, to clarify, what's so special about buffer being wiped out *during* `on_init`? Is this a realistic scenario? I was thinking that the use of `on_init` is an artificial scenario you chose to reproduce the bug, and the race condition could happen as buffer will be removed somewhere else than `on_init`.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T22:47:40Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610760596",
            "id": 1610760596,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAkGU",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072541370,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610760596/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T22:48:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610760596",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610782514"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610782514"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I'm not sure _why_ someone would be deleting buffers in `on_init`, but based on my read-through of the code, that's the most obvious way the `Invalid buffer id: 44` error from #28575 could happen. It's definitely weird, but it's still a valid usage of the API and therefore should work. This might not end up being the root cause of #28575 but it's still worth fixing if only to narrow the search. The lack of a good repro doesn't leave us with a lot of good options.\r\n\r\n> the race condition could happen as buffer will be removed somewhere else than on_init.\r\n\r\nIf you've identified another potential place this could happen, I'm all ears.\r\n\r\n",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T23:25:51Z",
            "diff_hunk": "@@ -493,6 +493,31 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init', function()",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610782514",
            "id": 1610782514,
            "in_reply_to_id": 1610434501,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gApcy",
            "original_commit_id": "0a948cead369bbcb1198fe30c052c0c8cb8a918f",
            "original_line": 496,
            "original_position": 4,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072573502,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610782514/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T23:28:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610782514",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610796376"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610796376"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n        local ok = vim.wait(1000, function() return on_init_called end)\r\n        assert(ok, \"on_init was not called\")\r\n```",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T23:54:03Z",
            "diff_hunk": "@@ -493,6 +493,34 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init #28575', function()\n+      clear()\n+      exec_lua(create_server_definition)\n+      exec_lua([[\n+        local server = _create_server({\n+          handlers = {\n+            initialize = function(method, params, callback)\n+              vim.schedule(function()\n+                callback(nil, { capabilities = {} })\n+              end)\n+            end\n+          }\n+        })\n+        local bufnr = vim.api.nvim_create_buf(false, true)\n+        local on_init_called = false\n+        local client_id = vim.lsp.start({\n+          name = 'detach-dummy',\n+          cmd = server.cmd,\n+          on_init = function()\n+            vim.api.nvim_buf_delete(bufnr, {})\n+            on_init_called = true\n+          end\n+        })\n+        vim.lsp.buf_attach_client(bufnr, client_id)\n+        vim.fn.wait(1000, on_init_called)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610796376",
            "id": 1610796376,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAs1Y",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 520,
            "original_position": 28,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072591990,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610796376/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T23:59:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610796376",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610798807"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610798807"
                }
            },
            "author_association": "MEMBER",
            "body": "Is this a really necessary change (using `callback` for all the handlers) for this PR? Seems complex. This doesn't work like asynchronously, and doesn't seem quite relevant with `initialize` being deferred.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-22T23:58:41Z",
            "diff_hunk": "@@ -39,8 +39,7 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          handler(method, params, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610798807",
            "id": 1610798807,
            "line": 42,
            "node_id": "PRRC_kwDOAPphoM5gAtbX",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": 6,
            "pull_request_review_id": 2072591990,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610798807/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-22T23:59:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610798807",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610800180"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800180"
                }
            },
            "author_association": "MEMBER",
            "body": "Hmm actually this won't be enough either, because `on_attach` will be called after `on_init` so we will have to wait a bit more. (btw, the previous implementation is not evaluating `on_init_called` properly) It should be something like: until `on_attach` is called.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T00:01:41Z",
            "diff_hunk": "@@ -493,6 +493,34 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init #28575', function()\n+      clear()\n+      exec_lua(create_server_definition)\n+      exec_lua([[\n+        local server = _create_server({\n+          handlers = {\n+            initialize = function(method, params, callback)\n+              vim.schedule(function()\n+                callback(nil, { capabilities = {} })\n+              end)\n+            end\n+          }\n+        })\n+        local bufnr = vim.api.nvim_create_buf(false, true)\n+        local on_init_called = false\n+        local client_id = vim.lsp.start({\n+          name = 'detach-dummy',\n+          cmd = server.cmd,\n+          on_init = function()\n+            vim.api.nvim_buf_delete(bufnr, {})\n+            on_init_called = true\n+          end\n+        })\n+        vim.lsp.buf_attach_client(bufnr, client_id)\n+        vim.fn.wait(1000, on_init_called)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610800180",
            "id": 1610800180,
            "in_reply_to_id": 1610796376,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAtw0",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 520,
            "original_position": 28,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072596735,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800180/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T00:01:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800180",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610800538"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800538"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "You requested that the test simulate the more realistic async scenario. So I needed to change the test server to support async responses. I wanted to overload the handlers based on their arity, but the puc-lua runner doesn't support `debug.getinfo(fn, 'u').nparams`.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T00:02:23Z",
            "diff_hunk": "@@ -39,8 +39,7 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          handler(method, params, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610800538",
            "id": 1610800538,
            "in_reply_to_id": 1610798807,
            "line": 42,
            "node_id": "PRRC_kwDOAPphoM5gAt2a",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": 6,
            "pull_request_review_id": 2072597206,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800538/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T00:19:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610800538",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610803231"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610803231"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "If the tests seem too verbose, we could add a `handler_stub` testutil like:\r\n\r\n``` lua\r\nfunction M.handler_stub(response, err)\r\n  return function (_, _, callback)\r\n    callback(vim.deepcopy(err), vim.deepcopy(response))\r\n  end\r\nend\r\n```\r\n\r\nThe most handlers would look like this:\r\n\r\n``` lua\r\nlocal handlers = {\r\n  [\"textDocument/codeAction\"] = handler_stub({\r\n    title = \"Code Action 1\",\r\n    command = {\r\n      title = \"Command 1\",\r\n      command = \"command:1\",\r\n    }\r\n  })\r\n}\r\n```",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T00:08:25Z",
            "diff_hunk": "@@ -39,8 +39,7 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          handler(method, params, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610803231",
            "id": 1610803231,
            "in_reply_to_id": 1610798807,
            "line": 42,
            "node_id": "PRRC_kwDOAPphoM5gAugf",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": 6,
            "pull_request_review_id": 2072601169,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610803231/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T00:24:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610803231",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610817103"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610817103"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "> Hmm actually this won't be enough either, because on_attach will be called after on_init so we will have to wait a bit more.\r\n\r\nI think it's fine because `on_init` and `_on_attach` are both called synchronously and should both run in the same event loop iteration/task",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T00:36:07Z",
            "diff_hunk": "@@ -493,6 +493,34 @@ describe('LSP', function()\n       eq(0, result.num_attached_after)\n     end)\n \n+    it('should not re-attach buffer if it was deleted in on_init #28575', function()\n+      clear()\n+      exec_lua(create_server_definition)\n+      exec_lua([[\n+        local server = _create_server({\n+          handlers = {\n+            initialize = function(method, params, callback)\n+              vim.schedule(function()\n+                callback(nil, { capabilities = {} })\n+              end)\n+            end\n+          }\n+        })\n+        local bufnr = vim.api.nvim_create_buf(false, true)\n+        local on_init_called = false\n+        local client_id = vim.lsp.start({\n+          name = 'detach-dummy',\n+          cmd = server.cmd,\n+          on_init = function()\n+            vim.api.nvim_buf_delete(bufnr, {})\n+            on_init_called = true\n+          end\n+        })\n+        vim.lsp.buf_attach_client(bufnr, client_id)\n+        vim.fn.wait(1000, on_init_called)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610817103",
            "id": 1610817103,
            "in_reply_to_id": 1610796376,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAx5P",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 520,
            "original_position": 28,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp_spec.lua",
            "position": null,
            "pull_request_review_id": 2072625167,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610817103/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T00:46:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610817103",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1610819853"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610819853"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I actually did exactly this at first. But passing a callback is less code, provides more control, and is easier to understand.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T00:41:54Z",
            "diff_hunk": "@@ -39,8 +39,12 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          if debug.getinfo(handler, 'u').nparams == 3 then",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1610819853",
            "id": 1610819853,
            "in_reply_to_id": 1610721297,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5gAykN",
            "original_commit_id": "b214d24d3f54ceb621ba66038fae2d7ccbbd02c4",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": null,
            "pull_request_review_id": 2072629698,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610819853/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T00:41:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1610819853",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1611137755"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611137755"
                }
            },
            "author_association": "MEMBER",
            "body": "Could also support either a function with synchronous result or a table that has something like: `{type: async|sync, handler: fun}`\r\n\r\nLet me know what you think. Otherwise I can also merge the PR as is. Changing them all to async with callback is fine by me and would also match what came up as part of https://github.com/neovim/neovim/pull/24338 (which I should get back to at some point)",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T07:21:58Z",
            "diff_hunk": "@@ -39,8 +39,7 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          handler(method, params, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1611137755",
            "id": 1611137755,
            "in_reply_to_id": 1610798807,
            "line": 42,
            "node_id": "PRRC_kwDOAPphoM5gCALb",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": 6,
            "pull_request_review_id": 2073071806,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611137755/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T07:22:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611137755",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28914#discussion_r1611606996"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28914"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611606996"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I'm happy with the current state of the PR. The callback signature didn't increase the existing test LOC so I don't think adding overloads is worth it. I've squashed the changes.",
            "commit_id": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
            "created_at": "2024-05-23T12:29:20Z",
            "diff_hunk": "@@ -39,8 +39,7 @@ M.create_server_definition = [[\n         })\n         local handler = handlers[method]\n         if handler then\n-          local response, err = handler(method, params)\n-          callback(err, response)\n+          handler(method, params, callback)",
            "html_url": "https://github.com/neovim/neovim/pull/28914#discussion_r1611606996",
            "id": 1611606996,
            "in_reply_to_id": 1610798807,
            "line": 42,
            "node_id": "PRRC_kwDOAPphoM5gDyvU",
            "original_commit_id": "a2c7264cb9ac40b5114d495bcb094b26f7968b19",
            "original_line": 42,
            "original_position": 6,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/testutil.lua",
            "position": 6,
            "pull_request_review_id": 2073825523,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611606996/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-05-23T12:29:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1611606996",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "MEMBER",
            "body": "Looks good to me. Any chance you could add a test? With `_create_server`  in the lsp_spec I think it should be possible to simulate the scenario.",
            "created_at": "2024-05-22T16:28:37Z",
            "html_url": "https://github.com/neovim/neovim/pull/28914#issuecomment-2125233909",
            "id": 2125233909,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
            "node_id": "IC_kwDOAPphoM5-rH71",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125233909/reactions"
            },
            "updated_at": "2024-05-22T16:28:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125233909",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@mfussenegger done",
            "created_at": "2024-05-22T17:41:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/28914#issuecomment-2125405855",
            "id": 2125405855,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
            "node_id": "IC_kwDOAPphoM5-rx6f",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125405855/reactions"
            },
            "updated_at": "2024-05-22T17:41:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125405855",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@mfussenegger this is ready for review again.",
            "created_at": "2024-05-22T23:33:33Z",
            "html_url": "https://github.com/neovim/neovim/pull/28914#issuecomment-2125944230",
            "id": 2125944230,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
            "node_id": "IC_kwDOAPphoM5-t1Wm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125944230/reactions"
            },
            "updated_at": "2024-05-22T23:33:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2125944230",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Successfully created backport PR for `release-0.10`:\n- #28942",
            "created_at": "2024-05-23T13:20:08Z",
            "html_url": "https://github.com/neovim/neovim/pull/28914#issuecomment-2127094118",
            "id": 2127094118,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
            "node_id": "IC_kwDOAPphoM5-yOFm",
            "performed_via_github_app": {
                "created_at": "2018-07-30T09:30:17Z",
                "description": "Automate your workflow from idea to production",
                "events": [
                    "branch_protection_rule",
                    "check_run",
                    "check_suite",
                    "create",
                    "delete",
                    "deployment",
                    "deployment_status",
                    "discussion",
                    "discussion_comment",
                    "fork",
                    "gollum",
                    "issues",
                    "issue_comment",
                    "label",
                    "merge_group",
                    "milestone",
                    "page_build",
                    "project",
                    "project_card",
                    "project_column",
                    "public",
                    "pull_request",
                    "pull_request_review",
                    "pull_request_review_comment",
                    "push",
                    "registry_package",
                    "release",
                    "repository",
                    "repository_dispatch",
                    "status",
                    "watch",
                    "workflow_dispatch",
                    "workflow_run"
                ],
                "external_url": "https://help.github.com/en/actions",
                "html_url": "https://github.com/apps/github-actions",
                "id": 15368,
                "name": "GitHub Actions",
                "node_id": "MDM6QXBwMTUzNjg=",
                "owner": {
                    "avatar_url": "https://avatars.githubusercontent.com/u/9919?v=4",
                    "events_url": "https://api.github.com/users/github/events{/privacy}",
                    "followers_url": "https://api.github.com/users/github/followers",
                    "following_url": "https://api.github.com/users/github/following{/other_user}",
                    "gists_url": "https://api.github.com/users/github/gists{/gist_id}",
                    "gravatar_id": "",
                    "html_url": "https://github.com/github",
                    "id": 9919,
                    "login": "github",
                    "node_id": "MDEyOk9yZ2FuaXphdGlvbjk5MTk=",
                    "organizations_url": "https://api.github.com/users/github/orgs",
                    "received_events_url": "https://api.github.com/users/github/received_events",
                    "repos_url": "https://api.github.com/users/github/repos",
                    "site_admin": false,
                    "starred_url": "https://api.github.com/users/github/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/github/subscriptions",
                    "type": "Organization",
                    "url": "https://api.github.com/users/github"
                },
                "permissions": {
                    "actions": "write",
                    "administration": "read",
                    "attestations": "write",
                    "checks": "write",
                    "contents": "write",
                    "deployments": "write",
                    "discussions": "write",
                    "issues": "write",
                    "merge_queues": "write",
                    "metadata": "read",
                    "packages": "write",
                    "pages": "write",
                    "pull_requests": "write",
                    "repository_hooks": "write",
                    "repository_projects": "write",
                    "security_events": "write",
                    "statuses": "write",
                    "vulnerability_alerts": "read"
                },
                "slug": "github-actions",
                "updated_at": "2024-04-10T20:33:16Z"
            },
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2127094118/reactions"
            },
            "updated_at": "2024-05-23T13:20:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2127094118",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
                "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
                "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
                "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
                "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/apps/github-actions",
                "id": 41898282,
                "login": "github-actions[bot]",
                "node_id": "MDM6Qm90NDE4OTgyODI=",
                "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
                "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
                "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
                "type": "Bot",
                "url": "https://api.github.com/users/github-actions%5Bbot%5D"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Git push to origin failed for release-0.10 with exitcode 1",
            "created_at": "2024-05-23T13:20:30Z",
            "html_url": "https://github.com/neovim/neovim/pull/28914#issuecomment-2127094957",
            "id": 2127094957,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
            "node_id": "IC_kwDOAPphoM5-yOSt",
            "performed_via_github_app": {
                "created_at": "2018-07-30T09:30:17Z",
                "description": "Automate your workflow from idea to production",
                "events": [
                    "branch_protection_rule",
                    "check_run",
                    "check_suite",
                    "create",
                    "delete",
                    "deployment",
                    "deployment_status",
                    "discussion",
                    "discussion_comment",
                    "fork",
                    "gollum",
                    "issues",
                    "issue_comment",
                    "label",
                    "merge_group",
                    "milestone",
                    "page_build",
                    "project",
                    "project_card",
                    "project_column",
                    "public",
                    "pull_request",
                    "pull_request_review",
                    "pull_request_review_comment",
                    "push",
                    "registry_package",
                    "release",
                    "repository",
                    "repository_dispatch",
                    "status",
                    "watch",
                    "workflow_dispatch",
                    "workflow_run"
                ],
                "external_url": "https://help.github.com/en/actions",
                "html_url": "https://github.com/apps/github-actions",
                "id": 15368,
                "name": "GitHub Actions",
                "node_id": "MDM6QXBwMTUzNjg=",
                "owner": {
                    "avatar_url": "https://avatars.githubusercontent.com/u/9919?v=4",
                    "events_url": "https://api.github.com/users/github/events{/privacy}",
                    "followers_url": "https://api.github.com/users/github/followers",
                    "following_url": "https://api.github.com/users/github/following{/other_user}",
                    "gists_url": "https://api.github.com/users/github/gists{/gist_id}",
                    "gravatar_id": "",
                    "html_url": "https://github.com/github",
                    "id": 9919,
                    "login": "github",
                    "node_id": "MDEyOk9yZ2FuaXphdGlvbjk5MTk=",
                    "organizations_url": "https://api.github.com/users/github/orgs",
                    "received_events_url": "https://api.github.com/users/github/received_events",
                    "repos_url": "https://api.github.com/users/github/repos",
                    "site_admin": false,
                    "starred_url": "https://api.github.com/users/github/starred{/owner}{/repo}",
                    "subscriptions_url": "https://api.github.com/users/github/subscriptions",
                    "type": "Organization",
                    "url": "https://api.github.com/users/github"
                },
                "permissions": {
                    "actions": "write",
                    "administration": "read",
                    "attestations": "write",
                    "checks": "write",
                    "contents": "write",
                    "deployments": "write",
                    "discussions": "write",
                    "issues": "write",
                    "merge_queues": "write",
                    "metadata": "read",
                    "packages": "write",
                    "pages": "write",
                    "pull_requests": "write",
                    "repository_hooks": "write",
                    "repository_projects": "write",
                    "security_events": "write",
                    "statuses": "write",
                    "vulnerability_alerts": "read"
                },
                "slug": "github-actions",
                "updated_at": "2024-04-10T20:33:16Z"
            },
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2127094957/reactions"
            },
            "updated_at": "2024-05-23T13:20:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2127094957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
                "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
                "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
                "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
                "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/apps/github-actions",
                "id": 41898282,
                "login": "github-actions[bot]",
                "node_id": "MDM6Qm90NDE4OTgyODI=",
                "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
                "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
                "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
                "type": "Bot",
                "url": "https://api.github.com/users/github-actions%5Bbot%5D"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28914/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/28914/commits",
    "created_at": "2024-05-22T14:08:06Z",
    "diff_url": "https://github.com/neovim/neovim/pull/28914.diff",
    "draft": false,
    "head": {
        "label": "icholy:check-buffer-before-reattaching",
        "ref": "check-buffer-before-reattaching",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/icholy/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/icholy/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/icholy/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/icholy/neovim/branches{/branch}",
            "clone_url": "https://github.com/icholy/neovim.git",
            "collaborators_url": "https://api.github.com/repos/icholy/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/icholy/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/icholy/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/icholy/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/icholy/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/icholy/neovim/contributors",
            "created_at": "2023-09-12T21:01:16Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/icholy/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/icholy/neovim/downloads",
            "events_url": "https://api.github.com/repos/icholy/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/icholy/neovim/forks",
            "full_name": "icholy/neovim",
            "git_commits_url": "https://api.github.com/repos/icholy/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/icholy/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/icholy/neovim/git/tags{/sha}",
            "git_url": "git://github.com/icholy/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/icholy/neovim/hooks",
            "html_url": "https://github.com/icholy/neovim",
            "id": 690771309,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/icholy/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/icholy/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/icholy/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/icholy/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/icholy/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/icholy/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/icholy/neovim/merges",
            "milestones_url": "https://api.github.com/repos/icholy/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOKSxVbQ",
            "notifications_url": "https://api.github.com/repos/icholy/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
                "events_url": "https://api.github.com/users/icholy/events{/privacy}",
                "followers_url": "https://api.github.com/users/icholy/followers",
                "following_url": "https://api.github.com/users/icholy/following{/other_user}",
                "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/icholy",
                "id": 943597,
                "login": "icholy",
                "node_id": "MDQ6VXNlcjk0MzU5Nw==",
                "organizations_url": "https://api.github.com/users/icholy/orgs",
                "received_events_url": "https://api.github.com/users/icholy/received_events",
                "repos_url": "https://api.github.com/users/icholy/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/icholy"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/icholy/neovim/pulls{/number}",
            "pushed_at": "2024-05-27T15:13:08Z",
            "releases_url": "https://api.github.com/repos/icholy/neovim/releases{/id}",
            "size": 262863,
            "ssh_url": "git@github.com:icholy/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/icholy/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/icholy/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/icholy/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/icholy/neovim/subscription",
            "svn_url": "https://github.com/icholy/neovim",
            "tags_url": "https://api.github.com/repos/icholy/neovim/tags",
            "teams_url": "https://api.github.com/repos/icholy/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/icholy/neovim/git/trees{/sha}",
            "updated_at": "2024-05-19T15:56:59Z",
            "url": "https://api.github.com/repos/icholy/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "93684a12aaab9fd4ad7c8216963a630c1dd7fead",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
            "events_url": "https://api.github.com/users/icholy/events{/privacy}",
            "followers_url": "https://api.github.com/users/icholy/followers",
            "following_url": "https://api.github.com/users/icholy/following{/other_user}",
            "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/icholy",
            "id": 943597,
            "login": "icholy",
            "node_id": "MDQ6VXNlcjk0MzU5Nw==",
            "organizations_url": "https://api.github.com/users/icholy/orgs",
            "received_events_url": "https://api.github.com/users/icholy/received_events",
            "repos_url": "https://api.github.com/users/icholy/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/icholy"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/28914",
    "id": 1882561727,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28914",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "0052CC",
            "default": false,
            "description": "",
            "id": 6959860626,
            "name": "ci:backport release-0.10",
            "node_id": "LA_kwDOAPphoM8AAAABntcLkg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ci:backport%20release-0.10"
        }
    ],
    "locked": false,
    "merge_commit_sha": "af200c10cf9d117a14ebf9f2e9c666721a1090d6",
    "merged_at": "2024-05-23T13:17:53Z",
    "milestone": {
        "closed_at": null,
        "closed_issues": 29,
        "created_at": "2024-05-14T14:02:12Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
            "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
            "followers_url": "https://api.github.com/users/zeertzjq/followers",
            "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
            "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zeertzjq",
            "id": 35768171,
            "login": "zeertzjq",
            "node_id": "MDQ6VXNlcjM1NzY4MTcx",
            "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
            "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
            "repos_url": "https://api.github.com/users/zeertzjq/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zeertzjq"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/42",
        "id": 11051793,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/42/labels",
        "node_id": "MI_kwDOAPphoM4AqKMR",
        "number": 42,
        "open_issues": 6,
        "state": "open",
        "title": "0.10.1",
        "updated_at": "2024-05-28T01:49:49Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/42"
    },
    "node_id": "PR_kwDOAPphoM5wNZy_",
    "number": 28914,
    "patch_url": "https://github.com/neovim/neovim/pull/28914.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/28914/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/93684a12aaab9fd4ad7c8216963a630c1dd7fead",
    "title": "fix(lsp): check if buffer was detached in on_init callback",
    "updated_at": "2024-05-26T04:16:29Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/28914",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
        "events_url": "https://api.github.com/users/icholy/events{/privacy}",
        "followers_url": "https://api.github.com/users/icholy/followers",
        "following_url": "https://api.github.com/users/icholy/following{/other_user}",
        "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/icholy",
        "id": 943597,
        "login": "icholy",
        "node_id": "MDQ6VXNlcjk0MzU5Nw==",
        "organizations_url": "https://api.github.com/users/icholy/orgs",
        "received_events_url": "https://api.github.com/users/icholy/received_events",
        "repos_url": "https://api.github.com/users/icholy/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/icholy"
    }
}