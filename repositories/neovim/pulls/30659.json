{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/30659/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/30659/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/30659"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/30659"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/30659/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 5646,
            "forks_count": 5646,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1800,
            "open_issues_count": 1800,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2024-10-15T01:40:54Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 289049,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 82517,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2024-10-15T02:03:54Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 82517,
            "watchers_count": 82517,
            "web_commit_signoff_required": false
        },
        "sha": "9788b81d7e53e7ad1ca9db249d86e43426ce56c2",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "body": "Problem: on `CompleteDone` cursor can jump to the end of line instead of the end of completed word.\r\n\r\nSolution: trim the part of the line that was cut off and pasted again.\r\n\r\nFixes #30656\r\n\r\nCo-authored-by: @mfussenegger",
    "closed_at": "2024-10-10T09:40:03Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788592425"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788592425"
                }
            },
            "author_association": "MEMBER",
            "body": "If this \"works\", I would guess it's only by accident. The parameter is a row, not a column.\r\n\r\nThe `#line` arg looks suspicious, is that intentional @MariaSolOs ?",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T13:14:15Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788592425",
            "id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm8Ep",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349579058,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788592425/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T13:14:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788592425",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788594723"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788594723"
                }
            },
            "author_association": "MEMBER",
            "body": "I agree that changing the `row` parameter to `col` might just be making the tests pass but not be a correct change.\r\n\r\nRegarding `#line`, what do you find suspicious about it @justinmk?",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T13:28:54Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788594723",
            "id": 1788594723,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm8oj",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349582078,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788594723/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T13:28:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788594723",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788596875"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788596875"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Ah, I see. Being focused on creating the correct test I left the wrong untested change. The original change I tested manually was placed inside installed lua files and lost with next `make install`. Without checking I see that `#line` (like described in the issue, not `cursor_row`) should be probably change to `cursor_col`. ",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T13:35:45Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788596875",
            "id": 1788596875,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm9KL",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349585677,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788596875/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T14:03:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788596875",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788604359"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788604359"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "Even after changing the argument there is an incorrect \"suffix\" that is pasted after the completed word. ",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T13:51:41Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788604359",
            "id": 1788604359,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm-_H",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349595399,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788604359/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T13:51:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788604359",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788605316"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788605316"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "I see that returning empty string can avoid that but not aware possibly side effect (and all tests from `./test/functional/plugin/lsp/completion_spec.lua` passed for me).",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T13:57:57Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788605316",
            "id": 1788605316,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm_OE",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349596492,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788605316/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T13:57:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788605316",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788607561"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607561"
                }
            },
            "author_association": "MEMBER",
            "body": "> Even after changing the argument there is an incorrect \"suffix\" that is pasted after the completed word.\r\n\r\nYou'd also have to adapt the `suffix` logic.\r\n`apply_snippet` no longer needs to have a `suffix` parameter and `clear_word` doesn't need to have a return value\r\n\r\n```diff\r\ndiff --git a/runtime/lua/vim/lsp/completion.lua b/runtime/lua/vim/lsp/completion.lua\r\nindex 71ea2df10..fa9cf3e88 100644\r\n--- a/runtime/lua/vim/lsp/completion.lua\r\n+++ b/runtime/lua/vim/lsp/completion.lua\r\n@@ -111,16 +111,15 @@ local function parse_snippet(input)\r\n   end)\r\n   return ok and tostring(parsed) or input\r\n end\r\n \r\n --- @param item lsp.CompletionItem\r\n---- @param suffix? string\r\n-local function apply_snippet(item, suffix)\r\n+local function apply_snippet(item)\r\n   if item.textEdit then\r\n-    vim.snippet.expand(item.textEdit.newText .. suffix)\r\n+    vim.snippet.expand(item.textEdit.newText)\r\n   elseif item.insertText then\r\n-    vim.snippet.expand(item.insertText .. suffix)\r\n+    vim.snippet.expand(item.insertText)\r\n   end\r\n end\r\n \r\n --- Returns text that should be inserted when a selecting completion item. The\r\n --- precedence is as follows: textEdit.newText > insertText > label\r\n@@ -537,19 +536,16 @@ local function on_complete_done()\r\n       return nil\r\n     end\r\n \r\n     -- Remove the already inserted word.\r\n     local start_char = cursor_col - #completed_item.word\r\n-    local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\r\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\r\n-    return line:sub(cursor_col + 1)\r\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, cursor_col, { '' })\r\n   end\r\n \r\n-  --- @param suffix? string\r\n-  local function apply_snippet_and_command(suffix)\r\n+  local function apply_snippet_and_command()\r\n     if expand_snippet then\r\n-      apply_snippet(completion_item, suffix)\r\n+      apply_snippet(completion_item)\r\n     end\r\n \r\n     local command = completion_item.command\r\n     if command then\r\n       client:_exec_cmd(command, { bufnr = bufnr }, nil, function()\r\n@@ -563,37 +559,37 @@ local function on_complete_done()\r\n       end)\r\n     end\r\n   end\r\n \r\n   if completion_item.additionalTextEdits and next(completion_item.additionalTextEdits) then\r\n-    local suffix = clear_word()\r\n+    clear_word()\r\n     lsp.util.apply_text_edits(completion_item.additionalTextEdits, bufnr, offset_encoding)\r\n-    apply_snippet_and_command(suffix)\r\n+    apply_snippet_and_command()\r\n   elseif resolve_provider and type(completion_item) == 'table' then\r\n     local changedtick = vim.b[bufnr].changedtick\r\n \r\n     --- @param result lsp.CompletionItem\r\n     client.request(ms.completionItem_resolve, completion_item, function(err, result)\r\n       if changedtick ~= vim.b[bufnr].changedtick then\r\n         return\r\n       end\r\n \r\n-      local suffix = clear_word()\r\n+      clear_word()\r\n       if err then\r\n         vim.notify_once(err.message, vim.log.levels.WARN)\r\n       elseif result and result.additionalTextEdits then\r\n         lsp.util.apply_text_edits(result.additionalTextEdits, bufnr, offset_encoding)\r\n         if result.command then\r\n           completion_item.command = result.command\r\n         end\r\n       end\r\n \r\n-      apply_snippet_and_command(suffix)\r\n+      apply_snippet_and_command()\r\n     end, bufnr)\r\n   else\r\n-    local suffix = clear_word()\r\n-    apply_snippet_and_command(suffix)\r\n+    clear_word()\r\n+    apply_snippet_and_command()\r\n   end\r\n end\r\n \r\n --- @class vim.lsp.completion.BufferOpts\r\n --- @field autotrigger? boolean Whether to trigger completion automatically. Default: false\r\n```",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T14:06:17Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788607561",
            "id": 1788607561,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm_xJ",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349599557,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607561/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T14:06:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607561",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1788607579"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607579"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "> Regarding `#line`, what do you find suspicious about it @justinmk?\r\n\r\nLike in #30656 - the part from the end of the word to the end of line is appended to the string that is then expanded as a snippet. ",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-05T14:06:29Z",
            "diff_hunk": "@@ -540,7 +540,7 @@ local function on_complete_done()\n     -- Remove the already inserted word.\n     local start_char = cursor_col - #completed_item.word\n     local line = api.nvim_buf_get_lines(bufnr, cursor_row, cursor_row + 1, true)[1]\n-    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_row, #line, { '' })\n+    api.nvim_buf_set_text(bufnr, cursor_row, start_char, cursor_col, #line, { '' })",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1788607579",
            "id": 1788607579,
            "in_reply_to_id": 1788592425,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qm_xb",
            "original_commit_id": "131fdaa89e87498d191413f683f671365ba10168",
            "original_line": 543,
            "original_position": 5,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2349599580,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607579/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-05T14:06:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1788607579",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1790291011"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1790291011"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n  it('puts cursor at the end of completed word', function()\r\n```",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-07T14:03:13Z",
            "diff_hunk": "@@ -726,3 +731,68 @@ describe('vim.lsp.completion: protocol', function()\n     end)\n   end)\n end)\n+\n+describe('vim.lsp.completion: integration', function()\n+  before_each(function()\n+    clear()\n+    exec_lua(create_server_definition)\n+  end)\n+\n+  after_each(clear)\n+\n+  it('should put cursor at the end of completed word', function()",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1790291011",
            "id": 1790291011,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5qtaxD",
            "original_commit_id": "f4bb0bd4e8cfdf83ed4e70c671816a530188b492",
            "original_line": 743,
            "original_position": 95,
            "original_start_line": null,
            "path": "test/functional/plugin/lsp/completion_spec.lua",
            "position": null,
            "pull_request_review_id": 2352053588,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1790291011/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-07T14:03:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1790291011",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1793398339"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793398339"
                }
            },
            "author_association": "MEMBER",
            "body": "is there a 1-line comment that can give a hint about why the schedule() is needed?",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-09T12:04:27Z",
            "diff_hunk": "@@ -462,7 +461,9 @@ local function trigger(bufnr, clients)\n       end\n     end\n     local start_col = (server_start_boundary or word_boundary) + 1\n-    vim.fn.complete(start_col, matches)\n+    vim.schedule(function()\n+      vim.fn.complete(start_col, matches)",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1793398339",
            "id": 1793398339,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5q5RZD",
            "original_commit_id": "a7bb6574e7f9dd58368af58e1ac6220d93a3bf50",
            "original_line": 465,
            "original_position": 22,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2356946712,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793398339/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-09T12:04:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793398339",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1793860219"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793860219"
                }
            },
            "author_association": "MEMBER",
            "body": "It raises a `Vim:E565: Not allowed to change text or change window`  without it.\r\n\r\nI suspect this doesn't happen outside of test-cases because the rpc layer already adds a schedule to escape the luv callback.\r\n\r\nWe could probably also do something like this:\r\n\r\n```diff\r\ndiff --git a/test/functional/plugin/lsp/completion_spec.lua b/test/functional/plugin/lsp/completion_spec.lua\r\nindex 7e2dd0fbe3..a25bc738c9 100644\r\n--- a/test/functional/plugin/lsp/completion_spec.lua\r\n+++ b/test/functional/plugin/lsp/completion_spec.lua\r\n@@ -729,13 +729,10 @@ end)\r\n \r\n describe('vim.lsp.completion: integration', function()\r\n   before_each(function()\r\n     clear()\r\n     exec_lua(create_server_definition)\r\n-    exec_lua(function()\r\n-      vim.fn.complete = vim.schedule_wrap(vim.fn.complete)\r\n-    end)\r\n   end)\r\n \r\n   after_each(clear)\r\n \r\n   it('puts cursor at the end of completed word', function()\r\ndiff --git a/test/functional/plugin/lsp/testutil.lua b/test/functional/plugin/lsp/testutil.lua\r\nindex a36cbac568..ca00805a16 100644\r\n--- a/test/functional/plugin/lsp/testutil.lua\r\n+++ b/test/functional/plugin/lsp/testutil.lua\r\n@@ -62,10 +62,11 @@ M.create_server_definition = function()\r\n       function srv.request(method, params, callback)\r\n         table.insert(server.messages, {\r\n           method = method,\r\n           params = params,\r\n         })\r\n+        callback = vim.schedule_wrap(callback)\r\n         local handler = handlers[method]\r\n         if handler then\r\n           handler(method, params, callback)\r\n         elseif method == 'initialize' then\r\n           callback(nil, {\r\n```",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-09T16:56:56Z",
            "diff_hunk": "@@ -462,7 +461,9 @@ local function trigger(bufnr, clients)\n       end\n     end\n     local start_col = (server_start_boundary or word_boundary) + 1\n-    vim.fn.complete(start_col, matches)\n+    vim.schedule(function()\n+      vim.fn.complete(start_col, matches)",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1793860219",
            "id": 1793860219,
            "in_reply_to_id": 1793398339,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5q7CJ7",
            "original_commit_id": "a7bb6574e7f9dd58368af58e1ac6220d93a3bf50",
            "original_line": 465,
            "original_position": 22,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2357712020,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793860219/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-09T16:56:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793860219",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1793889956"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793889956"
                }
            },
            "author_association": "CONTRIBUTOR",
            "body": "@mfussenegger please feel free to make such change here if you are sure that we need to schedule each request callback in the test server.",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-09T17:18:22Z",
            "diff_hunk": "@@ -462,7 +461,9 @@ local function trigger(bufnr, clients)\n       end\n     end\n     local start_col = (server_start_boundary or word_boundary) + 1\n-    vim.fn.complete(start_col, matches)\n+    vim.schedule(function()\n+      vim.fn.complete(start_col, matches)",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1793889956",
            "id": 1793889956,
            "in_reply_to_id": 1793398339,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5q7Jak",
            "original_commit_id": "a7bb6574e7f9dd58368af58e1ac6220d93a3bf50",
            "original_line": 465,
            "original_position": 22,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2357756843,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793889956/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-09T17:18:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793889956",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1793900425"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793900425"
                }
            },
            "author_association": "MEMBER",
            "body": "I'd tend to, alone for the reason to bring the in-process test server closer to the behavior of a cmd-stdio/tcp server.\r\n\r\nAnd for future people + test-cases - debugging that this was necessary took quite some time as it's non-obvious and the errror wasn't propagated.",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-09T17:26:57Z",
            "diff_hunk": "@@ -462,7 +461,9 @@ local function trigger(bufnr, clients)\n       end\n     end\n     local start_col = (server_start_boundary or word_boundary) + 1\n-    vim.fn.complete(start_col, matches)\n+    vim.schedule(function()\n+      vim.fn.complete(start_col, matches)",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1793900425",
            "id": 1793900425,
            "in_reply_to_id": 1793398339,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5q7L-J",
            "original_commit_id": "a7bb6574e7f9dd58368af58e1ac6220d93a3bf50",
            "original_line": 465,
            "original_position": 22,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2357773333,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793900425/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-09T17:26:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1793900425",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/30659#discussion_r1795062257"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/30659"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1795062257"
                }
            },
            "author_association": "MEMBER",
            "body": "Looks like making it general would break a couple of other tests due to the changed timing.\r\nGiven the impact I'd rather change this separately so I'm going ahead and merge this as is.",
            "commit_id": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
            "created_at": "2024-10-10T09:32:55Z",
            "diff_hunk": "@@ -462,7 +461,9 @@ local function trigger(bufnr, clients)\n       end\n     end\n     local start_col = (server_start_boundary or word_boundary) + 1\n-    vim.fn.complete(start_col, matches)\n+    vim.schedule(function()\n+      vim.fn.complete(start_col, matches)",
            "html_url": "https://github.com/neovim/neovim/pull/30659#discussion_r1795062257",
            "id": 1795062257,
            "in_reply_to_id": 1793398339,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5q_nnx",
            "original_commit_id": "a7bb6574e7f9dd58368af58e1ac6220d93a3bf50",
            "original_line": 465,
            "original_position": 22,
            "original_start_line": null,
            "path": "runtime/lua/vim/lsp/completion.lua",
            "position": null,
            "pull_request_review_id": 2359649703,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1795062257/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-10-10T09:32:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1795062257",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Still a draft while here is no test for #30656. ",
            "created_at": "2024-10-04T13:43:53Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2393741798",
            "id": 2393741798,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OrZnm",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2393741798/reactions"
            },
            "updated_at": "2024-10-04T13:43:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2393741798",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Probably I need help with creating test. I'm not sure if I can check the cursor position in `test/functional/plugin/lsp/completion_spec.lua` I tried \r\n```lua\r\n  it('should put cursor at the end of completed word', function()\r\n    local completion_list = {\r\n      isIncomplete = false,\r\n      items = {\r\n        {\r\n          insertText = \"bo\",\r\n          insertTextFormat = 2,\r\n          kind = 10,\r\n          label = \"bo?\",\r\n          sortText = \"0001\",\r\n        },\r\n      },\r\n    }\r\n    local expected = {\r\n      abbr = \"bo?\",\r\n      dup = 1,\r\n      empty = 1,\r\n      hl_group = \"\",\r\n      icase = 1,\r\n      info = \"\",\r\n      kind = \"Property\",\r\n      menu = \"\",\r\n      word = \"bo\",\r\n    }\r\n    local line = 'vim._with({bo|}, f)'\r\n    local cursor_col_before = line:find('|') - 1\r\n    local result = complete(line, completion_list)\r\n\r\n    local cursor_col_after = exec_lua(function ()\r\n      return vim.fn.col(\".\")\r\n      -- local row, col = vim.api.nvim_win_get_cursor(0)\r\n      -- return col\r\n    end)\r\n    eq(cursor_col_before, cursor_col_after)\r\n  end)\r\n```\r\nin `vim.lsp.completion: protocol` set. ",
            "created_at": "2024-10-04T15:57:18Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2394013678",
            "id": 2394013678,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Osb_u",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2394013678/reactions"
            },
            "updated_at": "2024-10-04T15:57:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2394013678",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Probably I need help with creating test. I'm not sure if I can check the cursor position in `test/functional/plugin/lsp/completion_spec.lua` I\r\n\r\nA new test probably isn't needed, just assert the cursor position in an existing test (may need to add some extra text to the initial buffer, to cover this scenario).\r\n\r\nWhat problem did you have with checking `nvim_win_get_cursor` or `vim.fn.col(\".\")` ?",
            "created_at": "2024-10-05T13:19:09Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395055667",
            "id": 2395055667,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OwaYz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395055667/reactions"
            },
            "updated_at": "2024-10-05T13:19:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395055667",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> What problem did you have with checking `nvim_win_get_cursor` or `vim.fn.col(\".\")` ?\r\n\r\n\r\nWith `return vim.fn.col(\".\")` (as above) I get\r\n```\r\nFAILED   ./test/functional/plugin/lsp/completion_spec.lua @ 542: vim.lsp.completion: protocol should put cursor at the end of completed word\r\n./test/functional/plugin/lsp/completion_spec.lua:575: Expected objects to be the same.\r\nPassed in:\r\n(number) 1\r\nExpected:\r\n(number) 13\r\n```",
            "created_at": "2024-10-05T13:42:05Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395062941",
            "id": 2395062941,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OwcKd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395062941/reactions"
            },
            "updated_at": "2024-10-05T13:42:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395062941",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> > What problem did you have with checking `nvim_win_get_cursor` or `vim.fn.col(\".\")` ?\r\n> \r\n> With `return vim.fn.col(\".\")` (as above) I get\r\n> \r\n> ```\r\n> FAILED   ./test/functional/plugin/lsp/completion_spec.lua @ 542: vim.lsp.completion: protocol should put cursor at the end of completed word\r\n> ./test/functional/plugin/lsp/completion_spec.lua:575: Expected objects to be the same.\r\n> Passed in:\r\n> (number) 1\r\n> Expected:\r\n> (number) 13\r\n> ```\r\n\r\nIn the snippet tests I use [this utility function](https://github.com/neovim/neovim/blob/988482d9422b40e86225935326127063d881b090/test/functional/lua/snippet_spec.lua#L115) to verify the cursor position. Maybe try something similar?",
            "created_at": "2024-10-05T14:04:37Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395069651",
            "id": 2395069651,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OwdzT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395069651/reactions"
            },
            "updated_at": "2024-10-05T14:04:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395069651",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > > What problem did you have with checking `nvim_win_get_cursor` or `vim.fn.col(\".\")` ?\r\n> > \r\n> > \r\n> > With `return vim.fn.col(\".\")` (as above) I get\r\n> > ```\r\n> > FAILED   ./test/functional/plugin/lsp/completion_spec.lua @ 542: vim.lsp.completion: protocol should put cursor at the end of completed word\r\n> > ./test/functional/plugin/lsp/completion_spec.lua:575: Expected objects to be the same.\r\n> > Passed in:\r\n> > (number) 1\r\n> > Expected:\r\n> > (number) 13\r\n> > ```\r\n> \r\n> In the snippet tests I use [this utility function](https://github.com/neovim/neovim/blob/988482d9422b40e86225935326127063d881b090/test/functional/lua/snippet_spec.lua#L115) to verify the cursor position. Maybe try something similar?\r\n\r\nYou can see I tried it but forgot to `unpack` the result. \r\n```lua\r\n    local cursor_col_after = exec_lua(function ()\r\n      -- return vim.fn.col(\".\")\r\n      local row, col = unpack(vim.api.nvim_win_get_cursor(0))\r\n      return col\r\n    end)\r\n```\r\nThe effect is the same (0 as the first column).",
            "created_at": "2024-10-05T14:17:59Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395073853",
            "id": 2395073853,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Owe09",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395073853/reactions"
            },
            "updated_at": "2024-10-05T14:17:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395073853",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "```lua\r\n    local line = 'vim._with({bo|}, f)'\r\n    local cursor_col_before = line:find('|') - 1\r\n    local result = complete(line, completion_list)\r\n    local cursor_col_after = exec_lua(function ()\r\n      -- return vim.fn.col(\".\")\r\n      local row, col = unpack(vim.api.nvim_win_get_cursor(0))\r\n      return col\r\n    end)\r\n    eq(cursor_col_before, cursor_col_after)\r\n\r\n```\r\nIs it possible that `complete` executes something asynchronously and `cursor_col_after` can be checked too early?",
            "created_at": "2024-10-05T14:22:37Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395075023",
            "id": 2395075023,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OwfHP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395075023/reactions"
            },
            "updated_at": "2024-10-05T14:22:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395075023",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "We need to test the callback attached to `CompleteDone` that is not executed in `completion_spec.lua` and is a local function. I need a different approach than what I originally proposed. ",
            "created_at": "2024-10-05T18:06:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395136306",
            "id": 2395136306,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OwuEy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395136306/reactions"
            },
            "updated_at": "2024-10-05T18:06:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395136306",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "```lua\r\n  it('should put cursor at the end of completed word', function()\r\n    local line = 'vim._with({n|}, f)'\r\n    local cursor_col = line:find('|') - 1\r\n    line = line:gsub('|', '')\r\n    local line_to_cursor = line:sub(1, cursor_col)\r\n    local client_start_boundary = exec_lua(function ()\r\n      return vim.fn.match(line_to_cursor, '\\\\k*$')\r\n    end)\r\n    local completed_word = 'noautocmd'\r\n\r\n    local expected_cursor_column = client_start_boundary + #completed_word\r\n\r\n    local cursor_column = exec_lua(function()\r\n      local buf = vim.api.nvim_get_current_buf()\r\n      vim.api.nvim_buf_set_lines(buf, 0, 1, true, {line})\r\n      vim.api.nvim_win_set_cursor(0, {1, cursor_col})\r\n      vim.cmd.startinsert()\r\n      vim.api.nvim_buf_set_text(0, 0, client_start_boundary, 0, cursor_col, {completed_word})\r\n      vim.api.nvim_set_vvar('completed_item', {\r\n        abbr = 'noautocmd?',\r\n        info = '',\r\n        kind = 'Property',\r\n        menu = '',\r\n        user_data = {\r\n          nvim = {\r\n            lsp = {\r\n              client_id = 1,\r\n              completion_item = {\r\n                data = {\r\n                  id = 1,\r\n                  uri = 'file:///tmp/test.lua'\r\n                },\r\n                insertText = 'noautocmd',\r\n                insertTextFormat = 2,\r\n                kind = 10,\r\n                label = 'noautocmd?',\r\n                sortText = '0001'\r\n              }\r\n            }\r\n          }\r\n        },\r\n        word = 'noautocmd',\r\n      })\r\n\r\n      vim.api.nvim_exec_autocmds('CompleteDone', { buffer = buf, modeline = false })\r\n\r\n      local _, col = unpack(vim.api.nvim_win_get_cursor(0))\r\n\r\n      return col\r\n    end)\r\n\r\n    eq(expected_cursor_column, cursor_column)\r\n  end)\r\n```\r\nIt seems to be closer to what we want but still needs to run the autocommand (probably run `vim.lsp.completion.enable`) and (how to do?) simulate `vim.v.event.reason == 'accept'`. ",
            "created_at": "2024-10-05T19:45:51Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395170659",
            "id": 2395170659,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Ow2dj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395170659/reactions"
            },
            "updated_at": "2024-10-05T19:45:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395170659",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Now the problem is that **in the test** the result word is appended to the existing part instead of replacing it. For example completion `vim._with({no|}, f)` results with `vim._with({nonoautocmd}, f)`. ",
            "created_at": "2024-10-05T23:08:29Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395221597",
            "id": 2395221597,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OxC5d",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395221597/reactions"
            },
            "updated_at": "2024-10-05T23:08:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395221597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> (how to do?) simulate `vim.v.event.reason == 'accept'`.\r\n\r\nlooks like you figured that out, right? (`feed('<c-y>')`).\r\n\r\n\r\n> Now the problem is that **in the test** the result word is appended to the existing part instead of replacing it. For example completion `vim._with({no|}, f)` results with `vim._with({nonoautocmd}, f)`.\r\n\r\nbut it works interactively? are you certain `trigger_at_pos` is triggering at the right position?",
            "created_at": "2024-10-06T09:03:50Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395357637",
            "id": 2395357637,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6OxkHF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395357637/reactions"
            },
            "updated_at": "2024-10-06T09:03:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395357637",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> but it works interactively? are you certain `trigger_at_pos` is triggering at the right position?\r\n\r\nI have no problem with interactive use unless someone points out some untested use case.\r\n\r\n> looks like you figured that out, right? (`feed('<c-y>')`).\r\n\r\nYes, `on_complete_done` is executed also in the test case, but I found that `clear_word` isn't. I suspect we need to add a resolve provider to the server.\r\n",
            "created_at": "2024-10-06T11:35:57Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395404785",
            "id": 2395404785,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Oxvnx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395404785/reactions"
            },
            "updated_at": "2024-10-06T11:36:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395404785",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Adding \r\n```diff\r\ndiff --git a/test/functional/plugin/lsp/completion_spec.lua b/test/functional/plugin/lsp/completion_spec.lua\r\nindex 73961506f..3b78f8ca9 100644\r\n--- a/test/functional/plugin/lsp/completion_spec.lua\r\n+++ b/test/functional/plugin/lsp/completion_spec.lua\r\n@@ -495,6 +495,7 @@ describe('vim.lsp.completion: protocol', function()\r\n         capabilities = {\r\n           completionProvider = {\r\n             triggerCharacters = { '.' },\r\n+            resolveProvider = true,\r\n           },\r\n         },\r\n```\r\nis probably needed like above (but then it seems to affect `vim.lsp.completion: protocol executes commands` case) on in another way, but it's not enough: we need some response from `completionItem/resolve` like \r\n````lua\r\n{\r\n  data = {\r\n    id = 1,\r\n    uri = \"file:///.../examples/with.lua\"\r\n  },\r\n  detail = \"boolean?\",\r\n  documentation = {\r\n    kind = \"markdown\",\r\n    value = \"```lua\\n(field) vim.context.mods.noautocmd: boolean?\\n```\"\r\n  },\r\n  insertText = \"noautocmd\",\r\n  insertTextFormat = 2,\r\n  kind = 10,\r\n  label = \"noautocmd?\",\r\n  sortText = \"0001\"\r\n}\r\n````",
            "created_at": "2024-10-06T12:03:15Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395413301",
            "id": 2395413301,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Oxxs1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395413301/reactions"
            },
            "updated_at": "2024-10-06T12:03:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395413301",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Now I see that `vim.snippet.expand('noautocmd')` is executed in the test case, but the cursor still isn't placed as expected. ",
            "created_at": "2024-10-06T13:42:23Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395445317",
            "id": 2395445317,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Ox5hF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395445317/reactions"
            },
            "updated_at": "2024-10-06T13:42:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395445317",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "if there is potential for a race while waiting for the server request/response, may be worth trying `t.retry()` https://github.com/neovim/neovim/blob/056009f74146b349c66790fbcba3130e85a6c6da/test/testutil.lua#L96",
            "created_at": "2024-10-06T14:41:19Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2395464753",
            "id": 2395464753,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6Ox-Qx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395464753/reactions"
            },
            "updated_at": "2024-10-06T14:41:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2395464753",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The problem has place before `CompleteDone`. To reduce complexity I put `vim.api.nvim_clear_autocmds({group = ('vim/lsp/completion-%d'):format(vim.api.nvim_get_current_buf())})` before `vim.v.completed_item = ...` and see that the buffer is not updated. Probably it was not necessary to any previous test. For example, the case `executes commands` behaves the same - we can see it adding \r\n```lua\r\n    local col_line = exec_lua(function()\r\n      return { vim.api.nvim_win_get_cursor(0)[2], vim.api.nvim_buf_get_lines(0, 0, 1, true)[1]}\r\n    end)\r\n    eq({5, 'hello'}, col_line)\r\n```\r\nat the end (the result is `{1, 'h'}`). \r\n\r\nI suspect that overriding `vim.fn.complete()` is not enough for this test, but still not understand why. After commenting it (with dependants) I get the correct result, both with and without `CompleteDone` autocommand. ",
            "created_at": "2024-10-07T12:36:18Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2396810070",
            "id": 2396810070,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6O3GtW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396810070/reactions"
            },
            "updated_at": "2024-10-07T12:36:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396810070",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Probably it was not necessary to any previous test\r\n\r\nsounds good. is this unblocked then?",
            "created_at": "2024-10-07T13:07:47Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2396883393",
            "id": 2396883393,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6O3YnB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396883393/reactions"
            },
            "updated_at": "2024-10-07T13:07:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396883393",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Before the change I tried to catch the new cursor position using `retry` but with no success. \r\n\r\nFinally I created a separate test set with as much shared local functions as possible with original `vim.fn.complete`. ",
            "created_at": "2024-10-07T13:24:31Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2396928333",
            "id": 2396928333,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6O3jlN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396928333/reactions"
            },
            "updated_at": "2024-10-07T13:24:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2396928333",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "After switching to use original `vim.fn.complete` setting `vim.v.completed_item` stopped working. Now this assignment works under `CompleteDone` autocommand created before `vim.lsp.completion.enable` creates its own analogue.\r\n\r\n",
            "created_at": "2024-10-07T18:51:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2397650287",
            "id": 2397650287,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6O6T1v",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2397650287/reactions"
            },
            "updated_at": "2024-10-07T18:51:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2397650287",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> is probably needed like above (but then it seems to affect vim.lsp.completion: protocol executes commands case) on in another way, but it's not enough: we need some response from completionItem/resolve like\r\n\r\n`resolve` shouldn't be needed to expand snippets, that's entirely optional.\r\nIt looks like there was just a `clear_word()` call missing in one of the branches.\r\n\r\n\r\nThat `feed('<c-x><c-o>')` didn't trigger completion correctly seems to be related to a missing `vim.schedule` call - `vim.fn.complete()` wasn't called in the mainloop but in a luv callback.\r\n\r\nI'm not entirely sure why that's only in the testcase a problem. Maybe due to the test-case using the in-process server.\r\n\r\nWith these two things fixed, it's possible to simplify the test-case:\r\n\r\n\r\n```diff\r\ndiff --git a/runtime/lua/vim/lsp/completion.lua b/runtime/lua/vim/lsp/completion.lua\r\nindex e399a6a829..2e88672e58 100644\r\n--- a/runtime/lua/vim/lsp/completion.lua\r\n+++ b/runtime/lua/vim/lsp/completion.lua\r\n@@ -459,11 +459,13 @@ local function trigger(bufnr, clients)\r\n         )\r\n         vim.list_extend(matches, client_matches)\r\n       end\r\n     end\r\n     local start_col = (server_start_boundary or word_boundary) + 1\r\n-    vim.fn.complete(start_col, matches)\r\n+    vim.schedule(function()\r\n+      vim.fn.complete(start_col, matches)\r\n+    end)\r\n   end)\r\n \r\n   table.insert(Context.pending_requests, cancel_request)\r\n end\r\n \r\n@@ -584,10 +586,11 @@ local function on_complete_done()\r\n       end\r\n \r\n       apply_snippet_and_command()\r\n     end, bufnr)\r\n   else\r\n+    clear_word()\r\n     apply_snippet_and_command()\r\n   end\r\n end\r\n \r\n --- @class vim.lsp.completion.BufferOpts\r\ndiff --git a/test/functional/plugin/lsp/completion_spec.lua b/test/functional/plugin/lsp/completion_spec.lua\r\nindex 579c4a7acf..dc1f8a19f3 100644\r\n--- a/test/functional/plugin/lsp/completion_spec.lua\r\n+++ b/test/functional/plugin/lsp/completion_spec.lua\r\n@@ -739,70 +739,36 @@ describe('vim.lsp.completion: integration', function()\r\n   end)\r\n \r\n   after_each(clear)\r\n \r\n   it('puts cursor at the end of completed word', function()\r\n-    local line = ('vim._with({%s|}, f)'):format('noau')\r\n-    local completed_word = 'noautocmd'\r\n-\r\n-    local completion_item = {\r\n-      insertText = completed_word,\r\n-      insertTextFormat = 2, -- vim.lsp.protocol.InsertTextFormat.Snippet\r\n-      label = completed_word,\r\n-    }\r\n-\r\n     local completion_list = {\r\n       isIncomplete = false,\r\n-      items = { completion_item },\r\n+      items = {\r\n+        {\r\n+          label = 'hello',\r\n+          insertText = \"${1:hello} friends\",\r\n+          insertTextFormat = 2,\r\n+        },\r\n+      },\r\n     }\r\n-\r\n-    local initial_cursor_col = line:find('|') - 1\r\n-    line = line:gsub('|', '')\r\n-    local line_to_cursor = line:sub(1, initial_cursor_col)\r\n-    local word_start = exec_lua(function()\r\n-      return vim.fn.match(line_to_cursor, '\\\\k*$')\r\n-    end)\r\n-\r\n     exec_lua(function()\r\n-      vim.api.nvim_create_autocmd('CompleteDone', {\r\n-        callback = function()\r\n-          vim.v.completed_item = {\r\n-            user_data = {\r\n-              nvim = {\r\n-                lsp = {\r\n-                  client_id = vim.tbl_keys(vim.lsp.get_clients({ name = 'dummy' }))[1],\r\n-                  completion_item = completion_item,\r\n-                },\r\n-              },\r\n-            },\r\n-            word = completed_word,\r\n-          }\r\n-        end,\r\n-      })\r\n+      vim.o.completeopt = 'menuone,noselect'\r\n     end)\r\n-\r\n-    local expected_cursor_column = word_start + #completed_word\r\n-\r\n-    create_server(completion_list, completion_item)\r\n-    eq(\r\n-      1,\r\n-      exec_lua(function()\r\n-        return #vim.lsp.get_clients()\r\n-      end)\r\n-    )\r\n-\r\n-    feed('i' .. line)\r\n-\r\n-    exec_lua(function()\r\n-      vim.api.nvim_win_set_cursor(0, { 1, initial_cursor_col })\r\n-      vim.lsp.completion.trigger()\r\n+    create_server(completion_list)\r\n+    feed('i world<esc>0ih<c-x><c-o>')\r\n+    retry(nil, nil, function()\r\n+      eq(1, exec_lua(function() return vim.fn.pumvisible() end))\r\n     end)\r\n-\r\n-    feed('<C-x><C-o><C-y>')\r\n-\r\n-    local cursor_column = exec_lua(function()\r\n+    feed('<C-n><C-y>')\r\n+    eq({true, {\"hello friends world\"}}, exec_lua(function()\r\n+      return {\r\n+        vim.snippet.active({ direction = 1}),\r\n+        vim.api.nvim_buf_get_lines(0, 0, -1, true)\r\n+      }\r\n+    end))\r\n+    feed('<tab>')\r\n+    eq(#\"hello friends\", exec_lua(function()\r\n       return vim.api.nvim_win_get_cursor(0)[2]\r\n-    end)\r\n-\r\n-    eq(expected_cursor_column, cursor_column)\r\n+    end))\r\n   end)\r\n end)\r\n```\r\n",
            "created_at": "2024-10-08T19:39:21Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400678691",
            "id": 2400678691,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PF3Mj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400678691/reactions"
            },
            "updated_at": "2024-10-08T19:39:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400678691",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Indeed, `clear_word` was present on master when no resolve provider. Now it is again there and does not affect the current test case.\r\n\r\n@mfussenegger can you reproduce the bug with cleared `CompleteDone` autocommand (e.g. `vim.api.nvim_clear_autocmds({group = string.format('vim/lsp/completion-%d', args.buf)})` in LspAttach)? I cannot (also with scheduled `complete()`). \r\n\r\nIt would be nice to have simpler test case and it seems for me that `clear_word()` in _no resolve_ case should cause the same bug but I still cannot see it on master. Let's wait for finding the explanation before we simplify the test case. ",
            "created_at": "2024-10-08T21:34:40Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400864206",
            "id": 2400864206,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PGkfO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400864206/reactions"
            },
            "updated_at": "2024-10-08T21:34:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400864206",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I confused disabling the whole `CompleteDone` callback with only resolve provider. It probably will allow me see what happens. ",
            "created_at": "2024-10-08T21:37:54Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400868463",
            "id": 2400868463,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PGlhv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400868463/reactions"
            },
            "updated_at": "2024-10-08T21:37:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400868463",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm not sure what you mean. My posted test-case will fail without the the `suffix`/`#line` change and passes with the fixes from this PR",
            "created_at": "2024-10-08T21:59:28Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400894878",
            "id": 2400894878,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PGr-e",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400894878/reactions"
            },
            "updated_at": "2024-10-08T21:59:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400894878",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "After adding `client.server_capabilities.completionProvider.resolveProvider = nil` (in `LspAttah`) to the real repro I see the bug so we can simplify the test case probably as you suggest :)",
            "created_at": "2024-10-08T22:04:42Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400901276",
            "id": 2400901276,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PGtic",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400901276/reactions"
            },
            "updated_at": "2024-10-08T22:04:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400901276",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thank you all for the hints. Writing this test turned out to be not as simple as the fix itself.",
            "created_at": "2024-10-08T22:47:42Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2400948832",
            "id": 2400948832,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PG5Jg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400948832/reactions"
            },
            "updated_at": "2024-10-08T22:47:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2400948832",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The current test fails without `schedule`d `complete`. I have no idea of an example that shows the need of `schedule` in real environment. ",
            "created_at": "2024-10-09T13:01:45Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2402267559",
            "id": 2402267559,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PL7Gn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402267559/reactions"
            },
            "updated_at": "2024-10-09T13:01:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402267559",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "While not sure we can redefine\r\n```lua\r\n    exec_lua(function()\r\n      vim.fn.complete = vim.schedule_wrap(vim.fn.complete)\r\n    end)\r\n```\r\nonly for the test case. ",
            "created_at": "2024-10-09T13:19:21Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2402330821",
            "id": 2402330821,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PMKjF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402330821/reactions"
            },
            "updated_at": "2024-10-09T13:19:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402330821",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Even if we need such `schedule` in real env, it's probably a separate issue. @mfussenegger what do you think?",
            "created_at": "2024-10-09T13:26:43Z",
            "html_url": "https://github.com/neovim/neovim/pull/30659#issuecomment-2402348311",
            "id": 2402348311,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
            "node_id": "IC_kwDOAPphoM6PMO0X",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402348311/reactions"
            },
            "updated_at": "2024-10-09T13:26:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2402348311",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30659/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/30659/commits",
    "created_at": "2024-10-04T13:37:23Z",
    "diff_url": "https://github.com/neovim/neovim/pull/30659.diff",
    "draft": false,
    "head": {
        "label": "przepompownia:complete-done-cursor-jump",
        "ref": "complete-done-cursor-jump",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/przepompownia/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/przepompownia/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/przepompownia/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/przepompownia/neovim/branches{/branch}",
            "clone_url": "https://github.com/przepompownia/neovim.git",
            "collaborators_url": "https://api.github.com/repos/przepompownia/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/przepompownia/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/przepompownia/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/przepompownia/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/przepompownia/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/przepompownia/neovim/contributors",
            "created_at": "2023-09-25T21:56:41Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/przepompownia/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/przepompownia/neovim/downloads",
            "events_url": "https://api.github.com/repos/przepompownia/neovim/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/przepompownia/neovim/forks",
            "full_name": "przepompownia/neovim",
            "git_commits_url": "https://api.github.com/repos/przepompownia/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/przepompownia/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/przepompownia/neovim/git/tags{/sha}",
            "git_url": "git://github.com/przepompownia/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/przepompownia/neovim/hooks",
            "html_url": "https://github.com/przepompownia/neovim",
            "id": 696503495,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/przepompownia/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/przepompownia/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/przepompownia/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/przepompownia/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/przepompownia/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/przepompownia/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/przepompownia/neovim/merges",
            "milestones_url": "https://api.github.com/repos/przepompownia/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOKYPMxw",
            "notifications_url": "https://api.github.com/repos/przepompownia/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/przepompownia/neovim/pulls{/number}",
            "pushed_at": "2024-10-14T05:31:02Z",
            "releases_url": "https://api.github.com/repos/przepompownia/neovim/releases{/id}",
            "size": 280924,
            "ssh_url": "git@github.com:przepompownia/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/przepompownia/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/przepompownia/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/przepompownia/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/przepompownia/neovim/subscription",
            "svn_url": "https://github.com/przepompownia/neovim",
            "tags_url": "https://api.github.com/repos/przepompownia/neovim/tags",
            "teams_url": "https://api.github.com/repos/przepompownia/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/przepompownia/neovim/git/trees{/sha}",
            "updated_at": "2024-10-04T13:37:48Z",
            "url": "https://api.github.com/repos/przepompownia/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
            "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
            "followers_url": "https://api.github.com/users/przepompownia/followers",
            "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
            "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/przepompownia",
            "id": 11404453,
            "login": "przepompownia",
            "node_id": "MDQ6VXNlcjExNDA0NDUz",
            "organizations_url": "https://api.github.com/users/przepompownia/orgs",
            "received_events_url": "https://api.github.com/users/przepompownia/received_events",
            "repos_url": "https://api.github.com/users/przepompownia/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/przepompownia"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/30659",
    "id": 2107612577,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30659",
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "locked": false,
    "merge_commit_sha": "b3109084c2c3675aa886bf16ff15f50025f30096",
    "merged_at": "2024-10-10T09:40:03Z",
    "milestone": {
        "closed_at": null,
        "closed_issues": 77,
        "created_at": "2023-12-07T23:09:35Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "",
        "due_on": "2024-12-25T08:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/41",
        "id": 10283236,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/41/labels",
        "node_id": "MI_kwDOAPphoM4AnOjk",
        "number": 41,
        "open_issues": 56,
        "state": "open",
        "title": "0.11",
        "updated_at": "2024-10-13T21:06:14Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/41"
    },
    "node_id": "PR_kwDOAPphoM59n52h",
    "number": 30659,
    "patch_url": "https://github.com/neovim/neovim/pull/30659.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/30659/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/e03f13a7b70e2b9a2935a36a63be2beb4f6e56ee",
    "title": "fix(lsp): fix cursor position after snippet expansion",
    "updated_at": "2024-10-10T11:23:21Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/30659",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
        "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
        "followers_url": "https://api.github.com/users/przepompownia/followers",
        "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
        "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/przepompownia",
        "id": 11404453,
        "login": "przepompownia",
        "node_id": "MDQ6VXNlcjExNDA0NDUz",
        "organizations_url": "https://api.github.com/users/przepompownia/orgs",
        "received_events_url": "https://api.github.com/users/przepompownia/received_events",
        "repos_url": "https://api.github.com/users/przepompownia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/przepompownia"
    }
}