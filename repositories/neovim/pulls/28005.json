{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/28005/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28005/commits"
        },
        "html": {
            "href": "https://github.com/neovim/neovim/pull/28005"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/neovim/issues/28005"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28005/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/neovim/statuses/6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8"
        }
    },
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "auto_merge": null,
    "base": {
        "label": "neovim:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/neovim/branches{/branch}",
            "clone_url": "https://github.com/neovim/neovim.git",
            "collaborators_url": "https://api.github.com/repos/neovim/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/neovim/contributors",
            "created_at": "2014-01-31T13:39:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/neovim/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/neovim/downloads",
            "events_url": "https://api.github.com/repos/neovim/neovim/events",
            "fork": false,
            "forks": 5202,
            "forks_count": 5202,
            "forks_url": "https://api.github.com/repos/neovim/neovim/forks",
            "full_name": "neovim/neovim",
            "git_commits_url": "https://api.github.com/repos/neovim/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/neovim/git/tags{/sha}",
            "git_url": "git://github.com/neovim/neovim.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/neovim/neovim/hooks",
            "html_url": "https://github.com/neovim/neovim",
            "id": 16408992,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/neovim/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/neovim/neovim/merges",
            "milestones_url": "https://api.github.com/repos/neovim/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "MDEwOlJlcG9zaXRvcnkxNjQwODk5Mg==",
            "notifications_url": "https://api.github.com/repos/neovim/neovim/notifications{?since,all,participating}",
            "open_issues": 1720,
            "open_issues_count": 1720,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/neovim/pulls{/number}",
            "pushed_at": "2024-03-26T01:37:47Z",
            "releases_url": "https://api.github.com/repos/neovim/neovim/releases{/id}",
            "size": 262768,
            "ssh_url": "git@github.com:neovim/neovim.git",
            "stargazers_count": 75451,
            "stargazers_url": "https://api.github.com/repos/neovim/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/neovim/subscription",
            "svn_url": "https://github.com/neovim/neovim",
            "tags_url": "https://api.github.com/repos/neovim/neovim/tags",
            "teams_url": "https://api.github.com/repos/neovim/neovim/teams",
            "topics": [
                "api",
                "c",
                "lua",
                "neovim",
                "nvim",
                "text-editor",
                "vim"
            ],
            "trees_url": "https://api.github.com/repos/neovim/neovim/git/trees{/sha}",
            "updated_at": "2024-03-26T01:55:03Z",
            "url": "https://api.github.com/repos/neovim/neovim",
            "visibility": "public",
            "watchers": 75451,
            "watchers_count": 75451,
            "web_commit_signoff_required": false
        },
        "sha": "2bcf88d35462325d1b90b0dacb373685f2d708a5",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "body": "Fixes #26388.\r\n\r\nThe problem occurs because `want_vcol` is offset by the width of the virtual text, which increases the number of inserted spaces. Similar issue also happens for 'linebreak' and 'breakindent'.\r\n\r\nThis can be fixed by ignoring 'linebreak', 'breakindent' and inline virtual text when calculating virtual columns.\r\n\r\nI also changed one of the conditions from `if (curwin->w_cursor.col == 0)` to `if (curwin->w_cursor.col <= revins_on)` since when `revins_on` is `true` and the cursor is at the start of the line, its `col` is 1. `vcol` and `want_vcol` are calculated for different lines in this case, which results in this behavior:\r\n![revins](https://github.com/neovim/neovim/assets/65824523/21f407a6-2709-44d1-b592-06c10381a583)\r\n\r\n",
    "closed_at": "2024-03-25T21:12:56Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537019474"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537019474"
                }
            },
            "author_association": "MEMBER",
            "body": "`setup()` overshadows a global function.",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:32:16Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537019474",
            "id": 1537019474,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnQ5S",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 235,
            "original_position": 15,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956817586,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537019474/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:48:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537019474",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537020498"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537020498"
                }
            },
            "author_association": "MEMBER",
            "body": "This is not needed as `clear()` is already called in `before_each()`.",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:34:39Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)\n+      clear()",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537020498",
            "id": 1537020498,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnRJS",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 236,
            "original_position": 16,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956817586,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537020498/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:48:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537020498",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537026831"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026831"
                }
            },
            "author_association": "MEMBER",
            "body": "I think this should be moved to the top of the file.",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:48:35Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537026831",
            "id": 1537026831,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnSsP",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 227,
            "original_position": 7,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956817586,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026831/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:48:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026831",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537026908"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026908"
                }
            },
            "author_association": "MEMBER",
            "body": "Why not use `command()` instead of `feed_command()`?",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:48:51Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)\n+      clear()\n+      local screen = Screen.new(width, height + 1)\n+      screen:attach()\n+      feed_command('setl listchars=space:.,tab:>- list')",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537026908",
            "id": 1537026908,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnStc",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 239,
            "original_position": 19,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956817586,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026908/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:48:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537026908",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027373"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027373"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\r\n```",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:50:16Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)\n+      clear()\n+      local screen = Screen.new(width, height + 1)\n+      screen:attach()\n+      feed_command('setl listchars=space:.,tab:>- list')\n+    end\n+\n+    local function test_cols(expected_cols)\n+      local cols = { { helpers.fn.col('.'), helpers.fn.virtcol('.') } }\n+      for _ = 2, #expected_cols do\n+        feed('<BS>')\n+        table.insert(cols, { helpers.fn.col('.'), helpers.fn.virtcol('.') })\n+      end\n+      eq(expected_cols, cols)\n+    end\n+\n+    it('works with tabs and spaces', function()\n+      setup(30, 1)\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 26 },\n+        { 17, 25 },\n+        { 15, 21 },\n+        { 11, 17 },\n+        { 7, 13 },\n+        { 6, 9 },\n+        { 2, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with varsofttabstop', function()\n+      setup(30, 1)\n+      feed_command('setl vsts=6,2,5,3')\n+      set_lines(0, 1, 'a\\t' .. s(4) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 9, 18 },\n+        { 8, 17 },\n+        { 8, 14 },\n+        { 3, 9 },\n+        { 7, 7 },\n+        { 2, 2 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with tab as ^I', function()\n+      setup(30, 1)\n+      feed_command('set listchars=space:.')\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 21 },\n+        { 15, 17 },\n+        { 11, 13 },\n+        { 7, 9 },\n+        { 4, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works in replace mode', function()\n+      setup(50, 1)\n+      feed_command('setl ts=8 sw=8 sts=8')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')\n+      feed('$R')\n+      test_cols({\n+        { 18, 34 },\n+        { 17, 33 },\n+        { 15, 25 },\n+        { 7, 17 },\n+        { 2, 9 },\n+        { 1, 8 }, -- last screen cell of first tab is at vcol 8\n+      })\n+    end)\n+\n+    it('works with breakindent', function()\n+      setup(17, 3)\n+      feed_command('setl ts=4 sw=4 bri briopt=min:5')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027373",
            "id": 1537027373,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnS0t",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 318,
            "original_position": 98,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956828298,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027373/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:50:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027373",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027476"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027476"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\r\n```",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:50:28Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)\n+      clear()\n+      local screen = Screen.new(width, height + 1)\n+      screen:attach()\n+      feed_command('setl listchars=space:.,tab:>- list')\n+    end\n+\n+    local function test_cols(expected_cols)\n+      local cols = { { helpers.fn.col('.'), helpers.fn.virtcol('.') } }\n+      for _ = 2, #expected_cols do\n+        feed('<BS>')\n+        table.insert(cols, { helpers.fn.col('.'), helpers.fn.virtcol('.') })\n+      end\n+      eq(expected_cols, cols)\n+    end\n+\n+    it('works with tabs and spaces', function()\n+      setup(30, 1)\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 26 },\n+        { 17, 25 },\n+        { 15, 21 },\n+        { 11, 17 },\n+        { 7, 13 },\n+        { 6, 9 },\n+        { 2, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with varsofttabstop', function()\n+      setup(30, 1)\n+      feed_command('setl vsts=6,2,5,3')\n+      set_lines(0, 1, 'a\\t' .. s(4) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 9, 18 },\n+        { 8, 17 },\n+        { 8, 14 },\n+        { 3, 9 },\n+        { 7, 7 },\n+        { 2, 2 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with tab as ^I', function()\n+      setup(30, 1)\n+      feed_command('set listchars=space:.')\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 21 },\n+        { 15, 17 },\n+        { 11, 13 },\n+        { 7, 9 },\n+        { 4, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works in replace mode', function()\n+      setup(50, 1)\n+      feed_command('setl ts=8 sw=8 sts=8')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027476",
            "id": 1537027476,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnS2U",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 303,
            "original_position": 83,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956828416,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027476/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:50:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027476",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027559"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027559"
                }
            },
            "author_association": "MEMBER",
            "body": "```suggestion\r\n      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\r\n```",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T03:50:39Z",
            "diff_hunk": "@@ -221,4 +221,132 @@ describe('insert-mode', function()\n     ]],\n     }\n   end)\n+\n+  describe('backspace', function()\n+    local feed_command = helpers.feed_command\n+    local api = helpers.api\n+    local function set_lines(line_b, line_e, ...)\n+      api.nvim_buf_set_lines(0, line_b, line_e, true, { ... })\n+    end\n+    local function s(count)\n+      return (' '):rep(count)\n+    end\n+\n+    local function setup(width, height)\n+      clear()\n+      local screen = Screen.new(width, height + 1)\n+      screen:attach()\n+      feed_command('setl listchars=space:.,tab:>- list')\n+    end\n+\n+    local function test_cols(expected_cols)\n+      local cols = { { helpers.fn.col('.'), helpers.fn.virtcol('.') } }\n+      for _ = 2, #expected_cols do\n+        feed('<BS>')\n+        table.insert(cols, { helpers.fn.col('.'), helpers.fn.virtcol('.') })\n+      end\n+      eq(expected_cols, cols)\n+    end\n+\n+    it('works with tabs and spaces', function()\n+      setup(30, 1)\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 26 },\n+        { 17, 25 },\n+        { 15, 21 },\n+        { 11, 17 },\n+        { 7, 13 },\n+        { 6, 9 },\n+        { 2, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with varsofttabstop', function()\n+      setup(30, 1)\n+      feed_command('setl vsts=6,2,5,3')\n+      set_lines(0, 1, 'a\\t' .. s(4) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 9, 18 },\n+        { 8, 17 },\n+        { 8, 14 },\n+        { 3, 9 },\n+        { 7, 7 },\n+        { 2, 2 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with tab as ^I', function()\n+      setup(30, 1)\n+      feed_command('set listchars=space:.')\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 21 },\n+        { 15, 17 },\n+        { 11, 13 },\n+        { 7, 9 },\n+        { 4, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works in replace mode', function()\n+      setup(50, 1)\n+      feed_command('setl ts=8 sw=8 sts=8')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')\n+      feed('$R')\n+      test_cols({\n+        { 18, 34 },\n+        { 17, 33 },\n+        { 15, 25 },\n+        { 7, 17 },\n+        { 2, 9 },\n+        { 1, 8 }, -- last screen cell of first tab is at vcol 8\n+      })\n+    end)\n+\n+    it('works with breakindent', function()\n+      setup(17, 3)\n+      feed_command('setl ts=4 sw=4 bri briopt=min:5')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')\n+      feed('$i')\n+      test_cols({\n+        { 18, 50 },\n+        { 17, 49 },\n+        { 15, 33 },\n+        { 11, 17 },\n+        { 7, 13 },\n+        { 6, 9 },\n+        { 2, 5 },\n+        { 1, 1 },\n+      })\n+    end)\n+\n+    it('works with inline virtual text', function()\n+      setup(50, 1)\n+      feed_command('setl ts=4 sw=4')\n+      set_lines(0, 1, '\\t' .. s(4) .. '\\t' .. s(9) .. '\\t ' .. 'a')",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537027559",
            "id": 1537027559,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5bnS3n",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 335,
            "original_position": 115,
            "original_start_line": null,
            "path": "test/functional/editor/mode_insert_spec.lua",
            "position": null,
            "pull_request_review_id": 1956828519,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027559/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T03:50:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537027559",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537217676"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537217676"
                }
            },
            "author_association": "MEMBER",
            "body": "It seems that this change can cause Nvim to crash:\r\n```\r\n=================================================================\r\n==556309==ERROR: AddressSanitizer: heap-use-after-free on address 0x5020000362b0 at pc 0x5b35d4e921f5 bp 0x7fff2aa0cf50 sp 0x7fff2aa0c710\r\nREAD of size 3 at 0x5020000362b0 thread T0\r\n    #0 0x5b35d4e921f4 in strlen.part.0 asan_interceptors.cpp.o\r\n    #1 0x5b35d5f45681 in do_join **/src/nvim/ops.c:3983:21\r\n    #2 0x5b35d54dd91f in ins_bs **/src/nvim/edit.c:3778:9\r\n    #3 0x5b35d54d4a91 in insert_handle_key **/src/nvim/edit.c:833:24\r\n    #4 0x5b35d54ad6ee in insert_execute **/src/nvim/edit.c:694:10\r\n    #5 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #6 0x5b35d54b5562 in insert_enter **/src/nvim/edit.c:345:5\r\n    #7 0x5b35d54a9daa in edit **/src/nvim/edit.c:1293:3\r\n    #8 0x5b35d5ed1644 in invoke_edit **/src/nvim/normal.c:6258:7\r\n    #9 0x5b35d5ea6f6d in nv_edit **/src/nvim/normal.c:6230:5\r\n    #10 0x5b35d5e8fd50 in normal_execute **/src/nvim/normal.c:1227:3\r\n    #11 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #12 0x5b35d5e727da in normal_enter **/src/nvim/normal.c:516:3\r\n    #13 0x5b35d5b948e9 in main **/src/nvim/main.c:663:3\r\n    #14 0x729accb00ccf  (/usr/lib/libc.so.6+0x25ccf) (BuildId: c0caa0b7709d3369ee575fcd7d7d0b0fc48733af)\r\n    #15 0x729accb00d89 in __libc_start_main (/usr/lib/libc.so.6+0x25d89) (BuildId: c0caa0b7709d3369ee575fcd7d7d0b0fc48733af)\r\n    #16 0x5b35d4e47d64 in _start (**/build/bin/nvim+0xbedd64) (BuildId: e6fd2bc4219f19528bbd5f0ab0c514ae58fe3e27)\r\n\r\n0x5020000362b2 is located 0 bytes after 2-byte region [0x5020000362b0,0x5020000362b2)\r\nfreed by thread T0 here:\r\n    #0 0x5b35d4f35f12 in free.part.0 asan_malloc_linux.cpp.o\r\n    #1 0x5b35d5d7193b in xfree **/src/nvim/memory.c:144:3\r\n    #2 0x5b35d5d44e32 in ml_flush_line **/src/nvim/memline.c:2852:5\r\n    #3 0x5b35d5d603db in ml_find_line_or_offset **/src/nvim/memline.c:3953:5\r\n    #4 0x5b35d59464e4 in extmark_splice **/src/nvim/extmark.c:506:16\r\n    #5 0x5b35d5f4564d in do_join **/src/nvim/ops.c:3978:7\r\n    #6 0x5b35d54dd91f in ins_bs **/src/nvim/edit.c:3778:9\r\n    #7 0x5b35d54d4a91 in insert_handle_key **/src/nvim/edit.c:833:24\r\n    #8 0x5b35d54ad6ee in insert_execute **/src/nvim/edit.c:694:10\r\n    #9 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #10 0x5b35d54b5562 in insert_enter **/src/nvim/edit.c:345:5\r\n    #11 0x5b35d54a9daa in edit **/src/nvim/edit.c:1293:3\r\n    #12 0x5b35d5ed1644 in invoke_edit **/src/nvim/normal.c:6258:7\r\n    #13 0x5b35d5ea6f6d in nv_edit **/src/nvim/normal.c:6230:5\r\n    #14 0x5b35d5e8fd50 in normal_execute **/src/nvim/normal.c:1227:3\r\n    #15 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #16 0x5b35d5e727da in normal_enter **/src/nvim/normal.c:516:3\r\n    #17 0x5b35d5b948e9 in main **/src/nvim/main.c:663:3\r\n    #18 0x729accb00ccf  (/usr/lib/libc.so.6+0x25ccf) (BuildId: c0caa0b7709d3369ee575fcd7d7d0b0fc48733af)\r\n\r\npreviously allocated by thread T0 here:\r\n    #0 0x5b35d4f36f49 in malloc (**/build/bin/nvim+0xcdcf49) (BuildId: e6fd2bc4219f19528bbd5f0ab0c514ae58fe3e27)\r\n    #1 0x5b35d5d71629 in try_malloc **/src/nvim/memory.c:98:15\r\n    #2 0x5b35d5d71854 in xmalloc **/src/nvim/memory.c:132:15\r\n    #3 0x5b35d5d73613 in xmemdup **/src/nvim/memory.c:512:17\r\n    #4 0x5b35d5d4b5b5 in ml_get_buf_impl **/src/nvim/memline.c:1959:29\r\n    #5 0x5b35d5d4ba52 in ml_get_buf **/src/nvim/memline.c:1820:10\r\n    #6 0x5b35d5d4bce2 in ml_get_buf_len **/src/nvim/memline.c:1856:8\r\n    #7 0x5b35d536d39e in check_cursor_col **/src/nvim/cursor.c:349:17\r\n    #8 0x5b35d5f47fe4 in do_join **/src/nvim/ops.c:4080:3\r\n    #9 0x5b35d54dd91f in ins_bs **/src/nvim/edit.c:3778:9\r\n    #10 0x5b35d54d4a91 in insert_handle_key **/src/nvim/edit.c:833:24\r\n    #11 0x5b35d54ad6ee in insert_execute **/src/nvim/edit.c:694:10\r\n    #12 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #13 0x5b35d54b5562 in insert_enter **/src/nvim/edit.c:345:5\r\n    #14 0x5b35d54a9daa in edit **/src/nvim/edit.c:1293:3\r\n    #15 0x5b35d5ed1644 in invoke_edit **/src/nvim/normal.c:6258:7\r\n    #16 0x5b35d5ea6f6d in nv_edit **/src/nvim/normal.c:6230:5\r\n    #17 0x5b35d5e8fd50 in normal_execute **/src/nvim/normal.c:1227:3\r\n    #18 0x5b35d64b5479 in state_enter **/src/nvim/state.c:101:26\r\n    #19 0x5b35d5e727da in normal_enter **/src/nvim/normal.c:516:3\r\n    #20 0x5b35d5b948e9 in main **/src/nvim/main.c:663:3\r\n    #21 0x729accb00ccf  (/usr/lib/libc.so.6+0x25ccf) (BuildId: c0caa0b7709d3369ee575fcd7d7d0b0fc48733af)\r\n\r\nSUMMARY: AddressSanitizer: heap-use-after-free asan_interceptors.cpp.o in strlen.part.0\r\nShadow bytes around the buggy address:\r\n  0x502000036000: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa\r\n  0x502000036080: fa fa fd fa fa fa fd fa fa fa fd fd fa fa fd fd\r\n  0x502000036100: fa fa fd fd fa fa 00 00 fa fa fd fa fa fa 01 fa\r\n  0x502000036180: fa fa fd fa fa fa 02 fa fa fa fd fa fa fa fd fa\r\n  0x502000036200: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa\r\n=>0x502000036280: fa fa fd fa fa fa[fd]fa fa fa fd fa fa fa fd fa\r\n  0x502000036300: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fd\r\n  0x502000036380: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa\r\n  0x502000036400: fa fa fd fa fa fa fd fd fa fa fd fd fa fa fd fd\r\n  0x502000036480: fa fa fd fd fa fa fd fa fa fa fd fa fa fa fd fd\r\n  0x502000036500: fa fa fd fd fa fa fd fa fa fa fd fa fa fa fd fa\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==556309==ABORTING\r\n```\r\nPlease remove this change from this PR.",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T08:42:17Z",
            "diff_hunk": "@@ -3752,7 +3735,7 @@ static bool ins_bs(int c, int mode, int *inserted_space_p)\n   }\n \n   // Delete newline!\n-  if (curwin->w_cursor.col == 0) {\n+  if (curwin->w_cursor.col <= revins_on) {",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537217676",
            "id": 1537217676,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5boBSM",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 3738,
            "original_position": 29,
            "original_start_line": null,
            "path": "src/nvim/edit.c",
            "position": null,
            "pull_request_review_id": 1957133839,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537217676/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T08:45:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537217676",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537250396"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537250396"
                }
            },
            "author_association": "MEMBER",
            "body": "The `lnum` variable seems unnecessary.\r\n```suggestion\r\n      char *const line = get_cursor_line_ptr();\r\n```",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T09:09:27Z",
            "diff_hunk": "@@ -3846,42 +3829,68 @@ static bool ins_bs(int c, int mode, int *inserted_space_p)\n     // Handle deleting one 'shiftwidth' or 'softtabstop'.\n     if (mode == BACKSPACE_CHAR\n         && ((p_sta && in_indent)\n-            || ((get_sts_value() != 0\n-                 || tabstop_count(curbuf->b_p_vsts_array))\n+            || ((get_sts_value() != 0 || tabstop_count(curbuf->b_p_vsts_array))\n                 && curwin->w_cursor.col > 0\n                 && (*(get_cursor_pos_ptr() - 1) == TAB\n                     || (*(get_cursor_pos_ptr() - 1) == ' '\n                         && (!*inserted_space_p || arrow_used)))))) {\n-      colnr_T vcol;\n-      colnr_T want_vcol;\n-\n       *inserted_space_p = false;\n-      // Compute the virtual column where we want to be.  Since\n-      // 'showbreak' may get in the way, need to get the last column of\n-      // the previous character.\n-      getvcol(curwin, &curwin->w_cursor, &vcol, NULL, NULL);\n-      colnr_T start_vcol = vcol;\n-      dec_cursor();\n-      getvcol(curwin, &curwin->w_cursor, NULL, NULL, &want_vcol);\n-      inc_cursor();\n+\n+      bool const use_ts = !curwin->w_p_list || curwin->w_p_lcs_chars.tab1;\n+      int const lnum = curwin->w_cursor.lnum;\n+      char *const line = ml_get_buf(curbuf, lnum);",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537250396",
            "id": 1537250396,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5boJRc",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 3841,
            "original_position": 59,
            "original_start_line": 3840,
            "path": "src/nvim/edit.c",
            "position": null,
            "pull_request_review_id": 1957184661,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537250396/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": "RIGHT",
            "subject_type": "line",
            "updated_at": "2024-03-25T09:09:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537250396",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/neovim/pull/28005#discussion_r1537261079"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/28005"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537261079"
                }
            },
            "author_association": "MEMBER",
            "body": "`ascii_iswhite()` should be used, not `ascii_isspace()`.\r\n```suggestion\r\n        bool cur_space = ascii_iswhite(sci.chr.value);\r\n```",
            "commit_id": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
            "created_at": "2024-03-25T09:18:27Z",
            "diff_hunk": "@@ -3846,42 +3829,68 @@ static bool ins_bs(int c, int mode, int *inserted_space_p)\n     // Handle deleting one 'shiftwidth' or 'softtabstop'.\n     if (mode == BACKSPACE_CHAR\n         && ((p_sta && in_indent)\n-            || ((get_sts_value() != 0\n-                 || tabstop_count(curbuf->b_p_vsts_array))\n+            || ((get_sts_value() != 0 || tabstop_count(curbuf->b_p_vsts_array))\n                 && curwin->w_cursor.col > 0\n                 && (*(get_cursor_pos_ptr() - 1) == TAB\n                     || (*(get_cursor_pos_ptr() - 1) == ' '\n                         && (!*inserted_space_p || arrow_used)))))) {\n-      colnr_T vcol;\n-      colnr_T want_vcol;\n-\n       *inserted_space_p = false;\n-      // Compute the virtual column where we want to be.  Since\n-      // 'showbreak' may get in the way, need to get the last column of\n-      // the previous character.\n-      getvcol(curwin, &curwin->w_cursor, &vcol, NULL, NULL);\n-      colnr_T start_vcol = vcol;\n-      dec_cursor();\n-      getvcol(curwin, &curwin->w_cursor, NULL, NULL, &want_vcol);\n-      inc_cursor();\n+\n+      bool const use_ts = !curwin->w_p_list || curwin->w_p_lcs_chars.tab1;\n+      int const lnum = curwin->w_cursor.lnum;\n+      char *const line = ml_get_buf(curbuf, lnum);\n+      char *const end_ptr = line + curwin->w_cursor.col;\n+\n+      colnr_T vcol = 0;\n+      colnr_T space_vcol = 0;\n+      StrCharInfo sci = utf_ptr2StrCharInfo(line);\n+      StrCharInfo space_sci = sci;\n+      bool prev_space = false;\n+      do {\n+        bool cur_space = ascii_isspace(sci.chr.value);",
            "html_url": "https://github.com/neovim/neovim/pull/28005#discussion_r1537261079",
            "id": 1537261079,
            "line": null,
            "node_id": "PRRC_kwDOAPphoM5boL4X",
            "original_commit_id": "00ecdacd87180fd9218e3f8ba6ed5d09a7a38087",
            "original_line": 3850,
            "original_position": 68,
            "original_start_line": null,
            "path": "src/nvim/edit.c",
            "position": null,
            "pull_request_review_id": 1957201313,
            "pull_request_url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537261079/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2024-03-25T09:18:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/pulls/comments/1537261079",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comment_regular_data": [],
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28005/comments",
    "commits_url": "https://api.github.com/repos/neovim/neovim/pulls/28005/commits",
    "created_at": "2024-03-23T22:43:52Z",
    "diff_url": "https://github.com/neovim/neovim/pull/28005.diff",
    "draft": false,
    "head": {
        "label": "vanaigr:backspace-fix",
        "ref": "backspace-fix",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/vanaigr/neovim/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/vanaigr/neovim/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/vanaigr/neovim/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/vanaigr/neovim/branches{/branch}",
            "clone_url": "https://github.com/vanaigr/neovim.git",
            "collaborators_url": "https://api.github.com/repos/vanaigr/neovim/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/vanaigr/neovim/comments{/number}",
            "commits_url": "https://api.github.com/repos/vanaigr/neovim/commits{/sha}",
            "compare_url": "https://api.github.com/repos/vanaigr/neovim/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/vanaigr/neovim/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/vanaigr/neovim/contributors",
            "created_at": "2023-12-05T22:08:59Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/vanaigr/neovim/deployments",
            "description": "Vim-fork focused on extensibility and usability",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/vanaigr/neovim/downloads",
            "events_url": "https://api.github.com/repos/vanaigr/neovim/events",
            "fork": true,
            "forks": 1,
            "forks_count": 1,
            "forks_url": "https://api.github.com/repos/vanaigr/neovim/forks",
            "full_name": "vanaigr/neovim",
            "git_commits_url": "https://api.github.com/repos/vanaigr/neovim/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/vanaigr/neovim/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/vanaigr/neovim/git/tags{/sha}",
            "git_url": "git://github.com/vanaigr/neovim.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": true,
            "homepage": "https://neovim.io",
            "hooks_url": "https://api.github.com/repos/vanaigr/neovim/hooks",
            "html_url": "https://github.com/vanaigr/neovim",
            "id": 727936921,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/vanaigr/neovim/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/vanaigr/neovim/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/vanaigr/neovim/issues{/number}",
            "keys_url": "https://api.github.com/repos/vanaigr/neovim/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/vanaigr/neovim/labels{/name}",
            "language": "Vim Script",
            "languages_url": "https://api.github.com/repos/vanaigr/neovim/languages",
            "license": {
                "key": "other",
                "name": "Other",
                "node_id": "MDc6TGljZW5zZTA=",
                "spdx_id": "NOASSERTION",
                "url": null
            },
            "merges_url": "https://api.github.com/repos/vanaigr/neovim/merges",
            "milestones_url": "https://api.github.com/repos/vanaigr/neovim/milestones{/number}",
            "mirror_url": null,
            "name": "neovim",
            "node_id": "R_kgDOK2NvmQ",
            "notifications_url": "https://api.github.com/repos/vanaigr/neovim/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/65824523?v=4",
                "events_url": "https://api.github.com/users/vanaigr/events{/privacy}",
                "followers_url": "https://api.github.com/users/vanaigr/followers",
                "following_url": "https://api.github.com/users/vanaigr/following{/other_user}",
                "gists_url": "https://api.github.com/users/vanaigr/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vanaigr",
                "id": 65824523,
                "login": "vanaigr",
                "node_id": "MDQ6VXNlcjY1ODI0NTIz",
                "organizations_url": "https://api.github.com/users/vanaigr/orgs",
                "received_events_url": "https://api.github.com/users/vanaigr/received_events",
                "repos_url": "https://api.github.com/users/vanaigr/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vanaigr/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vanaigr/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vanaigr"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/vanaigr/neovim/pulls{/number}",
            "pushed_at": "2024-03-25T19:33:40Z",
            "releases_url": "https://api.github.com/repos/vanaigr/neovim/releases{/id}",
            "size": 255551,
            "ssh_url": "git@github.com:vanaigr/neovim.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/vanaigr/neovim/stargazers",
            "statuses_url": "https://api.github.com/repos/vanaigr/neovim/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/vanaigr/neovim/subscribers",
            "subscription_url": "https://api.github.com/repos/vanaigr/neovim/subscription",
            "svn_url": "https://github.com/vanaigr/neovim",
            "tags_url": "https://api.github.com/repos/vanaigr/neovim/tags",
            "teams_url": "https://api.github.com/repos/vanaigr/neovim/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/vanaigr/neovim/git/trees{/sha}",
            "updated_at": "2023-12-13T20:00:37Z",
            "url": "https://api.github.com/repos/vanaigr/neovim",
            "visibility": "public",
            "watchers": 0,
            "watchers_count": 0,
            "web_commit_signoff_required": false
        },
        "sha": "6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/65824523?v=4",
            "events_url": "https://api.github.com/users/vanaigr/events{/privacy}",
            "followers_url": "https://api.github.com/users/vanaigr/followers",
            "following_url": "https://api.github.com/users/vanaigr/following{/other_user}",
            "gists_url": "https://api.github.com/users/vanaigr/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/vanaigr",
            "id": 65824523,
            "login": "vanaigr",
            "node_id": "MDQ6VXNlcjY1ODI0NTIz",
            "organizations_url": "https://api.github.com/users/vanaigr/orgs",
            "received_events_url": "https://api.github.com/users/vanaigr/received_events",
            "repos_url": "https://api.github.com/users/vanaigr/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/vanaigr/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/vanaigr/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/vanaigr"
        }
    },
    "html_url": "https://github.com/neovim/neovim/pull/28005",
    "id": 1787966591,
    "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28005",
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 5826991063,
            "name": "insert-mode",
            "node_id": "LA_kwDOAPphoM8AAAABW1DT1w",
            "url": "https://api.github.com/repos/neovim/neovim/labels/insert-mode"
        }
    ],
    "locked": false,
    "merge_commit_sha": "14839c5d18c2bef7bdd41944b059603a8589523e",
    "merged_at": "2024-03-25T21:12:56Z",
    "milestone": null,
    "node_id": "PR_kwDOAPphoM5qkjR_",
    "number": 28005,
    "patch_url": "https://github.com/neovim/neovim/pull/28005.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/neovim/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/neovim/pulls/28005/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/neovim/neovim/statuses/6d38e6e65a0eac7ec4dab1f32c8d05e8b3237ff8",
    "title": "fix(edit): backspace adds extra spaces for inline virtual text",
    "updated_at": "2024-03-25T21:12:56Z",
    "url": "https://api.github.com/repos/neovim/neovim/pulls/28005",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/65824523?v=4",
        "events_url": "https://api.github.com/users/vanaigr/events{/privacy}",
        "followers_url": "https://api.github.com/users/vanaigr/followers",
        "following_url": "https://api.github.com/users/vanaigr/following{/other_user}",
        "gists_url": "https://api.github.com/users/vanaigr/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vanaigr",
        "id": 65824523,
        "login": "vanaigr",
        "node_id": "MDQ6VXNlcjY1ODI0NTIz",
        "organizations_url": "https://api.github.com/users/vanaigr/orgs",
        "received_events_url": "https://api.github.com/users/vanaigr/received_events",
        "repos_url": "https://api.github.com/users/vanaigr/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vanaigr/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vanaigr/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vanaigr"
    }
}