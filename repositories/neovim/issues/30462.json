{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\r\n\r\nbracketed paste is not cancelled when `vim.paste()` returns `false`\r\n\r\n### Steps to reproduce\r\n\r\n1. Run `nvim --clean`\r\n2. Source the following file:\r\n```lua\r\nvim.paste = (function(overridden)\r\n  return function(lines, phase)\r\n    for i, line in ipairs(lines) do\r\n      if line:find('CANCEL') then\r\n        return false\r\n      end\r\n    end\r\n    return overridden(lines, phase)\r\n  end\r\nend)(vim.paste)\r\n```\r\n3. Use bracketed paste to paste a piece of text that:\r\n   - is long enough to be split into multiple chunks\r\n   - contains `CANCEL` in a non-last chunk\r\n4. The chunk containing `CANCEL` is not pasted, but the chunks that come after are still pasted\r\n\r\nIn contrast, throwing an error does prevent the following chunks from being pasted:\r\n```lua\r\nvim.paste = (function(overridden)\r\n  return function(lines, phase)\r\n    for i, line in ipairs(lines) do\r\n      if line:find('CANCEL') then\r\n        error(42)\r\n      end\r\n    end\r\n    return overridden(lines, phase)\r\n  end\r\nend)(vim.paste)\r\n```\r\n\r\n### Expected behavior\r\n\r\nNone of the chunks starting from the chunk containing `CANCEL` are pasted\r\n\r\n### Nvim version (nvim -v)\r\n\r\nv0.11.0-dev-812+ge697c1b43d\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Terminal name/version\r\n\r\nkitty 0.36.2\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuild from repo",
    "closed_at": "2024-09-23T23:14:15Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Theoretically this is a bug in the TUI client, but I think the behavior of the `nvim_paste` API can be improved too.\r\n\r\nThe current behavior of `nvim_paste` is:\r\n- When `vim.paste()` returns `false`, return `false` to the client, but treat following chunks normally (i.e. rely on the client cancelling the paste as expected).\r\n- When `vim.paste()` throws an error, still return `true` to the client, but drain the following chunks in the stream without calling `vim.paste()`.\r\n\r\nA problem with such behavior is that when `vim.paste()` errors, the client is still supposed to send the remaining chunks of the stream, even though they do nothing. Furthermore, having two different code paths for two uncommon but similar situations complicates maintenance.\r\n\r\nInstead, if both the cancel case and the error case return `false` to the client and drain the remaining chunks of the stream, apart from sharing the same code path, it seems beneficial whether the client checks the return value of `nvim_paste` or not:\r\n- If the client checks the return value, it can avoid sending the following chunks needlessly after an error.\r\n- If the client doesn't check the return value, chunks following a cancelled chunk won't be pasted on the server regardless, which leads to less confusing behavior.",
            "created_at": "2024-09-21T23:11:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/30462#issuecomment-2365352377",
            "id": 2365352377,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30462",
            "node_id": "IC_kwDOAPphoM6M_Gm5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365352377/reactions"
            },
            "updated_at": "2024-09-23T02:19:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2365352377",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30462/comments",
    "created_at": "2024-09-21T22:52:33Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30462/events",
    "html_url": "https://github.com/neovim/neovim/issues/30462",
    "id": 2540542964,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "clipboard, paste",
            "id": 186192409,
            "name": "clipboard",
            "node_id": "MDU6TGFiZWwxODYxOTI0MDk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/clipboard"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30462/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6XbZv0",
    "number": 30462,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30462/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30462/timeline",
    "title": "bracketed paste is not cancelled when vim.paste() returns false",
    "updated_at": "2024-09-23T23:14:16Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30462",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq"
    }
}