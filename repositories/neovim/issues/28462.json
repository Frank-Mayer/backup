{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nNeovim opens language parsers in a way that blocks other processes from overwriting them, and does not release the associated file handle until Neovim closes. This prevents the reinstallation and upgrade of language parsers on Windows after the parser has been loaded.\n\n### Steps to reproduce\n\nThese reproduction steps use `lazy.nvim` and `nvim-treesitter`, but manually installing a parser where Neovim can pick it up will trigger the error as well.\r\n\r\n1. Install a language parser like `:TSInstall rust`, or manually by installing it in the correct directory for Neovim to find it.\r\n2. Close Neovim if it was open, then open a file that uses an installed parser.\r\n3. Inspect the tree with `:InspectTree` (this is just one way of being sure the language parser was loaded)\r\n4. Close the tree and the buffer if you want, but keep the same instance of Neovim open.\r\n5. Attempt to reinstall the language parser (or manually replace it).\r\n6. Observe an error indicating access is denied.\r\n\r\nI'm not sure why, but reinstalling immediately after the initial installation results in no message at all.\r\n\r\nFor reference, I reproduced this initially with a simple `init.lua`:\r\n\r\n```lua init.lua\r\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\r\nif not (vim.uv or vim.loop).fs_stat(lazypath) then\r\n\tvim.fn.system({\r\n\t\t\"git\",\r\n\t\t\"clone\",\r\n\t\t\"--filter=blob:none\",\r\n\t\t\"https://github.com/folke/lazy.nvim.git\",\r\n\t\t\"--branch=stable\", -- latest stable release\r\n\t\tlazypath,\r\n\t})\r\nend\r\nvim.opt.rtp:prepend(lazypath)\r\n\r\nrequire(\"lazy\").setup({\r\n\t\"nvim-treesitter/nvim-treesitter\",\r\n\tbranch = \"main\",\r\n\tbuild = \":TSUpdate\",\r\n\tlazy = false,\r\n})\r\n```\r\n\r\nThen I tried to rule out the involvement of `nvim-treesitter` and even `lazy.nvim` by cleaning out the configuration and data files, leaving behind only `C:\\Users\\User\\AppData\\Local\\nvim-data\\site`, which held the parser in `parser\\rust.so`. Then I just used a sanity-check `init.lua`:\r\n\r\n```lua init.lua\r\nprint(\"Hello, world!\")\r\n```\r\n\r\nThe problem still occurred.\r\n\r\nWindows has a way of [locking files](https://superuser.com/questions/1500604/why-cant-you-change-the-name-of-an-open-file-in-windows), depending on how they are opened, so it seems like that is causing the problem, which is made worse because they don't seem to be closed until Neovim itself is closed.\n\n### Expected behavior\n\nI would expect treesitter language parsers to be replaceable, even when in use, so they can always be upgraded from within Neovim.\n\n### Neovim version (nvim -v)\n\n0.10.0-dev-2976+g208852126\n\n### Vim (not Nvim) behaves the same?\n\nno?\n\n### Operating system/version\n\nWindows 10 Pro 22H2\n\n### Terminal name/version\n\nWindows Terminal 1.19.10821.0\n\n### $TERM environment variable\n\nN/A - it's empty\n\n### Installation\n\nDownloaded `nvim-win64.zip` from the repository's release assets, but it also exists in 0.9.x versions installed with `winget`, including 0.9.5.",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I'm not sure there's much we can do here, to be honest. Tree-sitter itself is not eager in releasing parsers, and we cache them for hard won performance reasons. \n\nI general, Neovim doesn't really support hot reloading, and this is a corollary of that. ",
            "created_at": "2024-04-22T20:23:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/28462#issuecomment-2070888158",
            "id": 2070888158,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28462",
            "node_id": "IC_kwDOAPphoM57bz7e",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2070888158/reactions"
            },
            "updated_at": "2024-04-22T20:23:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2070888158",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28462/comments",
    "created_at": "2024-04-22T20:07:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/28462/events",
    "html_url": "https://github.com/neovim/neovim/issues/28462",
    "id": 2257374094,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/28462/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6GjMuO",
    "number": 28462,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/28462/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/28462/timeline",
    "title": "Treesitter language parsers are opened in a blocking way on Windows, preventing reinstallation",
    "updated_at": "2024-04-22T20:23:23Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/28462",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35066367?v=4",
        "events_url": "https://api.github.com/users/FlippingBinary/events{/privacy}",
        "followers_url": "https://api.github.com/users/FlippingBinary/followers",
        "following_url": "https://api.github.com/users/FlippingBinary/following{/other_user}",
        "gists_url": "https://api.github.com/users/FlippingBinary/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/FlippingBinary",
        "id": 35066367,
        "login": "FlippingBinary",
        "node_id": "MDQ6VXNlcjM1MDY2MzY3",
        "organizations_url": "https://api.github.com/users/FlippingBinary/orgs",
        "received_events_url": "https://api.github.com/users/FlippingBinary/received_events",
        "repos_url": "https://api.github.com/users/FlippingBinary/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/FlippingBinary/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/FlippingBinary/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/FlippingBinary"
    }
}