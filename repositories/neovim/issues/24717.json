{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe Neovim terminal (`:terminal`) does not appear to advertise directcolor support anywhere when `termguicolors` is set. This makes it impossible for CLI programs to unambiguously determine whether directcolor sequences can be used when running in the Nvim terminal.\r\n\r\nSteps to reproduce:\r\n\r\n1. Install `nvim`.\r\n2. Install a program that uses terminal colors, e.g. [`chafa`](https://github.com/hpjansson/chafa), from its master branch.\r\n3. `unset COLORTERM NVIM_TUI_ENABLE_TRUE_COLOR` (the former may not be present, and it's my understanding that the latter is deprecated).\r\n4. `export TERM=vte`. This step probably doesn't matter as long as you indicate an outer terminal that has directcolor support.\r\n5. Start `nvim`.\r\n6. Issue `:terminal` in Nvim and hit `i`.\r\n7. Print something that issues SGR codes, e.g. `chafa test.png`.\r\n8. `chafa` has no way to determine whether the Nvim terminal supports directcolor, so will only use 256 colors. If you try to use directcolor, the output will look corrupted.\r\n9. Exit Nvim.\r\n10. Add `set termguicolors` to `init.vim`.\r\n11. Repeat steps 5-8. Observe that `chafa` will still use only 256 colors, because it can't determine from the environment that directcolor support is now available.\r\n12. Issue `chafa -c full test.png` and observe that correct directcolor output is possible if forced.\r\n\r\nAdditionally, the inner `TERM` is set to `xterm-256color` in both cases and there appears to be no other environment variables indicating directcolor support. `COLORTERM` almost does the job, but Neovim doesn't set it unconditionally.\r\n\r\n\r\n### Expected behavior\r\n\r\nNeovim should make it possible for CLI programs to differentiate 256-color from directcolor `:terminal` environments. The exact mechanism is of lesser importance, but I guess it could either export a different TERM string or set some other environment variable. The goal is to produce optimal output in Neovim without extra prompting from the user.\r\n\r\nIt could also be resolved with some policy, e.g. \"it's the user's responsibility to ensure `COLORTERM` is set\".\r\n\r\nA quick test with vim 9.0.1632 showed that it exports `COLORS=16777216` when outer `TERM=xterm-direct2`.",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24717/comments",
    "created_at": "2023-08-15T00:15:42Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24717/events",
    "html_url": "https://github.com/neovim/neovim/issues/24717",
    "id": 1850739029,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "built-in :terminal or :shell",
            "id": 212696822,
            "name": "terminal",
            "node_id": "MDU6TGFiZWwyMTI2OTY4MjI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/terminal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24717/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5uUAlV",
    "number": 24717,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24717/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24717/timeline",
    "title": "Advertise directcolor support in Neovim terminal",
    "updated_at": "2023-08-15T03:02:10Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24717",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/234488?v=4",
        "events_url": "https://api.github.com/users/hpjansson/events{/privacy}",
        "followers_url": "https://api.github.com/users/hpjansson/followers",
        "following_url": "https://api.github.com/users/hpjansson/following{/other_user}",
        "gists_url": "https://api.github.com/users/hpjansson/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/hpjansson",
        "id": 234488,
        "login": "hpjansson",
        "node_id": "MDQ6VXNlcjIzNDQ4OA==",
        "organizations_url": "https://api.github.com/users/hpjansson/orgs",
        "received_events_url": "https://api.github.com/users/hpjansson/received_events",
        "repos_url": "https://api.github.com/users/hpjansson/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/hpjansson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/hpjansson/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/hpjansson"
    }
}