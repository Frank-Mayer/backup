{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nFound crash issue when trying OSC52 feature. Option `keymap=dvorak` comes from my regular using vimrc.\n\n### Steps to reproduce\n\n`nvim --clean +'set keymap=dvorak' +vs`\r\n\r\nbacktrace:\r\n```\r\n           PID: 3666388 (nvim)\r\n           UID: 1000 (fool)\r\n           GID: 1000 (fool)\r\n        Signal: 6 (ABRT)\r\n     Timestamp: Wed 2024-01-31 06:21:06 CST (22s ago)\r\n  Command Line: ./dbgbin/bin/nvim --embed --clean $'+set keymap=dvorak' +vs\r\n    Executable: /home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim\r\n Control Group: /user.slice/user-1000.slice/user@1000.service/app.slice/app-gnome-Alacritty-3632594.scope\r\n          Unit: user@1000.service\r\n     User Unit: app-gnome-Alacritty-3632594.scope\r\n         Slice: user-1000.slice\r\n     Owner UID: 1000 (fool)\r\n       Boot ID: 063136d1630f4433b70f51dfc439064f\r\n    Machine ID: 73919ff8bb40473bb572f40cdaef6220\r\n      Hostname: fool-GTR5\r\n       Storage: /var/lib/systemd/coredump/core.nvim.1000.063136d1630f4433b70f51dfc439064f.3666388.1706653266000000.zst (present)\r\n     Disk Size: 289.0K\r\n       Message: Process 3666388 (nvim) of user 1000 dumped core.\r\n                \r\n                Found module /home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim with build-id: deaab6163f7445f0dfae61ebc65951ed0c92c501\r\n                Found module linux-vdso.so.1 with build-id: 9483b2083c2a30ba4e4f346b36803f814b9a1743\r\n                Found module ld-linux-x86-64.so.2 with build-id: 15921ea631d9f36502d20459c43e5c85b7d6ab76\r\n                Found module libc.so.6 with build-id: c289da5071a3399de893d2af81d6a30c62646e1e\r\n                Found module libgcc_s.so.1 with build-id: e3a44e0da9c6e835d293ed8fd2882b4c4a87130c\r\n                Found module libm.so.6 with build-id: a88ef0199bd5e742ebd0c359edf5cb2be0ec08b5\r\n                Stack trace of thread 3666388:\r\n                #0  0x00007f7ec92969fc __pthread_kill_implementation (libc.so.6 + 0x969fc)\r\n                #1  0x00007f7ec9242476 __GI_raise (libc.so.6 + 0x42476)\r\n                #2  0x00007f7ec92287f3 __GI_abort (libc.so.6 + 0x287f3)\r\n                #3  0x00007f7ec922871b __assert_fail_base (libc.so.6 + 0x2871b)\r\n                #4  0x00007f7ec9239e96 __GI___assert_fail (libc.so.6 + 0x39e96)\r\n                #5  0x0000561aa68510b5 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x3dd0b5)\r\n                #6  0x0000561aa6849ab2 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x3d5ab2)\r\n                #7  0x0000561aa684c58f n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x3d858f)\r\n                #8  0x0000561aa668c03f n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x21803f)\r\n                #9  0x0000561aa668b715 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x217715)\r\n                #10 0x0000561aa680b78d n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x39778d)\r\n                #11 0x0000561aa65c7345 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x153345)\r\n                #12 0x0000561aa672a025 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x2b6025)\r\n                #13 0x0000561aa672a291 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x2b6291)\r\n                #14 0x0000561aa680a79a n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x39679a)\r\n                #15 0x0000561aa6727e6b n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x2b3e6b)\r\n                #16 0x0000561aa66cbf98 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x257f98)\r\n                #17 0x00007f7ec9229d90 __libc_start_call_main (libc.so.6 + 0x29d90)\r\n                #18 0x00007f7ec9229e40 __libc_start_main_impl (libc.so.6 + 0x29e40)\r\n                #19 0x0000561aa650c705 n/a (/home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim + 0x98705)\r\n\r\nGNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1\r\nCopyright (C) 2022 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.\r\nType \"show copying\" and \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<https://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n    <http://www.gnu.org/software/gdb/documentation/>.\r\n\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /home/fool/Code/z/github.com/neovim/neovim/dbgbin/bin/nvim...\r\n\r\nwarning: Can't open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing\r\n\r\nwarning: Can't open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing\r\n\r\nwarning: Can't open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing\r\n\r\nwarning: Can't open file anon_inode:[io_uring] which was expanded to anon_inode:[io_uring] during file-backed mapping note processing\r\n[New LWP 3666388]\r\n[New LWP 3666390]\r\n\r\nwarning: Section `.reg-xstate/3666388' in core file too small.\r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\nCore was generated by `./dbgbin/bin/nvim --embed --clean +set keymap=dvorak +vs'.\r\nProgram terminated with signal SIGABRT, Aborted.\r\n\r\nwarning: Section `.reg-xstate/3666388' in core file too small.\r\n#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140182519320576) at ./nptl/pthread_kill.c:44\r\n44\t./nptl/pthread_kill.c: 没有那个文件或目录.\r\n[Current thread is 1 (Thread 0x7f7ec9449000 (LWP 3666388))]\r\n\u001b[?2004h(gdb) \u001b[7mthread apply all bt full\u001b[27m\r\n\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[Cthread apply all bt full\r\n\u001b[?2004l\r\nThread 2 (LWP 3666390):\r\nwarning: Section `.reg-xstate/3666390' in core file too small.\r\n#0  0x0000000000000000 in ?? ()\r\nNo symbol table info available.\r\nBacktrace stopped: Cannot access memory at address 0x0\r\n\r\nThread 1 (Thread 0x7f7ec9449000 (LWP 3666388)):\r\n#0  __pthread_kill_implementation (no_tid=0, signo=6, threadid=140182519320576) at ./nptl/pthread_kill.c:44\r\n        tid = <optimized out>\r\n        ret = 0\r\n        pd = 0x7f7ec9449000\r\n        old_mask = {__val = {94672497249660, 94672497249360, 94672497249660, 0, 0, 0, 0, 0, 3376528792, 140733461777736, 0, 0, 0, 11030676009801187840, 18446744073709551615, 11030676009801187840}}\r\n        ret = <optimized out>\r\n        pd = <optimized out>\r\n        old_mask = <optimized out>\r\n        ret = <optimized out>\r\n        tid = <optimized out>\r\n        ret = <optimized out>\r\n        resultvar = <optimized out>\r\n        resultvar = <optimized out>\r\n        __arg3 = <optimized out>\r\n        __arg2 = <optimized out>\r\n        __arg1 = <optimized out>\r\n        _a3 = <optimized out>\r\n        _a2 = <optimized out>\r\n        _a1 = <optimized out>\r\n        __futex = <optimized out>\r\n        resultvar = <optimized out>\r\n        __arg3 = <optimized out>\r\n        __arg2 = <optimized out>\r\n        __arg1 = <optimized out>\r\n        _a3 = <optimized out>\r\n        _a2 = <optimized out>\r\n        _a1 = <optimized out>\r\n        __futex = <optimized out>\r\n        __private = <optimized out>\r\n        __oldval = <optimized out>\r\n        result = <optimized out>\r\n#1  __pthread_kill_internal (signo=6, threadid=140182519320576) at ./nptl/pthread_kill.c:78\r\nNo locals.\r\n#2  __GI___pthread_kill (threadid=140182519320576, signo=signo@entry=6) at ./nptl/pthread_kill.c:89\r\nNo locals.\r\n#3  0x00007f7ec9242476 in __GI_raise (sig=sig@entry=6) at ../sysdeps/posix/raise.c:26\r\n        ret = <optimized out>\r\n#4  0x00007f7ec92287f3 in __GI_abort () at ./stdlib/abort.c:79\r\n        save_stage = 1\r\n        act = {__sigaction_handler = {sa_handler = 0x561aa88dd840, sa_sigaction = 0x561aa88dd840}, sa_mask = {__val = {18, 94672497249360, 2147483647, 4, 140182518858986, 0, 268401090, 140182516479127, 11030676009801187840, 0, 18446744073709551440, 0, 94672464807696, 546, 94672464807984, 140182520750144}}, sa_flags = -919972781, sa_restorer = 0x7f7ec9417600 <_IO_file_jumps>}\r\n        sigs = {__val = {32, 140182519133856, 94672464807696, 546, 94672464807984, 140182520750144, 140182519320576, 140182517442798, 206158430256, 140733461777808, 206158430232, 140733461777808, 140733461777600, 11030676009801187840, 140733461788082, 140182518859426}}\r\n#5  0x00007f7ec922871b in __assert_fail_base (fmt=0x7f7ec9193497 \"%s%s%s:%u：%s%s假设 ‘%s’ 失败。\\n%n\", assertion=0x561aa6a28830 \"attrs[i] >= 0\", file=0x561aa6a28710 \"/home/fool/Code/z/github.com/neovim/neovim/src/nvim/ui_compositor.c\", line=546, function=<optimized out>) at ./assert/assert.c:92\r\n        str = 0x561aa88dd840 \"my$\\311\\037V\"\r\n        total = 4096\r\n#6  0x00007f7ec9239e96 in __GI___assert_fail (assertion=0x561aa6a28830 \"attrs[i] >= 0\", file=0x561aa6a28710 \"/home/fool/Code/z/github.com/neovim/neovim/src/nvim/ui_compositor.c\", line=546, function=0x561aa6a28870 <__PRETTY_FUNCTION__.1> \"ui_comp_raw_line\") at ./assert/assert.c:101\r\nNo locals.\r\n#7  0x0000561aa68510b5 in ui_comp_raw_line (grid=1, row=31, startcol=49, endcol=152, clearcol=152, clearattr=0, flags=0, chunk=0x561aa886add4, attrs=0x561aa889b554) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/ui_compositor.c:546\r\n        i = 7\r\n        __PRETTY_FUNCTION__ = \"ui_comp_raw_line\"\r\n        __func__ = \"ui_comp_raw_line\"\r\n        covered = false\r\n#8  0x0000561aa6849ab2 in ui_call_raw_line (grid=1, row=31, startcol=49, endcol=152, clearcol=152, clearattr=0, flags=0, chunk=0x561aa886add4, attrs=0x561aa889b554) at /home/fool/Code/z/github.com/neovim/neovim/build/src/nvim/auto/ui_events_call.generated.h:232\r\nNo locals.\r\n#9  0x0000561aa684c58f in ui_line (grid=0x561aa6ae4000 <default_grid>, row=31, invalid_row=false, startcol=49, endcol=152, clearcol=152, clearattr=0, wrap=false) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/ui.c:476\r\n        __PRETTY_FUNCTION__ = \"ui_line\"\r\n        flags = 0\r\n        off = 4761\r\n#10 0x0000561aa668c03f in grid_put_linebuf (grid=0x561aa6ae4000 <default_grid>, row=31, coloff=0, col=152, endcol=152, clear_width=152, rl=false, bg_attr=0, wrap=false) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/grid.c:787\r\n        redraw_next = false\r\n        clear_next = false\r\n        __PRETTY_FUNCTION__ = \"grid_put_linebuf\"\r\n        __func__ = \"grid_put_linebuf\"\r\n        invalid_row = false\r\n        off_to = 4712\r\n        max_off_to = 4864\r\n        clear_start = 152\r\n        start_dirty = 49\r\n        end_dirty = 152\r\n        clear_dirty_start = -1\r\n        clear_end = 152\r\n#11 0x0000561aa668b715 in grid_line_flush () at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/grid.c:570\r\n        grid = 0x561aa6ae4000 <default_grid>\r\n        __PRETTY_FUNCTION__ = \"grid_line_flush\"\r\n#12 0x0000561aa680b78d in win_redr_status (wp=0x561aa8858c50) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/statusline.c:175\r\n        len = 9\r\n        this_ru_col = 57\r\n        fillchar = 32\r\n        stl_width = 75\r\n        p = 0x561aa6af7420 <NameBuff> \"<en-dv>\"\r\n        col = 77\r\n        width = 9\r\n        attr = 37\r\n        is_stl_global = false\r\n        busy = true\r\n#13 0x0000561aa65c7345 in update_screen () at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/drawscreen.c:646\r\n        wp = 0x561aa8858c50\r\n        did_intro = false\r\n        is_stl_global = false\r\n        type = 40\r\n        hl_changed = true\r\n        did_one = true\r\n#14 0x0000561aa672a025 in normal_redraw (s=0x7fff0fff51e0) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/normal.c:1355\r\nNo locals.\r\n#15 0x0000561aa672a291 in normal_check (state=0x7fff0fff51e0) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/normal.c:1451\r\n        s = 0x7fff0fff51e0\r\n#16 0x0000561aa680a79a in state_enter (s=0x7fff0fff51e0) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/state.c:40\r\n        check_result = 268391104\r\n        key = 22042\r\n        keyname = 0x7fff0fff51e0 \"3\\241r\\246\\032V\"\r\n        execute_result = 32767\r\n        __func__ = \"state_enter\"\r\n#17 0x0000561aa6727e6b in normal_enter (cmdwin=false, noexmode=false) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/normal.c:516\r\n        state = {state = {check = 0x561aa672a133 <normal_check>, execute = 0x561aa67294c3 <normal_execute>}, command_finished = false, ctrl_w = false, need_flushbuf = false, set_prevcount = false, previous_got_int = false, cmdwin = false, noexmode = false, toplevel = true, oa = {op_type = 0, regname = 0, motion_type = kMTCharWise, motion_force = 0, use_reg_one = false, inclusive = false, end_adjusted = false, start = {lnum = 0, col = 0, coladd = 0}, end = {lnum = 0, col = 0, coladd = 0}, cursor_start = {lnum = 0, col = 0, coladd = 0}, line_count = 0, empty = false, is_VIsual = false, start_vcol = 0, end_vcol = 0, prev_opcount = 0, prev_count0 = 0, excl_tr_ws = false}, ca = {oap = 0x0, prechar = 0, cmdchar = 0, nchar = 0, ncharC1 = 0, ncharC2 = 0, extra_char = 0, opcount = 0, count0 = 0, count1 = 0, arg = 0, retval = 0, searchbuf = 0x0}, mapped_len = 0, old_mapped_len = 0, idx = 0, c = 0, old_col = 0, old_pos = {lnum = 0, col = 0, coladd = 0}}\r\n        prev_oap = 0x0\r\n#18 0x0000561aa66cbf98 in main (argc=5, argv=0x7fff0fff55b8) at /home/fool/Code/z/github.com/neovim/neovim/src/nvim/main.c:651\r\n        fname = 0x0\r\n        params = {argc = 5, argv = 0x7fff0fff55b8, use_vimrc = 0x561aa69ff8dd \"NONE\", clean = true, n_commands = 2, commands = {0x7fff0fff75c8 \"set keymap=dvorak\", 0x7fff0fff75db \"vs\", 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}, cmds_tofree = \"\\000\\000\\000\\000\\000\\000\\000\\000\\000\", n_pre_commands = 0, pre_commands = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}, luaf = 0x0, lua_arg0 = -1, edit_type = 0, tagname = 0x0, use_ef = 0x0, input_istext = false, no_swap_file = 0, use_debug_break_level = -1, window_count = 1, window_layout = 0, diff_mode = 0, listen_addr = 0x0, remote = 0, server_addr = 0x0, scriptin = 0x0, scriptout = 0x0, scriptout_append = false, had_stdin_file = false}\r\n        cwd = 0x0\r\n        has_term = true\r\n        use_builtin_ui = false\r\n        remote_ui = false\r\n        __PRETTY_FUNCTION__ = \"main\"\r\n        use_remote_ui = true\r\n        listen_and_embed = false\r\n        vimrc_none = true\r\n        __func__ = \"main\"\r\n\u001b[?2004h(gdb) q\r\n\u001b[?2004l\r\n```\n\n### Expected behavior\n\nCrash with assertion failure.\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0-dev-2243+g4ffc20c95\n\n### Vim (not Nvim) behaves the same?\n\nno, VIM 8.2\n\n### Operating system/version\n\nUbuntu 22.04.3 LTS x86_64\n\n### Terminal name/version\n\nalacritty 0.13.1 & zellij 0.39.2\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nbuild from repo",
    "closed_at": "2024-01-31T00:48:54Z",
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27269/comments",
    "created_at": "2024-01-30T22:28:10Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27269/events",
    "html_url": "https://github.com/neovim/neovim/issues/27269",
    "id": 2108906314,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "tabline, winbar, statuscolumn",
            "id": 3385615828,
            "name": "statusline",
            "node_id": "LA_kwDOAPphoM7JzGXU",
            "url": "https://api.github.com/repos/neovim/neovim/labels/statusline"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27269/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM59s1tK",
    "number": 27269,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27269/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27269/timeline",
    "title": "ui_comp_raw_line assertion failed if set keymap=dvorak then vsplit",
    "updated_at": "2024-01-31T00:48:54Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27269",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/22391687?v=4",
        "events_url": "https://api.github.com/users/lifeich1/events{/privacy}",
        "followers_url": "https://api.github.com/users/lifeich1/followers",
        "following_url": "https://api.github.com/users/lifeich1/following{/other_user}",
        "gists_url": "https://api.github.com/users/lifeich1/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lifeich1",
        "id": 22391687,
        "login": "lifeich1",
        "node_id": "MDQ6VXNlcjIyMzkxNjg3",
        "organizations_url": "https://api.github.com/users/lifeich1/orgs",
        "received_events_url": "https://api.github.com/users/lifeich1/received_events",
        "repos_url": "https://api.github.com/users/lifeich1/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lifeich1/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lifeich1/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lifeich1"
    }
}