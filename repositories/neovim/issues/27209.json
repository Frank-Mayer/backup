{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\r\n\r\n```\r\n4   nvim                          \t       0x1029207d8 buf_signcols_count_range + 1300 (decoration.c:824)\r\n5   nvim                          \t       0x102920ad4 buf_remove_decor_sh + 128 (decoration.c:214)\r\n6   nvim                          \t       0x1029209e4 buf_decor_remove + 216 (decoration.c:200)\r\n7   nvim                          \t       0x102a100fc extmark_del + 604 (extmark.c:157)\r\n8   nvim                          \t       0x102a10334 extmark_clear + 472 (extmark.c:194)\r\n9   nvim                          \t       0x102898df0 nvim_buf_clear_namespace + 308 (extmark.c:982)\r\n10  nvim                          \t       0x102873c24 nlua_api_nvim_buf_clear_namespace + 384 (lua_api_c_bindings.generated.c:2922)\r\n11  nvim                          \t       0x102d5386c lj_BC_FUNCC + 44\r\n12  nvim                          \t       0x102d544b0 lj_ff_coroutine_resume + 156\r\n13  nvim                          \t       0x102d69c84 lua_pcall + 228\r\n14  nvim                          \t       0x102a76710 nlua_schedule_event + 80 (executor.c:367)\r\n15  nvim                          \t       0x102c1549c state_handle_k_event + 96 (state.c:119)\r\n16  nvim                          \t       0x102b01fc8 nv_event + 112 (normal.c:6613)\r\n17  nvim                          \t       0x102af9b2c normal_execute + 2380 (normal.c:1227)\r\n18  nvim                          \t       0x102c153f4 state_enter + 676 (state.c:101)\r\n19  nvim                          \t       0x102af50f4 normal_enter + 208 (normal.c:516)\r\n20  nvim                          \t       0x102a820b8 main + 4452 (main.c:651)\r\n21  dyld                          \t       0x18ca990e0 start + 2360\r\n```\r\n\r\n### Steps to reproduce\r\n\r\n- Have a setup with gitsigns.\r\n- Apply this PR: https://github.com/lewis6991/gitsigns.nvim/pull/938\r\n- Open a git maintained file.\r\n- Add a bunch of new lines\r\n- Undo\r\n- [Crash]\r\n\r\nCan provide better repro on request.\r\n\r\n### Expected behavior\r\n\r\nNo crash\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-4e59422e1\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNA\r\n\r\n### Operating system/version\r\n\r\nmacOS 14.2.1\r\n\r\n### Terminal name/version\r\n\r\nwezterm\r\n\r\n### $TERM environment variable\r\n\r\nwexterm\r\n\r\n### Installation\r\n\r\nSource",
    "closed_at": "2024-01-26T15:06:26Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "@luukvbaal ",
            "created_at": "2024-01-26T09:47:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1911762835",
            "id": 1911762835,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x8y-T",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1911762835/reactions"
            },
            "updated_at": "2024-01-26T09:47:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1911762835",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Note adding `undo_restore = false` avoids the crash but causes new signs not to be applied after adding newlines, undoing, and adding the lines back again. This is regardless of whether an id is provided or not.",
            "created_at": "2024-01-26T09:57:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1911776642",
            "id": 1911776642,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x82WC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1911776642/reactions"
            },
            "updated_at": "2024-01-26T09:57:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1911776642",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Note adding `undo_restore = false` avoids the crash but causes new signs not to be applied after adding newlines, undoing, and adding the lines back again. This is regardless of whether an id is provided or not.\r\n\r\nWhat does this mean exactly? Can't seem to reproduce.",
            "created_at": "2024-01-26T14:47:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1912183536",
            "id": 1912183536,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x-Zrw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912183536/reactions"
            },
            "updated_at": "2024-01-26T14:47:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912183536",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`undo_restore = true` (default) results in assert failure\r\n\r\nhttps://github.com/neovim/neovim/assets/7904185/15fe3a13-37b2-465b-b3d2-1d22f8590ad6\r\n\r\n`undo_restore = false` new signs aren't applied after undo despite new extmarks being applied.\r\n\r\nhttps://github.com/neovim/neovim/assets/7904185/be370ed6-9adb-482f-a3c9-f5da162272e5",
            "created_at": "2024-01-26T14:58:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1912206116",
            "id": 1912206116,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x-fMk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912206116/reactions"
            },
            "updated_at": "2024-01-26T14:58:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912206116",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks, yeah that's what I assumed you meant and what I tried out. The crash should be resolved by #27215, still can't seem to reproduce the redraw issue. Perhaps something else is triggering a redraw in my config. Or is it not just a redraw issue on your end?",
            "created_at": "2024-01-26T15:03:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1912212873",
            "id": 1912212873,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x-g2J",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912212873/reactions"
            },
            "updated_at": "2024-01-26T15:03:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912212873",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Awesome. I'll look into the other issue some more later.",
            "created_at": "2024-01-26T15:06:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/27209#issuecomment-1912217946",
            "id": 1912217946,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27209",
            "node_id": "IC_kwDOAPphoM5x-iFa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912217946/reactions"
            },
            "updated_at": "2024-01-26T15:06:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1912217946",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27209/comments",
    "created_at": "2024-01-26T09:46:43Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27209/events",
    "html_url": "https://github.com/neovim/neovim/issues/27209",
    "id": 2101904577,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27209/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM59SITB",
    "number": 27209,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27209/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27209/timeline",
    "title": "Crash when using extmarks with `invalidate=true` and undo",
    "updated_at": "2024-01-26T15:06:43Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27209",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991"
    }
}