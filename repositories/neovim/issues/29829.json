{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nI don't know if this is a real bug or expected behaviour, but it has thrown me off quite a bit. Since Scheme and Treesitter queries share the same file extension `.scm` the `FileType` autocommand gets fired twice (once per file type), even if there is a modeline that sets the file type explicitly.\r\n\r\nThe reason this threw me off is because the callback function happens to raise and error for Scheme, but not for Treesitter queries. This would not be an issue because I never expected the file type to be Scheme. The best I can do is silently ignore errors in the callback, but this might come back to haunt me in the future if there happens to be an error after the file type settles.\n\n### Steps to reproduce\n\nTake the following query file:\r\n\r\n```\r\n(foo (bar (baz)) @bar) @foo\r\n\r\n;;; vim:ft=query\r\n```\r\n\r\nIn my `init.lua` I have the following code:\r\n\r\n```lua\r\nlocal function on_file_type(_args)\r\n\tprint(vim.inspect(_args))\r\nend\r\n\r\nvim.api.nvim_create_autocmd('FileType', {pattern = '*', callback = on_file_type})\r\n```\r\n\r\nThe callback function gets called twice:\r\n\r\n```\r\n{\r\n  buf = 1,\r\n  event = \"FileType\",\r\n  file = \"test/highlight/samples/query/regular.scm\",\r\n  id = 8,\r\n  match = \"scheme\"\r\n}\r\n\r\n{\r\n  buf = 1,\r\n  event = \"FileType\",\r\n  file = \"test/highlight/samples/query/regular.scm\",\r\n  id = 8,\r\n  match = \"query\"\r\n}\r\n```\n\n### Expected behavior\n\nThe autocommand should be fired only once after the file type has settled, at least if there is a modeline which explicitly sets the file type.\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nVoid Linux\n\n### Terminal name/version\n\nalacritty 0.13.2\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nVoid packages",
    "closed_at": "2024-07-21T20:09:52Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Yes, that is expected. The builtin filetype detection (correctly) detects this as a scheme file; then the modeline overrides this as a query. These are separate mechanisms. ",
            "created_at": "2024-07-21T20:09:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/29829#issuecomment-2241760557",
            "id": 2241760557,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29829",
            "node_id": "IC_kwDOAPphoM6Fno0t",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2241760557/reactions"
            },
            "updated_at": "2024-07-21T20:10:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2241760557",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29829/comments",
    "created_at": "2024-07-21T19:42:19Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29829/events",
    "html_url": "https://github.com/neovim/neovim/issues/29829",
    "id": 2421575457,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29829/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6QVk8h",
    "number": 29829,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29829/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29829/timeline",
    "title": "Autocommand `FileType` called twice for Treesitter query files",
    "updated_at": "2024-07-21T20:10:22Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29829",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4954650?v=4",
        "events_url": "https://api.github.com/users/HiPhish/events{/privacy}",
        "followers_url": "https://api.github.com/users/HiPhish/followers",
        "following_url": "https://api.github.com/users/HiPhish/following{/other_user}",
        "gists_url": "https://api.github.com/users/HiPhish/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/HiPhish",
        "id": 4954650,
        "login": "HiPhish",
        "node_id": "MDQ6VXNlcjQ5NTQ2NTA=",
        "organizations_url": "https://api.github.com/users/HiPhish/orgs",
        "received_events_url": "https://api.github.com/users/HiPhish/received_events",
        "repos_url": "https://api.github.com/users/HiPhish/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/HiPhish/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/HiPhish/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/HiPhish"
    }
}