{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
        "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
        "followers_url": "https://api.github.com/users/zeertzjq/followers",
        "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
        "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zeertzjq",
        "id": 35768171,
        "login": "zeertzjq",
        "node_id": "MDQ6VXNlcjM1NzY4MTcx",
        "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
        "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
        "repos_url": "https://api.github.com/users/zeertzjq/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zeertzjq"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
            "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
            "followers_url": "https://api.github.com/users/zeertzjq/followers",
            "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
            "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zeertzjq",
            "id": 35768171,
            "login": "zeertzjq",
            "node_id": "MDQ6VXNlcjM1NzY4MTcx",
            "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
            "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
            "repos_url": "https://api.github.com/users/zeertzjq/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zeertzjq"
        }
    ],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nWhen using extmark with virt_lines and conceallevel + concealcursor, the cursor gets messed up. It do not skips over virt lines and it also sometimes completely refuses to update and gets stuck. This do not happens in v0.9.5 release where it works correctly with no issues with same config (just opening new window is slightly different ofc from steps to reproduce).\r\n\r\nFor additional full reproduction, you can also use https://github.com/CopilotC-Nvim/CopilotChat.nvim plugin on commit [55722d7](https://github.com/CopilotC-Nvim/CopilotChat.nvim/commit/55722d7b3131ef6d2441e379d9c64c5991b0cf5c) and simply run `CopilotChatOpen` and notice the messed up cursor. Also works fine on v0.9.5.\r\n\r\n### Steps to reproduce\r\n\r\nminimal.lua\r\n```lua\r\n-- Run this file as `nvim --clean -u minimal.lua`\r\nvim.api.nvim_create_user_command('Test', function()\r\n    local ns = vim.api.nvim_create_namespace('my_namespace')\r\n    local bufnr = vim.api.nvim_create_buf(false, true)\r\n\r\n    local opts = {\r\n        id = ns,\r\n        hl_mode = 'combine',\r\n        priority = 100,\r\n        virt_lines_leftcol = true,\r\n        virt_lines = {\r\n            { { '| Hello', 'DiagnosticInfo' } },\r\n            { { '| World', 'DiagnosticInfo' } },\r\n        },\r\n    }\r\n\r\n    vim.api.nvim_buf_set_text(\r\n        bufnr,\r\n        0,\r\n        0,\r\n        0,\r\n        0,\r\n        { '', '' }\r\n    )\r\n\r\n    vim.api.nvim_buf_set_extmark(bufnr, ns, 0, 0, opts)\r\n\r\n    local winnr = vim.api.nvim_open_win(bufnr, false, {\r\n        vertical = true\r\n    })\r\n\r\n    vim.wo[winnr].conceallevel = 2\r\n    vim.wo[winnr].concealcursor = 'niv'\r\nend, {})\r\n```\r\n\r\nRun\r\n`nvim --clean -u minimal.lua`\r\n\r\nRun\r\n`:Test`\r\n\r\nNavigate to new window\r\nMove cursor around, notice its on wrong position. With my own configuration the cursor position even stops completely updating.\r\n\r\n### Expected behavior\r\n\r\nCursor should work in identical way as it does in 0.9.5 and also in latest nightly when conceal is not set.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-2615+g924a7ef8b\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno, but nvim 0.95 release also works\r\n\r\n### Operating system/version\r\n\r\nArch Linux x86_64\r\n\r\n### Terminal name/version\r\n\r\nst\r\n\r\n### $TERM environment variable\r\n\r\ntmux-256color\r\n\r\n### Installation\r\n\r\nrepo",
    "closed_at": "2024-03-16T21:43:15Z",
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27887/comments",
    "created_at": "2024-03-16T16:19:34Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27887/events",
    "html_url": "https://github.com/neovim/neovim/issues/27887",
    "id": 2190120513,
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 3385582660,
            "name": "conceal",
            "node_id": "LA_kwDOAPphoM7Jy-RE",
            "url": "https://api.github.com/repos/neovim/neovim/labels/conceal"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27887/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 317,
        "created_at": "2023-02-02T14:11:43Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
            "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
            "followers_url": "https://api.github.com/users/bfredl/followers",
            "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
            "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/bfredl",
            "id": 1363104,
            "login": "bfredl",
            "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
            "organizations_url": "https://api.github.com/users/bfredl/orgs",
            "received_events_url": "https://api.github.com/users/bfredl/received_events",
            "repos_url": "https://api.github.com/users/bfredl/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/bfredl"
        },
        "description": "",
        "due_on": "2024-05-01T07:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/36",
        "id": 8997654,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/36/labels",
        "node_id": "MI_kwDOAPphoM4AiUsW",
        "number": 36,
        "open_issues": 115,
        "state": "open",
        "title": "0.10",
        "updated_at": "2024-03-19T00:59:38Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/36"
    },
    "node_id": "I_kwDOAPphoM6CipZB",
    "number": 27887,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27887/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27887/timeline",
    "title": "nvim_buf_set_extmark with virt_lines messes up the cursor when conceallevel and concealcursor is set",
    "updated_at": "2024-03-16T21:43:16Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27887",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5115805?v=4",
        "events_url": "https://api.github.com/users/deathbeam/events{/privacy}",
        "followers_url": "https://api.github.com/users/deathbeam/followers",
        "following_url": "https://api.github.com/users/deathbeam/following{/other_user}",
        "gists_url": "https://api.github.com/users/deathbeam/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/deathbeam",
        "id": 5115805,
        "login": "deathbeam",
        "node_id": "MDQ6VXNlcjUxMTU4MDU=",
        "organizations_url": "https://api.github.com/users/deathbeam/orgs",
        "received_events_url": "https://api.github.com/users/deathbeam/received_events",
        "repos_url": "https://api.github.com/users/deathbeam/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/deathbeam/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/deathbeam/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/deathbeam"
    }
}