{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Neovim Version\n\nv0.5.0\n\n### Operating system/version:\n\nUbuntu 18.04\n\n### Terminal name/version:\n\nterminal\n\n### TERM environment variable\n\nxterm-256color\n\n### Installation\n\nnvim.appimage from the release page\n\n### Steps to reproduce\n\n### Description\r\n\r\nI work on different servers and don't want to mess with system wide installed Python and NodeJS distributions. Moreover, the NodeJS distribution, shipped with e.g. Ubuntu 18.04 is too old. That is why I have a NodeJS distribution and custom Python environment in the ${HOME}/.local/share/nvim/lib folder, for Neovim only. Then I specify in **init.vim** the node host program and Python host program with the options:\r\n```\r\nlet g:python3_host_prog = join([$HOME, \"/.local/share/nvim/lib/python/bin/python3\"], \"\")\r\nlet g:node_host_prog = join([$HOME, \"/.local/share/nvim/lib/node/bin/node\"], \"\")\r\n```\r\nFor python, this works excellent. However, for Node, it does not work. Node only works well if the node binary is in the path _and_ the option `g:node_host_prog` is not set. \r\n\r\n### Workaround\r\nComment out the `g:node_host_prog` setting in **init.vim** and run **nvim** with:\r\n```sh\r\nPATH=${HOME}/.local/share/nvim/lib/node/bin:${PATH} nvim\r\n```\r\n\r\n\r\nPS: nvim 0.5.0 on macOS has the same problem.\n\n### Vim\n\n_No response_\n\n### Expected behavior\n\nRun :checkhealth in nvim with the node binary of choice in the path and _not_ set the `node_host_prog`:\r\n\r\n```\r\n...\r\n## Python 3 provider (optional)\r\n   - INFO: pyenv: Path: /home/ubuntu/.pyenv/libexec/pyenv\r\n   - INFO: pyenv: Root: /home/ubuntu/.pyenv\r\n   - INFO: Using: g:python3_host_prog = \"/home/ubuntu/.local/share/nvim/lib/python/bin/python3\"\r\n   - INFO: Executable: /home/ubuntu/.local/share/nvim/lib/python/bin/python3\r\n   - INFO: Python version: 3.7.7\r\n   - INFO: pynvim version: 0.4.3\r\n   - OK: Latest pynvim is installed.\r\n \r\n ## Node.js provider (optional)\r\n   - INFO: Node.js: v14.16.1\r\n   - INFO: Nvim node.js host: /home/ubuntu/.local/share/nvim/lib/node-v14.16.1-linux-x64/lib/node_modules/neovim/bin/cli.js\r\n   - OK: Latest \"neovim\" npm/yarn package is installed: 4.10.0\r\n...\r\n```\r\n\n\n### Actual behavior\n\nRun :checkhealth in nvim with `g:node_host_prog` and `g:python3_host_prog` set to custom locations. Note that for NodeJS, nvim finds `/usr/bin/node` (v8.10.0) installed on the system, instead of the one set with `g:node_host_prog` (v14.16.1) option.\r\n\r\n```\r\n...\r\n## Python 3 provider (optional)\r\n   - INFO: pyenv: Path: /home/ubuntu/.pyenv/libexec/pyenv\r\n   - INFO: pyenv: Root: /home/ubuntu/.pyenv\r\n   - INFO: Using: g:python3_host_prog = \"/home/ubuntu/.local/share/nvim/lib/python/bin/python3\"\r\n   - INFO: Executable: /home/ubuntu/.local/share/nvim/lib/python/bin/python3\r\n   - INFO: Python version: 3.7.7\r\n   - INFO: pynvim version: 0.4.3\r\n   - OK: Latest pynvim is installed.\r\n\r\n## Node.js provider (optional)\r\n   - INFO: Node.js: v8.10.0\r\n   - INFO: Nvim node.js host: /home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node\r\n   - ERROR: Command error (job=10, exit code 1): `node '/home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node' --version` (in '/home/ubuntu/.dotfiles/nvim')\r\n     stderr: module.js:549    throw err;    ^Error: Cannot find module '/home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node'    at Function.Module._resolveFilename (module.js:547:15) at Function.Module._load (module.js:474:25) at Function.Module.runMain (module.js:693:10) at startup (bootstrap_node.js:188:16) at bootstrap_node.js:609:3 in/node --prefix=/home/ubuntu/.local/share/\r\n   - ERROR: Failed to run: ['node', '/home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node', '--version']\r\n     - ADVICE:\r\n       - Report this issue with the output of:\r\n       - ['node', '/home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node', '--version']\r\n...\r\n```",
    "closed_at": "2021-08-09T03:39:47Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "When setting `let g:node_host_prog = '/home/ubuntu/.local/share/nvim/lib/node/bin/node'`, in **init.vim** it looks like nvim is trying to run:\r\n```\r\n`node '/home/ubuntu/.local/share/nvim/lib/node/bin/node --prefix=/home/ubuntu/.local/share/nvim/lib/node' --version`\r\n```\r\nI guess the first token `node` should not be there.",
            "created_at": "2021-08-08T12:13:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/15308#issuecomment-894788546",
            "id": 894788546,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/15308",
            "node_id": "IC_kwDOAPphoM41VWPC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894788546/reactions"
            },
            "updated_at": "2021-08-08T12:25:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894788546",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15607023?v=4",
                "events_url": "https://api.github.com/users/gilbertfrancois/events{/privacy}",
                "followers_url": "https://api.github.com/users/gilbertfrancois/followers",
                "following_url": "https://api.github.com/users/gilbertfrancois/following{/other_user}",
                "gists_url": "https://api.github.com/users/gilbertfrancois/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gilbertfrancois",
                "id": 15607023,
                "login": "gilbertfrancois",
                "node_id": "MDQ6VXNlcjE1NjA3MDIz",
                "organizations_url": "https://api.github.com/users/gilbertfrancois/orgs",
                "received_events_url": "https://api.github.com/users/gilbertfrancois/received_events",
                "repos_url": "https://api.github.com/users/gilbertfrancois/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gilbertfrancois/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gilbertfrancois/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gilbertfrancois"
            }
        },
        {
            "author_association": "NONE",
            "body": "Can reproduce this on CentOS 7 with nvim nightly.",
            "created_at": "2021-08-09T02:21:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/15308#issuecomment-894913159",
            "id": 894913159,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/15308",
            "node_id": "IC_kwDOAPphoM41V0qH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894913159/reactions"
            },
            "updated_at": "2021-08-09T05:04:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894913159",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/16662357?v=4",
                "events_url": "https://api.github.com/users/jdhao/events{/privacy}",
                "followers_url": "https://api.github.com/users/jdhao/followers",
                "following_url": "https://api.github.com/users/jdhao/following{/other_user}",
                "gists_url": "https://api.github.com/users/jdhao/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jdhao",
                "id": 16662357,
                "login": "jdhao",
                "node_id": "MDQ6VXNlcjE2NjYyMzU3",
                "organizations_url": "https://api.github.com/users/jdhao/orgs",
                "received_events_url": "https://api.github.com/users/jdhao/received_events",
                "repos_url": "https://api.github.com/users/jdhao/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jdhao/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jdhao/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jdhao"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`g:node_host_prog` is not a path to the `node` binary but to the `neovim-node-host` binary. `:h g:node_host_prog` makes this explicit:\r\n\r\n```\r\n\t\t\t\t\t\t*g:node_host_prog*\r\nCommand to start the Node.js host. Setting this makes startup faster.\r\n\r\nBy default, Nvim searches for \"neovim-node-host\" using \"npm root -g\", which\r\ncan be slow. To avoid this, set g:node_host_prog to the host path: >\r\n    let g:node_host_prog = '/usr/local/bin/neovim-node-host'\r\n```\r\n\r\nThis is e.g. the path to the binary resulting from `npm install -g neovim`.",
            "created_at": "2021-08-09T03:39:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/15308#issuecomment-894930294",
            "id": 894930294,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/15308",
            "node_id": "IC_kwDOAPphoM41V412",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894930294/reactions"
            },
            "updated_at": "2021-08-09T03:39:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/894930294",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders"
            }
        },
        {
            "author_association": "NONE",
            "body": "Incase someone gets here to try and set \"node\" to a fixed version instead of the one in `$PATH`. \r\n\r\n**Nope, this doesn't do it**. \r\n\r\nThis just sets the path that neovim uses to start the node host but it's still gonna use `node` from your path.\r\n\r\nEven if I do this (documentation was confusing, but this is the correct value to set `g:node_host_prog`)\r\n```lua\r\nvim.g.node_host_prog = vim.fn.expand(\"~\") .. \"/.nvm/versions/node/v20.13.0/lib/node_modules/neovim/bin/cli.js\"\r\n```\r\n\r\n**It won't do it**",
            "created_at": "2024-08-29T12:09:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/15308#issuecomment-2317467868",
            "id": 2317467868,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/15308",
            "node_id": "IC_kwDOAPphoM6KIcDc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2317467868/reactions"
            },
            "updated_at": "2024-08-29T12:09:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2317467868",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26249511?v=4",
                "events_url": "https://api.github.com/users/chardskarth/events{/privacy}",
                "followers_url": "https://api.github.com/users/chardskarth/followers",
                "following_url": "https://api.github.com/users/chardskarth/following{/other_user}",
                "gists_url": "https://api.github.com/users/chardskarth/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/chardskarth",
                "id": 26249511,
                "login": "chardskarth",
                "node_id": "MDQ6VXNlcjI2MjQ5NTEx",
                "organizations_url": "https://api.github.com/users/chardskarth/orgs",
                "received_events_url": "https://api.github.com/users/chardskarth/received_events",
                "repos_url": "https://api.github.com/users/chardskarth/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/chardskarth/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/chardskarth/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/chardskarth"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> but it's still gonna use `node` from your path.\r\n\r\nThat's probably because `cli.js` does so. \r\n\r\nThis will be fixed as we migrate to \"v2 remote plugins\" (which don't need `cli.js`): https://github.com/neovim/neovim/issues/27949",
            "created_at": "2024-08-29T13:04:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/15308#issuecomment-2317602696",
            "id": 2317602696,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/15308",
            "node_id": "IC_kwDOAPphoM6KI8-I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 1,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2317602696/reactions"
            },
            "updated_at": "2024-08-29T13:04:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2317602696",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/15308/comments",
    "created_at": "2021-08-08T12:06:59Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/15308/events",
    "html_url": "https://github.com/neovim/neovim/issues/15308",
    "id": 963418002,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "Issues that are closed as \"invalid\"",
            "id": 77997477,
            "name": "closed:invalid",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Nw==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:invalid"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/15308/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU5NjM0MTgwMDI=",
    "number": 15308,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/15308/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/15308/timeline",
    "title": "Setting g:node_host_prog in init.vim generates an error.",
    "updated_at": "2024-08-29T13:04:28Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/15308",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/15607023?v=4",
        "events_url": "https://api.github.com/users/gilbertfrancois/events{/privacy}",
        "followers_url": "https://api.github.com/users/gilbertfrancois/followers",
        "following_url": "https://api.github.com/users/gilbertfrancois/following{/other_user}",
        "gists_url": "https://api.github.com/users/gilbertfrancois/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gilbertfrancois",
        "id": 15607023,
        "login": "gilbertfrancois",
        "node_id": "MDQ6VXNlcjE1NjA3MDIz",
        "organizations_url": "https://api.github.com/users/gilbertfrancois/orgs",
        "received_events_url": "https://api.github.com/users/gilbertfrancois/received_events",
        "repos_url": "https://api.github.com/users/gilbertfrancois/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gilbertfrancois/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gilbertfrancois/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gilbertfrancois"
    }
}