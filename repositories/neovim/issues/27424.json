{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nSince commit 2e982f1aad9f1a03562b7a451d642f76b04c37cb, Volar LSP always exit a few seconds after attached to a Vue buffer.\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n- Do `npx create-vite@latest --template vue-ts bug-volar && cd bug-volar && npm i`\r\n- `minimal_init.lua`:\r\n```lua\r\nlocal pattern = 'vue'\r\nlocal cmd = {'vue-language-server' , '--stdio'}\r\n-- Add files/folders here that indicate the root of a project\r\nlocal root_markers = { 'package.json'}\r\n-- Change to table with settings if required\r\nlocal settings = vim.empty_dict()\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'bugged-volar',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings,\r\n      init_options = {\r\n        typescript = {\r\n          tsdk = \"\",\r\n        },\r\n      },\r\n    })\r\n  end\r\n})\r\n```\r\n- `nvim --clean -u minimal_init.lua src/App.vue`\r\n\r\n### Expected behavior\r\n\r\nVolar to not quit after a few seconds of attaching\r\n\r\n### Additional Information:\r\n\r\n- Using the minimal reproduce template on 0.9.5 gives this log file:\r\n```\r\n[START][2024-02-11 20:08:19] LSP logging initiated\r\n[WARN][2024-02-11 20:08:19] ...lsp/handlers.lua:137\t\"The language server volar triggers a registerCapability handler despite dynamicRegistration set to false. Report upstream, this warning is harmless\"\r\n```\r\n\r\n- Using the same minimal template on nightly creates this log:\r\n```\r\n[START][2024-02-11 20:11:28] LSP logging initiated\r\n[WARN][2024-02-11 20:11:29] ...lsp/handlers.lua:134\t\"The language server volar triggers a registerCapability handler for workspace/didChangeWorkspaceFolders despite dynamicRegistration set to false. Report upstream, this warning is harmless\"\r\n[WARN][2024-02-11 20:11:32] .../lua/vim/lsp.lua:823\t\"server_request: no handler found for\"\t\"workspace/semanticTokens/refresh\"\r\n[ERROR][2024-02-11 20:11:32] .../vim/lsp/rpc.lua:798\t\"rpc\"\t\"/home/lucario387/.local/share/nvim/mason/bin/vue-language-server\"\t\"stderr\"\t\"/home/lucario387/.local/share/nvim/mason/packages/vue-language-server/node_modules/@vue/language-server/node_modules/vscode-jsonrpc/lib/common/connection.js:565\\n                        responsePromise.reject(new messages_1.ResponseError(error.code, error.message, error.data));\\n                                               ^\\n\\nResponseError: MethodNotFound\\n    at handleResponse (/home/lucario387/.local/share/nvim/mason/packages/vue-language-server/node_modules/@vue/language-server/node_modules/vscode-jsonrpc/lib/common/connection.js:565:48)\\n    at handleMessage (/home/lucario387/.local/share/nvim/mason/packages/vue-language-server/node_modules/@vue/language-server/node_modules/vscode-jsonrpc/lib/common/connection.js:345:13)\\n    at processMessageQueue (/home/lucario387/.local/share/nvim/mason/packages/vue-language-server/node_modules/@vue/language-server/node_modules/vscode-jsonrpc/lib/common/connection.js:362:17)\\n    at Immediate.<anonymous> (/home/lucario387/.local/share/nvim/mason/packages/vue-language-server/node_modules/@vue/language-server/node_modules/vscode-jsonrpc/lib/common/connection.js:334:13)\\n    at process.processImmediate (node:internal/timers:478:21) {\\n  code: -32601,\\n  data: undefined\\n}\\n\\nNode.js v20.11.0\\n\"\r\n```\r\n\r\nThe problem seems to be from not having a handler due to deferred loading\r\n\r\ncc. @wookayin\r\n\r\n### Neovim version (nvim -v)\r\n\r\ned1b66bd998b98ee8cf76b5a23c323352588dd56\r\n\r\n### Language server name/version\r\n\r\nVolar 1.8.27\r\n\r\n### Operating system/version\r\n\r\nLinux 6.7.4-arch1-1\r\n\r\n### Log file\r\n\r\n_No response_",
    "closed_at": "2024-02-12T09:31:49Z",
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "For me, volar quits on first save to the buffer.",
            "created_at": "2024-02-11T13:28:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937755121",
            "id": 1937755121,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zf8vx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937755121/reactions"
            },
            "updated_at": "2024-02-11T13:28:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937755121",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/69750637?v=4",
                "events_url": "https://api.github.com/users/gegoune/events{/privacy}",
                "followers_url": "https://api.github.com/users/gegoune/followers",
                "following_url": "https://api.github.com/users/gegoune/following{/other_user}",
                "gists_url": "https://api.github.com/users/gegoune/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gegoune",
                "id": 69750637,
                "login": "gegoune",
                "node_id": "MDQ6VXNlcjY5NzUwNjM3",
                "organizations_url": "https://api.github.com/users/gegoune/orgs",
                "received_events_url": "https://api.github.com/users/gegoune/received_events",
                "repos_url": "https://api.github.com/users/gegoune/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gegoune/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gegoune/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gegoune"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm not able to reproduce. I get this log:\r\n\r\n```\r\n[START][2024-02-11 17:38:33] LSP logging initiated\r\n[WARN][2024-02-11 17:38:33] ...lsp/handlers.lua:573\t\"No typescript found, vue-language-server will not work.\"\r\n[WARN][2024-02-11 17:38:33] ...lsp/handlers.lua:134\t\"The language server bugged-volar triggers a registerCapability handler for workspace/didChangeWorkspaceFolders despite dynamicRegistration set to false. Report upstream, this warning is harmless\"\r\n```\r\n\r\nI followed the steps to install `vue-language-server` (not in the OP) [here](https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#volar) with `npm install -g @vue/language-server`\r\n\r\nAdding `tsdk = \"node_modules/typescript/lib\"` gives me an LSP log of:\r\n\r\n```\r\n[START][2024-02-11 17:57:03] LSP logging initiated\r\n[WARN][2024-02-11 17:57:03] ...lsp/handlers.lua:134\t\"The language server bugged-volar triggers a registerCapability handler for workspace/didChangeWorkspaceFolders despite dynamicRegistration set to false. Report upstream, this warning is harmless\"\r\n```\r\n\r\nUsing the default config in nvim-lspconfig results in the same.",
            "created_at": "2024-02-11T17:40:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937819275",
            "id": 1937819275,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zgMaL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937819275/reactions"
            },
            "updated_at": "2024-02-11T17:59:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937819275",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ah I can reproduce now by saving the buffer with the config in nvim-lspconfig",
            "created_at": "2024-02-11T18:00:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937823824",
            "id": 1937823824,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zgNhQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937823824/reactions"
            },
            "updated_at": "2024-02-11T18:00:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937823824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@lucario387 @gegoune can you check with #27427.",
            "created_at": "2024-02-11T18:10:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937826573",
            "id": 1937826573,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zgOMN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 2,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937826573/reactions"
            },
            "updated_at": "2024-02-11T18:10:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937826573",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "NONE",
            "body": "@lewis6991 I can confirm that #27427 indeed fixes Volar's crash for me. Thank you so much!",
            "created_at": "2024-02-11T20:25:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937860123",
            "id": 1937860123,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zgWYb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937860123/reactions"
            },
            "updated_at": "2024-02-11T20:31:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937860123",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/69750637?v=4",
                "events_url": "https://api.github.com/users/gegoune/events{/privacy}",
                "followers_url": "https://api.github.com/users/gegoune/followers",
                "following_url": "https://api.github.com/users/gegoune/following{/other_user}",
                "gists_url": "https://api.github.com/users/gegoune/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gegoune",
                "id": 69750637,
                "login": "gegoune",
                "node_id": "MDQ6VXNlcjY5NzUwNjM3",
                "organizations_url": "https://api.github.com/users/gegoune/orgs",
                "received_events_url": "https://api.github.com/users/gegoune/received_events",
                "repos_url": "https://api.github.com/users/gegoune/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gegoune/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gegoune/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gegoune"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I manually required lsp.handlers in my neovim so I expect this to also work.",
            "created_at": "2024-02-12T00:58:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1937945919",
            "id": 1937945919,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zgrU_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937945919/reactions"
            },
            "updated_at": "2024-02-12T00:58:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1937945919",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/29790821?v=4",
                "events_url": "https://api.github.com/users/lucario387/events{/privacy}",
                "followers_url": "https://api.github.com/users/lucario387/followers",
                "following_url": "https://api.github.com/users/lucario387/following{/other_user}",
                "gists_url": "https://api.github.com/users/lucario387/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lucario387",
                "id": 29790821,
                "login": "lucario387",
                "node_id": "MDQ6VXNlcjI5NzkwODIx",
                "organizations_url": "https://api.github.com/users/lucario387/orgs",
                "received_events_url": "https://api.github.com/users/lucario387/received_events",
                "repos_url": "https://api.github.com/users/lucario387/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lucario387/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lucario387/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lucario387"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Can confirm this is working :D \n\nThank you for the fix",
            "created_at": "2024-02-12T04:40:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/27424#issuecomment-1938058153",
            "id": 1938058153,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27424",
            "node_id": "IC_kwDOAPphoM5zhGup",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1938058153/reactions"
            },
            "updated_at": "2024-02-12T04:40:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1938058153",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/29790821?v=4",
                "events_url": "https://api.github.com/users/lucario387/events{/privacy}",
                "followers_url": "https://api.github.com/users/lucario387/followers",
                "following_url": "https://api.github.com/users/lucario387/following{/other_user}",
                "gists_url": "https://api.github.com/users/lucario387/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lucario387",
                "id": 29790821,
                "login": "lucario387",
                "node_id": "MDQ6VXNlcjI5NzkwODIx",
                "organizations_url": "https://api.github.com/users/lucario387/orgs",
                "received_events_url": "https://api.github.com/users/lucario387/received_events",
                "repos_url": "https://api.github.com/users/lucario387/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lucario387/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lucario387/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lucario387"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27424/comments",
    "created_at": "2024-02-11T13:13:02Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27424/events",
    "html_url": "https://github.com/neovim/neovim/issues/27424",
    "id": 2128983615,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27424/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5-5bY_",
    "number": 27424,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 2,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27424/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27424/timeline",
    "title": "Volar Quits with Exit Code 1 on Neovim Nightly",
    "updated_at": "2024-02-12T09:31:50Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27424",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/29790821?v=4",
        "events_url": "https://api.github.com/users/lucario387/events{/privacy}",
        "followers_url": "https://api.github.com/users/lucario387/followers",
        "following_url": "https://api.github.com/users/lucario387/following{/other_user}",
        "gists_url": "https://api.github.com/users/lucario387/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lucario387",
        "id": 29790821,
        "login": "lucario387",
        "node_id": "MDQ6VXNlcjI5NzkwODIx",
        "organizations_url": "https://api.github.com/users/lucario387/orgs",
        "received_events_url": "https://api.github.com/users/lucario387/received_events",
        "repos_url": "https://api.github.com/users/lucario387/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lucario387/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lucario387/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lucario387"
    }
}