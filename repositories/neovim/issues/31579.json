{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen using treesitter for javascript and specific queries, neovim crashes when looking at deeply nested JSX. This occurs with the stock nvim-treesitter configuration as of https://github.com/nvim-treesitter/nvim-treesitter/commit/a8c082b4f5b3b70bde2ffb08cc112dfd7e515fb3\n\nThe problem does not require nvim-treesitter to reproduce though. It's simply the queries defined in nvim-treesitter that causes it.\n\nI've noticed it also only crashes on ARM machines (specifically a Macbook Air M2). On x86_64 machines, the highlighting is broken but it does not crash. Though with my full config it also crashes on x86_64 machines too.\n\n### Steps to reproduce\n\nI've made a [repo](https://github.com/thatsmydoing/tree-sitter-crash) with the setup and steps.\n\nHere's the backtrace from a Fedora 41 VM [bt.txt](https://github.com/user-attachments/files/18137183/bt.txt)\n\nIt also crashes on macOS with neovim installed via nix.\n\n### Expected behavior\n\nneovim does not crash\n\n### Nvim version (nvim -v)\n\nv0.10.2\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\nFedora 41\n\n### Terminal name/version\n\nalacritty\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nDNF",
    "closed_at": "2024-12-14T19:18:40Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Please test the provided releases (on macOS at least). Your backtrace indicates you're using a different tree-sitter version than we do. (Also test the latest nightly, please.)\n\n(The crash is in the tree-sitter library, not nvim itself, so this is important.)",
            "created_at": "2024-12-14T18:32:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/31579#issuecomment-2543304300",
            "id": 2543304300,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31579",
            "node_id": "IC_kwDOAPphoM6Xl75s",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543304300/reactions"
            },
            "updated_at": "2024-12-14T18:32:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543304300",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Nightly does not crash on macOS with the official build nor on Fedora from source, but it does show the weird highlight behavior that I saw on x86_64.\n\nI did also test the macOS official 0.10.2 release and Fedora from source on the v0.10.2 tag and they both crash. Here's the backtrace from Fedora [bt.txt](https://github.com/user-attachments/files/18137320/bt.txt)\n\n> (The crash is in the tree-sitter library, not nvim itself, so this is important.)\n\nI think this is it. I updated nixpkgs again just now and it looks like they've updated tree-sitter to 0.24.3 from 0.22.6 and I don't get the crash anymore there either with neovim 0.10.2 from nix on macOS.\n\nThe highlight is still somewhat broken though, only the outermost tags are highlighted while everything inside isn't. Without the offending query, the highlighting works correctly.",
            "created_at": "2024-12-14T19:16:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/31579#issuecomment-2543317068",
            "id": 2543317068,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31579",
            "node_id": "IC_kwDOAPphoM6Xl_BM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543317068/reactions"
            },
            "updated_at": "2024-12-14T19:16:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543317068",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/246230?v=4",
                "events_url": "https://api.github.com/users/thatsmydoing/events{/privacy}",
                "followers_url": "https://api.github.com/users/thatsmydoing/followers",
                "following_url": "https://api.github.com/users/thatsmydoing/following{/other_user}",
                "gists_url": "https://api.github.com/users/thatsmydoing/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/thatsmydoing",
                "id": 246230,
                "login": "thatsmydoing",
                "node_id": "MDQ6VXNlcjI0NjIzMA==",
                "organizations_url": "https://api.github.com/users/thatsmydoing/orgs",
                "received_events_url": "https://api.github.com/users/thatsmydoing/received_events",
                "repos_url": "https://api.github.com/users/thatsmydoing/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/thatsmydoing/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/thatsmydoing/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/thatsmydoing",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Then this is not a Neovim problem. ",
            "created_at": "2024-12-14T19:18:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/31579#issuecomment-2543317530",
            "id": 2543317530,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31579",
            "node_id": "IC_kwDOAPphoM6Xl_Ia",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543317530/reactions"
            },
            "updated_at": "2024-12-14T19:18:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543317530",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Ah, it seems this is the upstream bug https://github.com/tree-sitter/tree-sitter/issues/3725\n\nAnd I believe the lack of highlighting is simply due to hitting the match limit since each separate query contributes to the count.",
            "created_at": "2024-12-14T19:22:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/31579#issuecomment-2543318719",
            "id": 2543318719,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31579",
            "node_id": "IC_kwDOAPphoM6Xl_a_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543318719/reactions"
            },
            "updated_at": "2024-12-15T03:45:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2543318719",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/246230?v=4",
                "events_url": "https://api.github.com/users/thatsmydoing/events{/privacy}",
                "followers_url": "https://api.github.com/users/thatsmydoing/followers",
                "following_url": "https://api.github.com/users/thatsmydoing/following{/other_user}",
                "gists_url": "https://api.github.com/users/thatsmydoing/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/thatsmydoing",
                "id": 246230,
                "login": "thatsmydoing",
                "node_id": "MDQ6VXNlcjI0NjIzMA==",
                "organizations_url": "https://api.github.com/users/thatsmydoing/orgs",
                "received_events_url": "https://api.github.com/users/thatsmydoing/received_events",
                "repos_url": "https://api.github.com/users/thatsmydoing/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/thatsmydoing/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/thatsmydoing/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/thatsmydoing",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31579/comments",
    "created_at": "2024-12-14T18:26:29Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31579/events",
    "html_url": "https://github.com/neovim/neovim/issues/31579",
    "id": 2740080389,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31579/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6jUk8F",
    "number": 31579,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31579/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31579/timeline",
    "title": "Neovim treesitter crash with nested JSX on ARM",
    "updated_at": "2024-12-15T03:45:51Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31579",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/246230?v=4",
        "events_url": "https://api.github.com/users/thatsmydoing/events{/privacy}",
        "followers_url": "https://api.github.com/users/thatsmydoing/followers",
        "following_url": "https://api.github.com/users/thatsmydoing/following{/other_user}",
        "gists_url": "https://api.github.com/users/thatsmydoing/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/thatsmydoing",
        "id": 246230,
        "login": "thatsmydoing",
        "node_id": "MDQ6VXNlcjI0NjIzMA==",
        "organizations_url": "https://api.github.com/users/thatsmydoing/orgs",
        "received_events_url": "https://api.github.com/users/thatsmydoing/received_events",
        "repos_url": "https://api.github.com/users/thatsmydoing/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/thatsmydoing/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/thatsmydoing/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/thatsmydoing",
        "user_view_type": "public"
    }
}