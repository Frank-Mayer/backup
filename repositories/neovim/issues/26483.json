{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nIf a file changes on disk/outside of neovim, it seems like neovim's buffers or \"view\" of the file becomes out of sync with the new content. The LSP client reports inaccurate diagnostics, semantic highlighting, completion, etc.\r\n\r\nFurthermore, reloading the file (e.g. through `:e`) doesn't resolve the problem. It's like the buffer or lsp state becomes \"stuck\" at where it was before the file was changed outside of neovim.\r\n\r\nI haven't found a workaround aside from restarting neovim.\r\n\r\nAlthough I only have encountered this with the `tsserver` LSP, I believe it is a neovim client bug since even restarting the `tsserver` LSP does not fix the inaccurate diagnostics until neovim itself is restarted.\r\n\r\n\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n1. Make sure you have `typescript-language-server` installed globally\r\n2. clone the repro: `git clone git@github.com:jacksonludwig/nvimlsprepro.git`\r\n3. cd `nvimlsprepro`\r\n4. run `npm i` to install typescript locally\r\n5. use the minimal config to open the typescript file: `nvim -u minimal_init.lua index.ts`\r\n6. move to line 8\r\n7. copy/paste the line (e.g. `yyp`)\r\n8. delete one of the quotes in the `console.log('stuff')` so you're left with `console.log(stuff')`. **Notice the errors reported here so far are accurate and expected.**\r\n9. save the file with `:w`\r\n10. open a terminal and stash your changes: `:sp | term`, then `git stash`\r\n11. go back to the buffer with the `index.ts` file\r\n12. run `:e` to re-read from disk and update the buffer contents\r\n13. **Notice that the diagnostics are no longer accurate. Making other changes results in continued inaccurate diagnostics.**\r\n\r\n### Expected behavior\r\n\r\nLSP client should report diagnostics consistent with the current buffer contents.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nstable 0.9.4\r\n\r\n### Language server name/version\r\n\r\ntypscript-language-server 4.1.3\r\n\r\n### Operating system/version\r\n\r\nubuntu 20.04\r\n\r\n### Log file\r\n\r\nhttps://gist.github.com/jacksonludwig/227a4f33cceeb67624e474b837bf98aa",
    "closed_at": "2023-12-09T18:32:30Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "In 0.9 neovim doesn't enable the lsp file watching mechanism by default, so the language server doesn't get notified about changes happening outside of neovim.\r\n\r\nYou can enable the mechanism by setting the following client capabilities:\r\n\r\n```lua\r\nworkspace = {\r\n  didChangeWatchedFiles = {\r\n    dynamicRegistration = true\r\n  }\r\n}\r\n```\r\n\r\nFor 0.10/nightly it's currently enabled by default, but that may still change before the release - depending on https://github.com/neovim/neovim/issues/23291\r\n\r\n\r\n> Furthermore, reloading the file (e.g. through :e) doesn't resolve the problem. It's like the buffer or lsp state becomes \"stuck\" at where it was before the file was changed outside of neovim.\r\n\r\n\r\nThis sounds a bit more like a language server problem, and related to https://github.com/neovim/neovim/issues/26131\r\nMost other servers do re-publish diagnostics on `:e`.\r\n",
            "created_at": "2023-12-09T08:57:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/26483#issuecomment-1848332363",
            "id": 1848332363,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26483",
            "node_id": "IC_kwDOAPphoM5uK1BL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1848332363/reactions"
            },
            "updated_at": "2023-12-09T08:57:58Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1848332363",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks for the info. I see that this is a language server thing. I think I'll close this a duplicate with #26131 then.",
            "created_at": "2023-12-09T18:32:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/26483#issuecomment-1848608533",
            "id": 1848608533,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26483",
            "node_id": "IC_kwDOAPphoM5uL4cV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1848608533/reactions"
            },
            "updated_at": "2023-12-09T18:32:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1848608533",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/42984254?v=4",
                "events_url": "https://api.github.com/users/jacksonludwig/events{/privacy}",
                "followers_url": "https://api.github.com/users/jacksonludwig/followers",
                "following_url": "https://api.github.com/users/jacksonludwig/following{/other_user}",
                "gists_url": "https://api.github.com/users/jacksonludwig/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jacksonludwig",
                "id": 42984254,
                "login": "jacksonludwig",
                "node_id": "MDQ6VXNlcjQyOTg0MjU0",
                "organizations_url": "https://api.github.com/users/jacksonludwig/orgs",
                "received_events_url": "https://api.github.com/users/jacksonludwig/received_events",
                "repos_url": "https://api.github.com/users/jacksonludwig/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jacksonludwig/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jacksonludwig/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jacksonludwig"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26483/comments",
    "created_at": "2023-12-09T04:22:14Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26483/events",
    "html_url": "https://github.com/neovim/neovim/issues/26483",
    "id": 2033602223,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as duplicates of other issues",
            "id": 3221613764,
            "name": "closed:duplicate",
            "node_id": "MDU6TGFiZWwzMjIxNjEzNzY0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26483/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM55Nk6v",
    "number": 26483,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26483/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26483/timeline",
    "title": "Buffer becomes out of sync with language server if file changes outside of neovim",
    "updated_at": "2023-12-09T22:33:54Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26483",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/42984254?v=4",
        "events_url": "https://api.github.com/users/jacksonludwig/events{/privacy}",
        "followers_url": "https://api.github.com/users/jacksonludwig/followers",
        "following_url": "https://api.github.com/users/jacksonludwig/following{/other_user}",
        "gists_url": "https://api.github.com/users/jacksonludwig/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jacksonludwig",
        "id": 42984254,
        "login": "jacksonludwig",
        "node_id": "MDQ6VXNlcjQyOTg0MjU0",
        "organizations_url": "https://api.github.com/users/jacksonludwig/orgs",
        "received_events_url": "https://api.github.com/users/jacksonludwig/received_events",
        "repos_url": "https://api.github.com/users/jacksonludwig/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jacksonludwig/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jacksonludwig/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jacksonludwig"
    }
}