{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\r\n\r\nProviding here the stacktrace while I'm working on minimal repro steps (need to finish day job work first)\r\n```\r\n(gdb) bt\r\n#0  0x00005cd7cf73555d in marktree_itr_next_skip (b=0x5cd7d126ef90, itr=0x7fff5ab4f260, skip=false, preload=false, oldbase=0x0, meta_filter=0x0)\r\n    at /home/stephan/projects/neovim/src/nvim/marktree.c:1529\r\n#1  0x00005cd7cf7396d9 in marktree_itr_next (b=0x5cd7d126ef90, itr=0x7fff5ab4f260) at /home/stephan/projects/neovim/src/nvim/marktree.c:1479\r\n#2  0x00005cd7cf73b779 in marktree_itr_get_ext (b=0x5cd7d126ef90, p=..., itr=0x7fff5ab4f260, last=false, gravity=false, oldbase=0x0, meta_filter=0x5cd7cfab5010 <inline_filter>)\r\n    at /home/stephan/projects/neovim/src/nvim/marktree.c:1422\r\n#3  0x00005cd7cf73bb93 in marktree_itr_get_filter (b=0x5cd7d126ef90, row=95, col=0, stop_row=96, stop_col=0, meta_filter=0x5cd7cfab5010 <inline_filter>, itr=0x7fff5ab4f260)\r\n    at /home/stephan/projects/neovim/src/nvim/marktree.c:1554\r\n#4  0x00005cd7cf7d4e49 in init_charsize_arg (csarg=0x7fff5ab4f238, wp=0x5cd7d0d24c70, lnum=96, line=0x5cd7d128af22 \"    // values from MediaFoundation SDK (mfobjects.h)\")\r\n    at /home/stephan/projects/neovim/src/nvim/plines.c:96\r\n#5  0x00005cd7cf7d68e5 in getvcol (wp=0x5cd7d0d24c70, pos=0x5cd7cfb7a0d8 <var2fpos[pos]>, start=0x7fff5ab4f414, cursor=0x0, end=0x7fff5ab4f410)\r\n    at /home/stephan/projects/neovim/src/nvim/plines.c:482\r\n#6  0x00005cd7cf7d76b0 in getvvcol (wp=0x5cd7d0d24c70, pos=0x5cd7cfb7a0d8 <var2fpos[pos]>, start=0x7fff5ab4f414, cursor=0x0, end=0x7fff5ab4f410)\r\n    at /home/stephan/projects/neovim/src/nvim/plines.c:616\r\n#7  0x00005cd7cf645be9 in f_virtcol (argvars=0x7fff5ab4f780, rettv=0x7fff5ab4f758, fptr=...) at /home/stephan/projects/neovim/src/nvim/eval/funcs.c:9034\r\n#8  0x00005cd7cf63cba2 in call_internal_func (fname=0x5cd7d1294550 \"virtcol\", argcount=1, argvars=0x7fff5ab4f780, rettv=0x7fff5ab4f758)\r\n    at /home/stephan/projects/neovim/src/nvim/eval/funcs.c:290\r\n#9  0x00005cd7cf664120 in call_func (funcname=0x73368f246790 \"virtcol\", len=7, rettv=0x7fff5ab4f758, argcount_in=1, argvars_in=0x7fff5ab4f780, funcexe=0x7fff5ab4f718)\r\n    at /home/stephan/projects/neovim/src/nvim/eval/userfunc.c:1709\r\n#10 0x00005cd7cf70a449 in nlua_call (lstate=0x7336911ef380) at /home/stephan/projects/neovim/src/nvim/lua/executor.c:1202\r\n#11 0x00005cd7cf9c1606 in lj_BC_FUNCC ()\r\n#12 0x00005cd7cf9ab4ea in lua_pcall (L=0x7fff5ab4f260, nargs=<optimized out>, nresults=<optimized out>, errfunc=<optimized out>) at lj_api.c:1150\r\n#13 0x00005cd7cf709482 in nlua_pcall (lstate=0x7336911ef380, nargs=0, nresults=1) at /home/stephan/projects/neovim/src/nvim/lua/executor.c:172\r\n#14 0x00005cd7cf70b597 in nlua_call_ref (ref=971, name=0x0, args=..., retval=true, err=0x7fff5ab50b88) at /home/stephan/projects/neovim/src/nvim/lua/executor.c:1610\r\n#15 0x00005cd7cf5a070c in nvim_win_call (window=1000, fun=971, err=0x7fff5ab50b88) at /home/stephan/projects/neovim/src/nvim/api/window.c:441\r\n#16 0x00005cd7cf54a03d in nlua_api_nvim_win_call (lstate=0x7336911ef380) at /home/stephan/projects/neovim/build/src/nvim/auto/lua_api_c_bindings.generated.c:7428\r\n#17 0x00005cd7cf9c1606 in lj_BC_FUNCC ()\r\n#18 0x00005cd7cf9ab4ea in lua_pcall (L=0x7fff5ab4f260, nargs=<optimized out>, nresults=<optimized out>, errfunc=<optimized out>) at lj_api.c:1150\r\n#19 0x00005cd7cf709482 in nlua_pcall (lstate=0x7336911ef380, nargs=0, nresults=0) at /home/stephan/projects/neovim/src/nvim/lua/executor.c:172\r\n#20 0x00005cd7cf70e7c6 in nlua_schedule_event (argv=0x7fff5ab50c88) at /home/stephan/projects/neovim/src/nvim/lua/executor.c:367\r\n#21 0x00005cd7cf87bed5 in state_handle_k_event () at /home/stephan/projects/neovim/src/nvim/state.c:119\r\n#22 0x00005cd7cf789828 in nv_event (cap=0x7fff5ab50e18) at /home/stephan/projects/neovim/src/nvim/normal.c:6613\r\n#23 0x00005cd7cf782816 in normal_execute (state=0x7fff5ab50da8, key=-26365) at /home/stephan/projects/neovim/src/nvim/normal.c:1227\r\n#24 0x00005cd7cf87be5f in state_enter (s=0x7fff5ab50da8) at /home/stephan/projects/neovim/src/nvim/state.c:101\r\n#25 0x00005cd7cf77e884 in normal_enter (cmdwin=false, noexmode=false) at /home/stephan/projects/neovim/src/nvim/normal.c:516\r\n#26 0x00005cd7cf7195c2 in main (argc=2, argv=0x7fff5ab511d8) at /home/stephan/projects/neovim/src/nvim/main.c:651\r\n(gdb) frame\r\n#0  0x00005cd7cf73555d in marktree_itr_next_skip (b=0x5cd7d126ef90, itr=0x7fff5ab4f260, skip=false, preload=false, oldbase=0x0, meta_filter=0x0)\r\n    at /home/stephan/projects/neovim/src/nvim/marktree.c:1529\r\n1529          assert(itr->x->ptr[itr->i]->parent == itr->x);\r\n```\r\n\r\n### Steps to reproduce\r\n\r\n(this is just a draft while I'm on work. will update to minimal.lua once at home and also bisect Neovim)\r\n- Have tree-sitter highlighting enabled for C files (crash reproduced with bundled parser, no parsers installed apart from bundled ones). Be sure LSP is disabled. (TODO: are nvim-treesitter queries used/needed?)\r\n- Open this file https://github.com/FFmpeg/FFmpeg/blob/master/libavdevice/dshow.c\r\n- Scroll slowly down via `<c-D>`\r\n- when reaching ~line 350, the child process of Neovim terminates. When nvim is built in Debug mode, an assertion is hit\r\n\r\nStacktrace was obtained via\r\n- start `nvim`\r\n- in other terminal `pgrep nvim`\r\n- `sudo gdb -pid <PID>` where `<PID>` highest PID as obtained by pgrep\r\n- `c` in gdb to unfreeze the child process\r\n- in Nvim, repeat repro steps above\r\n\r\n### Expected behavior\r\n\r\nNo crash in release mode, no assertion in Debug mode\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-2165+gd3fa8adea\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno, no tree-sitter in VIm\r\n\r\n### Operating system/version\r\n\r\nUbuntu 24.04 development release\r\n\r\n### Terminal name/version\r\n\r\nkonsole\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nbuild from repo",
    "closed_at": "2024-01-23T11:19:17Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Is this fixed in `NVIM v0.10.0-dev-2167` with https://github.com/neovim/neovim/pull/27147 ?",
            "created_at": "2024-01-23T11:14:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/27151#issuecomment-1905822497",
            "id": 1905822497,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27151",
            "node_id": "IC_kwDOAPphoM5xmIsh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1905822497/reactions"
            },
            "updated_at": "2024-01-23T11:14:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1905822497",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, thank you!",
            "created_at": "2024-01-23T11:19:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/27151#issuecomment-1905830286",
            "id": 1905830286,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27151",
            "node_id": "IC_kwDOAPphoM5xmKmO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1905830286/reactions"
            },
            "updated_at": "2024-01-23T11:19:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1905830286",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7189118?v=4",
                "events_url": "https://api.github.com/users/theHamsta/events{/privacy}",
                "followers_url": "https://api.github.com/users/theHamsta/followers",
                "following_url": "https://api.github.com/users/theHamsta/following{/other_user}",
                "gists_url": "https://api.github.com/users/theHamsta/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/theHamsta",
                "id": 7189118,
                "login": "theHamsta",
                "node_id": "MDQ6VXNlcjcxODkxMTg=",
                "organizations_url": "https://api.github.com/users/theHamsta/orgs",
                "received_events_url": "https://api.github.com/users/theHamsta/received_events",
                "repos_url": "https://api.github.com/users/theHamsta/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/theHamsta/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/theHamsta/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/theHamsta"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27151/comments",
    "created_at": "2024-01-23T11:07:13Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27151/events",
    "html_url": "https://github.com/neovim/neovim/issues/27151",
    "id": 2095827464,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27151/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5868oI",
    "number": 27151,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27151/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27151/timeline",
    "title": "SEGFAULT/assert in `marktree_itr_next_skip` with tree-sitter-c",
    "updated_at": "2024-01-23T11:19:18Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27151",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7189118?v=4",
        "events_url": "https://api.github.com/users/theHamsta/events{/privacy}",
        "followers_url": "https://api.github.com/users/theHamsta/followers",
        "following_url": "https://api.github.com/users/theHamsta/following{/other_user}",
        "gists_url": "https://api.github.com/users/theHamsta/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/theHamsta",
        "id": 7189118,
        "login": "theHamsta",
        "node_id": "MDQ6VXNlcjcxODkxMTg=",
        "organizations_url": "https://api.github.com/users/theHamsta/orgs",
        "received_events_url": "https://api.github.com/users/theHamsta/received_events",
        "repos_url": "https://api.github.com/users/theHamsta/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/theHamsta/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/theHamsta/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/theHamsta"
    }
}