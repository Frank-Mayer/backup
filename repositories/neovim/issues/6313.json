{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "I've stumbled across this interesting PoC that exploits Vim's non-standard implementation of UTF-8. And I'm currently investigating ways to fix this. Here's code in question (from `mbyte.c` plus some widely used code that checks UTF-8 validity. \r\n\r\n```c\r\n#include <stdint.h>\r\n#include <stdio.h>\r\n\r\nstatic uint8_t utf8len_tab_zero[256] =\r\n{\r\n  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\r\n  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\r\n  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\r\n  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\r\n  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n  2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,\r\n  3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,6,6,0,0,\r\n};\r\n\r\n\r\nint utf_ptr2char(const unsigned char *p)\r\n{\r\n  uint8_t len;\r\n\r\n  if (p[0] < 0x80)      /* be quick for ASCII */\r\n    return p[0];\r\n\r\n  len = utf8len_tab_zero[p[0]];\r\n  if (len > 1 && (p[1] & 0xc0) == 0x80) {\r\n    if (len == 2)\r\n      return ((p[0] & 0x1f) << 6) + (p[1] & 0x3f);\r\n    if ((p[2] & 0xc0) == 0x80) {\r\n      if (len == 3)\r\n        return ((p[0] & 0x0f) << 12) + ((p[1] & 0x3f) << 6)\r\n          + (p[2] & 0x3f);\r\n      if ((p[3] & 0xc0) == 0x80) {\r\n        if (len == 4)\r\n          return ((p[0] & 0x07) << 18) + ((p[1] & 0x3f) << 12)\r\n            + ((p[2] & 0x3f) << 6) + (p[3] & 0x3f);\r\n        if ((p[4] & 0xc0) == 0x80) {\r\n          if (len == 5)\r\n            return ((p[0] & 0x03) << 24) + ((p[1] & 0x3f) << 18)\r\n              + ((p[2] & 0x3f) << 12) + ((p[3] & 0x3f) << 6)\r\n              + (p[4] & 0x3f);\r\n          if ((p[5] & 0xc0) == 0x80 && len == 6)\r\n            return ((p[0] & 0x01) << 30) + ((p[1] & 0x3f) << 24)\r\n              + ((p[2] & 0x3f) << 18) + ((p[3] & 0x3f) << 12)\r\n              + ((p[4] & 0x3f) << 6) + (p[5] & 0x3f);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  /* Illegal value, just return the first byte */\r\n  return p[0];\r\n}\r\n\r\nint utf_isvalid(const unsigned char *input) {\r\n  int nb;\r\n  const unsigned char *c = input;\r\n  \r\n  for (c = input;  *c;  c += (nb + 1)) {\r\n    if (!(*c & 0x80)) nb = 0;\r\n    else if ((*c & 0xc0) == 0x80) return 0;\r\n    else if ((*c & 0xe0) == 0xc0) nb = 1;\r\n    else if ((*c & 0xf0) == 0xe0) nb = 2;\r\n    else if ((*c & 0xf8) == 0xf0) nb = 3;\r\n    else if ((*c & 0xfc) == 0xf8) nb = 4;\r\n    else if ((*c & 0xfe) == 0xfc) nb = 5;\r\n    while (nb-- > 0)\r\n      if ((*(c + nb) & 0xc0) != 0x80) return 0;\r\n  } \r\n  \r\n  return 1;\r\n}\r\n\r\nint main()\r\n{\r\n  unsigned char in[] = { 0xC1, 0xA1 };\r\n  printf(\"%c %d %d\\n\", utf_ptr2char(in), utf_ptr2char(in), utf_isvalid(in));\r\n  return 0;\r\n}\r\n```\r\nThis shows how `utf_ptr2char` interprets a non-standard conforming encoding of 'a' and yet returns it as the result. `utf_isvalid` correctly recognizes it as invalid since it is in non-shortest form which is forbidden by the standard.\r\n\r\nAny pointers and ideas on how to tackle this issue, it would be nice to have a standard conforming implementation of UTF-8 in Neovim.",
    "closed_at": "2024-09-04T13:29:13Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason"
    },
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Forgot to paste the [link to the PoC](https://github.com/bspammer/vimcryption). Here is the site from where I took the code for [`utf_isvalid`](http://etutorials.org/Programming/secure+programming/Chapter+3.+Input+Validation/3.12+Detecting+Illegal+UTF-8+Characters/)",
            "created_at": "2017-03-18T22:50:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287580701",
            "id": 287580701,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzU4MDcwMQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287580701/reactions"
            },
            "updated_at": "2017-03-18T22:54:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287580701",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I've stumbled across this interesting PoC that exploits Vim's non-standard implementation of UTF-8. And I'm currently investigating ways to fix this.\r\n\r\nOne could start implementing a newer version of Unicode. UTF-8 is encoded in `1` to `4` bytes. Vim still uses up to `6`. \r\n\r\nTesting `utf_isvalid(input)` with `input={x,0}` and `0x00 < x< 0x80` gives no result.",
            "created_at": "2017-03-18T23:23:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287582341",
            "id": 287582341,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzU4MjM0MQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287582341/reactions"
            },
            "updated_at": "2017-03-18T23:23:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287582341",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2077655?v=4",
                "events_url": "https://api.github.com/users/oni-link/events{/privacy}",
                "followers_url": "https://api.github.com/users/oni-link/followers",
                "following_url": "https://api.github.com/users/oni-link/following{/other_user}",
                "gists_url": "https://api.github.com/users/oni-link/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/oni-link",
                "id": 2077655,
                "login": "oni-link",
                "node_id": "MDQ6VXNlcjIwNzc2NTU=",
                "organizations_url": "https://api.github.com/users/oni-link/orgs",
                "received_events_url": "https://api.github.com/users/oni-link/received_events",
                "repos_url": "https://api.github.com/users/oni-link/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/oni-link/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/oni-link/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/oni-link"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@oni-link I'm not proposing to use that code, it was the first thing I've found and there where a couple of references to it. I wanted some sort of litmus test. (I shudder a bit at the idea that some people might actually have this code running in production…). Anyway, I'd rather not have yet another implementation that will almost certainly be wrong in subtle ways again but something that has been well tested.",
            "created_at": "2017-03-18T23:46:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287583391",
            "id": 287583391,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzU4MzM5MQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287583391/reactions"
            },
            "updated_at": "2017-03-18T23:47:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287583391",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "See https://github.com/neovim/neovim/issues/5149 for some related discussion. tl;dr seems that a PR adding some sort of support for utf8proc (or a similar library) would be welcome. (thanks to jamessan for issue reference).",
            "created_at": "2017-03-19T00:06:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287584303",
            "id": 287584303,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzU4NDMwMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287584303/reactions"
            },
            "updated_at": "2017-03-19T00:06:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287584303",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6589866?v=4",
                "events_url": "https://api.github.com/users/brcolow/events{/privacy}",
                "followers_url": "https://api.github.com/users/brcolow/followers",
                "following_url": "https://api.github.com/users/brcolow/following{/other_user}",
                "gists_url": "https://api.github.com/users/brcolow/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/brcolow",
                "id": 6589866,
                "login": "brcolow",
                "node_id": "MDQ6VXNlcjY1ODk4NjY=",
                "organizations_url": "https://api.github.com/users/brcolow/orgs",
                "received_events_url": "https://api.github.com/users/brcolow/received_events",
                "repos_url": "https://api.github.com/users/brcolow/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/brcolow/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/brcolow/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/brcolow"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@brcolow I was looking at utf8proc last night as well. I will play around with this a little. The idea of making this replace the ad-hoc UTF-8 implementation from Vim is quite appealing :)",
            "created_at": "2017-03-19T08:36:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287602327",
            "id": 287602327,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYwMjMyNw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287602327/reactions"
            },
            "updated_at": "2017-03-19T08:36:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287602327",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The behavior of overlong control chars are also interesting, they are printed as their (invalidly) decoded value, so an overlong NUL is displayed as `<00>`. This is confusing as this notation is also used for invalid utf-8 bytes (well, that is correctly identified as invalid), such as `<ff>` for the raw byte `\\xff`. I suppose the correct display would be to show all bytes in an overlong sequence individually as `<xx>`",
            "created_at": "2017-03-19T08:45:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287602697",
            "id": 287602697,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYwMjY5Nw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287602697/reactions"
            },
            "updated_at": "2017-03-19T08:49:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287602697",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Some vim-dev discussion here: \r\nhttps://groups.google.com/d/msg/vim_dev/ZcY7VODyloU/VD0xRwPsHgAJ\r\n",
            "created_at": "2017-03-19T09:31:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287604540",
            "id": 287604540,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYwNDU0MA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287604540/reactions"
            },
            "updated_at": "2017-03-19T09:31:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287604540",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@bfredl Thanks for digging that up. 👍",
            "created_at": "2017-03-19T09:45:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287605179",
            "id": 287605179,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYwNTE3OQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287605179/reactions"
            },
            "updated_at": "2017-03-19T09:45:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287605179",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Forbidding overlong ASCII shouldn't be that complicated:\r\n```diff\r\ndiff --git a/src/nvim/globals.h b/src/nvim/globals.h\r\nindex f8c7c9d33..ca5fa489a 100644\r\n--- a/src/nvim/globals.h\r\n+++ b/src/nvim/globals.h\r\n@@ -794,7 +794,7 @@ EXTERN char utf8len_tab[256] INIT(= {\r\n   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\r\n   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\r\n   1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\r\n-  2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,\r\n+  1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,\r\n   2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,\r\n   3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,\r\n   4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 6, 6, 1, 1,\r\ndiff --git a/src/nvim/mbyte.c b/src/nvim/mbyte.c\r\nindex 6a87a63b8..4fe051913 100644\r\n--- a/src/nvim/mbyte.c\r\n+++ b/src/nvim/mbyte.c\r\n@@ -79,7 +79,7 @@ static uint8_t utf8len_tab_zero[256] =\r\n   1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,\r\n   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,\r\n-  2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,\r\n+  0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,\r\n   3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,6,6,0,0,\r\n };\r\n```\r\n(though probably there could be some edge case bugs...) Disabling overlong _unicode_ requires a bit more work, e.g. `mb_ptr2len` would need to check if start byte is E0 or F0 and then see if the decoded value is in range.",
            "created_at": "2017-03-19T10:30:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287607242",
            "id": 287607242,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYwNzI0Mg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287607242/reactions"
            },
            "updated_at": "2017-03-19T10:30:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287607242",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I'll be playing around with utf8proc in Neovim here: https://github.com/raichoo/neovim/tree/utf8",
            "created_at": "2017-03-19T13:18:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287616121",
            "id": 287616121,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYxNjEyMQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287616121/reactions"
            },
            "updated_at": "2017-03-19T13:18:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287616121",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "After some initial hacking this seems to work rather nicely. Anyone up to take a look at some of the stuff I'm doing? This is really just a hack by now but having a couple more eyeballs and braincells on the issue might help :)",
            "created_at": "2017-03-19T14:19:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287619750",
            "id": 287619750,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYxOTc1MA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287619750/reactions"
            },
            "updated_at": "2017-03-19T14:19:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287619750",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "cc @joshuarubin ",
            "created_at": "2017-03-19T14:48:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287621580",
            "id": 287621580,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYyMTU4MA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287621580/reactions"
            },
            "updated_at": "2017-03-19T14:48:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287621580",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Work is being done here: https://github.com/neovim/neovim/pull/6317",
            "created_at": "2017-03-19T18:02:02Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-287634753",
            "id": 287634753,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzYzNDc1Mw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287634753/reactions"
            },
            "updated_at": "2017-03-19T18:02:02Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/287634753",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
                "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
                "followers_url": "https://api.github.com/users/raichoo/followers",
                "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
                "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/raichoo",
                "id": 151506,
                "login": "raichoo",
                "node_id": "MDQ6VXNlcjE1MTUwNg==",
                "organizations_url": "https://api.github.com/users/raichoo/orgs",
                "received_events_url": "https://api.github.com/users/raichoo/received_events",
                "repos_url": "https://api.github.com/users/raichoo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/raichoo"
            }
        },
        {
            "author_association": "NONE",
            "body": "Just a side question.\r\n\r\nWhile tampering with displaying characters, do you think it would be possible to centralize all the needed code which just transforms unprintable characters to the `<00>` form into a separate header file as a standalone header-only library?\r\n\r\nI've already come across few use cases in some projects, when it was desirable to show them. And because Vim/Neovim already implements it quite well and users are used to it, it would make sense to reuse the code.",
            "created_at": "2017-04-08T16:04:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-292727303",
            "id": 292727303,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "MDEyOklzc3VlQ29tbWVudDI5MjcyNzMwMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/292727303/reactions"
            },
            "updated_at": "2017-04-08T16:04:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/292727303",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2451044?v=4",
                "events_url": "https://api.github.com/users/dumblob/events{/privacy}",
                "followers_url": "https://api.github.com/users/dumblob/followers",
                "following_url": "https://api.github.com/users/dumblob/following{/other_user}",
                "gists_url": "https://api.github.com/users/dumblob/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dumblob",
                "id": 2451044,
                "login": "dumblob",
                "node_id": "MDQ6VXNlcjI0NTEwNDQ=",
                "organizations_url": "https://api.github.com/users/dumblob/orgs",
                "received_events_url": "https://api.github.com/users/dumblob/received_events",
                "repos_url": "https://api.github.com/users/dumblob/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dumblob/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dumblob/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dumblob"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, nothing has changed regarding this.",
            "created_at": "2024-09-04T13:28:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-2329056424",
            "id": 2329056424,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "IC_kwDOAPphoM6K0pSo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2329056424/reactions"
            },
            "updated_at": "2024-09-04T13:28:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2329056424",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": ">  it would be nice to have a standard conforming implementation of UTF-8 in Neovim.\r\n\r\nAnd indeed we have now bundled utf8proc and will be -- incrementally -- leveraging it for standard-compliant Unicode handling. Work is on-going and need not be tracked here.",
            "created_at": "2024-09-04T13:29:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/6313#issuecomment-2329057492",
            "id": 2329057492,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/6313",
            "node_id": "IC_kwDOAPphoM6K0pjU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2329057492/reactions"
            },
            "updated_at": "2024-09-04T13:29:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2329057492",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        }
    ],
    "comments": 16,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/6313/comments",
    "created_at": "2017-03-18T22:43:29Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/6313/events",
    "html_url": "https://github.com/neovim/neovim/issues/6313",
    "id": 215227019,
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "changes that are not features or bugfixes",
            "id": 106949155,
            "name": "refactor",
            "node_id": "MDU6TGFiZWwxMDY5NDkxNTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/refactor"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 158930125,
            "name": "encoding",
            "node_id": "MDU6TGFiZWwxNTg5MzAxMjU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/encoding"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "(multibyte) unicode characters",
            "id": 2882115256,
            "name": "unicode  💩",
            "node_id": "MDU6TGFiZWwyODgyMTE1MjU2",
            "url": "https://api.github.com/repos/neovim/neovim/labels/unicode%20%20%F0%9F%92%A9"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/6313/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 50,
        "created_at": "2023-12-07T23:09:35Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "",
        "due_on": "2024-10-31T07:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/41",
        "id": 10283236,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/41/labels",
        "node_id": "MI_kwDOAPphoM4AnOjk",
        "number": 41,
        "open_issues": 58,
        "state": "open",
        "title": "0.11",
        "updated_at": "2024-09-09T15:40:25Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/41"
    },
    "node_id": "MDU6SXNzdWUyMTUyMjcwMTk=",
    "number": 6313,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 2,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/6313/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/6313/timeline",
    "title": "Fix broken UTF-8 implementation",
    "updated_at": "2024-09-04T13:34:04Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/6313",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/151506?v=4",
        "events_url": "https://api.github.com/users/raichoo/events{/privacy}",
        "followers_url": "https://api.github.com/users/raichoo/followers",
        "following_url": "https://api.github.com/users/raichoo/following{/other_user}",
        "gists_url": "https://api.github.com/users/raichoo/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/raichoo",
        "id": 151506,
        "login": "raichoo",
        "node_id": "MDQ6VXNlcjE1MTUwNg==",
        "organizations_url": "https://api.github.com/users/raichoo/orgs",
        "received_events_url": "https://api.github.com/users/raichoo/received_events",
        "repos_url": "https://api.github.com/users/raichoo/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/raichoo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/raichoo/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/raichoo"
    }
}