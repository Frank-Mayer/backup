{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nOpenBSD pkg maintainer here. A user emailed me a potential bug.\n\nSummary: If you open a Lua file when there is no config file in place, you get a crash.\n\n```\n$ mv ~/.config/nvim ~/.config/nvim.orig\n$ echo \"print('hi')\" > a.lua\n$ nvim a.lua\n```\n\n```\nError detected while processing BufReadPost Autocommands for \"*\":\nError executing lua callback: /usr/local/share/nvim/runtime/filetype.lua:35: Error executing lua: /usr/local/share/nvim/runtime/filetype.lua:36: BufReadPost Autocommands for \"*\"..Fil\neType Autocommands for \"*\"..function <SNR>1_LoadFTPlugin[20]..script /usr/local/share/nvim/runtime/ftplugin/lua.lua: Vim(runtime):E5113: Error while calling lua chunk: ...local/share\n/nvim/runtime/lua/vim/treesitter/language.lua:107: no parser for 'lua' language, see :help treesitter-parsers\nstack traceback:\n        [C]: in function 'error'\n        ...local/share/nvim/runtime/lua/vim/treesitter/language.lua:107: in function 'add'\n        ...l/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:111: in function 'new'\n        /usr/local/share/nvim/runtime/lua/vim/treesitter.lua:41: in function '_create_parser'\n        /usr/local/share/nvim/runtime/lua/vim/treesitter.lua:108: in function 'get_parser'\n        /usr/local/share/nvim/runtime/lua/vim/treesitter.lua:416: in function 'start'\n        /usr/local/share/nvim/runtime/ftplugin/lua.lua:2: in main chunk\n        [C]: in function 'nvim_cmd'\n        /usr/local/share/nvim/runtime/filetype.lua:36: in function </usr/local/share/nvim/runtime/filetype.lua:35>\n        [C]: in function 'nvim_buf_call'\n        /usr/local/share/nvim/runtime/filetype.lua:35: in function </usr/local/share/nvim/runtime/filetype.lua:10>\nstack traceback:\n        [C]: in function 'nvim_cmd'\n        /usr/local/share/nvim/runtime/filetype.lua:36: in function </usr/local/share/nvim/runtime/filetype.lua:35>\n        [C]: in function 'nvim_buf_call'\n        /usr/local/share/nvim/runtime/filetype.lua:35: in function </usr/local/share/nvim/runtime/filetype.lua:10>\nstack traceback:\n        [C]: in function 'nvim_buf_call'\n        /usr/local/share/nvim/runtime/filetype.lua:35: in function </usr/local/share/nvim/runtime/filetype.lua:10>\n```\n\nI don't know if this is expected or not.\n\nI can reproduce this on neovim-0.10.2 on OpenBSD-current, but the user says it also happens on neovim-0.10.1 that we shipped with OpenBSD-7.6. They claim it *didn't* happen with neovim-0.9.5 that we shipped with OpenBSD-7.5.\n\nIt does not happen if you open the file with `nvim -u NONE a.lua`.\n\nIs it a bug?\n\n### Steps to reproduce\n\n```\n$ mv ~/.config/nvim ~/.config/nvim.orig\n$ echo \"print('hi')\" > a.lua\n$ nvim a.lua\n```\n\n### Expected behavior\n\nNo crash(?) Not sure.\n\n### Nvim version (nvim -v)\n\n0.10.2, 0.10.1\n\n### Vim (not Nvim) behaves the same?\n\nno, vim-9.1.707\n\n### Operating system/version\n\nOpenBSD\n\n### Terminal name/version\n\n-\n\n### $TERM environment variable\n\n-\n\n### Installation\n\nOpenBSD package",
    "closed_at": "2024-10-11T11:48:13Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Is that actually a crash or just a (noisy) error? Does the bsd package include the treesitter parsers? Nvim 0.10 expects the lua treesitter `.so` file to be available on 'runtimepath'. \n\nUser should also try `:checkhealth`, which has info about this.",
            "created_at": "2024-10-11T10:59:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407164773",
            "id": 2407164773,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6Pemtl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407164773/reactions"
            },
            "updated_at": "2024-10-11T10:59:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407164773",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This means that you didn't package the tree-sitter-lua parser, which is a required(!) part of the runtime files since 0.10.0. This is not a (Neovim) bug.",
            "created_at": "2024-10-11T11:47:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407244445",
            "id": 2407244445,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6Pe6Kd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407244445/reactions"
            },
            "updated_at": "2024-10-11T11:48:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407244445",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thanks for your responses.\n\n> Is that actually a crash or just a (noisy) error?\n\nIt's just a noisy error. Neovim continues to run after you hit enter.\n\n> Does the bsd package include the treesitter parsers?\n\nI've been using them with my config for ages, so I believe(d) so, but now I'm not so sure!\n\n[Here's the packing list for our package](https://cvsweb.openbsd.org/cgi-bin/cvsweb/ports/editors/neovim/pkg/PLIST?rev=1.23&content-type=text/x-cvsweb-markup)\n\n\nThe only files I see related to treesitter are:\n```\nshare/nvim/runtime/lua/vim/treesitter/\nshare/nvim/runtime/lua/vim/treesitter.lua\nshare/nvim/runtime/lua/vim/treesitter/_fold.lua\nshare/nvim/runtime/lua/vim/treesitter/_meta.lua\nshare/nvim/runtime/lua/vim/treesitter/_query_linter.lua\nshare/nvim/runtime/lua/vim/treesitter/_range.lua\nshare/nvim/runtime/lua/vim/treesitter/dev.lua\nshare/nvim/runtime/lua/vim/treesitter/health.lua\nshare/nvim/runtime/lua/vim/treesitter/highlighter.lua\nshare/nvim/runtime/lua/vim/treesitter/language.lua\nshare/nvim/runtime/lua/vim/treesitter/languagetree.lua\nshare/nvim/runtime/lua/vim/treesitter/query.lua\n```\n\nShould we expect some other TS files?\n\n>  Nvim 0.10 expects the lua treesitter .so file to be available on 'runtimepath'.\n\nOur neovim port depends on our existing tree-sitter package, rather than statically including it.\n\nWe use `-DUSE_BUNDLED=OFF` to achieve that (but note that we do statically embed some stuff with strict version requirements, like luajit and some related lua libs)\n\nOur tree-sitter package is v0.22.6. Should that be OK?\n\nMy guess, based on all of this, is that bundling turns off installing the parsers and it's been working for me because I use the `nvim-treesitter/nvim-treesitter` package which is auto-fetching the parsers.\n\nDoes that sound feasible?\n\nMaybe I need to do something similar to what FreeBSD does [here](https://cgit.freebsd.org/ports/tree/editors/neovim/Makefile#n55).\n\nWould it be better for neovim package to bundle the parsers, or for the treesitter package to bundle them (if that's even possible)?\n\nThanks",
            "created_at": "2024-10-11T12:30:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407314840",
            "id": 2407314840,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6PfLWY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407314840/reactions"
            },
            "updated_at": "2024-10-11T12:30:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407314840",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604955?v=4",
                "events_url": "https://api.github.com/users/vext01/events{/privacy}",
                "followers_url": "https://api.github.com/users/vext01/followers",
                "following_url": "https://api.github.com/users/vext01/following{/other_user}",
                "gists_url": "https://api.github.com/users/vext01/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vext01",
                "id": 604955,
                "login": "vext01",
                "node_id": "MDQ6VXNlcjYwNDk1NQ==",
                "organizations_url": "https://api.github.com/users/vext01/orgs",
                "received_events_url": "https://api.github.com/users/vext01/received_events",
                "repos_url": "https://api.github.com/users/vext01/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vext01/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vext01/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vext01"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Should we expect some other TS files?\n\nYes, `lib/nvim/parser/lua.so` (among others).\n\n> Our neovim port depends on our existing tree-sitter package, rather than statically including it.\n\nNot relevant; we're talking about the _parsers_, not the lib.\n\n> We use -DUSE_BUNDLED=OFF to achieve that (but note that we do statically embed some stuff with strict version requirements, like luajit and some related lua libs)\n\nThen you need to add (all!) the tree-sitter parsers to that list.\n\n> My guess, based on all of this, is that bundling turns off installing the parsers and it's been working for me because I use the nvim-treesitter/nvim-treesitter package which is auto-fetching the parsers.\n\nYes.\n\n> Maybe I need to do something similar to what FreeBSD does [here](https://cgit.freebsd.org/ports/tree/editors/neovim/Makefile#n55).\n\nYes.\n\n> Would it be better for neovim package to bundle the parsers\n\nYes, since queries are only guaranteed to be compatible with a specific parser version, and you can't expect two editors to agree on which.\n\n",
            "created_at": "2024-10-11T12:32:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407319464",
            "id": 2407319464,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6PfMeo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407319464/reactions"
            },
            "updated_at": "2024-10-11T12:34:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407319464",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thank you! Much appreciated.",
            "created_at": "2024-10-11T12:36:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407325232",
            "id": 2407325232,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6PfN4w",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407325232/reactions"
            },
            "updated_at": "2024-10-11T12:36:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407325232",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/604955?v=4",
                "events_url": "https://api.github.com/users/vext01/events{/privacy}",
                "followers_url": "https://api.github.com/users/vext01/followers",
                "following_url": "https://api.github.com/users/vext01/following{/other_user}",
                "gists_url": "https://api.github.com/users/vext01/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vext01",
                "id": 604955,
                "login": "vext01",
                "node_id": "MDQ6VXNlcjYwNDk1NQ==",
                "organizations_url": "https://api.github.com/users/vext01/orgs",
                "received_events_url": "https://api.github.com/users/vext01/received_events",
                "repos_url": "https://api.github.com/users/vext01/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vext01/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vext01/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vext01"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`USE_BUNDLED_TS_PARSERS` can be set separately",
            "created_at": "2024-10-11T12:40:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/30761#issuecomment-2407332762",
            "id": 2407332762,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30761",
            "node_id": "IC_kwDOAPphoM6PfPua",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407332762/reactions"
            },
            "updated_at": "2024-10-11T12:40:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2407332762",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30761/comments",
    "created_at": "2024-10-11T10:54:56Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30761/events",
    "html_url": "https://github.com/neovim/neovim/issues/30761",
    "id": 2581077026,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "packaging and distributing Nvim to users",
            "id": 124686703,
            "name": "distribution",
            "node_id": "MDU6TGFiZWwxMjQ2ODY3MDM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/distribution"
        },
        {
            "color": "d4c5f9",
            "default": false,
            "description": "issues specific to BSD descendants (please specify which in the issue)",
            "id": 201019594,
            "name": "platform:bsd",
            "node_id": "MDU6TGFiZWwyMDEwMTk1OTQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:bsd"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30761/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6Z2Bwi",
    "number": 30761,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30761/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30761/timeline",
    "title": "no parser for 'lua' language when config not present.",
    "updated_at": "2024-10-11T12:42:13Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30761",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/604955?v=4",
        "events_url": "https://api.github.com/users/vext01/events{/privacy}",
        "followers_url": "https://api.github.com/users/vext01/followers",
        "following_url": "https://api.github.com/users/vext01/following{/other_user}",
        "gists_url": "https://api.github.com/users/vext01/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vext01",
        "id": 604955,
        "login": "vext01",
        "node_id": "MDQ6VXNlcjYwNDk1NQ==",
        "organizations_url": "https://api.github.com/users/vext01/orgs",
        "received_events_url": "https://api.github.com/users/vext01/received_events",
        "repos_url": "https://api.github.com/users/vext01/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vext01/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vext01/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vext01"
    }
}