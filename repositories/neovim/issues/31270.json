{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nFor `vim.uri_encode()`, there is the following definition:\n```lua\nlocal PATTERNS = {\n  ...\n  -- RFC 2732\n  -- https://tools.ietf.org/html/rfc2732\n  rfc2732 = \"^A-Za-z0-9%-_.!~*'()[]\",\n  ...\n}\n```\nSome of the characters here have special meaning within Lua patterns and should be escaped.\n\nEspecially, `uri_encode()` is defined as follows:\n```lua\nfunction M.uri_encode(str, rfc)\n  local pattern = PATTERNS[rfc] or PATTERNS.rfc3986\n  return (str:gsub('([' .. pattern .. '])', percent_encode_char)) -- clamped to 1 retval with ()\nend\n```\n\nFor RFC2732, this gives the following pattern:\n```lua\nreturn (str:gsub('([^A-Za-z0-9%-_.!~*'()[]])', percent_encode_char))\n```\n\nThis makes a bit clearer that the pattern now has two unescaped closing brackets. The matcher interprets this as a character group followed by a literal closing bracket.\n\nThe solution would be to escape all magic characters in `PATTERNS` with percents.\n\n### Steps to reproduce\n\nThe following command:\n```\n:=vim.uri_encode('[:]', 'rfc2732')\n```\nproduces the output:\n```\n[%3a\n```\n\n### Expected behavior\n\nIt should produce the output:\n```\n[%3a]\n```\n(Mind the closing bracket.)\n\n### Nvim version (nvim -v)\n\n0.10.2\n\n### Vim (not Nvim) behaves the same?\n\nNo, this is a Lua-exclusive bug\n\n### Operating system/version\n\nFedora Silverblue 41\n\n### Terminal name/version\n\nkitty 0.36.4\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nAppImage",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31270/comments",
    "created_at": "2024-11-19T13:02:23Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31270/events",
    "html_url": "https://github.com/neovim/neovim/issues/31270",
    "id": 2672092015,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31270/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6fRONv",
    "number": 31270,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31270/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31270/timeline",
    "title": "Pattern of vim.uri_encode() for RFC2732 has unescaped magic characters",
    "updated_at": "2024-11-19T13:51:39Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31270",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5731814?v=4",
        "events_url": "https://api.github.com/users/troiganto/events{/privacy}",
        "followers_url": "https://api.github.com/users/troiganto/followers",
        "following_url": "https://api.github.com/users/troiganto/following{/other_user}",
        "gists_url": "https://api.github.com/users/troiganto/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/troiganto",
        "id": 5731814,
        "login": "troiganto",
        "node_id": "MDQ6VXNlcjU3MzE4MTQ=",
        "organizations_url": "https://api.github.com/users/troiganto/orgs",
        "received_events_url": "https://api.github.com/users/troiganto/received_events",
        "repos_url": "https://api.github.com/users/troiganto/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/troiganto/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/troiganto/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/troiganto",
        "user_view_type": "public"
    }
}