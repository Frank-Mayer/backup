{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nCompletion for `:lua vim.fn.*` does not work correctly, there are items missing.\n\n### Steps to reproduce\n\n- `nvim --clean`\r\n- enter `:lua vim.fn.`\r\n- press tab\r\n\r\nResult: It completes to `:lua vim.fn.executable`. No other choices are shown, like when tryingn to complete `:lua vim.`.\n\n### Expected behavior\n\nCompletion should show all possible options.\r\n\r\nOn my normal setup (personal config + some plugins, including nvim-cmp, but not cmp-cmdline), completing `:lua vim.fn.` shows some more options, but still not a complete list:\r\n\r\n![screen_2024-05-22_074913](https://github.com/neovim/neovim/assets/6276613/fe85148f-baa5-4701-bef0-498d5005207b)\r\n\r\n[This comment](https://github.com/neovim/neovim/issues/19623#issuecomment-1727751856) says that lua cmdline completion is implemented \"a bit hacky\". Maybe this is a symptom of this.\n\n### Neovim version (nvim -v)\n\nv0.10.0\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\nArchlinux\n\n### Terminal name/version\n\nfoot version: 1.17.2\n\n### $TERM environment variable\n\nfoot-extra\n\n### Installation\n\nofficial repos",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "`:lua= vim._expand_pat('vim.fn.')` indeed returns `{ \"exectuable\" }` only in a fresh nvim 0.10, apparently the vimscript function `executable()` is used somewhere in the default startup script. On nvim 0.9.4, it will simply return `{}` (no completion).\r\n\r\nThis behavior is due to the specific implementation details of (hacky) Lua tab completion and `vim.fn`. In short, Lua completions for `vim.fn` will show **only the vimscript functions that have been invoked at least once via `vim.fn`**. This is because: (i) `vim.fn` works like a cache-like table that store all the function keys, and (ii) `vim._expand_pat` will suggest all the existing keys for a table instance (`vim.fn`).\r\n\r\nTo avoid the confusion, we can consider changing the implementation of meta-accessor `vim.fn` in a way that it does not cache the Lua bridge function to `vim.call` *if* it would not hurt the performance. However, a better solution will be to \"implement\" tab completion *specifically* for `vim.fn` so that it can fully suggest the completion like `getcompletion(<query>, 'function')` would do. I've written a similar tab completion for other Lua meta accessors before (PR coming soon), so this won't be difficult to fix as well.",
            "created_at": "2024-05-22T06:31:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/28910#issuecomment-2123974788",
            "id": 2123974788,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28910",
            "node_id": "IC_kwDOAPphoM5-mUiE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2123974788/reactions"
            },
            "updated_at": "2024-05-22T06:50:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2123974788",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28910/comments",
    "created_at": "2024-05-22T05:55:49Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/28910/events",
    "html_url": "https://github.com/neovim/neovim/issues/28910",
    "id": 2309633539,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "Nvim built-in (omni)completion",
            "id": 3214348835,
            "name": "completion",
            "node_id": "MDU6TGFiZWwzMjE0MzQ4ODM1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/completion"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/28910/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 621,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 544,
        "state": "open",
        "title": "backlog",
        "updated_at": "2024-05-27T15:06:05Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM6JqjYD",
    "number": 28910,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/28910/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/28910/timeline",
    "title": "cmdline lua completion for `vim.fn.*` has missing items",
    "updated_at": "2024-05-23T13:28:07Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/28910",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6276613?v=4",
        "events_url": "https://api.github.com/users/camoz/events{/privacy}",
        "followers_url": "https://api.github.com/users/camoz/followers",
        "following_url": "https://api.github.com/users/camoz/following{/other_user}",
        "gists_url": "https://api.github.com/users/camoz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/camoz",
        "id": 6276613,
        "login": "camoz",
        "node_id": "MDQ6VXNlcjYyNzY2MTM=",
        "organizations_url": "https://api.github.com/users/camoz/orgs",
        "received_events_url": "https://api.github.com/users/camoz/received_events",
        "repos_url": "https://api.github.com/users/camoz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/camoz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/camoz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/camoz"
    }
}