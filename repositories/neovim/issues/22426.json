{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "### Problem\r\n\r\nOur treesitter implementation could be more efficient to overcome many known issues with performance. Specifically around large files.\r\n\r\n---\r\n\r\n- [x] **Injection languages are not incremental**\r\n   See: #18107\r\n   Resolved with: #22309 \r\n\r\n- [ ] **Rendering long lines is inefficient**\r\n   See: #14756\r\n   Resolved with: #15405\r\n\r\n- [ ] **Parsing blocks user input**\r\n   This is especially bad for the initial parse since this takes the longest.\r\n\r\n   Either:\r\n   (a): We run parsing on a separate thread (difficult).\r\n   (b): Use treesitters parsing timeout feature to segment the parse over several event-loop iterations (less-difficult).\r\n    \r\n   See: #20765\r\n   Resolved with: (b) #22420 \r\n\r\n- [ ] **Injection queries are run too often**\r\n   Currently we run the **full** injection query on every edit to a buffer.\r\n   - [ ] *Incrementally* run the query on tree changes (#23070).\r\n     - [ ] ... on tree changes that intersect the injection regions.\r\n   - [ ] *Partially* run the query for rendered lines.\r\n\r\n- [x] **Injections are not highlighted incrementally**\r\n   Currently every injection is parsed, even if it never gets displayed.\r\n  Resolved with: #24647 \r\n\r\n---\r\n\r\n### Other\r\n\r\n- [ ] Add better benchmarking to the testsuite (#23070)\r\n\r\n### Files for benchmarking:\r\n- https://raw.githubusercontent.com/torvalds/linux/master/drivers/gpu/drm/amd/include/asic_reg/bif/bif_5_1_sh_mask.h\r\n- https://raw.githubusercontent.com/torvalds/linux/master/drivers/gpu/drm/amd/include/asic_reg/dcn/dcn_3_2_0_sh_mask.h",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Another issue is incremental querying, which may help with expensive injection predicates as in https://github.com/nvim-treesitter/nvim-treesitter/issues/2996?",
            "created_at": "2023-02-27T10:35:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1446085597",
            "id": 1446085597,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5WMYPd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1446085597/reactions"
            },
            "updated_at": "2023-02-27T10:35:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1446085597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This will be partially resolved by just running the queries less in #22394.",
            "created_at": "2023-02-27T10:46:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1446099386",
            "id": 1446099386,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5WMbm6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1446099386/reactions"
            },
            "updated_at": "2023-02-27T10:48:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1446099386",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "\"Bad\" files for performance testing: https://raw.githubusercontent.com/torvalds/linux/master/drivers/gpu/drm/amd/include/asic_reg/bif/bif_5_1_sh_mask.h\r\nhttps://raw.githubusercontent.com/torvalds/linux/master/drivers/gpu/drm/amd/include/asic_reg/dcn/dcn_3_2_0_sh_mask.h\r\n\r\n(cpp header files consisting of, respectively, 33k and 220k injections of cpp into preprocessor macros)",
            "created_at": "2023-03-08T14:29:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1460242707",
            "id": 1460242707,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5XCYkT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460242707/reactions"
            },
            "updated_at": "2023-03-08T15:31:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460242707",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Idea from chat: Highlighter should not parse off-screen injections (should help with those files).",
            "created_at": "2023-03-08T14:53:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1460282070",
            "id": 1460282070,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5XCiLW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 11,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 11,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460282070/reactions"
            },
            "updated_at": "2023-09-16T16:21:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460282070",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Idea from chat: Highlighter should not parse off-screen injections (should help with those files).\r\n\r\n#24647 is now merged which should improve the performance of large files with lots of injections.",
            "created_at": "2023-08-12T15:24:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1675962587",
            "id": 1675962587,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5j5Sjb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 11,
                "total_count": 11,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1675962587/reactions"
            },
            "updated_at": "2023-08-12T15:24:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1675962587",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
                "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
                "followers_url": "https://api.github.com/users/lewis6991/followers",
                "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
                "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/lewis6991",
                "id": 7904185,
                "login": "lewis6991",
                "node_id": "MDQ6VXNlcjc5MDQxODU=",
                "organizations_url": "https://api.github.com/users/lewis6991/orgs",
                "received_events_url": "https://api.github.com/users/lewis6991/received_events",
                "repos_url": "https://api.github.com/users/lewis6991/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/lewis6991"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hey gusy! I'm really appreciate with this plugin and your efforts on improving it!\r\n\r\nI'd like to ask, in this issue, if you are dealing with the problem of treesitter starting to perform dramatically poorly for large file, especially when turning-on highlight and indent .\r\n\r\nThank you very much!",
            "created_at": "2023-09-16T16:19:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/22426#issuecomment-1722263217",
            "id": 1722263217,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22426",
            "node_id": "IC_kwDOAPphoM5mp6ax",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1722263217/reactions"
            },
            "updated_at": "2023-09-16T16:20:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1722263217",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/57752203?v=4",
                "events_url": "https://api.github.com/users/MKrbm/events{/privacy}",
                "followers_url": "https://api.github.com/users/MKrbm/followers",
                "following_url": "https://api.github.com/users/MKrbm/following{/other_user}",
                "gists_url": "https://api.github.com/users/MKrbm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MKrbm",
                "id": 57752203,
                "login": "MKrbm",
                "node_id": "MDQ6VXNlcjU3NzUyMjAz",
                "organizations_url": "https://api.github.com/users/MKrbm/orgs",
                "received_events_url": "https://api.github.com/users/MKrbm/received_events",
                "repos_url": "https://api.github.com/users/MKrbm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MKrbm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MKrbm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MKrbm"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22426/comments",
    "created_at": "2023-02-27T09:54:16Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22426/events",
    "html_url": "https://github.com/neovim/neovim/issues/22426",
    "id": 1600843843,
    "labels": [
        {
            "color": "FEF2C0",
            "default": false,
            "description": "issues reporting performance problems",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22426/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5favBD",
    "number": 22426,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 27,
        "-1": 0,
        "confused": 0,
        "eyes": 6,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 12,
        "total_count": 45,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22426/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22426/timeline",
    "title": "Treesitter performance (tracking issue)",
    "updated_at": "2023-09-16T16:21:59Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22426",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991"
    }
}