{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\n**TL;DR:** It would be nice to patch tables in `src/unicode/` to mark codepoints used by Nerd Fonts doublewidth icons as doublewidth. Proof of concept (very likely implemented in wrong way/place but working): https://github.com/powerman/wcwidth-icons/blob/master/patches/neovim/wcwidth-icons.patch\r\n\r\nNerd Fonts today release fonts in few flavors (mentioned in font name's suffixes): default, \"Propo\" and \"Mono\":\r\n```\r\nNotoMonoNerdFont-Regular.ttf: NotoMono Nerd Font,NotoMono NF:style=Regular\r\nNotoMonoNerdFontPropo-Regular.ttf: NotoMono Nerd Font Propo,NotoMono NFP:style=Regular\r\nNotoMonoNerdFontMono-Regular.ttf: NotoMono Nerd Font Mono,NotoMono NFM:style=Regular\r\n```\r\n\r\nThe \"Mono\" is designed for apps which does not support doublewidth glyphs. It will work everywhere, but icons will be too small and thus nearly unless - this is better than nothing but in no way fun!\r\n`$ urxvt -fn 'xft:NotoMono Nerd Font Mono' -e nvim ~/nerd-symbols.txt`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/8c962238-be8a-4e57-ae62-6abc4f49f662)\r\n\r\nThe other two flavors mostly don't work (only few icons are shown) because of missing support for doublewidth glyphs both in terminal and Neovim.\r\n`$ urxvt -fn 'xft:NotoMono Nerd Font' -e nvim ~/nerd-symbols.txt`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/195eeefa-3ea6-4ae3-a1ce-e4f9ecc6ce44)\r\n\r\nIf we'll use terminal with support for doublewidth glyphs the \"Mono\" will looks the same, but other two flavors will be broken: icons will be shown as doublewidth but as result it'll shown over next symbol (a space, in this case):\r\n`$ wezterm --config \"font = wezterm.font 'NotoMono Nerd Font Mono'\" -e nvim ~/nerd-symbols.txt`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/619dd360-4bef-4bb3-b6fb-764f274b2ad9)\r\n`$ wezterm --config \"font = wezterm.font 'NotoMono Nerd Font'\" -e nvim ~/nerd-symbols.txt`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/69c1d1ce-1a9b-4cb1-bc45-0061e980958f)\r\nTo make this more obvious we can open file with multiple icons in a row without spaces between them:\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/b68887f8-205f-4967-af36-b617fcad3c29)\r\n\r\nThere is a way to fix most old apps (e.g. urxvt) by using LD_PRELOAD hack to patch result of `wcwidth(3)` and `wcswidth(3)` to make them return 2 for doublewidth codepoints in Nerd Fonts. (One implementation is https://github.com/powerman/wcwidth-icons.) This way we can make icons work in urxvt, **but not in Neovim**:\r\n`$ LD_PRELOAD=/usr/lib64/libwcwidth-icons.so urxvt -fn 'xft:NotoMono Nerd Font'`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/e0ef30b4-49a6-40e3-8b36-3da360670eae)\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/f72ab13c-43ca-4964-996c-fefe04ff625a)\r\n\r\nThis is because some apps (vim and Neovim included) does not use `wcwidth(3)`, instead they hardcode list of doublewidth codepoints in their sources. So, to make them support nice large icons we need to patch these apps. Patch for vim is available at https://github.com/powerman/wcwidth-icons/blob/master/patches/vim/wcwidth-icons.patch. As for Neovim, today I've tried to implement such patch (and it works!), but current implementation feels like a dirty hack because to me it looks like this should be implemented in different way and place, which will likely require patching this logic:\r\n\r\nhttps://github.com/neovim/neovim/blob/724d1110b1e4699a34f489e9cdb2d25098746499/src/nvim/generators/gen_unicode_tables.lua#L248-L251\r\n\r\nAnyway, dirty hack or not, but it now works!\r\n`$ LD_PRELOAD=/usr/lib64/libwcwidth-icons.so urxvt -fn 'xft:NotoMono Nerd Font' -e nvim ~/nerd-symbols.txt`\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/fd1c22ba-619a-43f1-8e33-0ab1f06b2a91)\r\n\n\n### Expected behavior\n\nThis feature should be available in Neovim out-of-box, because a lot of Neovim users and plugins use Nerd Font icons.",
    "closed_at": "2024-06-27T13:29:24Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> t would be nice to patch tables in src/unicode/ to mark codepoints used by Nerd Fonts doublewidth icons as doublewidth.\r\n\r\nWe are trying to get _rid_ of those tables... see #26165 ",
            "created_at": "2024-06-27T12:58:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/29496#issuecomment-2194626014",
            "id": 2194626014,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29496",
            "node_id": "IC_kwDOAPphoM6Cz1Xe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194626014/reactions"
            },
            "updated_at": "2024-06-27T12:58:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194626014",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "Cool! Just don't forget to test how utf8proc handles these doublewidth Nerd Fonts codepoints. :smile: ",
            "created_at": "2024-06-27T13:01:30Z",
            "html_url": "https://github.com/neovim/neovim/issues/29496#issuecomment-2194638952",
            "id": 2194638952,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29496",
            "node_id": "IC_kwDOAPphoM6Cz4ho",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194638952/reactions"
            },
            "updated_at": "2024-06-27T13:01:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194638952",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1354301?v=4",
                "events_url": "https://api.github.com/users/powerman/events{/privacy}",
                "followers_url": "https://api.github.com/users/powerman/followers",
                "following_url": "https://api.github.com/users/powerman/following{/other_user}",
                "gists_url": "https://api.github.com/users/powerman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/powerman",
                "id": 1354301,
                "login": "powerman",
                "node_id": "MDQ6VXNlcjEzNTQzMDE=",
                "organizations_url": "https://api.github.com/users/powerman/orgs",
                "received_events_url": "https://api.github.com/users/powerman/received_events",
                "repos_url": "https://api.github.com/users/powerman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/powerman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/powerman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/powerman"
            }
        },
        {
            "author_association": "NONE",
            "body": "BTW, I've tried to use https://github.com/nvim-lua/kickstart.nvim and noticed it breaks with my patch:\r\n![изображение](https://github.com/neovim/neovim/assets/1354301/0ddc2538-f95b-44c6-9123-69e43f93003b)\r\n\r\nThis happens because plugin author thinks Nerd Font icons are not doublewidth and adds extra space after an icon (it may not be obvious from the snippet, but if you'll try to copy&paste it you'll notice space after an icon inside a quoted string):\r\n\r\nhttps://github.com/folke/todo-comments.nvim/blob/51e10f838e84b4756c16311d0b1ef0972c6482d2/lua/todo-comments/config.lua#L26-L28\r\n\r\nSimilar issues was already reported for some other plugins (e.g. https://github.com/puremourning/vimspector/issues/263) and was fixed by adding extra check for 'ambiwidth' vim option: https://github.com/puremourning/vimspector/pull/264/files#diff-4607cd06061548fc2a8d9ee4fad6df8b1dc48d80dc905d9e68249f39134c257fR16-R17",
            "created_at": "2024-06-27T13:12:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/29496#issuecomment-2194662883",
            "id": 2194662883,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29496",
            "node_id": "IC_kwDOAPphoM6Cz-Xj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194662883/reactions"
            },
            "updated_at": "2024-06-27T13:18:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194662883",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1354301?v=4",
                "events_url": "https://api.github.com/users/powerman/events{/privacy}",
                "followers_url": "https://api.github.com/users/powerman/followers",
                "following_url": "https://api.github.com/users/powerman/following{/other_user}",
                "gists_url": "https://api.github.com/users/powerman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/powerman",
                "id": 1354301,
                "login": "powerman",
                "node_id": "MDQ6VXNlcjEzNTQzMDE=",
                "organizations_url": "https://api.github.com/users/powerman/orgs",
                "received_events_url": "https://api.github.com/users/powerman/received_events",
                "repos_url": "https://api.github.com/users/powerman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/powerman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/powerman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/powerman"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`setcellwidths()`",
            "created_at": "2024-06-27T13:29:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/29496#issuecomment-2194697663",
            "id": 2194697663,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29496",
            "node_id": "IC_kwDOAPphoM6C0G2_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194697663/reactions"
            },
            "updated_at": "2024-06-27T13:29:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2194697663",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29496/comments",
    "created_at": "2024-06-27T12:54:33Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29496/events",
    "html_url": "https://github.com/neovim/neovim/issues/29496",
    "id": 2378081932,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29496/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6NvqaM",
    "number": 29496,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29496/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29496/timeline",
    "title": "Add support for Nerd Fonts (doublewidth icons)",
    "updated_at": "2024-06-27T13:29:24Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29496",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1354301?v=4",
        "events_url": "https://api.github.com/users/powerman/events{/privacy}",
        "followers_url": "https://api.github.com/users/powerman/followers",
        "following_url": "https://api.github.com/users/powerman/following{/other_user}",
        "gists_url": "https://api.github.com/users/powerman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/powerman",
        "id": 1354301,
        "login": "powerman",
        "node_id": "MDQ6VXNlcjEzNTQzMDE=",
        "organizations_url": "https://api.github.com/users/powerman/orgs",
        "received_events_url": "https://api.github.com/users/powerman/received_events",
        "repos_url": "https://api.github.com/users/powerman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/powerman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/powerman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/powerman"
    }
}