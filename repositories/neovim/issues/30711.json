{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nNeovim (inheriting from Vim) has a seldom used feature for combining multiple filetypes into the `'filetype'` option separated by a dot: https://github.com/neovim/neovim/blob/61f1b091ea97793f9b644cebf6c84cf6bbb4f0bc/runtime/doc/options.txt#L2541-L2546\n\nThe runtime files for `eruby` and `liquid`, both templating languages, use the second filetype to decide the syntax of the language the template is generating, combining those runtime files with its own. Outside of those special cases, the default behavior in Vim is to load each language's runtime files in succession, with the first language setting a variable—`b:current_syntax`, `b:did_ftplugin`, `b:did_indent`—that subsequent runtime files use to short-circuit.  These short circuits are missing from the syntax files that delegate to Tree-Sitter, producing an error whenever a Tree-Sitter language is used as a secondary syntax.\n\n### Steps to reproduce\n\n```\nnvim --clean\n:setf sh.lua\n```\n\nNeovim 0.10:\n\n```\nError detected while processing FileType Autocommands for \"*\"..function <SNR>1_LoadFTPlugin[20]..script /opt/homebrew/Cellar/neovim/0.10.2_1/share/nvim/runtime/ftplugin/lua.lua:\nE5113: Error while calling lua chunk: ...0.2_1/share/nvim/runtime/lua/vim/treesitter/language.lua:101: 'sh.lua' is not a valid language name\nstack traceback:\n        [C]: in function 'error'\n        ...0.2_1/share/nvim/runtime/lua/vim/treesitter/language.lua:101: in function 'add'\n        ...1/share/nvim/runtime/lua/vim/treesitter/languagetree.lua:111: in function 'new'\n        ...eovim/0.10.2_1/share/nvim/runtime/lua/vim/treesitter.lua:41: in function '_create_parser'\n        ...eovim/0.10.2_1/share/nvim/runtime/lua/vim/treesitter.lua:108: in function 'get_parser'\n        ...eovim/0.10.2_1/share/nvim/runtime/lua/vim/treesitter.lua:416: in function 'start'\n        ...llar/neovim/0.10.2_1/share/nvim/runtime/ftplugin/lua.lua:2: in main chunk\n```\n\nNeovim 0.11 HEAD:\n\n```\nError detected while processing FileType Autocommands for \"*\"..function <SNR>1_LoadFTPlugin[20]..script /home/tpope/Code/vim/neovim/builds/0.11/share/nvim/runtime/ftplugin/lua.lua:\nE5113: Error while calling lua chunk: ...im/builds/0.11/share/nvim/runtime/lua/vim/treesitter.lua:426: Parser could not be created for buffer 1 and language \"sh\"\nstack traceback:\n        [C]: in function 'assert'\n        ...im/builds/0.11/share/nvim/runtime/lua/vim/treesitter.lua:426: in function 'start'\n        ...m/neovim/builds/0.11/share/nvim/runtime/ftplugin/lua.lua:2: in main chunk\n```\n\nNeovim 0.11 does fix the reverse case: `filetype=lua.sh`.\n\n### Expected behavior\n\nI would expect silence. For file types like `eruby` and `liquid`, it would of course be nice if they functioned as intended, but I wouldn't expect combining Tree-Sitter with regexp based highlighting to work, and it's not the subject of this bug report.\n\n### Nvim version (nvim -v)\n\n0.10.2, HEAD\n\n### Vim (not Nvim) behaves the same?\n\nno, vim 9.1\n\n### Operating system/version\n\nany\n\n### Terminal name/version\n\nany\n\n### $TERM environment variable\n\nany\n\n### Installation\n\nHomebrew, manual compile",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "This is a problem with 'commentstring' as well. For `:set ft=sh.c`, in Vim 'commentstring' is set to `# %s`, while in Nvim it's set to `// %s`.",
            "created_at": "2024-10-08T01:27:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/30711#issuecomment-2398415537",
            "id": 2398415537,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30711",
            "node_id": "IC_kwDOAPphoM6O9Oqx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2398415537/reactions"
            },
            "updated_at": "2024-10-08T01:27:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2398415537",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30711/comments",
    "created_at": "2024-10-07T19:07:35Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30711/events",
    "html_url": "https://github.com/neovim/neovim/issues/30711",
    "id": 2571240226,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "funtime",
            "id": 120251370,
            "name": "runtime",
            "node_id": "MDU6TGFiZWwxMjAyNTEzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/runtime"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30711/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6ZQgMi",
    "number": 30711,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30711/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30711/timeline",
    "title": "Tree-Sitter errors when filetype contains a dot",
    "updated_at": "2024-10-08T01:27:55Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30711",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/378?v=4",
        "events_url": "https://api.github.com/users/tpope/events{/privacy}",
        "followers_url": "https://api.github.com/users/tpope/followers",
        "following_url": "https://api.github.com/users/tpope/following{/other_user}",
        "gists_url": "https://api.github.com/users/tpope/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/tpope",
        "id": 378,
        "login": "tpope",
        "node_id": "MDQ6VXNlcjM3OA==",
        "organizations_url": "https://api.github.com/users/tpope/orgs",
        "received_events_url": "https://api.github.com/users/tpope/received_events",
        "repos_url": "https://api.github.com/users/tpope/repos",
        "site_admin": true,
        "starred_url": "https://api.github.com/users/tpope/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tpope/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/tpope"
    }
}