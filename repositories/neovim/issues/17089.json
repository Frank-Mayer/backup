{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Neovim version (nvim -v)\r\n\r\n0.6.1\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A\r\n\r\n### Operating system/version\r\n\r\nLinux\r\n\r\n### Terminal name/version\r\n\r\nN/A\r\n\r\n### $TERM environment variable\r\n\r\nN/A\r\n\r\n### Installation\r\n\r\nFrom source\r\n\r\n### How to reproduce the issue\r\n\r\nCall\r\n\r\nBug 1: It doesn't work if called too early\r\n\r\n```\r\nvim.api.nvim_command(\"hi MsgArea ctermbg=236 ctermfg=230\")\r\n```\r\n\r\nbefore `colorsheme` and it does nothing. Call it after (or in `vim.scheduled_wrap`) and it works.\r\n\r\nBug 2:\r\n\r\nCalling `vim.api.nvim_set_hl(NS, \"MsgArea\", { ctermbg = \"white\" })` explodes. Or if done later using `:lua vim.api.nvim_set_hl(1, \"MsgArea\", { ctermbg = \"white\" })`, does nothing.\r\n\r\nIf you manually call `vim.api.nvim_command(\"hi MsgArea ctermbg=236 ctermfg=230\")`, *then* **in another event loop iteration** call `set_hl`, then,  it starts to work correctly.\r\n\r\n### Expected behavior\r\n\r\nWork just like every other color groups. Not have to call `:hl MsgArea` before the Lua API starts working. \r\n\r\n### Actual behavior\r\n\r\nFor \"bug 1\", it does nothing unless the call is placed after the colorsheme is loaded. Other `hl` groups don't behave like this.\r\n\r\nFor \"bug 2\":\r\n\r\nIt explodes when calling `nvim_set_hl`.\r\n\r\n```txt\r\nE5108: Error executing lua highlight.lua:61:                   \r\nExpected lua string                                                                                 \r\nstack traceback:                                                                                    \r\n         [C]: in function 'nvim_set_hl'                                                 \r\n```\r\n\r\nCalling any other color take a table with `ctermbg`, `bold`, `foreground`, etc. This group, for some reason, think it needs a string. Passing it a string also explodes.\r\n\r\n\r\n### Workaround\r\n\r\n```lua\r\nlocal set_hl_ns = vim.api.nvim__set_hl_ns or vim.api.nvim_set_hl_ns\r\nlocal namespace = vim.api.nvim_create_namespace(\"hl\")\r\n\r\n-- The delay mitigates a bug.\r\n-- https://github.com/neovim/neovim/issues/17089\r\nvim.schedule_wrap(function()\r\n    vim.api.nvim_command(\"hi MsgArea ctermbg=None ctermfg=None\")\r\n\r\n    vim.schedule(function()\r\n        pcall(function()\r\n            vim.api.nvim_set_hl(namespace, name, {\r\n                ctermbg = 236,\r\n                ctermfg = 230\r\n            })\r\n            set_hl_ns(namespace)\r\n        end)\r\n    end)\r\nend)\r\n\r\n```\r\n\r\nedit: mitigation in my config https://github.com/Elv13/reclaimail/commit/223b7595b3ce2df364ac8b058b489280f1e3a27f#diff-bdc56ba78f46e5c354431ef45a14094b952fb6765a827b27f922c8db42328221R1",
    "closed_at": "2024-12-02T10:47:53Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "bug 1 duplicate https://github.com/neovim/neovim/issues/17832",
            "created_at": "2023-10-31T01:14:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/17089#issuecomment-1786281871",
            "id": 1786281871,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/17089",
            "node_id": "IC_kwDOAPphoM5qeH-P",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1786281871/reactions"
            },
            "updated_at": "2023-10-31T01:14:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1786281871",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Bug 1: It doesn't work if called too early\n\nThis works on Nvim 0.11 c1378413c142e1762b80132c41b10c16c4aa7c13 :\n\n    nvim --cmd 'set notermguicolors' --cmd 'lua vim.api.nvim_command(\"hi MsgArea ctermbg=236 ctermfg=230\")'\n\n\n\n> Bug 2:\n> \n> Calling `vim.api.nvim_set_hl(NS, \"MsgArea\", { ctermbg = \"white\" })` explodes. Or if done later using `:lua vim.api.nvim_set_hl(1, \"MsgArea\", { ctermbg = \"white\" })`, does nothing.\n\nThis works (ns=0):\n\n    nvim --cmd 'set notermguicolors' --cmd 'lua vim.api.nvim_set_hl(0, \"MsgArea\", { ctermbg = \"white\" })'",
            "created_at": "2024-12-02T10:47:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/17089#issuecomment-2511190966",
            "id": 2511190966,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/17089",
            "node_id": "IC_kwDOAPphoM6Vrbu2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511190966/reactions"
            },
            "updated_at": "2024-12-02T10:47:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511190966",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/17089/comments",
    "created_at": "2022-01-14T10:50:23Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/17089/events",
    "html_url": "https://github.com/neovim/neovim/issues/17089",
    "id": 1103457453,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1786207367,
            "name": "highlight",
            "node_id": "MDU6TGFiZWwxNzg2MjA3MzY3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/highlight"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/17089/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5BxWyt",
    "number": 17089,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/17089/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/17089/timeline",
    "title": "The highlight \"MsgArea\" hl_group is misbehaving when used with the Lua API",
    "updated_at": "2024-12-02T10:47:55Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/17089",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/340384?v=4",
        "events_url": "https://api.github.com/users/Elv13/events{/privacy}",
        "followers_url": "https://api.github.com/users/Elv13/followers",
        "following_url": "https://api.github.com/users/Elv13/following{/other_user}",
        "gists_url": "https://api.github.com/users/Elv13/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Elv13",
        "id": 340384,
        "login": "Elv13",
        "node_id": "MDQ6VXNlcjM0MDM4NA==",
        "organizations_url": "https://api.github.com/users/Elv13/orgs",
        "received_events_url": "https://api.github.com/users/Elv13/received_events",
        "repos_url": "https://api.github.com/users/Elv13/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Elv13/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Elv13/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Elv13",
        "user_view_type": "public"
    }
}