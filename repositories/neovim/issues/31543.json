{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nWhen a new popup is displayed, there seems to be a risk that it is shown behind an older popup. The reverse (\"zindex\") order would be better so that the newest popup is fully visible.\n\n\n### Steps to reproduce\n\nFor example, using `vim.lsp.buf.hover()` to spawn a popup, and then inside that popup calling `<Cmd>lua vim.diagnostic.goto_next({float={source=true}})<CR>` causes the diagnostics popup to appear below/behind the hover popup.\n\n![Image](https://github.com/user-attachments/assets/de41653b-e7da-40b5-9b05-4155d9660700)\n\n### Expected behavior\n\nNewest popup to appear on top\n\n### Nvim version (nvim -v)\n\nv0.10.2\n\n### Vim (not Nvim) behaves the same?\n\ndont know\n\n### Operating system/version\n\nUbuntu 24.04\n\n### Terminal name/version\n\nWezterm\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\ndont remember",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> For example, using `vim.lsp.buf.hover()` to spawn a popup, and then inside that popup calling `<Cmd>lua vim.diagnostic.goto_next({float={source=true}})<CR>` causes the diagnostics popup to appear below/behind the hover popup.\n\nHow can you have diagnostics in the LSP popup window?",
            "created_at": "2024-12-10T23:33:52Z",
            "html_url": "https://github.com/neovim/neovim/issues/31543#issuecomment-2533220084",
            "id": 2533220084,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31543",
            "node_id": "IC_kwDOAPphoM6W_d70",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533220084/reactions"
            },
            "updated_at": "2024-12-10T23:34:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533220084",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> How can you have diagnostics in the LSP popup window?\n\nDoes it matter? I think it makes sense if the compositor would place child/newer windows on top of parent/older windows. Cycling through the windows with `Ctrl-W` in this repro should show the problem:\n\n```lua\nvim.cmd.call(\"setline(1, ['foobar']->repeat(100))\")\nvim.api.nvim_open_win(0, true, { relative = 'editor', row = 1, col = 1, width = 10, height = 5 })\nvim.api.nvim_open_win(vim.api.nvim_create_buf(false, false), true, { relative = 'editor', row = 3, col = 3, width = 10, height = 5 })\nvim.cmd.call(\"setline(1, ['newest']->repeat(100))\")\n```\n\nIf we don't fix the compositor I suppose we could make sure our runtime does not open windows with equal zindex to parent windows.",
            "created_at": "2024-12-10T23:48:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/31543#issuecomment-2533239586",
            "id": 2533239586,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31543",
            "node_id": "IC_kwDOAPphoM6W_isi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533239586/reactions"
            },
            "updated_at": "2024-12-10T23:48:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533239586",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ah, that seems to be intentional. It happened here in `ui_comp_grid_cursor_goto()`:\n```c\n  // TODO(bfredl): maybe not the best time to do this, for efficiency we\n  // should configure all grids before entering win_update()\n  if (curgrid != &default_grid) {\n    size_t new_index = kv_size(layers) - 1;\n\n    while (new_index > 1 && kv_A(layers, new_index)->zindex > curgrid->zindex) {\n      new_index--;\n    }\n\n    if (curgrid->comp_index < new_index) {\n      ui_comp_raise_grid(curgrid, new_index);\n    }\n  }\n```",
            "created_at": "2024-12-11T00:09:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/31543#issuecomment-2533275198",
            "id": 2533275198,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31543",
            "node_id": "IC_kwDOAPphoM6W_rY-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533275198/reactions"
            },
            "updated_at": "2024-12-11T00:09:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533275198",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yeah there's something to say for the curgrid behavior. Then maybe it should be up to the caller to choose an appropriate zindex (small popup window set zindex to something greater than parent window).",
            "created_at": "2024-12-11T00:29:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/31543#issuecomment-2533345319",
            "id": 2533345319,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31543",
            "node_id": "IC_kwDOAPphoM6W_8gn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533345319/reactions"
            },
            "updated_at": "2024-12-11T12:26:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2533345319",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > For example, using `vim.lsp.buf.hover()` to spawn a popup, and then inside that popup calling `<Cmd>lua vim.diagnostic.goto_next({float={source=true}})<CR>` causes the diagnostics popup to appear below/behind the hover popup.\n> \n> How can you have diagnostics in the LSP popup window?\n\nBy using otter.nvim: https://github.com/jmbuhr/otter.nvim/issues/189",
            "created_at": "2024-12-11T22:32:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/31543#issuecomment-2537337954",
            "id": 2537337954,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31543",
            "node_id": "IC_kwDOAPphoM6XPLRi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2537337954/reactions"
            },
            "updated_at": "2024-12-11T22:32:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2537337954",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/4508793?v=4",
                "events_url": "https://api.github.com/users/kaddkaka/events{/privacy}",
                "followers_url": "https://api.github.com/users/kaddkaka/followers",
                "following_url": "https://api.github.com/users/kaddkaka/following{/other_user}",
                "gists_url": "https://api.github.com/users/kaddkaka/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kaddkaka",
                "id": 4508793,
                "login": "kaddkaka",
                "node_id": "MDQ6VXNlcjQ1MDg3OTM=",
                "organizations_url": "https://api.github.com/users/kaddkaka/orgs",
                "received_events_url": "https://api.github.com/users/kaddkaka/received_events",
                "repos_url": "https://api.github.com/users/kaddkaka/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kaddkaka/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kaddkaka/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kaddkaka",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31543/comments",
    "created_at": "2024-12-10T21:53:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31543/events",
    "html_url": "https://github.com/neovim/neovim/issues/31543",
    "id": 2731273006,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "floating windows, popups, hover",
            "id": 3234818716,
            "name": "floatwin",
            "node_id": "MDU6TGFiZWwzMjM0ODE4NzE2",
            "url": "https://api.github.com/repos/neovim/neovim/labels/floatwin"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31543/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6iy-su",
    "number": 31543,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31543/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31543/timeline",
    "title": "New popup displayed behind old one",
    "updated_at": "2024-12-11T22:32:34Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31543",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/4508793?v=4",
        "events_url": "https://api.github.com/users/kaddkaka/events{/privacy}",
        "followers_url": "https://api.github.com/users/kaddkaka/followers",
        "following_url": "https://api.github.com/users/kaddkaka/following{/other_user}",
        "gists_url": "https://api.github.com/users/kaddkaka/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kaddkaka",
        "id": 4508793,
        "login": "kaddkaka",
        "node_id": "MDQ6VXNlcjQ1MDg3OTM=",
        "organizations_url": "https://api.github.com/users/kaddkaka/orgs",
        "received_events_url": "https://api.github.com/users/kaddkaka/received_events",
        "repos_url": "https://api.github.com/users/kaddkaka/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kaddkaka/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kaddkaka/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kaddkaka",
        "user_view_type": "public"
    }
}