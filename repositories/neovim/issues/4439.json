{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "followup to https://github.com/neovim/neovim/pull/4438#issuecomment-195421685\n\nAlso mentioned there: extend `:helptags` to eliminate `:UpdateRemotePlugins`.\n",
    "closed_at": "2024-03-20T14:57:48Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Also, I wonder if the logic of finding rplugin files/packages, and later, finding _changes_ to rplugin files to remove the need for `:UpdateRemotePlugins`, should be delegated to the rplugin hosts. Because for multi-file rplugins it is not obvious which file/s/ (`pkg/__init__.py` in the case of python) whose changes can change the rplugin registrations. Just give it all the relevant `rplugin/LANG/` folders. (this still allows \"private\" hosts like for the legacy python provider, though we will handle that one differently soon)\n",
            "created_at": "2016-03-11T16:39:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/4439#issuecomment-195443448",
            "id": 195443448,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/4439",
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTQ0MzQ0OA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195443448/reactions"
            },
            "updated_at": "2016-03-11T16:40:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195443448",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Also, I wonder if the logic of finding rplugin files/packages, and later, finding changes to rplugin files to remove the need for :UpdateRemotePlugins, should be delegated to the rplugin hosts\n\nThe whole point of having `:UpdateRemotePlugins` is to avoid the overhead of loading all hosts at startup, deferring to only when required. The logic for discovering and detecting changes would be better if delegated to plugin hosts, but since they would need to be loaded first, this becomes a bit of chicken/egg problem. \n\nA way to remove the need for `:UpdateRemotePlugins` without losing the benefits of lazy loading is to have nvim spawn a daemon that keeps running until the user logs out. Such daemon would only be spawned once, and subsequent nvim instances will connect to the existing daemon.\n\nThe main job of this daemon would be to keep track of all remote plugins in all rtp directories across all nvim instances, so nvim startup process becomes something like this:\n- spawn the rplugin daemon if not done already\n- connect to the rplugin daemon socket and asks for a list of remote plugin specifications for all its runtime paths.\n\nSince the daemon(which could be a libuv program using the fs watcher API) is always keeping track of remote plugins files/directories, new nvim instances will always get up to date rplugin information without needing `:UpdateRemotePlugins`. And it would be as fast as sourcing the manually updated rplugin spec file, since the daemon is only spawned once.\n\nAnothe nice thing about this daemon is that it could notify running nvim instances when a rplugin changes. Imagine this:\n- The user is editing a python rplugin being watched by the daemon\n- The daemon detects changes, and sends a notification to all connected nvim instances.\n- The user is prompted about plugin changes and has the option to reload the affected plugin host(if running).\n",
            "created_at": "2016-03-11T17:13:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/4439#issuecomment-195460505",
            "id": 195460505,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/4439",
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTQ2MDUwNQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195460505/reactions"
            },
            "updated_at": "2016-03-11T17:13:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195460505",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/842846?v=4",
                "events_url": "https://api.github.com/users/tarruda/events{/privacy}",
                "followers_url": "https://api.github.com/users/tarruda/followers",
                "following_url": "https://api.github.com/users/tarruda/following{/other_user}",
                "gists_url": "https://api.github.com/users/tarruda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tarruda",
                "id": 842846,
                "login": "tarruda",
                "node_id": "MDQ6VXNlcjg0Mjg0Ng==",
                "organizations_url": "https://api.github.com/users/tarruda/orgs",
                "received_events_url": "https://api.github.com/users/tarruda/received_events",
                "repos_url": "https://api.github.com/users/tarruda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tarruda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tarruda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tarruda"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> A way to remove the need for :UpdateRemotePlugins without losing the benefits of lazy loading is to have nvim spawn a daemon that keeps running until the user logs out. \n\nWhat about the idea of extending `:helptags`? \n\nAlso, in general, could we avoid a daemon and instead use a p2p strategy using [leader election](https://raft.github.io/) ? This would be more robust than a daemon. I've never heard of any application doing this for local communication, but I've also never heard anyone say why it would be a bad idea: from a high-level, it seems to me that it would avoid the various problems associated with detecting a zombie daemon, restarting the daemon, etc. (solutions for that are platform-specific; implementing \"raft\" protocol internal to nvim would be cross-platform).\n",
            "created_at": "2016-03-11T17:26:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/4439#issuecomment-195465807",
            "id": 195465807,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/4439",
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTQ2NTgwNw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195465807/reactions"
            },
            "updated_at": "2016-03-11T17:28:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195465807",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The question of who decides what is a rplugin file is independent of when the rplugin host needs to start. We could start the host when _any_ file in the rplugin tree is newer than the host's shada timestamp. Proper shada synchronization will ensure that only happens at most _once_ per file update.\n",
            "created_at": "2016-03-11T17:34:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/4439#issuecomment-195469201",
            "id": 195469201,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/4439",
            "node_id": "MDEyOklzc3VlQ29tbWVudDE5NTQ2OTIwMQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195469201/reactions"
            },
            "updated_at": "2016-03-11T17:34:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/195469201",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The whole point of having `:UpdateRemotePlugins` is to avoid the overhead of loading all hosts at startup, deferring to only when required. \r\n\r\nWe can achieve that by having \"remote\" plugins define their setup just like any other plugin, in a `lua/foo.lua` or `plugin/foo.lua` file. The missing piece is a standard `vim.rplugin()` interface that makes it easy to (1) start an API client and (2) point the client to the plugin main/library.\r\n\r\n- https://github.com/neovim/neovim/issues/27949\r\n\r\n> The logic for discovering and detecting changes would be better if delegated to plugin hosts, but since they would need to be loaded first, this becomes a bit of chicken/egg problem.\r\n\r\nWhy does the plugin host (aka API client) need to _detect_ changes at _runtime_?\r\n\r\n> A way to remove the need for `:UpdateRemotePlugins` without losing the benefits of lazy loading is to have nvim spawn a daemon that keeps running until the user logs out.\r\n\r\nhttps://github.com/neovim/neovim/issues/27949 proposes something like that, but we can ignore the \"daemon\" part initially. Instead we just need an easy way for plugins to start an API client and point it to a module.",
            "created_at": "2024-03-20T14:57:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/4439#issuecomment-2009774868",
            "id": 2009774868,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/4439",
            "node_id": "IC_kwDOAPphoM53yrsU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2009774868/reactions"
            },
            "updated_at": "2024-03-20T14:57:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2009774868",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/4439/comments",
    "created_at": "2016-03-11T16:31:26Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/4439/events",
    "html_url": "https://github.com/neovim/neovim/issues/4439",
    "id": 140228989,
    "labels": [
        {
            "color": "FBCA04",
            "default": false,
            "description": "needs a clear design proposal",
            "id": 124510010,
            "name": "needs:design",
            "node_id": "MDU6TGFiZWwxMjQ1MTAwMTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:design"
        },
        {
            "color": "c7def8",
            "default": false,
            "description": "user experience",
            "id": 151718455,
            "name": "ux",
            "node_id": "MDU6TGFiZWwxNTE3MTg0NTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/ux"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "For PRs that propose significant changes to some part of the architecture or API",
            "id": 212680983,
            "name": "needs:discussion",
            "node_id": "MDU6TGFiZWwyMTI2ODA5ODM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:discussion"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 652698463,
            "name": "remote-plugin",
            "node_id": "MDU6TGFiZWw2NTI2OTg0NjM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/remote-plugin"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/4439/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 601,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 430,
        "state": "open",
        "title": "backlog",
        "updated_at": "2024-03-25T22:54:54Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUxNDAyMjg5ODk=",
    "number": 4439,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/4439/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/4439/timeline",
    "title": "rplugin: cache registrations in 'shada' file",
    "updated_at": "2024-03-20T14:57:48Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/4439",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk"
    }
}