{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nSince 0.10.0 neovim supports LSP pull diagnostics, a specific LSP 'Verible' has both push and pull diagnostics (added 2 years ago in https://github.com/chipsalliance/verible/pull/1268 ).\r\n\r\nNow all warnings/errors appear twice:\r\n\r\n![tvnviewer_MzoLWoqsLp](https://github.com/user-attachments/assets/50da093c-d904-4fe3-aba5-1bb31fb834ae)\r\n\r\n- Both vscode and helix seem to handle this without issues.\r\n- In nvim 0.9 there were no LSP pull diagnostics so this issue did not appear (no duplicate warnings/errors).\r\n- Using nvim 0.10.0 an ancient version of the LSP without pull diagnostics (the version right before the pull request linked) also works as expected.\r\n\r\n\r\n\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\nTo reproduce simply use the Verible lsp with any systemverilog (.sv) file that contains any warning/error.\r\n\r\n```\r\n--- CHANGE THESE\r\nlocal pattern = 'systemverilog'\r\nlocal cmd = {'verible-verilog-ls'}\r\nlocal root_markers = {'.git', '.editorconfig'}\r\nlocal settings = vim.empty_dict()\r\n\r\n-- unchanged below :)\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'bugged-ls',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings\r\n    })\r\n  end\r\n})\r\n```\r\n\r\nExample invalid file _test.sv_, which produces: _syntax error, rejected \"--\"_\"\r\n```\r\nmodule test(--)\r\nendmodule\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect warnings to appear only once.\r\n\r\nI don't know the LSP standards too well, but perhaps when both push and pull are supported by a LSP only one of the two should be used? I could probably work around this issue by disabling the pull capabilities for this LSP, but I feel like it would be cleaner to fix this in nvim directly.\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.10.0\r\n\r\n### Language server name/version\r\n\r\nverible-v0.0-2023-gbda7f9a8 and later\r\n\r\n### Operating system/version\r\n\r\nN/A\r\n\r\n### Log file\r\n\r\nhttps://gist.github.com/henrykvdb/bf47ad22a44380426625d686543670e9",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "because   there pull diagnostic when open and change then server publish diagnostic there when open or change neovim pull diagnostic then make duplicate .. maybe you can set DiagnsoticProvider to false just use publish diangostic\r\n\r\nhttps://github.com/neovim/neovim/blob/d3019419e77669db4eb4959f673dff1d4963005e/runtime/lua/vim/lsp/diagnostic.lua#L430-L442",
            "created_at": "2024-08-01T10:18:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/29927#issuecomment-2262680530",
            "id": 2262680530,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29927",
            "node_id": "IC_kwDOAPphoM6G3cPS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2262680530/reactions"
            },
            "updated_at": "2024-08-01T10:19:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2262680530",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "NONE",
            "body": "Disabling pull diagnostics might be a decent temporary workaround, but shouldn't nvim work also when the lsp provides both? (other editors don't seem to have this issue)\r\n\r\nI was trying to disable some of the new nvim 0.10.0 capabilities but did not manage to get rid of the duplicate warnings this way\r\n```\r\ncapabilities[\"textDocument\"][\"codeAction\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"hover\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"rename\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"formatting\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"inlayHint\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"definition\"][\"dynamicRegistration\"] = false\r\ncapabilities[\"textDocument\"][\"rangeFormatting\"][\"dynamicRegistration\"] = fals\r\ncapabilities[\"textDocument\"][\"diagnostic\"][\"relatedDocumentSupport\"] = false\r\n```",
            "created_at": "2024-08-02T13:26:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/29927#issuecomment-2265404940",
            "id": 2265404940,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29927",
            "node_id": "IC_kwDOAPphoM6HB1YM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2265404940/reactions"
            },
            "updated_at": "2024-08-02T13:26:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2265404940",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1943875?v=4",
                "events_url": "https://api.github.com/users/henrykvdb/events{/privacy}",
                "followers_url": "https://api.github.com/users/henrykvdb/followers",
                "following_url": "https://api.github.com/users/henrykvdb/following{/other_user}",
                "gists_url": "https://api.github.com/users/henrykvdb/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/henrykvdb",
                "id": 1943875,
                "login": "henrykvdb",
                "node_id": "MDQ6VXNlcjE5NDM4NzU=",
                "organizations_url": "https://api.github.com/users/henrykvdb/orgs",
                "received_events_url": "https://api.github.com/users/henrykvdb/received_events",
                "repos_url": "https://api.github.com/users/henrykvdb/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/henrykvdb/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/henrykvdb/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/henrykvdb"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29927/comments",
    "created_at": "2024-07-31T15:39:59Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29927/events",
    "html_url": "https://github.com/neovim/neovim/issues/29927",
    "id": 2440359563,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 3361645105,
            "name": "diagnostic",
            "node_id": "MDU6TGFiZWwzMzYxNjQ1MTA1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/diagnostic"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29927/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6RdO6L",
    "number": 29927,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29927/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29927/timeline",
    "title": "Duplicate diagnostics for LSP implementing both push and pull",
    "updated_at": "2024-08-02T13:26:47Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29927",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1943875?v=4",
        "events_url": "https://api.github.com/users/henrykvdb/events{/privacy}",
        "followers_url": "https://api.github.com/users/henrykvdb/followers",
        "following_url": "https://api.github.com/users/henrykvdb/following{/other_user}",
        "gists_url": "https://api.github.com/users/henrykvdb/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/henrykvdb",
        "id": 1943875,
        "login": "henrykvdb",
        "node_id": "MDQ6VXNlcjE5NDM4NzU=",
        "organizations_url": "https://api.github.com/users/henrykvdb/orgs",
        "received_events_url": "https://api.github.com/users/henrykvdb/received_events",
        "repos_url": "https://api.github.com/users/henrykvdb/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/henrykvdb/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/henrykvdb/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/henrykvdb"
    }
}