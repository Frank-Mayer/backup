{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nI find the startup time on recent neovim 0.10.x nightly significantly slower than the latest stable version (v0.9.1).\r\n\r\nWith a lot of plugins and personal configs the difference is more significant, e.g.,\r\n\r\n<details>\r\n<summary>Click here to expand</summary>\r\n\r\nNOTE: This benchmark was done on a very slow machine to exaggerate the difference\r\n\r\n<img width=\"1078\" alt=\"image\" src=\"https://github.com/neovim/neovim/assets/1009873/9210c475-14b9-406c-b0e6-cacfb865758b\">\r\n\r\n<br/>\r\n\r\nPlease execuse me this might be an incomplete profiling information. I was just trying to say that in one in-the-wild configuration the startuptime can be quite different.\r\n\r\n`:Lazy profile` also reports 115.64ms vs 96.89ms.  It's quite difficult for me to narrow down where it actually gets even slower than in the \"minimal init.lua\" setup; some of the core API might be slower or it could be due to the different LuaJIT runtime.\r\n\r\n</details>\r\n\r\nIn the below I provide some benchmark results with minimal init.lua, but I can certainly tell neovim 0.10.x nightly consistently starts up much slower than neovim 0.9.1 stable, and the timing of the initial UI being drawn is quite human-noticeable.\r\n\r\n### Steps to reproduce\r\n\r\nOne can write a benchmark code using dstein64/vim-startuptime on the bare minimal init.lua:\r\n\r\n```lua\r\n-- minimal.lua\r\n-- $ nvim -u minimal.lua\r\n\r\nfor name, url in pairs {\r\n  ['vim-startuptime'] = 'https://github.com/dstein64/vim-startuptime',\r\n} do\r\n  local install_path = vim.fn.fnamemodify('/tmp/nvim_issue/' .. name, ':p')\r\n  if vim.fn.isdirectory(install_path) == 0 then\r\n    print(vim.fn.system { 'git', 'clone', '--depth=1', url, install_path })\r\n  end\r\n  vim.opt.runtimepath:append(install_path)\r\nend\r\n\r\nvim.schedule(function()\r\n  vim.cmd [[\r\n    let g:startuptime_exe_args = ['-u', 'minimal.lua']\r\n    StartupTime\r\n  ]]\r\nend)\r\n```\r\n\r\n### Results\r\n\r\nv0.9.1 vs nightly: 214ms vs 485ms\r\n\r\n```\r\n❯❯❯ time nvim -u minimal.lua +q     # stable v0.9.1\r\nnvim -u minimal.lua +q  0.18s user 0.04s system 101% cpu 0.214 total\r\n\r\n❯❯❯ time nvim-nightly -u minimal.lua +q   # v0.10.0-dev-1031+gc431d820e\r\nnvim-nightly -u minimal.lua +q  0.19s user 0.06s system 50% cpu 0.485 total\r\n```\r\n\r\n`:Startuptime` result:\r\n\r\nNVIM v0.10.0-dev-1031+gc431d820e\r\nLuaJIT 2.1.1693350652\r\n\r\n```diff\r\n        startup: 80.5\r\n event                  time percent plot\r\n+event init            38.18   47.43 ██████████████████████████\r\n+done waiting for UI   13.50   16.77 █████████▎\r\n rplugin.vim            5.00    6.21 ███▍\r\n rplugin.vim            4.74    5.88 ███▎\r\n reading ShaDa          4.68    5.81 ███▏\r\n loading rtp plugins    4.25    5.28 ██▉\r\n sourcing vimrc file(   2.14    2.66 █▌\r\n matchit.vim            1.82    2.26 █▎\r\n syntax.vim             0.99    1.23 ▋\r\n netrwPlugin.vim        0.96    1.19 ▋\r\n init lua interpreter   0.95    1.18 ▋\r\n init highlight         0.93    1.15 ▋\r\n inits 1                0.63    0.78 ▍\r\n matchit.vim            0.61    0.76 ▍\r\n vim._init_packages     0.60    0.75 ▍\r\n gzip.vim               0.51    0.63 ▍\r\n init default mapping   0.48    0.60 ▍\r\n matchparen.vim         0.47    0.59 ▍\r\n filetype.lua           0.45    0.55 ▎\r\n startuptime.vim        0.40    0.49 ▎\r\n opening buffers        0.38    0.47 ▎\r\n vim._editor            0.36    0.44 ▎\r\n minimal.lua            0.35    0.43 ▎\r\n loading packages       0.33    0.41 ▎\r\n host.vim               0.27    0.34 ▏\r\n synload.vim            0.25    0.32 ▏\r\n zipPlugin.vim          0.24    0.29 ▏\r\n define.vim             0.22    0.28 ▏\r\n first screen update    0.20    0.25 ▏\r\n tarPlugin.vim          0.17    0.21 ▏\r\n early init             0.17    0.21 ▏\r\n expanding arguments    0.16    0.20 ▏\r\n VimEnter autocommand   0.14    0.17 ▏\r\n man.lua                0.13    0.17 ▏\r\n tohtml.vim             0.13    0.16 ▏\r\n ftplugin.vim           0.13    0.16 ▏\r\n locale set             0.12    0.15 ▏\r\n nvim.lua               0.12    0.14 ▏\r\n shada.vim              0.11    0.14 ▏\r\n inits 2                0.11    0.13 ▏\r\n vim.inspect            0.10    0.13 ▏\r\n indent.vim             0.10    0.13 ▏\r\n editorconfig.lua       0.10    0.13 ▏\r\n vim._options           0.09    0.11 ▏\r\n vim.shared             0.09    0.11\r\n init first window      0.09    0.11\r\n spellfile.vim          0.04    0.05\r\n window checked         0.04    0.05\r\n tutor.vim              0.03    0.04\r\n executing command ar   0.03    0.04\r\n clear screen           0.03    0.04\r\n BufEnter autocommand   0.03    0.04\r\n vim.keymap             0.02    0.03\r\n loading after plugin   0.02    0.02\r\n inits 3                0.02    0.02\r\n --- NVIM STARTING --   0.01    0.02\r\n parsing arguments      0.01    0.01\r\n waiting for UI         0.01    0.01\r\n UIEnter autocommands   0.01    0.01\r\n editing files in win   0.00    0.00\r\n --- NVIM STARTED ---   0.00    0.00\r\n before starting main   0.00    0.00\r\n```\r\n\r\nNVIM v0.9.1\r\nLuaJIT 2.1.0-beta3\r\n\r\n```\r\n        startup: 19.3\r\n event                  time percent plot\r\n reading ShaDa          4.06   21.07 ██████████████████████████\r\n rplugin.vim            3.90   20.25 █████████████████████████\r\n rplugin.vim            3.69   19.14 ███████████████████████▋\r\n loading rtp plugins    2.07   10.76 █████████████▎\r\n init lua interpreter   0.88    4.55 █████▋\r\n matchit.vim            0.72    3.76 ████▋\r\n init highlight         0.72    3.74 ████▋\r\n sourcing vimrc file(   0.68    3.51 ████▍\r\n inits 1                0.58    3.01 ███▊\r\n vim._init_packages     0.52    2.70 ███▍\r\n netrwPlugin.vim        0.49    2.57 ███▏\r\n syntax.vim             0.40    2.10 ██▋\r\n opening buffers        0.34    1.74 ██▏\r\n startuptime.vim        0.33    1.71 ██▏\r\n init default mapping   0.33    1.69 ██▏\r\n vim._editor            0.28    1.46 █▊\r\n matchit.vim            0.25    1.28 █▋\r\n gzip.vim               0.23    1.20 █▌\r\n host.vim               0.22    1.14 █▍\r\n zipPlugin.vim          0.21    1.07 █▍\r\n matchparen.vim         0.20    1.04 █▎\r\n filetype.lua           0.20    1.02 █▎\r\n early init             0.18    0.96 █▏\r\n define.vim             0.18    0.93 █▏\r\n event init             0.18    0.92 █▏\r\n tarPlugin.vim          0.16    0.82 █\r\n first screen update    0.15    0.80 █\r\n done waiting for UI    0.15    0.77 █\r\n vim.shared             0.14    0.73 ▉\r\n loading packages       0.13    0.68 ▉\r\n expanding arguments    0.12    0.64 ▊\r\n synload.vim            0.12    0.62 ▊\r\n minimal.lua            0.12    0.60 ▊\r\n tohtml.vim             0.12    0.60 ▊\r\n VimEnter autocommand   0.12    0.60 ▊\r\n vim._meta              0.11    0.56 ▊\r\n shada.vim              0.11    0.56 ▋\r\n locale set             0.10    0.50 ▋\r\n init first window      0.09    0.45 ▌\r\n inits 2                0.09    0.45 ▌\r\n man.lua                0.09    0.45 ▌\r\n editorconfig.lua       0.08    0.39 ▌\r\n nvim.lua               0.07    0.34 ▍\r\n ftplugin.vim           0.06    0.33 ▍\r\n indent.vim             0.04    0.22 ▎\r\n spellfile.vim          0.04    0.19 ▎\r\n window checked         0.03    0.17 ▎\r\n executing command ar   0.03    0.15 ▏\r\n tutor.vim              0.03    0.14 ▏\r\n BufEnter autocommand   0.03    0.13 ▏\r\n loading after plugin   0.02    0.12 ▏\r\n --- NVIM STARTING --   0.02    0.11 ▏\r\n clear screen           0.02    0.09 ▏\r\n inits 3                0.02    0.09 ▏\r\n health.vim             0.01    0.07 ▏\r\n parsing arguments      0.01    0.04\r\n UIEnter autocommands   0.00    0.02\r\n waiting for UI         0.00    0.02\r\n editing files in win   0.00    0.02\r\n --- NVIM STARTED ---   0.00    0.02\r\n before starting main   0.00    0.01\r\n```\r\n\r\nNOTE: There might be some statistical errors, so please ignore them. But we can see that `event init` and `done waiting for UI` shows a significant difference, at least more 60~70 milliseconds.\r\n\r\nI will try to get more profiling information if possible.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-1031+gc431d820e\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nN/A\r\n\r\n### Operating system/version\r\n\r\nLinux x86_64, 5.4.0-150-generic #167-Ubuntu\r\n\r\n### Terminal name/version\r\n\r\nxterm\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nOfficial Releases",
    "closed_at": "2023-09-06T06:36:19Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "What are the build types being used?",
            "created_at": "2023-09-06T06:27:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/25031#issuecomment-1707745764",
            "id": 1707745764,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25031",
            "node_id": "IC_kwDOAPphoM5lyiHk",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707745764/reactions"
            },
            "updated_at": "2023-09-06T06:27:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707745764",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@zeertzjq Sorry for missing that; In this Linux environment used the appimage.\r\n\r\n- https://github.com/neovim/neovim/releases/download/nightly/nvim.appimage\r\n- https://github.com/neovim/neovim/releases/download/v0.9.1/nvim.appimage\r\n\r\nOn my local macOS machine, I built neovim 0.10.x from source via Homebrew (brew install neovim --HEAD) and used nvim 0.9 from a stable release (brew install neovim).",
            "created_at": "2023-09-06T06:31:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/25031#issuecomment-1707749349",
            "id": 1707749349,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25031",
            "node_id": "IC_kwDOAPphoM5lyi_l",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707749349/reactions"
            },
            "updated_at": "2023-09-06T06:31:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707749349",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Then the comparisons don't really make sense, because they use different build types.",
            "created_at": "2023-09-06T06:36:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/25031#issuecomment-1707754588",
            "id": 1707754588,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25031",
            "node_id": "IC_kwDOAPphoM5lykRc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707754588/reactions"
            },
            "updated_at": "2023-09-06T06:36:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707754588",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "@zeertzjq I see. I can see that\r\n\r\n- NVIM v0.10.0-dev-* => Build type: **RelWithDebInfo**\r\n- NVIM v0.9.1 => **Build type: Release**\r\n\r\nso it wasn't indeed a fair comparison. I tried to compile again with `CMAKE_BUILD_TYPE=Release`, and can see that performance are comparable. Sorry about the inconvenience.",
            "created_at": "2023-09-06T06:53:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/25031#issuecomment-1707773049",
            "id": 1707773049,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25031",
            "node_id": "IC_kwDOAPphoM5lyox5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707773049/reactions"
            },
            "updated_at": "2023-09-06T06:53:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1707773049",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25031/comments",
    "created_at": "2023-09-06T05:58:54Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/25031/events",
    "html_url": "https://github.com/neovim/neovim/issues/25031",
    "id": 1883293057,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "Issues that are closed as \"invalid\"",
            "id": 77997477,
            "name": "closed:invalid",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Nw==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:invalid"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/25031/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5wQMWB",
    "number": 25031,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/25031/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/25031/timeline",
    "title": "Potential performance regression in neovim 0.10.x ",
    "updated_at": "2023-09-06T06:53:31Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/25031",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
        "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
        "followers_url": "https://api.github.com/users/wookayin/followers",
        "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
        "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/wookayin",
        "id": 1009873,
        "login": "wookayin",
        "node_id": "MDQ6VXNlcjEwMDk4NzM=",
        "organizations_url": "https://api.github.com/users/wookayin/orgs",
        "received_events_url": "https://api.github.com/users/wookayin/received_events",
        "repos_url": "https://api.github.com/users/wookayin/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/wookayin"
    }
}