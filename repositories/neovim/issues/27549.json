{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nI'm trying to define a \"wrapper\" on text objects as a prefix that modifies the normal range/behavior of any text object. For this I am setting `vim.o.operatorfunc`, to a callback and then executing `g@` to get the text object's range. For example, here is a module `jump-textobj.lua` that defines mappings to jump to the start/end of text objects in normal mode, and which should also work as expected in operator-pending mode:\r\n```lua\r\nlocal M = {}\r\n\r\nM._jump = function(dir)\r\n  return function (_)\r\n    local spos, epos = vim.api.nvim_buf_get_mark(0, '['), vim.api.nvim_buf_get_mark(0, ']')\r\n\r\n    if vim.fn.mode():find(\"o\") ~= nil then\r\n      vim.cmd.normal { \"v\", bang = true }\r\n    end\r\n\r\n    if dir == \"start\" then\r\n      vim.api.nvim_win_set_cursor(0, spos)\r\n    else\r\n      vim.api.nvim_win_set_cursor(0, epos)\r\n    end\r\n  end\r\nend\r\n\r\nM.jump = function (dir)\r\n  vim.o.operatorfunc = (\"v:lua.require'jump-textobj'._jump'%s'\"):format(dir)\r\n  vim.fn.feedkeys \"g@\"\r\nend\r\n\r\nvim.keymap.set({\"n\", \"o\"}, \"<c-l>\", [[<cmd>lua require\"jump-textobj\".jump(\"end\")<CR>]])\r\nvim.keymap.set({\"n\", \"o\"}, \"<c-h>\", [[<cmd>lua require\"jump-textobj\".jump(\"start\")<CR>]])\r\n\r\nreturn M\r\n\r\n```\r\nThis only works well in normal mode. With operator-pending mode, something like `d<c-h>ap` doesn't delete until the beginning of the next paragraph, it just has the same effect as in normal mode. In this case, it seems that the \"second layer\" of operator-pending mode overrides the first one, so the initial `d` is forgotten and we have exited operator-pending mode by the time we enter `_jump`. If I replace the contents of `M.jump` with the contents of the inner function of `M._jump` (and fix `spos` and `epos`), it works as expected, leading me to believe that the extra layer of operator-pending mode introduced by `g@` is responsible for the issue.\r\n\r\nI suppose this behavior may be \"expected\" as of now in some sense, but I think that it would be nice for operator-pending mode to \"nest\" operators in some way.\r\n\r\n### Steps to reproduce\r\n\r\nLoad the module `jump-textobj.lua` above and edit the file:\r\n```\r\ntext1\r\ntext2\r\ntext3\r\n\r\ntext4\r\ntext5\r\ntext6\r\n```\r\n\r\nWith the cursor on \"text1\", do `d<c-l>ap`. Notice that the cursor jumps to the newline without deleting anything. I know this is a silly example because you could just do `d}` instead, but I couldn't find any interesting built-in text objects -- really, I wanted to use this with a plugin like [nvim-various-textobjs](https://github.com/chrisgrieser/nvim-various-textobjs).\r\n\r\n### Expected behavior\r\n\r\n`d<c-l>ap` should have the same effect as `d}`.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.9.5\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nYes, I think so -- I don't have vim installed and I'm not familiar enough with vimscript to test but I assume this issue originates from vim\r\n\r\n### Operating system/version\r\n\r\nUbuntu 22.04.3\r\n\r\n### Terminal name/version\r\n\r\nAlacritty 0.13.1\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nbuild from repo",
    "closed_at": "2024-02-20T11:39:47Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> I think that it would be nice for operator-pending mode to \"nest\" operators in some way.\r\n\r\nðŸ‘€ ",
            "created_at": "2024-02-20T11:29:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/27549#issuecomment-1954017341",
            "id": 1954017341,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27549",
            "node_id": "IC_kwDOAPphoM50d_A9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954017341/reactions"
            },
            "updated_at": "2024-02-20T11:29:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954017341",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`g@` is an operator, not a motion, and you cannot use any other operator in operator-pending mode either.",
            "created_at": "2024-02-20T11:29:58Z",
            "html_url": "https://github.com/neovim/neovim/issues/27549#issuecomment-1954018702",
            "id": 1954018702,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27549",
            "node_id": "IC_kwDOAPphoM50d_WO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954018702/reactions"
            },
            "updated_at": "2024-02-20T11:30:28Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954018702",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "\"nesting\" implies submodes, let's file this under https://github.com/neovim/neovim/issues/16313",
            "created_at": "2024-02-20T11:39:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/27549#issuecomment-1954035088",
            "id": 1954035088,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27549",
            "node_id": "IC_kwDOAPphoM50eDWQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954035088/reactions"
            },
            "updated_at": "2024-02-20T11:39:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954035088",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> `g@` is an operator, not a motion, and you cannot use any other operator in operator-pending mode either.\r\n\r\nI guess I thought of `g@` as more of a \"register callback on immediately following text object\" action, I suppose that when typed, it would indeed be an operator but I wonder if it would be possible to expose this as a proper api function of its own, something like `vim.api.nvim_register_motion_callback(cb)`? This would solve this problem and also possibly allow you to combine multiple operators, like `>zfip` to indent and fold the current paragraph (if we were to wrap existing operators such that they allow additional operators to follow, with the innermost callback applying all of them to the given text object).\r\n\r\nSo, in this case, it could be a lot easier to implement than as a submode. If that sounds reasonable I can make a separate feature request for it.",
            "created_at": "2024-02-20T14:40:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/27549#issuecomment-1954358574",
            "id": 1954358574,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27549",
            "node_id": "IC_kwDOAPphoM50fSUu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954358574/reactions"
            },
            "updated_at": "2024-02-20T14:40:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1954358574",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/14950617?v=4",
                "events_url": "https://api.github.com/users/rish987/events{/privacy}",
                "followers_url": "https://api.github.com/users/rish987/followers",
                "following_url": "https://api.github.com/users/rish987/following{/other_user}",
                "gists_url": "https://api.github.com/users/rish987/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rish987",
                "id": 14950617,
                "login": "rish987",
                "node_id": "MDQ6VXNlcjE0OTUwNjE3",
                "organizations_url": "https://api.github.com/users/rish987/orgs",
                "received_events_url": "https://api.github.com/users/rish987/received_events",
                "repos_url": "https://api.github.com/users/rish987/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rish987/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rish987/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rish987"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27549/comments",
    "created_at": "2024-02-20T10:11:19Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27549/events",
    "html_url": "https://github.com/neovim/neovim/issues/27549",
    "id": 2144015151,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "upstream issue that needs to be fixed in vim first",
            "id": 2639399975,
            "name": "needs:vim-patch",
            "node_id": "MDU6TGFiZWwyNjM5Mzk5OTc1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:vim-patch"
        },
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as duplicates of other issues",
            "id": 3221613764,
            "name": "closed:duplicate",
            "node_id": "MDU6TGFiZWwzMjIxNjEzNzY0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27549/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 215,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Zero priority; no timeline. Promote an item from this state by taking ownership of it.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 235,
        "state": "open",
        "title": "unplanned",
        "updated_at": "2024-02-20T11:39:48Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM5_yxMv",
    "number": 27549,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27549/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27549/timeline",
    "title": "`g@` cancels previous operator",
    "updated_at": "2024-02-20T14:40:37Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27549",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/14950617?v=4",
        "events_url": "https://api.github.com/users/rish987/events{/privacy}",
        "followers_url": "https://api.github.com/users/rish987/followers",
        "following_url": "https://api.github.com/users/rish987/following{/other_user}",
        "gists_url": "https://api.github.com/users/rish987/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/rish987",
        "id": 14950617,
        "login": "rish987",
        "node_id": "MDQ6VXNlcjE0OTUwNjE3",
        "organizations_url": "https://api.github.com/users/rish987/orgs",
        "received_events_url": "https://api.github.com/users/rish987/received_events",
        "repos_url": "https://api.github.com/users/rish987/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/rish987/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/rish987/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/rish987"
    }
}