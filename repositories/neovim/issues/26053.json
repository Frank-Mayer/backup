{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nIf nvim (or OS) has crashed, nvim won't be able to rewrite UNIX socket file with the same path as before, so client that expects this socket to be valid can't use it anymore.\r\n\r\nNeovim complains `Failed to start server: address already in use` in this case (which is false, because `nvim --remote-send` reports `E247: Failed to connect to '/tmp/test.sock': connection refused. Send failed.`).\r\n\r\nI've got a dirty [workaround](https://github.com/alopatindev/cargo-limit/blob/b7b66e7cda58ac818d5570a35e96040dcfcbf4a2/plugin/cargo-limit.vim#L139-L159) that **works on GNU/Linux and macOS**, it'd be great if Neovim behaved something like that out of the box (instead of having _this_ implemented in other plugins in future).\r\n\r\n### Steps to reproduce\r\n\r\n0. `rm -f /tmp/test.sock`\r\n1. Run `nvim --clean`, `:call serverstart('/tmp/test.sock')`\r\n2. In the other terminal: `nvim --clean --headless --server /tmp/test.sock --remote-send '<Esc>:echo \"hello\"<Enter>'` and then `killall -9 nvim`\r\n3. Run `nvim --clean` again, `:call serverstart('/tmp/test.sock')`\r\n4. In the other terminal run `nvim --clean` again, `:call serverstart('/tmp/test.sock')`\r\n5. In the other terminal: `nvim --clean --headless --server /tmp/test.sock --remote-send '<Esc>:echo \"world\"<Enter>'`\r\n\r\n\r\n### Expected behavior\r\n\r\n- Neovim instance **from step 3** should rewrite the socket file **if nobody actually listens** to it and **should print \"world\"** (this step currently fails with `Failed to start server: address already in use`)\r\n- Neovim instance **from step 4** shouldn't rewrite the socket file (since it's already been listened) and **should not print \"world\"** (this works as expected)\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.9.2\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNot applicable: `E117: Unknown function: serverstart`\r\n\r\n### Operating system/version\r\n\r\nGentoo GNU/Linux\r\n\r\n### Terminal name/version\r\n\r\nwezterm\r\n\r\n### $TERM environment variable\r\n\r\ntmux-256color\r\n\r\n### Installation\r\n\r\nGentoo Portage",
    "closed_at": "2024-09-09T10:49:57Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Currently `serverstart` seems to be [implemented using libuv](https://github.com/neovim/neovim/blob/d92dd2a0c05148154c353f0e7cd2099b2427308a/src/nvim/event/socket.c#L113).\r\n\r\nI'm not familiar with libuv. Does it support UNIX socket state querying? I don't see that from [the documentation](https://docs.libuv.org/en/v1.x/pipe.html).\r\n\r\nIf it does â€” I believe all we need to do is check whether existing socket file is not in the `LISTEN` state and then remove it.\r\n\r\nOtherwise some other API is likely unavoidable if we want to fix this issue this way.\r\n\r\nOtherwise we could simply make connection attempt to existing socket file and remove it if connection was refused.\r\n",
            "created_at": "2023-11-15T21:05:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/26053#issuecomment-1813260697",
            "id": 1813260697,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26053",
            "node_id": "IC_kwDOAPphoM5sFCmZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1813260697/reactions"
            },
            "updated_at": "2023-11-15T21:10:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1813260697",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/415408?v=4",
                "events_url": "https://api.github.com/users/alopatindev/events{/privacy}",
                "followers_url": "https://api.github.com/users/alopatindev/followers",
                "following_url": "https://api.github.com/users/alopatindev/following{/other_user}",
                "gists_url": "https://api.github.com/users/alopatindev/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alopatindev",
                "id": 415408,
                "login": "alopatindev",
                "node_id": "MDQ6VXNlcjQxNTQwOA==",
                "organizations_url": "https://api.github.com/users/alopatindev/orgs",
                "received_events_url": "https://api.github.com/users/alopatindev/received_events",
                "repos_url": "https://api.github.com/users/alopatindev/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alopatindev/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alopatindev/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alopatindev"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "# Status\r\n\r\nhttps://github.com/neovim/neovim/pull/30237 added validation to `--listen`, so now Nvim will fail to start if the listen address is invalid. However, the request in this issue makes sense and is not yet implemented.\r\n\r\n> Otherwise we could simply make connection attempt to existing socket file and remove it if connection was refused.\r\n\r\nThat seems reasonable, at least as a first pass. Let's use https://github.com/neovim/neovim/issues/30123 to track this, I added your notes there.\r\n",
            "created_at": "2024-09-09T10:49:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/26053#issuecomment-2337783215",
            "id": 2337783215,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26053",
            "node_id": "IC_kwDOAPphoM6LV72v",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2337783215/reactions"
            },
            "updated_at": "2024-09-09T10:52:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2337783215",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26053/comments",
    "created_at": "2023-11-15T18:09:02Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26053/events",
    "html_url": "https://github.com/neovim/neovim/issues/26053",
    "id": 1995283203,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c7def8",
            "default": false,
            "description": "channels, RPC, msgpack",
            "id": 242522707,
            "name": "channels-rpc",
            "node_id": "MDU6TGFiZWwyNDI1MjI3MDc=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/channels-rpc"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 406104372,
            "name": "server",
            "node_id": "MDU6TGFiZWw0MDYxMDQzNzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/server"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "Nvim startup sequence (`:h startup`)",
            "id": 870629450,
            "name": "startup",
            "node_id": "MDU6TGFiZWw4NzA2Mjk0NTA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/startup"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26053/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM527ZsD",
    "number": 26053,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26053/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26053/timeline",
    "title": "Neovim can't recreate UNIX socket after SIGKILL",
    "updated_at": "2024-09-09T10:53:09Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26053",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/415408?v=4",
        "events_url": "https://api.github.com/users/alopatindev/events{/privacy}",
        "followers_url": "https://api.github.com/users/alopatindev/followers",
        "following_url": "https://api.github.com/users/alopatindev/following{/other_user}",
        "gists_url": "https://api.github.com/users/alopatindev/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/alopatindev",
        "id": 415408,
        "login": "alopatindev",
        "node_id": "MDQ6VXNlcjQxNTQwOA==",
        "organizations_url": "https://api.github.com/users/alopatindev/orgs",
        "received_events_url": "https://api.github.com/users/alopatindev/received_events",
        "repos_url": "https://api.github.com/users/alopatindev/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/alopatindev/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alopatindev/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/alopatindev"
    }
}