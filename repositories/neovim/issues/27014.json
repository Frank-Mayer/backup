{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nI've found that there are some tree-sitter force-enablements for some filetypes in master.\r\n(actually, I was just triggered today by `lua` one, enforced on 1st January, and found `help` and `query` while investigated).\r\n\r\nUnfortunatelly, we're on Gentoo build neovim without any bundles (and also fetching deps during build is against packaging guidelines), so we're on \"provide all dependencies yourself\" path.\r\n\r\nIt works for pretty all nvim dependencies, but has an issue with tree-sitter grammars.\r\n\r\nWe're installing it as `/usr/${libdir}/libtree-sitter-${name}.so` (and it seems pretty all tree-sitter using software that we have packaged (and it seems like even emacsers) are using tree-sitter parsers by those paths.\r\n\r\nBut NeoVim expects them as `/usr/${libdir}/nvim/parser/${name}.so`.\r\n(Well, actually it expects them at `&runtimepath/parser/${name}.so`, but `/usr/${libdir}/nvim`, as far as I see, is the path your buildsystem uses to install them when buildtime fetching enabled).\r\n\r\nSo, as nvim can't find the grammars, it fails (even `nvim --clean`) on startup when opening corresponding files (at least, I reproduced on `lua` and `help`).\r\n\r\n\r\nSo, when we discussed about the ways of solving that issue, we decided to firstly ask if it is possible to add alternative search paths (and naming) on your side?\r\nMaybe we can collaborate on PR for that, if you don't mind?\r\n\r\n\r\nAlthough, I just found that alpine [packages](https://pkgs.alpinelinux.org/contents?branch=edge&name=tree%2dsitter%2dlua&arch=x86_64&repo=community) tree-sitter grammars at two path simultaneously: `/usr/${libdir}/libtree-sitter-${name}.so` (as we do) and `/usr/${libdir}/tree-sitter/${name}.so`, which seems like compatible with nvim's behaviour, and it will probably be enough to symlink `/usr/${libdir}/tree-sitter` to `/usr/${libdir}/nvim/parser`. What do you think about that way?\r\n\r\n\r\nThanks in advance!\n\n### Expected behavior\n\n[not relevant]",
    "closed_at": "2024-01-24T12:30:00Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "You can already use alternative search paths: just put them on runtimepath. Be mindful that you respect the ordering for the corresponding (compatible) queries. \n\nThe current defaults are finely tuned to support plugins and users overriding the bundled parsers and queries and will not be changed. \n\nOfficially, parsers (in the exact version and revision specified) are now part of the bundled runtime, and a build without them is considered broken. ",
            "created_at": "2024-01-15T08:03:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/27014#issuecomment-1891519431",
            "id": 1891519431,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27014",
            "node_id": "IC_kwDOAPphoM5wvkvH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1891519431/reactions"
            },
            "updated_at": "2024-01-15T08:03:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1891519431",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "So, yes, the symlink way is the right way. But again, make sure that you put there the exact revision specified in our build script; queries expect a certain revision and are not guaranteed to be compatible with others. (This is not a theoretical issue.)\n\nWhile we try to stick to tagged versions for our releases, nightly is free to make use of prerelease commits. \n\nIt's also not safe to assume that different editors target the same parser version (and this is impossible to check at runtime). \n\n**TL;DR:** Neovim intentionally does not support using system-installed parsers since we have no control over them. This will not change until tree-sitter adds support for parser version and introspection. ",
            "created_at": "2024-01-15T08:10:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/27014#issuecomment-1891529127",
            "id": 1891529127,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27014",
            "node_id": "IC_kwDOAPphoM5wvnGn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1891529127/reactions"
            },
            "updated_at": "2024-01-15T08:32:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1891529127",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27014/comments",
    "created_at": "2024-01-15T01:53:29Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27014/events",
    "html_url": "https://github.com/neovim/neovim/issues/27014",
    "id": 2081104446,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "funtime",
            "id": 120251370,
            "name": "runtime",
            "node_id": "MDU6TGFiZWwxMjAyNTEzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/runtime"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27014/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM58CyI-",
    "number": 27014,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27014/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27014/timeline",
    "title": "[feat] improve tree-sitter parsers search logic",
    "updated_at": "2024-01-24T12:30:00Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27014",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
        "events_url": "https://api.github.com/users/msva/events{/privacy}",
        "followers_url": "https://api.github.com/users/msva/followers",
        "following_url": "https://api.github.com/users/msva/following{/other_user}",
        "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/msva",
        "id": 268102,
        "login": "msva",
        "node_id": "MDQ6VXNlcjI2ODEwMg==",
        "organizations_url": "https://api.github.com/users/msva/orgs",
        "received_events_url": "https://api.github.com/users/msva/received_events",
        "repos_url": "https://api.github.com/users/msva/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/msva"
    }
}