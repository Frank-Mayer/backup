{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "@tarruda some time ago I asked a question about the possibility of `alloc_cb(); alloc_cb(); read_cb(); read_cb()` occurring on Windows: https://groups.google.com/forum/#!topic/libuv/OD38PeGeVgQ\n\nThis answer is enlightening:\n\n```\nE.g. this could happen: \n\n> > alloc_cb(handle1); \n> > alloc_cb(handle2); \n> > read_cb(handle1); \n> > read_cb(handle2); \n\nBut this isn't: \n\n> > alloc_cb(handle1); \n> > alloc_cb(handle1); \n> > read_cb(handle1); \n> > read_cb(handle1); \n```\n\nWhile reading `rstreamc.`, I see:\n\n``` c\n// Called by libuv to allocate memory for reading.\nstatic void alloc_cb(uv_handle_t *handle, size_t suggested, uv_buf_t *buf)\n{\n  RStream *rstream = handle_get_rstream(handle);\n\n  if (rstream->reading) {\n    buf->len = 0;\n    return;\n  }\n\n  buf->len = rstream->buffer_size - rstream->wpos;\n  buf->base = rstream->buffer + rstream->wpos;\n\n  // Avoid `alloc_cb`, `alloc_cb` sequences on windows\n  rstream->reading = true;\n}\n```\n\nIt seems like the `rstream->reading` thing is not necessary, even on Windows. The reason being that each stream has a 1-to-1 correspondance with a libuv handle, and `alloc_cb(handle1); alloc_cb(handle1);` can never happen.\n\nThere _would_ be a problem if we were reusing the same `rstream->buffer` for all streams though. As far as I can see, we don't though.\n",
    "closed_at": "2014-07-27T17:02:07Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/189413?v=4",
        "events_url": "https://api.github.com/users/aktau/events{/privacy}",
        "followers_url": "https://api.github.com/users/aktau/followers",
        "following_url": "https://api.github.com/users/aktau/following{/other_user}",
        "gists_url": "https://api.github.com/users/aktau/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/aktau",
        "id": 189413,
        "login": "aktau",
        "node_id": "MDQ6VXNlcjE4OTQxMw==",
        "organizations_url": "https://api.github.com/users/aktau/orgs",
        "received_events_url": "https://api.github.com/users/aktau/received_events",
        "repos_url": "https://api.github.com/users/aktau/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/aktau/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/aktau/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/aktau"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "I added this guard is because @saghul mentioned(or I misunderstood) that sequential calls to `alloc_cb` might happen for the same stream on windows.\n",
            "created_at": "2014-07-22T09:48:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/980#issuecomment-49718513",
            "id": 49718513,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/980",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzE4NTEz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718513/reactions"
            },
            "updated_at": "2014-07-22T09:48:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718513",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/842846?v=4",
                "events_url": "https://api.github.com/users/tarruda/events{/privacy}",
                "followers_url": "https://api.github.com/users/tarruda/followers",
                "following_url": "https://api.github.com/users/tarruda/following{/other_user}",
                "gists_url": "https://api.github.com/users/tarruda/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/tarruda",
                "id": 842846,
                "login": "tarruda",
                "node_id": "MDQ6VXNlcjg0Mjg0Ng==",
                "organizations_url": "https://api.github.com/users/tarruda/orgs",
                "received_events_url": "https://api.github.com/users/tarruda/received_events",
                "repos_url": "https://api.github.com/users/tarruda/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/tarruda/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/tarruda/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/tarruda"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I added this guard is because @saghul mentioned(or I misunderstood) that sequential calls to alloc_cb might happen for the same stream on windows.\n\nDo you remember where he said it? I'd like to know for sure too.\n",
            "created_at": "2014-07-22T09:50:14Z",
            "html_url": "https://github.com/neovim/neovim/issues/980#issuecomment-49718676",
            "id": 49718676,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/980",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzE4Njc2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718676/reactions"
            },
            "updated_at": "2014-07-22T09:50:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718676",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/189413?v=4",
                "events_url": "https://api.github.com/users/aktau/events{/privacy}",
                "followers_url": "https://api.github.com/users/aktau/followers",
                "following_url": "https://api.github.com/users/aktau/following{/other_user}",
                "gists_url": "https://api.github.com/users/aktau/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/aktau",
                "id": 189413,
                "login": "aktau",
                "node_id": "MDQ6VXNlcjE4OTQxMw==",
                "organizations_url": "https://api.github.com/users/aktau/orgs",
                "received_events_url": "https://api.github.com/users/aktau/received_events",
                "repos_url": "https://api.github.com/users/aktau/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/aktau/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aktau/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/aktau"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I added this guard is because @saghul mentioned(or I misunderstood) that sequential calls to alloc_cb might happen for the same stream on windows.\n\nNot for the same stream, just for different streams.\n",
            "created_at": "2014-07-22T09:53:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/980#issuecomment-49718935",
            "id": 49718935,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/980",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzE4OTM1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718935/reactions"
            },
            "updated_at": "2014-07-22T09:53:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49718935",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/317464?v=4",
                "events_url": "https://api.github.com/users/saghul/events{/privacy}",
                "followers_url": "https://api.github.com/users/saghul/followers",
                "following_url": "https://api.github.com/users/saghul/following{/other_user}",
                "gists_url": "https://api.github.com/users/saghul/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/saghul",
                "id": 317464,
                "login": "saghul",
                "node_id": "MDQ6VXNlcjMxNzQ2NA==",
                "organizations_url": "https://api.github.com/users/saghul/orgs",
                "received_events_url": "https://api.github.com/users/saghul/received_events",
                "repos_url": "https://api.github.com/users/saghul/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/saghul/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/saghul/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/saghul"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Not for the same stream, just for different streams.\n\nPerfect, then we can remove a couple of lines. I'll do it in my PR close to the commit that increases the buffer size. (and thanks @saghul!)\n",
            "created_at": "2014-07-22T09:57:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/980#issuecomment-49719303",
            "id": 49719303,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/980",
            "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzE5MzAz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49719303/reactions"
            },
            "updated_at": "2014-07-22T09:57:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/49719303",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/189413?v=4",
                "events_url": "https://api.github.com/users/aktau/events{/privacy}",
                "followers_url": "https://api.github.com/users/aktau/followers",
                "following_url": "https://api.github.com/users/aktau/following{/other_user}",
                "gists_url": "https://api.github.com/users/aktau/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/aktau",
                "id": 189413,
                "login": "aktau",
                "node_id": "MDQ6VXNlcjE4OTQxMw==",
                "organizations_url": "https://api.github.com/users/aktau/orgs",
                "received_events_url": "https://api.github.com/users/aktau/received_events",
                "repos_url": "https://api.github.com/users/aktau/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/aktau/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/aktau/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/aktau"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/980/comments",
    "created_at": "2014-07-22T09:26:59Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/980/events",
    "html_url": "https://github.com/neovim/neovim/issues/980",
    "id": 38382876,
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "changes that are not features or bugfixes",
            "id": 106949155,
            "name": "refactor",
            "node_id": "MDU6TGFiZWwxMDY5NDkxNTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/refactor"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/980/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWUzODM4Mjg3Ng==",
    "number": 980,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/980/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/980/timeline",
    "title": "possible rstream simplification",
    "updated_at": "2024-09-04T14:02:26Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/980",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/189413?v=4",
        "events_url": "https://api.github.com/users/aktau/events{/privacy}",
        "followers_url": "https://api.github.com/users/aktau/followers",
        "following_url": "https://api.github.com/users/aktau/following{/other_user}",
        "gists_url": "https://api.github.com/users/aktau/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/aktau",
        "id": 189413,
        "login": "aktau",
        "node_id": "MDQ6VXNlcjE4OTQxMw==",
        "organizations_url": "https://api.github.com/users/aktau/orgs",
        "received_events_url": "https://api.github.com/users/aktau/received_events",
        "repos_url": "https://api.github.com/users/aktau/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/aktau/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/aktau/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/aktau"
    }
}