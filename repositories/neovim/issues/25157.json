{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nI'm not too familiar with how to get a stack trace and/or attach a debugger, but the repro should be reliable.\r\n\r\nI suspect this has to do with the edge case of updating multiple locations at once. Though I'm not sure what the role of the LSP is (I suppose it's just for creating extmarks and it's probably possible to reproduce without LSP).\r\n\r\nI'm using `RelWithDebInfo`.\r\n\r\nBisected #13243 @bfredl \r\n\r\n### Steps to reproduce\r\n\r\n1. Checkout https://github.com/llllvvuu/neovim/tree/25155-repro\r\n2. `nvim --noplugin --clean -u minimal.lua runtime/lua/vim/shared.lua`, where `minimal.lua` is:\r\n```lua\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = { 'lua' },\r\n  callback = function()\r\n    vim.lsp.start({\r\n      name = 'lua_ls',\r\n      cmd = {'lua-language-server'},\r\n      root_dir = vim.fs.dirname(vim.fs.find({'.git', '.luacheckrc' }, { upward = true })[1]),\r\n    })\r\n  end,\r\n})\r\n```\r\n3. Try to do: `/Node<CR>V3j:s/Node/Tree`. Neovim should crash when you type the first letter of \"Tree\".\r\n\r\n### Expected behavior\r\n\r\nWhether or not the LSP is proper or malformed, Neovim should handle it gracefully.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-1089+g1c4a93b59\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNVIM v0.10.0-dev-1089+g1c4a93b59\r\n\r\n### Operating system/version\r\n\r\n13.4.1\r\n\r\n### Terminal name/version\r\n\r\nkitty 0.28.1\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuild from repo ",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25157/comments",
    "created_at": "2023-09-14T13:14:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/25157/events",
    "html_url": "https://github.com/neovim/neovim/issues/25157",
    "id": 1896553942,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains minimal reproducing steps",
            "id": 435851959,
            "name": "has:repro",
            "node_id": "MDU6TGFiZWw0MzU4NTE5NTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:repro"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/25157/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 129,
        "created_at": "2023-02-02T14:11:43Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
            "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
            "followers_url": "https://api.github.com/users/bfredl/followers",
            "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
            "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/bfredl",
            "id": 1363104,
            "login": "bfredl",
            "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
            "organizations_url": "https://api.github.com/users/bfredl/orgs",
            "received_events_url": "https://api.github.com/users/bfredl/received_events",
            "repos_url": "https://api.github.com/users/bfredl/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/bfredl"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/36",
        "id": 8997654,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/36/labels",
        "node_id": "MI_kwDOAPphoM4AiUsW",
        "number": 36,
        "open_issues": 143,
        "state": "open",
        "title": "0.10",
        "updated_at": "2023-09-14T21:29:51Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/36"
    },
    "node_id": "I_kwDOAPphoM5xCx3W",
    "number": 25157,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/25157/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/25157/timeline",
    "title": "bug: `:%s/` can crash Neovim with `lua-language-server` after #13243",
    "updated_at": "2023-09-14T16:37:38Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/25157",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5601392?v=4",
        "events_url": "https://api.github.com/users/llllvvuu/events{/privacy}",
        "followers_url": "https://api.github.com/users/llllvvuu/followers",
        "following_url": "https://api.github.com/users/llllvvuu/following{/other_user}",
        "gists_url": "https://api.github.com/users/llllvvuu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/llllvvuu",
        "id": 5601392,
        "login": "llllvvuu",
        "node_id": "MDQ6VXNlcjU2MDEzOTI=",
        "organizations_url": "https://api.github.com/users/llllvvuu/orgs",
        "received_events_url": "https://api.github.com/users/llllvvuu/received_events",
        "repos_url": "https://api.github.com/users/llllvvuu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/llllvvuu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/llllvvuu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/llllvvuu"
    }
}