{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen enabling `inlay_hints` on `LspAttach`, the hints are not shown on text already on screen. Scrolling and revealing more text does show inlay hints in the \"new\" text. Toggling inlay hints on and off fixes the \"stuck\" lines and show inlay hints there too. If the file is small enough and you scroll through all of it/can see all of it, no inlay hints will be displayed.\r\n\r\nBasically any text seen between `LspAttach` being fired and the lsp server being ready to provide hints causes the \"seen\" text to not show inlay hints until they are toggled. My assumption is that some caching is being done, but before the lsp is ready to send hints it says there are no hints. Then, once it is ready, this cache is not invalidated.\n\n### Steps to reproduce\n\n<details><summary><code>minimal_init.lua</code></summary>\r\n\r\n```lua\r\nlocal pattern = 'rust'\r\nlocal cmd = {'rust-analyzer'}\r\nlocal root_markers = {'.git', '.editorconfig', 'Cargo.toml'}\r\nlocal settings = vim.empty_dict()\r\n\r\n\r\nvim.api.nvim_create_autocmd(\"LspAttach\", {\r\n  callback = function(args)\r\n    local bufnr = args.buf\r\n    local client = vim.lsp.get_client_by_id(args.data.client_id)\r\n    if client.server_capabilities.inlayHintProvider then\r\n      vim.lsp.inlay_hint.enable(bufnr, true)\r\n    end\r\n  end,\r\n})\r\n\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'bugged-ls',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings\r\n    })\r\n  end\r\n})\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>Asciicast recording of the bug</summary>\r\n\r\n[![asciicast of bug report](https://asciinema.org/a/626154.svg)](https://asciinema.org/a/626154)\r\n\r\n</details>\r\n\r\n1. Open a rust project (may work with other servers providing inlay hints?) using `minimal_init.lua` (`nvim --clean -u minimal_init.lua src/main.rs`)\r\n2. Wait for `rust-analyzer` to finish starting\r\n3. Verify that everything on screen which should have inlay hints doesn't\r\n4. Scroll down to see that uncovered text does have inlay hints\r\n5. Toggle inlay hints (`:lua vim.lsp.inlay_hint.enable(0, false)`, `:lua vim.lsp.inlay_hint.enable(0, true)`)\r\n6. Verify that inlay hints are now properly shown\n\n### Expected behavior\n\nInlay hints should be drawn on displayed text once they become available.\r\n\r\nMy guess is that the same event that causes the syntax highlighting to be redrawn (see asciicast recording at 18s), should also be used to re-request inlay hints (invalidate hint cache(?)).\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0-dev-096211a\n\n### Vim (not Nvim) behaves the same?\n\nnot applicable\n\n### Operating system/version\n\nNixOS 24.05.20231204.2c7f3c0\n\n### Terminal name/version\n\nwezterm 20230712-072601-f4abf8fd\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nnix nix-community/neovim-nightly-overlay",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Tested with todays nightly and it is still there. \r\n\r\nThis issue creates a quite confusing behavior, basically rendering it unusable for rust development where inlay hints are quite important. ",
            "created_at": "2024-01-04T14:37:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/26511#issuecomment-1877200081",
            "id": 1877200081,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26511",
            "node_id": "IC_kwDOAPphoM5v48zR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1877200081/reactions"
            },
            "updated_at": "2024-01-04T14:37:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1877200081",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6420639?v=4",
                "events_url": "https://api.github.com/users/snaggen/events{/privacy}",
                "followers_url": "https://api.github.com/users/snaggen/followers",
                "following_url": "https://api.github.com/users/snaggen/following{/other_user}",
                "gists_url": "https://api.github.com/users/snaggen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/snaggen",
                "id": 6420639,
                "login": "snaggen",
                "node_id": "MDQ6VXNlcjY0MjA2Mzk=",
                "organizations_url": "https://api.github.com/users/snaggen/orgs",
                "received_events_url": "https://api.github.com/users/snaggen/received_events",
                "repos_url": "https://api.github.com/users/snaggen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/snaggen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/snaggen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/snaggen"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26511/comments",
    "created_at": "2023-12-10T17:39:10Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26511/events",
    "html_url": "https://github.com/neovim/neovim/issues/26511",
    "id": 2034465120,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26511/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM55Q3lg",
    "number": 26511,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26511/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26511/timeline",
    "title": "Inlay Hints not drawn once they are provided",
    "updated_at": "2024-01-04T14:37:39Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26511",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/60845989?v=4",
        "events_url": "https://api.github.com/users/jalil-salame/events{/privacy}",
        "followers_url": "https://api.github.com/users/jalil-salame/followers",
        "following_url": "https://api.github.com/users/jalil-salame/following{/other_user}",
        "gists_url": "https://api.github.com/users/jalil-salame/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jalil-salame",
        "id": 60845989,
        "login": "jalil-salame",
        "node_id": "MDQ6VXNlcjYwODQ1OTg5",
        "organizations_url": "https://api.github.com/users/jalil-salame/orgs",
        "received_events_url": "https://api.github.com/users/jalil-salame/received_events",
        "repos_url": "https://api.github.com/users/jalil-salame/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jalil-salame/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jalil-salame/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jalil-salame"
    }
}