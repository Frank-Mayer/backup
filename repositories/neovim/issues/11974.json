{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I'd like to force `nvim` to use only the basic 16 ANSI colors, regardless of what it detects in the `TERM` or `COLORTERM` environment variables or wherever else it is looking. The reason is that I plan to use the same config on multiple machines, including various combinations of tmux, SSH, etc, and I will configure the actual color values in my terminal emulator.\r\n\r\nThe following code is the only place `t_colors` is set that I can see, and I can't find a way to override it:\r\n\r\nhttps://github.com/neovim/neovim/blob/96059d72e539c0a23c1f7a24290f35247ff01749/src/nvim/tui/tui.c#L292-L293\r\n\r\nIn `vim` you can do this using: `set t_Co=16`\r\n\r\nBut in `nvim` this seems to have no effect (or crashes, see below).\r\n\r\nI've also tried `TERM= COLORTERM= nvim` which doesn't change anything, nvim is still using 256 colors.\r\n\r\nI can actually get a segfault by playing with this also, here are the steps:\r\n\r\n1. Launch `nvim`\r\n2. Run `:set t_Co=16`\r\n3. Press Ctrl+Z to suspend\r\n4. Type `fg` to resume\r\n5. Observe `Segmentation fault` (without Step 2 this does not happen).",
    "closed_at": "2020-03-03T06:47:58Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "Some missing info above, though I don't think it'll be super relevant here:\r\n\r\n- `nvim --version`: NVIM v0.4.3 - Build type: RelWithDebInfo\r\n- `vim -u DEFAULTS` (version: 7.x, 8.0) behaves differently? - yes, `vim` allows setting `&t_Co` at runtime\r\n- Operating system/version: Linux 5.3.0 x86_64 (Debian-based)\r\n- Terminal name/version: xfce4-terminal v0.8.3\r\n- `$TERM`: the default value on my system is `xterm-256color` but multiple values attempted, see first post",
            "created_at": "2020-03-03T04:19:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/11974#issuecomment-593759906",
            "id": 593759906,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5Mzc1OTkwNg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/593759906/reactions"
            },
            "updated_at": "2020-03-03T04:50:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/593759906",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/227022?v=4",
                "events_url": "https://api.github.com/users/nylen/events{/privacy}",
                "followers_url": "https://api.github.com/users/nylen/followers",
                "following_url": "https://api.github.com/users/nylen/following{/other_user}",
                "gists_url": "https://api.github.com/users/nylen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nylen",
                "id": 227022,
                "login": "nylen",
                "node_id": "MDQ6VXNlcjIyNzAyMg==",
                "organizations_url": "https://api.github.com/users/nylen/orgs",
                "received_events_url": "https://api.github.com/users/nylen/received_events",
                "repos_url": "https://api.github.com/users/nylen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nylen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nylen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nylen"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> The reason is that I plan to use the same config on multiple machines, including various combinations of tmux, SSH, etc, \r\n\r\n `t_Co=16` isn't needed for that. You can force your N/Vim colorscheme to use ANSI color indexes: \r\n\r\n    :highlight Comment ctermfg=Red\r\n\r\nThen changing ANSI \"red\" to some other color in your terminal, will color comments as such. Note that this requires `:set notermguicolors`.\r\n\r\nThe `t_xx` inner-platform is not supported. `:help t_xx`\r\n\r\n\r\n> 5\\. Observe `Segmentation fault` (without Step 2 this does not happen).\r\n\r\nIs `set t_Co=16` required to repro that? If that happens with  the [development version](https://github.com/neovim/neovim/releases) please open a new report including a [backtrace](https://github.com/neovim/neovim/wiki/FAQ#backtrace-linux).",
            "created_at": "2020-03-03T06:47:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/11974#issuecomment-593795588",
            "id": 593795588,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5Mzc5NTU4OA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/593795588/reactions"
            },
            "updated_at": "2020-03-03T06:50:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/593795588",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks for the info. You tagged this issue as a duplicate, but I wasn't able to find anything that is really the same (\"force downscaling to 16 colors\") on a quick search.\r\n\r\nI do see https://github.com/neovim/neovim/issues/5538 and https://github.com/neovim/neovim/issues/11883 which also discuss `t_Co` but not quite in the same way.\r\n\r\nI will test this further and report back, including setting a 16-color scheme such as https://github.com/noahfrederick/vim-noctu or https://github.com/jeffkreeftmeijer/vim-dim, and trying to reproduce the segfault in the latest development version.",
            "created_at": "2020-03-04T17:04:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/11974#issuecomment-594664744",
            "id": 594664744,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11974",
            "node_id": "MDEyOklzc3VlQ29tbWVudDU5NDY2NDc0NA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/594664744/reactions"
            },
            "updated_at": "2020-03-04T17:04:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/594664744",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/227022?v=4",
                "events_url": "https://api.github.com/users/nylen/events{/privacy}",
                "followers_url": "https://api.github.com/users/nylen/followers",
                "following_url": "https://api.github.com/users/nylen/following{/other_user}",
                "gists_url": "https://api.github.com/users/nylen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nylen",
                "id": 227022,
                "login": "nylen",
                "node_id": "MDQ6VXNlcjIyNzAyMg==",
                "organizations_url": "https://api.github.com/users/nylen/orgs",
                "received_events_url": "https://api.github.com/users/nylen/received_events",
                "repos_url": "https://api.github.com/users/nylen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nylen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nylen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nylen"
            }
        },
        {
            "author_association": "NONE",
            "body": "@nylen you can emulate t_Co with `ffi`:  `:lua f=require\"ffi\" f.cdef\"int t_colors\" f.C.t_colors=16`, credit to @ seandewar from #neovim:matrix.org",
            "created_at": "2023-07-31T14:18:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/11974#issuecomment-1658464993",
            "id": 1658464993,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11974",
            "node_id": "IC_kwDOAPphoM5i2irh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 1,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1658464993/reactions"
            },
            "updated_at": "2023-07-31T14:18:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1658464993",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/82109173?v=4",
                "events_url": "https://api.github.com/users/emivespa/events{/privacy}",
                "followers_url": "https://api.github.com/users/emivespa/followers",
                "following_url": "https://api.github.com/users/emivespa/following{/other_user}",
                "gists_url": "https://api.github.com/users/emivespa/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/emivespa",
                "id": 82109173,
                "login": "emivespa",
                "node_id": "MDQ6VXNlcjgyMTA5MTcz",
                "organizations_url": "https://api.github.com/users/emivespa/orgs",
                "received_events_url": "https://api.github.com/users/emivespa/received_events",
                "repos_url": "https://api.github.com/users/emivespa/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/emivespa/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/emivespa/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/emivespa"
            }
        },
        {
            "author_association": "NONE",
            "body": "> > The reason is that I plan to use the same config on multiple machines, including various combinations of tmux, SSH, etc,\r\n> \r\n> `t_Co=16` isn't needed for that. You can force your N/Vim colorscheme to use ANSI color indexes:\r\n> \r\n> ```\r\n> :highlight Comment ctermfg=Red\r\n> ```\r\n> @justinmk \r\n\r\nThere is a reason to force it, unfortunately. It's not a requirement to achieve the end product as an environment, but it is necessary in order to properly use color names in a colorscheme alongside the standard way of configuring a 16 color terminal.\r\n\r\nhttps://github.com/neovim/neovim/blob/5792546777332361a9ac49107e46149c703de90e/src/nvim/highlight_group.c#L802-L849\r\n\r\nCompiled into a table, you can see that if you have assigned your terminal colors to 0-15, as is standard for individual customization, 88-color and 256-color terminals will not all you to use all 16 of those colors by name, and you will be forced to either assign custom colors to higher indexes in your terminal, or reference these colors by index rather than name, which is a pain for both readability and portability (including as the consumer of colorschemes found online).\r\n```\r\n                    color_numbers_16[28]        color_numbers_88[28]        color_numbers_256[28]       color_numbers_8[28] \r\nBlack:              0,                          0,                          0,                          0,                  \r\nDarkBlue:           1,                          4,                          4,                          4,                  \r\nDarkGreen:          2,                          2,                          2,                          2,                  \r\nDarkCyan:           3,                          6,                          6,                          6,                  \r\nDarkRed:            4,                          1,                          1,                          1,                  \r\nDarkMagenta:        5,                          5,                          5,                          5,                  \r\nBrown:              6,                          32,                         130,                        3,                  \r\nDarkYellow:         6,                          72,                         3,                          3,                  \r\nGray:               7,                          84,                         248,                        7,                  \r\nGrey:               7,                          84,                         248,                        7,                  \r\nLightGray:          7,                          7,                          7,                          7,                  \r\nLightGrey:          7,                          7,                          7,                          7,                  \r\nDarkGray:           8,                          82,                         242,                        0 + 8,              \r\nDarkGrey:           8,                          82,                         242,                        0 + 8,              \r\nBlue:               9,                          12,                         12,                         4 + 8,              \r\nLightBlue:          9,                          43,                         81,                         4 + 8,              \r\nGreen:              10,                         10,                         10,                         2 + 8,              \r\nLightGreen:         10,                         61,                         121,                        2 + 8,              \r\nCyan:               11,                         14,                         14,                         6 + 8,              \r\nLightCyan:          11,                         63,                         159,                        6 + 8,              \r\nRed:                12,                         9,                          9,                          1 + 8,              \r\nLightRed:           12,                         74,                         224,                        1 + 8,              \r\nMagenta:            13,                         13,                         13,                         5 + 8,              \r\nLightMagenta:       13,                         75,                         225,                        5 + 8,              \r\nYellow:             14,                         11,                         11,                         3 + 8,              \r\nLightYellow:        14,                         78,                         229,                        3 + 8,              \r\nWhite:              15,                         15,                         15,                         7 + 8,              \r\nNONE                -1                          -1                          -1                          -1                  \r\nMissing from 0-15:  {}                          {3, 8}                      {8}                         {}                  \r\n```\r\nI don't quite understand why these are configured this way, such that DarkGrey isn't taken from index 8 in 88-color and 256-color modes. I'd be happy to send out a PR to adjust, but I suspect this is intended behavior, although I'm not exactly sure what that intent would be.\r\n\r\nMy terminal is being recognized as 256-color (which it is), but this has unfortunately meant I cannot reference DarkGrey in any way other than the numeral 8 without forcing nvim to treat my term as 16-color. Given I already use sed to automatically convert from a template build my final colorscheme with cterm and gui colors, it's not a big hassle to work around, but it was rather confusing for a minute, since the other 15 standard names worked entirely as expected.\r\n\r\nI'm grateful to @emivespa for the workaround, this has solved my problem / petty annoyance.",
            "created_at": "2024-09-15T22:37:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/11974#issuecomment-2351816854",
            "id": 2351816854,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/11974",
            "node_id": "IC_kwDOAPphoM6MLeCW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2351816854/reactions"
            },
            "updated_at": "2024-09-15T22:38:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2351816854",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/29342886?v=4",
                "events_url": "https://api.github.com/users/voskresenie/events{/privacy}",
                "followers_url": "https://api.github.com/users/voskresenie/followers",
                "following_url": "https://api.github.com/users/voskresenie/following{/other_user}",
                "gists_url": "https://api.github.com/users/voskresenie/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/voskresenie",
                "id": 29342886,
                "login": "voskresenie",
                "node_id": "MDQ6VXNlcjI5MzQyODg2",
                "organizations_url": "https://api.github.com/users/voskresenie/orgs",
                "received_events_url": "https://api.github.com/users/voskresenie/received_events",
                "repos_url": "https://api.github.com/users/voskresenie/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/voskresenie/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/voskresenie/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/voskresenie"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/11974/comments",
    "created_at": "2020-03-03T01:23:47Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/11974/events",
    "html_url": "https://github.com/neovim/neovim/issues/11974",
    "id": 574354816,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as usage questions",
            "id": 77997478,
            "name": "closed:question",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3OA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:question"
        },
        {
            "color": "c5def5",
            "default": true,
            "description": "",
            "id": 84744038,
            "name": "documentation",
            "node_id": "MDU6TGFiZWw4NDc0NDAzOA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/documentation"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/11974/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU1NzQzNTQ4MTY=",
    "number": 11974,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/11974/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/11974/timeline",
    "title": "Force nvim to use 16 colors",
    "updated_at": "2024-09-15T22:38:53Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/11974",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/227022?v=4",
        "events_url": "https://api.github.com/users/nylen/events{/privacy}",
        "followers_url": "https://api.github.com/users/nylen/followers",
        "following_url": "https://api.github.com/users/nylen/following{/other_user}",
        "gists_url": "https://api.github.com/users/nylen/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/nylen",
        "id": 227022,
        "login": "nylen",
        "node_id": "MDQ6VXNlcjIyNzAyMg==",
        "organizations_url": "https://api.github.com/users/nylen/orgs",
        "received_events_url": "https://api.github.com/users/nylen/received_events",
        "repos_url": "https://api.github.com/users/nylen/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/nylen/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/nylen/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/nylen"
    }
}