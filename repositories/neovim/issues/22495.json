{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
            "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
            "followers_url": "https://api.github.com/users/lewis6991/followers",
            "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
            "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/lewis6991",
            "id": 7904185,
            "login": "lewis6991",
            "node_id": "MDQ6VXNlcjc5MDQxODU=",
            "organizations_url": "https://api.github.com/users/lewis6991/orgs",
            "received_events_url": "https://api.github.com/users/lewis6991/received_events",
            "repos_url": "https://api.github.com/users/lewis6991/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/lewis6991"
        }
    ],
    "author_association": "MEMBER",
    "body": "Neovim's treesitter highlighting implementation is different from that in the tree-sitter reference highlighter (which is used by Helix and Github and, it's fair to guess, Zed), which has consequences to how queries are written. This in turn prevents us from sharing highlighting queries across editors, which would be very much desirable for obvious reasons. We should consider changing our behavior to match upstream so the queries can be aligned and shared. (This would mean breaking changes and a good deal of work for nvim-treesitter, but @amaanq has kindly volunteered to spearhead that effort.)\r\n\r\nThere are two major issues:\r\n\r\n## Query order\r\n\r\nRight now, we apply highlights for _all_ found matches and rely on extmark ordering to select the \"winner\". In effect, this means \"last match wins\", which means that more specific queries need to come _after_ more general queries.\r\n\r\nIn contrast, the upstream highlighter skips all highlights after the first one:\r\nhttps://github.com/tree-sitter/tree-sitter/blob/c51896d32dcc11a38e41f36e3deb1a6a9c4f4b14/highlight/src/lib.rs#L824-L832\r\nhttps://github.com/tree-sitter/tree-sitter/blob/c51896d32dcc11a38e41f36e3deb1a6a9c4f4b14/highlight/src/lib.rs#L853-L865\r\n(The same code is in Helix.)\r\n\r\nIn effect, this means \"first match wins\", which means that more specific queries need to come _before_ more general queries.\r\n\r\nI think we should implement the same logic. In order for `; extends` and `; inherits` to then still work as expected, we just need to concatenate them in reverse order to the current one.\r\n\r\n**EDIT** Upstream seems to like our strategy (and hence order) better, so this may be a case where _they_ align with _us_; many parsers also provide queries in \"Neovim order\" (being contributed by nvim-treesitter users).\r\n\r\n## Injection queries\r\n\r\nFor some (but not all) injections, we need to manually collect the ranges via the [`#exclude_children!` directive in nvim-treesitter](https://github.com/nvim-treesitter/nvim-treesitter/blob/a0d6c28f893cbbc761cfa7fc7204ba6f3e2710cf/lua/nvim-treesitter/query_predicates.lua#L164-L187), which is not necessary in upstream. Here, too we should change this.\r\n\r\n(I believe Helix implements our default behavior by setting an `include-unnamed-children` metadata for injections?)\r\n\r\n(@theHamsta needs to explain what this does and why this is needed, though...)\r\n\r\n* [x] https://github.com/neovim/neovim/pull/22518",
    "closed_at": "2023-07-21T13:26:33Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "For reference: upstream is considering changing the order of query resolution to match Nvim's original \"last wins\" approach: https://github.com/nvim-treesitter/nvim-treesitter/issues/3944#issuecomment-1458782497 \r\n\r\n> query precedence order - This is fairly minor, but right now, the tree-sitter-highlight crate prefers matches listed earlier in the query, so that you need to list the most specific patterns first. I noticed that Neovim uses the opposite convention, and I think this may be slightly more intuitive, because it matches the behavior of the \"cascade\" in CSS. Also, in Zed, we also found it slightly easier to implement with the more specific matches occurring later (like Neovim).",
            "created_at": "2023-03-08T20:28:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/22495#issuecomment-1460835487",
            "id": 1460835487,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22495",
            "node_id": "IC_kwDOAPphoM5XEpSf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 4,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 5,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460835487/reactions"
            },
            "updated_at": "2023-03-08T20:28:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1460835487",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "For reference: upstream has decided to indeed change their query order to match Neovim's: https://github.com/tree-sitter/tree-sitter/issues/2396#issuecomment-1641210799\r\n\r\nFurther alignment concerns capture names to make sharing highlight queries easier, but that is tracked in nvim-treesitter: https://github.com/nvim-treesitter/nvim-treesitter/issues/4799\r\n\r\nSo there's nothing more to do here.",
            "created_at": "2023-07-21T13:26:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/22495#issuecomment-1645582826",
            "id": 1645582826,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/22495",
            "node_id": "IC_kwDOAPphoM5iFZnq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 4,
                "laugh": 0,
                "rocket": 3,
                "total_count": 7,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1645582826/reactions"
            },
            "updated_at": "2023-07-21T13:26:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1645582826",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/22495/comments",
    "created_at": "2023-03-03T12:45:15Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/22495/events",
    "html_url": "https://github.com/neovim/neovim/issues/22495",
    "id": 1608569813,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/22495/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 63,
        "created_at": "2023-02-02T14:11:43Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
            "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
            "followers_url": "https://api.github.com/users/bfredl/followers",
            "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
            "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/bfredl",
            "id": 1363104,
            "login": "bfredl",
            "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
            "organizations_url": "https://api.github.com/users/bfredl/orgs",
            "received_events_url": "https://api.github.com/users/bfredl/received_events",
            "repos_url": "https://api.github.com/users/bfredl/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/bfredl"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/36",
        "id": 8997654,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/36/labels",
        "node_id": "MI_kwDOAPphoM4AiUsW",
        "number": 36,
        "open_issues": 146,
        "state": "open",
        "title": "0.10",
        "updated_at": "2023-07-23T23:05:24Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/36"
    },
    "node_id": "I_kwDOAPphoM5f4NPV",
    "number": 22495,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 11,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 4,
        "hooray": 0,
        "laugh": 0,
        "rocket": 5,
        "total_count": 20,
        "url": "https://api.github.com/repos/neovim/neovim/issues/22495/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/22495/timeline",
    "title": "Treesitter: align with upstream behavior",
    "updated_at": "2023-07-21T13:26:33Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/22495",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
        "events_url": "https://api.github.com/users/clason/events{/privacy}",
        "followers_url": "https://api.github.com/users/clason/followers",
        "following_url": "https://api.github.com/users/clason/following{/other_user}",
        "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/clason",
        "id": 2361214,
        "login": "clason",
        "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
        "organizations_url": "https://api.github.com/users/clason/orgs",
        "received_events_url": "https://api.github.com/users/clason/received_events",
        "repos_url": "https://api.github.com/users/clason/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/clason"
    }
}