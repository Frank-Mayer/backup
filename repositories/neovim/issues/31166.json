{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
        "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
        "followers_url": "https://api.github.com/users/luukvbaal/followers",
        "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
        "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/luukvbaal",
        "id": 31730729,
        "login": "luukvbaal",
        "node_id": "MDQ6VXNlcjMxNzMwNzI5",
        "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
        "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
        "repos_url": "https://api.github.com/users/luukvbaal/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/luukvbaal",
        "user_view_type": "public"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
            "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
            "followers_url": "https://api.github.com/users/luukvbaal/followers",
            "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
            "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/luukvbaal",
            "id": 31730729,
            "login": "luukvbaal",
            "node_id": "MDQ6VXNlcjMxNzMwNzI5",
            "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
            "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
            "repos_url": "https://api.github.com/users/luukvbaal/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/luukvbaal",
            "user_view_type": "public"
        }
    ],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\n@luukvbaal @bfredl thank you for #27813. I try to play with the feature, but cannot get correct result for multihighlight messages. In short, \n```lua\n    vim.api.nvim_echo({\n      {'E', 'ErrorMsg'},\n      {'W', 'WarningMsg'},\n      {'A', 'DiffAdd'},\n      {'C', 'DiffChange'},\n    }, false, {})\n```\nresults with chunks `{ { 24, \"E\", 27 }, { 44, \"W\", 31 }, { 20, \"A\", 32 }, { 21, \"C\", 32 } }`. \n\nNotice the same values for the two last elements.\n\n### Steps to reproduce\n\n`init.lua`:\n```lua\nlocal api = vim.api\nlocal ns = api.nvim_create_namespace('messageRedirection')\n\nlocal function log(msg)\n  if 0 == #vim.trim(msg) then\n    return\n  end\n  vim.schedule(function ()\n    api.nvim_buf_set_lines(1, -1, -1, true, vim.split(msg, '\\n'))\n    vim.cmd.normal 'G'\n  end)\nend\n\nlocal function notify(content)\n  for _, chunk in ipairs(content) do\n    local idAttr = chunk[3]\n    local msg = ('[%s -> %s] %s'):format(\n      tostring(idAttr),\n      vim.fn.synIDattr(idAttr, 'name'),\n      chunk[2]\n    )\n    log(msg)\n  end\nend\n\nlocal function redraw()\n  vim.schedule(function ()\n    vim.cmd.redraw()\n  end)\nend\napi.nvim_create_autocmd('CmdlineEnter', {\n  callback = function ()\n    vim.ui_detach(ns)\n    redraw()\n  end\n})\n\napi.nvim_create_autocmd({'UIEnter', 'CmdlineLeave'}, {\n  callback = function ()\n    vim.ui_attach(ns, {ext_messages = true, ext_cmdline = false}, function (event, kind, content, _replace_last)\n      if event == 'msg_show' and (kind == 'emsg' or kind == 'echo' or kind == 'lua_error') then\n        log(vim.inspect(content))\n        notify(content)\n      end\n      redraw()\n    end)\n    api.nvim_echo({\n      {'E', 'ErrorMsg'},\n      {'W', 'WarningMsg'},\n      {'A', 'DiffAdd'},\n      {'C', 'DiffChange'},\n    }, false, {})\n  end\n})\n```\n\nI get\n```\n{ { 24, \"E\", 27 }, { 44, \"W\", 31 }, { 20, \"A\", 32 }, { 21, \"C\", 32 } }\n[27 -> WarningMsg] E\n[31 -> DiffAdd] W\n[32 -> DiffChange] A\n[32 -> DiffChange] C\n```\n\n### Expected behavior\n\nProbably: fixed offset.\n\n### Nvim version (nvim -v)\n\nv0.11.0-dev-1134+gff575b3886\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nDebian Sid\n\n### Terminal name/version\n\nalacritty\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nfrom repo",
    "closed_at": "2024-11-11T19:04:08Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
        "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
        "followers_url": "https://api.github.com/users/bfredl/followers",
        "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
        "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/bfredl",
        "id": 1363104,
        "login": "bfredl",
        "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
        "organizations_url": "https://api.github.com/users/bfredl/orgs",
        "received_events_url": "https://api.github.com/users/bfredl/received_events",
        "repos_url": "https://api.github.com/users/bfredl/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/bfredl",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Oops, I guess I neglected to follow the attr logic when first testing if passing the highlight id worked properly, and then only ever verified single highlight messages. Thanks for the repro, #31167 should fix it.",
            "created_at": "2024-11-11T14:20:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468293848",
            "id": 2468293848,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6THyzY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468293848/reactions"
            },
            "updated_at": "2024-11-11T14:20:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468293848",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thank you for quick fix, now (on #31167) I see\n```\n{ { 24, \"E\", 7 }, { 44, \"W\", 27 }, { 20, \"A\", 31 }, { 21, \"C\", 32 } }\n[7 -> ErrorMsg] E\n[27 -> WarningMsg] W\n[31 -> DiffAdd] A\n[32 -> DiffChange] C\n```\nas expected. \n\nIt would be good to publish in the documentation someday a more detailed explanation of the practical use of the first chunk element that existed before.",
            "created_at": "2024-11-11T14:42:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468341833",
            "id": 2468341833,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6TH-hJ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468341833/reactions"
            },
            "updated_at": "2024-11-11T14:44:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468341833",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> It would be good to publish in the documentation someday a more detailed explanation of the practical use of the first chunk element that existed before.\n\nI think that's covered by the docs for [hl_attr_define](https://neovim.io/doc/user/ui.html#ui-event-hl_attr_define) and some earlier excerpts from ui.txt. It's for remote UIs, not vim.ui_attach, hence #27813 :)",
            "created_at": "2024-11-11T14:55:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468372492",
            "id": 2468372492,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6TIGAM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468372492/reactions"
            },
            "updated_at": "2024-11-11T14:59:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468372492",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> I think that's covered by the docs for [hl_attr_define](https://neovim.io/doc/user/ui.html#ui-event-hl_attr_define) and some earlier excerpts from ui.txt. It's for remote UIs, not vim.ui_attach, hence [#27813](https://github.com/neovim/neovim/pull/27813) :)\n\nDoes it mean that the only way to translate these ids to more usable information is catching `hl_attr_define` event somewhere? This is just out of curiosity, since we have hl ids. ",
            "created_at": "2024-11-11T15:11:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468407587",
            "id": 2468407587,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6TIOkj",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468407587/reactions"
            },
            "updated_at": "2024-11-11T15:11:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468407587",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, but since that event is not available to vim.ui_attach consumers, your only other option was to use internal functions through FFI. Which I believe is what noice.nvim does.",
            "created_at": "2024-11-11T15:17:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468420072",
            "id": 2468420072,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6TIRno",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468420072/reactions"
            },
            "updated_at": "2024-11-11T15:17:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468420072",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "A few months ago I tried to understand what was happening in Noice's FFI (and gave up) and ask about attr ids on our matrix chat, but no one responded then. The repro comes from that time and is slightly modified for this issue. I only know about #27813 after the merge. It's a nice feature useful for `cmdheight=0` cases. The next step is to find (or write) a simple notification plugin able to pass highlighted messages and encounter redirection issues. ",
            "created_at": "2024-11-11T16:13:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/31166#issuecomment-2468542020",
            "id": 2468542020,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31166",
            "node_id": "IC_kwDOAPphoM6TIvZE",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468542020/reactions"
            },
            "updated_at": "2024-11-11T16:13:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468542020",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31166/comments",
    "created_at": "2024-11-11T13:47:18Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31166/events",
    "html_url": "https://github.com/neovim/neovim/issues/31166",
    "id": 2649398492,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31166/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6d6pzc",
    "number": 31166,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31166/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31166/timeline",
    "title": "ext_messages: possible offset error on iterating through chunks",
    "updated_at": "2024-11-11T19:04:08Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31166",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
        "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
        "followers_url": "https://api.github.com/users/przepompownia/followers",
        "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
        "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/przepompownia",
        "id": 11404453,
        "login": "przepompownia",
        "node_id": "MDQ6VXNlcjExNDA0NDUz",
        "organizations_url": "https://api.github.com/users/przepompownia/orgs",
        "received_events_url": "https://api.github.com/users/przepompownia/received_events",
        "repos_url": "https://api.github.com/users/przepompownia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/przepompownia",
        "user_view_type": "public"
    }
}