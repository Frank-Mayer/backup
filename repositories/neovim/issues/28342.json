{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nWhen using lsp client with bicep language server, I notice that returned matches in the popup menu and text inserted during selection with Ctrl+N/Ctrl+P after @ character is different (when selecting the api version of resource type in Bicep). Upon selecting the api version the whole text including the resource type (which was already inserted last step) is inserted. This behaviour does not exist on vscode.  \r\n\r\n### Steps to reproduce\r\n\r\n1. To download the latest release (v0.26.170) and place in /usr/local/bin/bicep-langserver:\r\n```bash\r\n(cd $(mktemp -d) \\\r\n    && curl -fLO https://github.com/Azure/bicep/releases/latest/download/bicep-langserver.zip \\\r\n    && rm -rf /usr/local/bin/bicep-langserver \\\r\n    && unzip -d /usr/local/bin/bicep-langserver bicep-langserver.zip)\r\n```\r\n\r\n2. Bicep language server requires the [dotnet-sdk](https://dotnet.microsoft.com/download) to be installed.\r\n\r\n3. Create directory and place this Minimal config (minimal_init.lua) in it\r\n```\r\n-- Neovim does not have built-in support for the bicep filetype which is required for lspconfig to automatically launch the language server.\r\nvim.cmd [[ autocmd BufNewFile,BufRead *.bicep set filetype=bicep ]]\r\n\r\nlocal root_dirname = vim.fs.dirname(vim.fs.find({'main.bicep', '.git', '.github'}, { upward = true })[1])\r\nvim.lsp.start({\r\n    name = \"bicepls\",\r\n    cmd = { \"dotnet\", \"/usr/local/bin/bicep-langserver/Bicep.LangServer.dll\" },\r\n    root_dir = root_dirname,\r\n})\r\n```\r\n\r\n4. In the same directory: nvim -u minimal_init.lua main.bicep. Follow this video to see the issue\r\n\r\nhttps://github.com/neovim/neovim/assets/47608189/c6c75ae1-c250-4a25-8190-c351e75d75ea\r\n\r\n\r\n### Expected behavior\r\n\r\nThe completion item would be inserted as 2023-07-01 after @ as shown in popup menu, resulting in:\r\n\r\n`resource keyvault 'Microsoft.KeyVault/vaults@2023-07-01'`\r\n\r\nExample from Vscode:\r\n\r\nhttps://github.com/neovim/neovim/assets/47608189/d4870204-c123-4f44-9586-8b3c99a9d358\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.9.5\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno\r\n\r\n### Operating system/version\r\n\r\nMacOs Sonoma 14.4.1\r\n\r\n### Terminal name/version\r\n\r\niTerm2 3.4.3\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nhomebrew",
    "closed_at": "2024-04-15T12:08:32Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Can you try the development version? \r\n\r\n- The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. \r\n- Check `:version` to confirm that you are using the latest version.",
            "created_at": "2024-04-15T10:27:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/28342#issuecomment-2056486012",
            "id": 2056486012,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28342",
            "node_id": "IC_kwDOAPphoM56k3x8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056486012/reactions"
            },
            "updated_at": "2024-04-15T10:27:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056486012",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "With the preview version, the completion works fine when setting the resource api version as show below:\r\n\r\nhttps://github.com/neovim/neovim/assets/47608189/435f4b70-9717-4b7e-b1bb-410aa14b802e\r\n\r\n\r\nHowever, with module where we need ref file path, the issue is that completion doesn't work unless closing `'` is present as shown in this video. I also noticed the popup menu view does not show quote `'` at the end or beginning of file path but upon selection the quotes are inserted automatically\r\n\r\nhttps://github.com/neovim/neovim/assets/47608189/3523b479-78a5-4adc-a1f9-10d2cd66c20c\r\n\r\n\r\n",
            "created_at": "2024-04-15T12:03:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/28342#issuecomment-2056669185",
            "id": 2056669185,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28342",
            "node_id": "IC_kwDOAPphoM56lkgB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056669185/reactions"
            },
            "updated_at": "2024-04-15T12:06:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056669185",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/47608189?v=4",
                "events_url": "https://api.github.com/users/barunps3/events{/privacy}",
                "followers_url": "https://api.github.com/users/barunps3/followers",
                "following_url": "https://api.github.com/users/barunps3/following{/other_user}",
                "gists_url": "https://api.github.com/users/barunps3/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/barunps3",
                "id": 47608189,
                "login": "barunps3",
                "node_id": "MDQ6VXNlcjQ3NjA4MTg5",
                "organizations_url": "https://api.github.com/users/barunps3/orgs",
                "received_events_url": "https://api.github.com/users/barunps3/received_events",
                "repos_url": "https://api.github.com/users/barunps3/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/barunps3/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/barunps3/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/barunps3"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> With the preview version, the completion works fine when setting the resource api version as show below:\r\n\r\nClosing then.\r\n\r\n\r\n\r\n> However, with module where we need ref file path, the issue is that completion doesn't work unless closing `'` is present as shown in this video. I also noticed the popup menu view does not show quote `'` at the end or beginning of file path but upon selection the quotes are inserted automatically\r\n\r\n\r\n\r\nSounds like a separate issue. Please also review the existing issues: https://github.com/neovim/neovim/issues?q=is%3Aopen+is%3Aissue+label%3Acompletion\r\n\r\nCould this be related to `itemDefaults` ? https://github.com/neovim/neovim/issues/25714 ",
            "created_at": "2024-04-15T12:08:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/28342#issuecomment-2056680257",
            "id": 2056680257,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28342",
            "node_id": "IC_kwDOAPphoM56lnNB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056680257/reactions"
            },
            "updated_at": "2024-04-15T12:26:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2056680257",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28342/comments",
    "created_at": "2024-04-15T10:05:07Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/28342/events",
    "html_url": "https://github.com/neovim/neovim/issues/28342",
    "id": 2243250433,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "Nvim built-in (omni)completion",
            "id": 3214348835,
            "name": "completion",
            "node_id": "MDU6TGFiZWwzMjE0MzQ4ODM1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/completion"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/28342/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6FtUkB",
    "number": 28342,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/28342/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/28342/timeline",
    "title": "Bicep omnifunc completion mismatch between popup menu and inserted selection",
    "updated_at": "2024-04-15T12:26:46Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/28342",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/47608189?v=4",
        "events_url": "https://api.github.com/users/barunps3/events{/privacy}",
        "followers_url": "https://api.github.com/users/barunps3/followers",
        "following_url": "https://api.github.com/users/barunps3/following{/other_user}",
        "gists_url": "https://api.github.com/users/barunps3/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/barunps3",
        "id": 47608189,
        "login": "barunps3",
        "node_id": "MDQ6VXNlcjQ3NjA4MTg5",
        "organizations_url": "https://api.github.com/users/barunps3/orgs",
        "received_events_url": "https://api.github.com/users/barunps3/received_events",
        "repos_url": "https://api.github.com/users/barunps3/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/barunps3/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/barunps3/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/barunps3"
    }
}