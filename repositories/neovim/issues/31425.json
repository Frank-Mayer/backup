{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI maintain a plugin over at https://github.com/julienvincent/nvim-paredit whose test-suite started failing on nightly builds.\n\nI isolated the issue down to calls to `TSNode:next_named_sibling` which now returns `nil` even when there is a node sibling. There may be other broken API's too - but this was the first one I found that was failing.\n\nThis is working on stable/0.10.2 and previous neovim versions. I looked and didn't see any issues regarding this but might have missed something.\n\n### Steps to reproduce\n\nI setup a simple reproduce repository over at https://github.com/julienvincent/neovim-ts-repro with instructions on how to reproduce.\n\nIt effectively comes down to the following code:\n\n```lua\nlocal ts_utils = require(\"nvim-treesitter.ts_utils\")\n\nvim.api.nvim_set_option_value(\"filetype\", \"clojure\", {\n  buf = 0,\n})\n\nvim.api.nvim_buf_set_lines(0, 0, -1, true, { \"(a) b c\" })\nvim.api.nvim_win_set_cursor(0, { 1, 0 })\n\nvim.treesitter.get_parser(0):parse()\n\nlocal node = ts_utils.get_node_at_cursor()\nlocal sibling = node:next_named_sibling()\n-- sibling is nil\n```\n\n### Expected behavior\n\nThe `TSNode:next_named_sibling` should return siblings when the node has siblings.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0-dev-1265+g6cdcac4492\n\n### Vim (not Nvim) behaves the same?\n\nN\\A\n\n### Operating system/version\n\nmacOs 14.3\n\n### Terminal name/version\n\nWezterm 20240203-110809-5046fc22\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nmise",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "There were intentional changes, both in Neovim and in tree-sitter after 0.10. Please create a minimal and complete reproducing example using `nvim --clean` (since this involves the API only, you can use any bundled parser, e.g., Lua). Make sure you also show the parsed tree.\n\n(In your code snippet, `node` is `nil` so the result hardly surprising...)",
            "created_at": "2024-12-02T12:34:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/31425#issuecomment-2511423237",
            "id": 2511423237,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31425",
            "node_id": "IC_kwDOAPphoM6VsUcF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511423237/reactions"
            },
            "updated_at": "2024-12-02T12:36:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511423237",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@clason I did provide a reproducing example, link is in the issue description (https://github.com/julienvincent/neovim-ts-repro). Or perhaps I misunderstand what you are asking me.\n\n> (In your code snippet, node is nil so the result hardly surprising...)\n\nOops I copy-pasted incorrectly. Fixed. But either way, full working reproduce case is at the link provided",
            "created_at": "2024-12-02T13:29:57Z",
            "html_url": "https://github.com/neovim/neovim/issues/31425#issuecomment-2511550451",
            "id": 2511550451,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31425",
            "node_id": "IC_kwDOAPphoM6Vszfz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511550451/reactions"
            },
            "updated_at": "2024-12-02T13:32:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511550451",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8571121?v=4",
                "events_url": "https://api.github.com/users/julienvincent/events{/privacy}",
                "followers_url": "https://api.github.com/users/julienvincent/followers",
                "following_url": "https://api.github.com/users/julienvincent/following{/other_user}",
                "gists_url": "https://api.github.com/users/julienvincent/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/julienvincent",
                "id": 8571121,
                "login": "julienvincent",
                "node_id": "MDQ6VXNlcjg1NzExMjE=",
                "organizations_url": "https://api.github.com/users/julienvincent/orgs",
                "received_events_url": "https://api.github.com/users/julienvincent/received_events",
                "repos_url": "https://api.github.com/users/julienvincent/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/julienvincent/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/julienvincent/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/julienvincent",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This is far from minimal. I am asking for a simple snippet I can run with `nvim --clean -u minimal.lua`.",
            "created_at": "2024-12-02T14:54:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/31425#issuecomment-2511758591",
            "id": 2511758591,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31425",
            "node_id": "IC_kwDOAPphoM6VtmT_",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511758591/reactions"
            },
            "updated_at": "2024-12-02T14:54:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511758591",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Also, it would be helpful if you could bisect to when exactly your plugin broke.",
            "created_at": "2024-12-02T15:38:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/31425#issuecomment-2511876236",
            "id": 2511876236,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31425",
            "node_id": "IC_kwDOAPphoM6VuDCM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511876236/reactions"
            },
            "updated_at": "2024-12-02T15:38:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2511876236",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31425/comments",
    "created_at": "2024-12-02T12:29:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31425/events",
    "html_url": "https://github.com/neovim/neovim/issues/31425",
    "id": 2711767424,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "libnvim, Nvim RPC API",
            "id": 103819671,
            "name": "api",
            "node_id": "MDU6TGFiZWwxMDM4MTk2NzE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/api"
        },
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31425/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6hokmA",
    "number": 31425,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31425/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31425/timeline",
    "title": "Treesitter API `TSNode:next_named_sibling` broken on nightly",
    "updated_at": "2024-12-02T15:38:46Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31425",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8571121?v=4",
        "events_url": "https://api.github.com/users/julienvincent/events{/privacy}",
        "followers_url": "https://api.github.com/users/julienvincent/followers",
        "following_url": "https://api.github.com/users/julienvincent/following{/other_user}",
        "gists_url": "https://api.github.com/users/julienvincent/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/julienvincent",
        "id": 8571121,
        "login": "julienvincent",
        "node_id": "MDQ6VXNlcjg1NzExMjE=",
        "organizations_url": "https://api.github.com/users/julienvincent/orgs",
        "received_events_url": "https://api.github.com/users/julienvincent/received_events",
        "repos_url": "https://api.github.com/users/julienvincent/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/julienvincent/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/julienvincent/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/julienvincent",
        "user_view_type": "public"
    }
}