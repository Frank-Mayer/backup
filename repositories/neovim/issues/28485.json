{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhen I try to start to write gdscript code which is used in Godot Engine,  I found the engine provide a default language server and can communicate it on port `6005`, so I wrote config for it using `vim.lsp.start` and `vim.lsp.rpc.connect` as follow.\r\n```lua\r\nvim.api.nvim_create_autocmd(\"FileType\", {\r\n    pattern = { \"gd\", \"gdscript\", \"gdscript3\" },\r\n    group = vim.api.nvim_create_augroup(\"gdscript-lsp-start\", {}),\r\n    callback = function()\r\n        vim.lsp.start {\r\n            name = \"gdscript\",\r\n            cmd = vim.lsp.rpc.connect(\"127.0.0.1\", 6005),\r\n            capabilities = capabilities,\r\n            root_dir = vim.fs.dirname(vim.fs.find({ \"project.godot\", \".git\" }, { upward = true })[1]),\r\n        }\r\n    end,\r\n})\r\n```\r\nBut the neovim doesn't attach client and so that `vim.lsp.get_clients` returns empty list. Afterthat, I found `cmd` accept a command and so that rewrite config using `ncat` command.\r\n```lua\r\nvim.api.nvim_create_autocmd(\"FileType\", {\r\n    pattern = { \"gd\", \"gdscript\", \"gdscript3\" },\r\n    group = vim.api.nvim_create_augroup(\"gdscript-lsp-start\", {}),\r\n    callback = function()\r\n        vim.lsp.start {\r\n            name = \"gdscript\",\r\n            cmd = { \"ncat\", \"127.0.0.1\", \"6005\" },\r\n            capabilities = capabilities,\r\n            root_dir = vim.fs.dirname(vim.fs.find({ \"project.godot\", \".git\" }, { upward = true })[1]),\r\n        }\r\n    end,\r\n})\r\n```\r\nUnlike when using `vim.lsp.rpc.connect`, this works well and `vim.lsp.get_clients` returns the client infomation.\n\n### Steps to reproduce\n\nI don't know any other lsp which can communicate with tcp, so I just introduce the procedure using Godot Engine.\r\n1. create a `init.lua` with following content\r\n```lua\r\nvim.api.nvim_create_autocmd(\"FileType\", {\r\n    pattern = { \"gd\", \"gdscript\", \"gdscript3\" },\r\n    group = vim.api.nvim_create_augroup(\"gdscript-lsp-start\", {}),\r\n    callback = function()\r\n        vim.lsp.start {\r\n            name = \"gdscript\",\r\n            cmd = vim.lsp.rpc.connect(\"127.0.0.1\", 6005),\r\n            capabilities = capabilities,\r\n            root_dir = vim.fs.dirname(vim.fs.find({ \"project.godot\", \".git\" }, { upward = true })[1]),\r\n        }\r\n    end,\r\n})\r\n```\r\n2. download latest Godot Engine from [here](https://godotengine.org/) and extract it.\r\n3. open Godot Engine, then create a project by clicking `New` button.\r\n4. goto `Editor` -> `Editor Settings...` -> `Text Editor` -> `External`, then click `Use External Editor` and set `Exec Path` to any neovim gui frontend  (I check with Neovide).\r\n5. right-click file viewer on lower left and select `New Script...` to create a new gdscript code.\r\n6. double click the created file to open neovim.\r\n7. run `:lua vim.print(vim.get_clients())` and got a empty list.\n\n### Expected behavior\n\nGot a client infomation\n\n### Neovim version (nvim -v)\n\n0.10.0-dev-2987+g3305bb9e4\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\nWindows 11 Home 23H2\n\n### Terminal name/version\n\nNeovide\n\n### $TERM environment variable\n\nN/A\n\n### Installation\n\nDownloads nvim-win64.msi and execute it.",
    "closed_at": "2024-04-26T11:02:43Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "This may be related to [this regression](https://github.com/neovim/neovim/pull/28398#issuecomment-2078152491). Maybe the problem isn't only with named pipes, but with windows being slower in general to connect to named pipes and TCP.\r\n\r\nThe problem is that Neovim sends the initialization request here\r\n\r\nhttps://github.com/neovim/neovim/blob/af8500af64571f787579b60bf0064cd05655fd51/runtime/lua/vim/lsp.lua#L426-L441\r\n\r\nwhich may happen before the TCP/named pipe connection has been stablished here\r\n\r\nhttps://github.com/neovim/neovim/blob/af8500af64571f787579b60bf0064cd05655fd51/runtime/lua/vim/lsp/rpc.lua#L683-L687",
            "created_at": "2024-04-25T21:04:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/28485#issuecomment-2078173021",
            "id": 2078173021,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28485",
            "node_id": "IC_kwDOAPphoM573mdd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078173021/reactions"
            },
            "updated_at": "2024-04-25T21:04:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078173021",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/53507599?v=4",
                "events_url": "https://api.github.com/users/TheLeoP/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheLeoP/followers",
                "following_url": "https://api.github.com/users/TheLeoP/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheLeoP/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheLeoP",
                "id": 53507599,
                "login": "TheLeoP",
                "node_id": "MDQ6VXNlcjUzNTA3NTk5",
                "organizations_url": "https://api.github.com/users/TheLeoP/orgs",
                "received_events_url": "https://api.github.com/users/TheLeoP/received_events",
                "repos_url": "https://api.github.com/users/TheLeoP/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheLeoP/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheLeoP/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheLeoP"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Using a command works because it handles the body since the command is launched\r\n\r\nhttps://github.com/neovim/neovim/blob/af8500af64571f787579b60bf0064cd05655fd51/runtime/lua/vim/lsp/rpc.lua#L746-L748\r\n\r\nhttps://github.com/neovim/neovim/blob/af8500af64571f787579b60bf0064cd05655fd51/runtime/lua/vim/lsp/rpc.lua#L761-L770\r\n\r\nwhile connecting via TCP/named pipe starts handling the body once the connection has been established:\r\n\r\nhttps://github.com/neovim/neovim/blob/af8500af64571f787579b60bf0064cd05655fd51/runtime/lua/vim/lsp/rpc.lua#L679-L681",
            "created_at": "2024-04-25T21:28:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/28485#issuecomment-2078205381",
            "id": 2078205381,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28485",
            "node_id": "IC_kwDOAPphoM573uXF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078205381/reactions"
            },
            "updated_at": "2024-04-25T21:28:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078205381",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/53507599?v=4",
                "events_url": "https://api.github.com/users/TheLeoP/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheLeoP/followers",
                "following_url": "https://api.github.com/users/TheLeoP/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheLeoP/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheLeoP",
                "id": 53507599,
                "login": "TheLeoP",
                "node_id": "MDQ6VXNlcjUzNTA3NTk5",
                "organizations_url": "https://api.github.com/users/TheLeoP/orgs",
                "received_events_url": "https://api.github.com/users/TheLeoP/received_events",
                "repos_url": "https://api.github.com/users/TheLeoP/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheLeoP/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheLeoP/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheLeoP"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Would there be a prefered aproach for a PR addressing this? I can think of:\r\n\r\n- Using `vim.schedule_wrap` to ensure the initialization request is made after the TCP/named pipe connection has been stablished (it's a workaround and may cause more problems in the future)\r\n- Refactor the code to send the initialization request inside a callback provided by `client`. `vim.lsp.rpc.start` would use this callback inmedeatly after calling `vim.system` if everithing is ok and `vim.lsp.rpc.connect` would do the same inside the `on_connect` callback, after initializing the read loop",
            "created_at": "2024-04-25T21:39:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/28485#issuecomment-2078219152",
            "id": 2078219152,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28485",
            "node_id": "IC_kwDOAPphoM573xuQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078219152/reactions"
            },
            "updated_at": "2024-04-25T21:39:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078219152",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/53507599?v=4",
                "events_url": "https://api.github.com/users/TheLeoP/events{/privacy}",
                "followers_url": "https://api.github.com/users/TheLeoP/followers",
                "following_url": "https://api.github.com/users/TheLeoP/following{/other_user}",
                "gists_url": "https://api.github.com/users/TheLeoP/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TheLeoP",
                "id": 53507599,
                "login": "TheLeoP",
                "node_id": "MDQ6VXNlcjUzNTA3NTk5",
                "organizations_url": "https://api.github.com/users/TheLeoP/orgs",
                "received_events_url": "https://api.github.com/users/TheLeoP/received_events",
                "repos_url": "https://api.github.com/users/TheLeoP/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TheLeoP/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TheLeoP/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TheLeoP"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@pogyomo can you try with https://github.com/neovim/neovim/pull/28507 ?",
            "created_at": "2024-04-26T07:58:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/28485#issuecomment-2078839498",
            "id": 2078839498,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28485",
            "node_id": "IC_kwDOAPphoM576JLK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078839498/reactions"
            },
            "updated_at": "2024-04-26T07:58:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2078839498",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "NONE",
            "body": "@mfussenegger I just try it with #28507 and found `vim.lsp.rpc.connect` works correctly so that `vim.lsp.get_clients` returns client infomation.",
            "created_at": "2024-04-26T11:24:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/28485#issuecomment-2079198497",
            "id": 2079198497,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/28485",
            "node_id": "IC_kwDOAPphoM577g0h",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2079198497/reactions"
            },
            "updated_at": "2024-04-26T11:24:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2079198497",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/82942315?v=4",
                "events_url": "https://api.github.com/users/pogyomo/events{/privacy}",
                "followers_url": "https://api.github.com/users/pogyomo/followers",
                "following_url": "https://api.github.com/users/pogyomo/following{/other_user}",
                "gists_url": "https://api.github.com/users/pogyomo/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/pogyomo",
                "id": 82942315,
                "login": "pogyomo",
                "node_id": "MDQ6VXNlcjgyOTQyMzE1",
                "organizations_url": "https://api.github.com/users/pogyomo/orgs",
                "received_events_url": "https://api.github.com/users/pogyomo/received_events",
                "repos_url": "https://api.github.com/users/pogyomo/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/pogyomo/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/pogyomo/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/pogyomo"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/28485/comments",
    "created_at": "2024-04-24T10:53:11Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/28485/events",
    "html_url": "https://github.com/neovim/neovim/issues/28485",
    "id": 2261003916,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 5415073845,
            "name": "network",
            "node_id": "LA_kwDOAPphoM8AAAABQsN4NQ",
            "url": "https://api.github.com/repos/neovim/neovim/labels/network"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/28485/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6GxC6M",
    "number": 28485,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/28485/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/28485/timeline",
    "title": "vim.lsp.rpc.connect doesn't works on windows",
    "updated_at": "2024-04-26T11:24:33Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/28485",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/82942315?v=4",
        "events_url": "https://api.github.com/users/pogyomo/events{/privacy}",
        "followers_url": "https://api.github.com/users/pogyomo/followers",
        "following_url": "https://api.github.com/users/pogyomo/following{/other_user}",
        "gists_url": "https://api.github.com/users/pogyomo/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/pogyomo",
        "id": 82942315,
        "login": "pogyomo",
        "node_id": "MDQ6VXNlcjgyOTQyMzE1",
        "organizations_url": "https://api.github.com/users/pogyomo/orgs",
        "received_events_url": "https://api.github.com/users/pogyomo/received_events",
        "repos_url": "https://api.github.com/users/pogyomo/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/pogyomo/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pogyomo/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/pogyomo"
    }
}