{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nWhen calling `vim.lsp.util.stylize_markdown` (via lsp_signature or some plugins), the following error happens:\r\n\r\n```\r\nError executing vim.schedule lua callback: ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1485: Error executing lua: vim/_editor.\r\nlua:400: nvim_exec2()../opt/homebrew/Cellar/neovim/HEAD-b74262a/share/nvim/runtime/syntax/vim.vim, line 820: Vim(syntax):E403: syntax sync: li\r\nne continuations pattern specified twice\r\nstack traceback:\r\n        [C]: in function 'nvim_exec2'\r\n        vim/_editor.lua:400: in function 'cmd'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1470: in function 'apply_syntax_to_region'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1494: in function <...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util\r\n.lua:1485>\r\n        [C]: in function 'nvim_buf_call'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1485: in function 'stylize_markdown'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1699: in function 'open_floating_preview'\r\n        ...im/plugged/lsp_signature.nvim/lua/lsp_signature/init.lua:562: in function 'handler'\r\n        ...r/neovim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp.lua:1497: in function 'cb'\r\n        vim/_editor.lua:324: in function <vim/_editor.lua:323>\r\nstack traceback:\r\n        [C]: in function 'nvim_buf_call'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1485: in function 'stylize_markdown'\r\n        ...vim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp/util.lua:1699: in function 'open_floating_preview'\r\n        ...im/plugged/lsp_signature.nvim/lua/lsp_signature/init.lua:562: in function 'handler'\r\n        ...r/neovim/HEAD-b74262a/share/nvim/runtime/lua/vim/lsp.lua:1497: in function 'cb'\r\n        vim/_editor.lua:324: in function <vim/_editor.lua:323>\r\n```\r\n\r\nThe line 820 where vim syntax throws an error is:\r\n\r\n```\r\nsyn sync linecont\t\"^\\s\\+\\\\\"\r\n```\r\n\r\nNote: the documentation for `vim.fn.has(...)` has **two code blocks** in markdown doc: lua and vim, which results in including both of syntax/lua.vim and syntax/vim.vim.\r\n\r\n### Steps to reproduce\r\n\r\nA minimal way to reproduce this:\r\n\r\nI had a custom syntax for lua that includes vim syntax file, e.g. `~/.config/nvim/after/syntax/lua.vim`:\r\n\r\n```vim\r\nlet s:vimpath = fnameescape(expand(\"$VIMRUNTIME\").\"/syntax/vim.vim\")\r\nif !filereadable(s:vimpath)\r\n for s:vimpath in split(globpath(&rtp, \"syntax/vim.vim\"),\"\\n\")\r\n  if filereadable(fnameescape(s:vimpath))\r\n   let s:vimpath = fnameescape(s:vimpath)\r\n   break\r\n  endif\r\n endfor\r\nendif\r\n \r\nif !filereadable(s:vimpath)\r\n  finish\r\nend\r\n \r\nunlet! b:current_syntax\r\n \r\nexe \"syn include @vimLuaScript \".s:vimpath\r\n\r\nunlet s:vimpath\r\nlet b:current_syntax = 'lua'\r\n```\r\n\r\nThen\r\n\r\n```\r\n$ nvim -u NONE\r\n```\r\n\r\n```\r\n:lua vim.lsp.util.stylize_markdown(0, {'```lua', 'function vim.fn.has()', '```', '```vim', 'finish', '```'}, {})\r\n:lua vim.lsp.util.stylize_markdown(0, {'```lua', 'function vim.fn.has()', '```', '```vim', 'finish', '```'}, {})\r\n```\r\n\r\n<img width=\"800\" alt=\"image\" src=\"https://github.com/neovim/neovim/assets/1009873/0e2cfb07-ac5b-4710-8752-dbdc71caf1b3\">\r\n\r\n\r\n### Expected behavior\r\n\r\nNo error should happen.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-4724+gb74262a33-Homebrew\r\n\r\nNote: on nvim 0.9.1 (stable) it works OK. This seems to be a regression in neovim 0.10.x nightly.\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNot applicable\r\n\r\n### Operating system/version\r\n\r\nmacOS 12.1\r\n\r\n### Terminal name/version\r\n\r\nxterm, kitty\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color, xterm-kitty\r\n\r\n### Installation\r\n\r\nHomebrew",
    "closed_at": "2023-07-25T11:38:49Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "We want to replace that function with tree-sitter parsing anyway (@folke).",
            "created_at": "2023-07-22T17:36:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/24431#issuecomment-1646636221",
            "id": 1646636221,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24431",
            "node_id": "IC_kwDOAPphoM5iJay9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646636221/reactions"
            },
            "updated_at": "2023-07-22T17:36:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646636221",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The change comes from this commit (ba8f19ebb67ca27d746f4b1cd902ab3d807eace3):\r\n\r\nhttps://github.com/neovim/neovim/blame/master/runtime/lua/vim/lsp/util.lua#L1469\r\n\r\nIn neovim 0.9.x the line `syntax include vim syntax/vim.vim` would still throw an error, but this is protected by a `pcall` call. In 0.10.x this is no longer protected. \r\n\r\n@glepnir Would this be a deliberate change?",
            "created_at": "2023-07-23T20:47:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/24431#issuecomment-1646955881",
            "id": 1646955881,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24431",
            "node_id": "IC_kwDOAPphoM5iKo1p",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646955881/reactions"
            },
            "updated_at": "2023-07-23T20:47:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1646955881",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "because there do twice `syntax include` ..maybe we still need `pcall`. but it just ignore error. syntax still not work correct.",
            "created_at": "2023-07-24T06:18:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/24431#issuecomment-1647282266",
            "id": 1647282266,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24431",
            "node_id": "IC_kwDOAPphoM5iL4ha",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1647282266/reactions"
            },
            "updated_at": "2023-07-24T06:43:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1647282266",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Would updating vim/lua syntax file to ignore E403 errors at the line `syn sync linecont ...` be an option? This might need a patch to upstream vim though.",
            "created_at": "2023-07-24T15:20:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/24431#issuecomment-1648121368",
            "id": 1648121368,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24431",
            "node_id": "IC_kwDOAPphoM5iPFYY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1648121368/reactions"
            },
            "updated_at": "2023-07-24T15:20:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1648121368",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
                "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
                "followers_url": "https://api.github.com/users/wookayin/followers",
                "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
                "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/wookayin",
                "id": 1009873,
                "login": "wookayin",
                "node_id": "MDQ6VXNlcjEwMDk4NzM=",
                "organizations_url": "https://api.github.com/users/wookayin/orgs",
                "received_events_url": "https://api.github.com/users/wookayin/received_events",
                "repos_url": "https://api.github.com/users/wookayin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/wookayin"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24431/comments",
    "created_at": "2023-07-22T17:27:02Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24431/events",
    "html_url": "https://github.com/neovim/neovim/issues/24431",
    "id": 1816839072,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "regex syntax or non-regex parsing, lpeg, grammars",
            "id": 531600085,
            "name": "syntax",
            "node_id": "MDU6TGFiZWw1MzE2MDAwODU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/syntax"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24431/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5sSsOg",
    "number": 24431,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24431/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24431/timeline",
    "title": "Regression: Vim(syntax):E403: syntax sync: line continuations pattern specified twice",
    "updated_at": "2023-07-25T11:38:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24431",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1009873?v=4",
        "events_url": "https://api.github.com/users/wookayin/events{/privacy}",
        "followers_url": "https://api.github.com/users/wookayin/followers",
        "following_url": "https://api.github.com/users/wookayin/following{/other_user}",
        "gists_url": "https://api.github.com/users/wookayin/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/wookayin",
        "id": 1009873,
        "login": "wookayin",
        "node_id": "MDQ6VXNlcjEwMDk4NzM=",
        "organizations_url": "https://api.github.com/users/wookayin/orgs",
        "received_events_url": "https://api.github.com/users/wookayin/received_events",
        "repos_url": "https://api.github.com/users/wookayin/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/wookayin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/wookayin/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/wookayin"
    }
}