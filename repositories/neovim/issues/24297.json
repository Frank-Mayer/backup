{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI tried with null-ls, and lsp formatters, and the behavior is that whenever calling vim.lsp.buf.format(), the cursor remains in position, which is what I would expect.\r\n\r\nHowever, when undoing the formatting changes, I would expect the same behavior, seeing the changes revert back on the exact same lines displayed in the window.\r\nBut instead, the cursor jumps to the top of the window, more specifically to the lowest line number where a change was undone.\r\n\r\nThis is annoying because it makes it difficult to undo/redo formatting a couple of times to view the changes happening in a specific area.\n\n### Steps to reproduce\n\nopen a file for which you have a formatter installed\r\nmake sure the file is not formatted in multiple areas\r\ncall vim.lsp.buf.format()\r\nundo\n\n### Expected behavior\n\nthe cursor and window position remains the same\n\n### Neovim version (nvim -v)\n\nNVIM v0.9.1 Build type: Release LuaJIT 2.1.0-beta3\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\nLinux 6.4.1-artix1-1\n\n### Terminal name/version\n\nalacritty 0.12.2\n\n### $TERM environment variable\n\nalacritty\n\n### Installation\n\nartix repo",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> But instead, the cursor jumps to the top of the window, more specifically to the lowest line number where a change was undone.\r\n\r\nThis is just how undo works in vim. If other lsp formatters are behaving differently, maybe we can borrow their approach if it's not complicated.\r\n\r\nWe should also use `:keepmarks` to avoid setting `'[` and `']` to the start/end of the file. https://github.com/neovim/neovim/issues/8807\r\n\r\nRelated:\r\n\r\n- #22253\r\n- https://github.com/neovim/neovim/issues/21783",
            "created_at": "2023-07-08T17:23:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1627433026",
            "id": 1627433026,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5hAKhC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627433026/reactions"
            },
            "updated_at": "2023-07-08T17:23:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627433026",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "Let me know if there's any workarounds, something like a undo.stop_recording() and undo.continue_recording(), I like to trim trailing white spaces  on save, but doing so messes up my undo history",
            "created_at": "2023-07-09T10:01:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/24297#issuecomment-1627666212",
            "id": 1627666212,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24297",
            "node_id": "IC_kwDOAPphoM5hBDck",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627666212/reactions"
            },
            "updated_at": "2023-07-24T21:12:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1627666212",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26150581?v=4",
                "events_url": "https://api.github.com/users/duarm/events{/privacy}",
                "followers_url": "https://api.github.com/users/duarm/followers",
                "following_url": "https://api.github.com/users/duarm/following{/other_user}",
                "gists_url": "https://api.github.com/users/duarm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/duarm",
                "id": 26150581,
                "login": "duarm",
                "node_id": "MDQ6VXNlcjI2MTUwNTgx",
                "organizations_url": "https://api.github.com/users/duarm/orgs",
                "received_events_url": "https://api.github.com/users/duarm/received_events",
                "repos_url": "https://api.github.com/users/duarm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/duarm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/duarm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/duarm"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24297/comments",
    "created_at": "2023-07-08T15:14:58Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24297/events",
    "html_url": "https://github.com/neovim/neovim/issues/24297",
    "id": 1794981699,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, unlikely to cause distant/indirect damage",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 5581608985,
            "name": "marks",
            "node_id": "LA_kwDOAPphoM8AAAABTLCYGQ",
            "url": "https://api.github.com/repos/neovim/neovim/labels/marks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24297/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 188,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Zero priority; no timeline. Promote an item from this state by taking ownership of it.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 217,
        "state": "open",
        "title": "unplanned",
        "updated_at": "2023-07-25T13:31:27Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM5q_T9D",
    "number": 24297,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24297/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24297/timeline",
    "title": "LSP: undoing after vim.lsp.buf.format() changes cursor position",
    "updated_at": "2023-07-24T21:12:37Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24297",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/44764250?v=4",
        "events_url": "https://api.github.com/users/pantosaur/events{/privacy}",
        "followers_url": "https://api.github.com/users/pantosaur/followers",
        "following_url": "https://api.github.com/users/pantosaur/following{/other_user}",
        "gists_url": "https://api.github.com/users/pantosaur/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/pantosaur",
        "id": 44764250,
        "login": "pantosaur",
        "node_id": "MDQ6VXNlcjQ0NzY0MjUw",
        "organizations_url": "https://api.github.com/users/pantosaur/orgs",
        "received_events_url": "https://api.github.com/users/pantosaur/received_events",
        "repos_url": "https://api.github.com/users/pantosaur/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/pantosaur/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/pantosaur/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/pantosaur"
    }
}