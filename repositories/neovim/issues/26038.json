{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
        "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
        "followers_url": "https://api.github.com/users/gpanders/followers",
        "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
        "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gpanders",
        "id": 8965202,
        "login": "gpanders",
        "node_id": "MDQ6VXNlcjg5NjUyMDI=",
        "organizations_url": "https://api.github.com/users/gpanders/orgs",
        "received_events_url": "https://api.github.com/users/gpanders/received_events",
        "repos_url": "https://api.github.com/users/gpanders/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gpanders"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
            "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
            "followers_url": "https://api.github.com/users/gpanders/followers",
            "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
            "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/gpanders",
            "id": 8965202,
            "login": "gpanders",
            "node_id": "MDQ6VXNlcjg5NjUyMDI=",
            "organizations_url": "https://api.github.com/users/gpanders/orgs",
            "received_events_url": "https://api.github.com/users/gpanders/received_events",
            "repos_url": "https://api.github.com/users/gpanders/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/gpanders"
        }
    ],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nWhen starting Neovim which includes ab102f188e86bdbfce1d4de2ef633092a906e8fe, there is an active Command line containing string like `0000/0000/0000^G` where `000000` is terminal's background color. It waits for user to press the key and then works as usual.\n\n### Steps to reproduce\n\n1. Download [`st`](https://st.suckless.org/) (here is a [direct link](https://dl.suckless.org/st/st-0.9.tar.gz) for download).\r\n2. Extract archive and build it with `make` inside extracted directory.\r\n3. Run `./st` inside extracted directory to run the terminal emulator.\r\n4. Start `nvim --clean`. It shows `:0000/0000/0000^G` in Command line and waits for user to press a key. There is also a line `erresc: unknown csi ESC[>4;2m` printed in the terminal emulator instance which started `./st` (not sure if it is related).\r\n\r\nThis started to happen at ab102f188e86bdbfce1d4de2ef633092a906e8fe commit.\n\n### Expected behavior\n\nTerminal emulator starts as usual.\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0-dev-1561+g582d7f479\n\n### Vim (not Nvim) behaves the same?\n\nNo\n\n### Operating system/version\n\nEndeavourOS Linux x86_64 (6.6.1-arch1-1)\n\n### Terminal name/version\n\nst-0.9\n\n### $TERM environment variable\n\nst-256color\n\n### Installation\n\nBoth appimage and from source",
    "closed_at": "2023-11-16T21:02:48Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "My theory is that st is sending the OSC 11 response terminated with `BEL` (`0x07`) instead of `ST` (`0x1b 0x5c`) as it should be. We learned recently that libtermkey [does not accept BEL as an OSC terminator](https://github.com/neovim/libtermkey/pull/4), so if my theory is correct what is likely happening is that st is sending us the OSC 11 response and it is not being interpreted correctly by termkey as an OSC sequence. Thus, it never gets sent in the `TermResponse` autocommand and is instead treated like regular terminal input, where it then appears in Nvim.\r\n\r\n@echasnovski If you're comfortable doing this, here's what you can try to validate this theory:\r\n\r\n1. Clone my [libtermkey fork](https://github.com/gpanders/libtermkey) and checkout the `osc-bel` branch\r\n2. Clone the `neovim` repo if you haven't already. In `cmake.deps/deps.txt`, change the value of the `LIBTERMKEY_URL` variable to the path where you checked out the libtermkey fork in step 1\r\n3. Run `make distclean` just to be sure we're building everything from scratch. Then run `make deps` and `make` to rebuild Neovim\r\n4. Run `VIMRUNTIME=runtime ./build/bin/nvim` and see if the problem persists",
            "created_at": "2023-11-14T14:31:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/26038#issuecomment-1810333840",
            "id": 1810333840,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26038",
            "node_id": "IC_kwDOAPphoM5r54CQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810333840/reactions"
            },
            "updated_at": "2023-11-14T14:31:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810333840",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> @echasnovski If you're comfortable doing this, here's what you can try to validate this theory:\r\n> \r\n>     1. Clone my [libtermkey fork](https://github.com/gpanders/libtermkey) and checkout the `osc-bel` branch\r\n> \r\n>     2. Clone the `neovim` repo if you haven't already. In `cmake.deps/deps.txt`, change the value of the `LIBTERMKEY_URL` variable to the path where you checked out the libtermkey fork in step 1\r\n> \r\n>     3. Run `make distclean` just to be sure we're building everything from scratch. Then run `make deps` and `make` to rebuild Neovim\r\n> \r\n>     4. Run `VIMRUNTIME=runtime ./build/bin/nvim` and see if the problem persists\r\n\r\nYes, doing this seems to fix an issue. As you already know, your theory is also confirmed by [looking at source](https://git.suckless.org/st/file/st.c.html#l1859).\r\n\r\n------\r\n\r\nAs patching `st` to fix issues locally is generally acceptable, I received an advice on how to do it from a *very* knowledgeable person. Here is the diff of the change (computed for the current latest 0.9 tag): \r\n\r\n```patch\r\ndiff --git a/st.c b/st.c\r\nindex 62def59..51e57f7 100644\r\n--- a/st.c\r\n+++ b/st.c\r\n@@ -1849,7 +1849,7 @@ osc_color_response(int num, int index, int is_osc4)\r\n                return;\r\n        }\r\n\r\n-       n = snprintf(buf, sizeof buf, \"\\033]%s%d;rgb:%02x%02x/%02x%02x/%02x%02x\\007\",\r\n+       n = snprintf(buf, sizeof buf, \"\\033]%s%d;rgb:%02x%02x/%02x%02x/%02x%02x\\033\\\\\",\r\n                     is_osc4 ? \"4;\" : \"\", num, r, r, g, g, b, b);\r\n        if (n < 0 || n >= sizeof(buf)) {\r\n                fprintf(stderr, \"error: %s while printing %s response\\n\",\r\n```\r\n\r\nAfter adding this patch to my local configuration, everything seems to work just fine.",
            "created_at": "2023-11-14T15:31:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/26038#issuecomment-1810462317",
            "id": 1810462317,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26038",
            "node_id": "IC_kwDOAPphoM5r6XZt",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810462317/reactions"
            },
            "updated_at": "2023-11-14T15:31:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810462317",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
                "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
                "followers_url": "https://api.github.com/users/echasnovski/followers",
                "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
                "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/echasnovski",
                "id": 24854248,
                "login": "echasnovski",
                "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
                "organizations_url": "https://api.github.com/users/echasnovski/orgs",
                "received_events_url": "https://api.github.com/users/echasnovski/received_events",
                "repos_url": "https://api.github.com/users/echasnovski/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/echasnovski"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thanks @echasnovski.\r\n\r\nThis issue will be resolved when https://github.com/neovim/libtermkey/pull/4 is applied to libtermkey (either in our own fork, or upstream).",
            "created_at": "2023-11-14T16:12:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/26038#issuecomment-1810581233",
            "id": 1810581233,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26038",
            "node_id": "IC_kwDOAPphoM5r60bx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810581233/reactions"
            },
            "updated_at": "2023-11-14T16:12:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1810581233",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This also happens in Apple's Terminal.app",
            "created_at": "2023-11-16T18:13:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/26038#issuecomment-1814987392",
            "id": 1814987392,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26038",
            "node_id": "IC_kwDOAPphoM5sLoKA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 1,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1814987392/reactions"
            },
            "updated_at": "2023-11-16T18:13:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1814987392",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8965202?v=4",
                "events_url": "https://api.github.com/users/gpanders/events{/privacy}",
                "followers_url": "https://api.github.com/users/gpanders/followers",
                "following_url": "https://api.github.com/users/gpanders/following{/other_user}",
                "gists_url": "https://api.github.com/users/gpanders/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gpanders",
                "id": 8965202,
                "login": "gpanders",
                "node_id": "MDQ6VXNlcjg5NjUyMDI=",
                "organizations_url": "https://api.github.com/users/gpanders/orgs",
                "received_events_url": "https://api.github.com/users/gpanders/received_events",
                "repos_url": "https://api.github.com/users/gpanders/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gpanders/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gpanders/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gpanders"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26038/comments",
    "created_at": "2023-11-14T11:02:44Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26038/events",
    "html_url": "https://github.com/neovim/neovim/issues/26038",
    "id": 1992515134,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "Needs a third-party / external change or fix",
            "id": 101945532,
            "name": "status:blocked-external",
            "node_id": "MDU6TGFiZWwxMDE5NDU1MzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/status:blocked-external"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue is not fixed but can be circumvented until then",
            "id": 435850181,
            "name": "has:workaround",
            "node_id": "MDU6TGFiZWw0MzU4NTAxODE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:workaround"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26038/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 184,
        "created_at": "2023-02-02T14:11:43Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
            "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
            "followers_url": "https://api.github.com/users/bfredl/followers",
            "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
            "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/bfredl",
            "id": 1363104,
            "login": "bfredl",
            "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
            "organizations_url": "https://api.github.com/users/bfredl/orgs",
            "received_events_url": "https://api.github.com/users/bfredl/received_events",
            "repos_url": "https://api.github.com/users/bfredl/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/bfredl"
        },
        "description": "",
        "due_on": "2024-03-01T08:00:00Z",
        "html_url": "https://github.com/neovim/neovim/milestone/36",
        "id": 8997654,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/36/labels",
        "node_id": "MI_kwDOAPphoM4AiUsW",
        "number": 36,
        "open_issues": 129,
        "state": "open",
        "title": "0.10",
        "updated_at": "2023-11-16T21:02:47Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/36"
    },
    "node_id": "I_kwDOAPphoM52w14-",
    "number": 26038,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26038/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26038/timeline",
    "title": "New Lua background color detection doesn't work in `st` terminal emulator",
    "updated_at": "2023-11-16T21:02:48Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26038",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/24854248?v=4",
        "events_url": "https://api.github.com/users/echasnovski/events{/privacy}",
        "followers_url": "https://api.github.com/users/echasnovski/followers",
        "following_url": "https://api.github.com/users/echasnovski/following{/other_user}",
        "gists_url": "https://api.github.com/users/echasnovski/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/echasnovski",
        "id": 24854248,
        "login": "echasnovski",
        "node_id": "MDQ6VXNlcjI0ODU0MjQ4",
        "organizations_url": "https://api.github.com/users/echasnovski/orgs",
        "received_events_url": "https://api.github.com/users/echasnovski/received_events",
        "repos_url": "https://api.github.com/users/echasnovski/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/echasnovski/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/echasnovski/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/echasnovski"
    }
}