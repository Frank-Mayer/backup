{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nWhenever `vim.lsp.buf.hover()` is called, this disables all diagnostics in the buffer.\n\nThis can be quite annoying because you have to continuously toggle diagnostics back on again everytime you peak at symbol documentation with `K`.\n\nI'd like for diagnostics to not be disabled whenever `vim.lsp.buf.hover()` is called.\n\n### Steps to reproduce\n\n`minimal.lua`:\n\n```\n-- Install Lazy plugin manager if not already installed\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\nif not vim.loop.fs_stat(lazypath) then\n  vim.fn.system({\n    \"git\",\n    \"clone\",\n    \"--filter=blob:none\",\n    \"https://github.com/folke/lazy.nvim.git\",\n    \"--branch=stable\", -- latest stable release\n    lazypath,\n  })\nend\nvim.opt.rtp:prepend(lazypath)\n\n-- Setup Lazy to manage plugins\nrequire(\"lazy\").setup({\n  -- LSP config plugin\n  {\n    \"neovim/nvim-lspconfig\",\n    config = function()\n      local lspconfig = require(\"lspconfig\")\n\n      -- Set up LSP server (e.g., pyright for Python)\n      lspconfig.pyright.setup({})\n\n      -- Diagnostics config\n      vim.diagnostic.config({\n        virtual_text = true, -- Show inline diagnostic messages\n        signs = true, -- Show signs in the gutter\n        underline = true, -- Underline problematic code\n        update_in_insert = false, -- Do not update diagnostics in insert mode\n        float = { border = \"rounded\" },\n      })\n\n      -- Keymap for hover\n      vim.api.nvim_set_keymap(\"n\", \"K\", \"<cmd>lua vim.lsp.buf.hover()<CR>\", { noremap = true, silent = true })\n\n      -- Enable diagnostics globally\n      vim.diagnostic.enable(0)\n\n      -- Optional: Highlight the line with diagnostics\n      vim.cmd([[autocmd CursorHold * lua vim.diagnostic.open_float(nil, {focus=false})]])\n\n      -- On attach function to print diagnostics on hover\n      local on_attach = function(client, bufnr)\n        -- Hover documentation keymap\n        vim.api.nvim_buf_set_keymap(\n          bufnr,\n          \"n\",\n          \"K\",\n          \"<cmd>lua vim.lsp.buf.hover()<CR>\",\n          { noremap = true, silent = true }\n        )\n\n        -- Print diagnostics in floating window on cursor hold\n        vim.api.nvim_create_autocmd(\"CursorHold\", {\n          buffer = bufnr,\n          callback = function()\n            vim.diagnostic.open_float(nil, { focus = false })\n          end,\n        })\n      end\n\n      -- Attach LSP servers\n      lspconfig.pyright.setup({\n        on_attach = on_attach,\n      })\n    end,\n  },\n})\n\n-- Basic options\nvim.o.completeopt = \"menuone,noselect\"\n```\nfile.py:\n```python\nfrom datetime import datetime\n\n\ndatetime.fromisoformat(\"2024-10-14\")\nprint now  # should show a diagnostic error\n```\n\nRun:\n```\nnvim --clean -u minimal.lua file.py\n```\n\n1. See that diagnostics are showing\n2. Use `K` to hover over anything, observe that diagnostics go away `vim.diagnostic.is_enabled()` becomes `False`\n\nHere's an [asciinema](https://asciinema.org/a/J7G5zhSlEQ8kmBCZrOJSTk4Dj) that demonstrates this \n![Image](https://github.com/user-attachments/assets/78c1d111-71a4-47b0-a646-ae9964fe68ee)\n \n\n\n### Expected behavior\n\nI would expect Diagnostics to remain unchanged (and still be enabled if they started enabled) when using `vim.lsp.buf.hover()`.\n\n### Nvim version (nvim -v)\n\nNVIM v0.10.0 Build type: Release LuaJIT 2.1.1716656478\n\n### Vim (not Nvim) behaves the same?\n\nno\n\n### Operating system/version\n\n14.5 (23F79)\n\n### Terminal name/version\n\nalacritty, tmux\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nbrew",
    "closed_at": "2024-10-15T10:37:00Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
        "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
        "followers_url": "https://api.github.com/users/justinmk/followers",
        "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
        "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/justinmk",
        "id": 1359421,
        "login": "justinmk",
        "node_id": "MDQ6VXNlcjEzNTk0MjE=",
        "organizations_url": "https://api.github.com/users/justinmk/orgs",
        "received_events_url": "https://api.github.com/users/justinmk/received_events",
        "repos_url": "https://api.github.com/users/justinmk/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/justinmk",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thank you for the thorough details. Why is lazy.nvim required, are you sure it isn't related? \n\nThis issue does not occur for me in a lua / LuaLS buffer.\n\nI don't see anywhere in our hover handler that would disable diagnostics. https://github.com/neovim/neovim/blob/e049c6e4c08a141c94218672e770f86f91c27a11/runtime/lua/vim/lsp/handlers.lua#L381\n\n> NVIM v0.10.0\n\nLatest stable version is 0.10.2. Always use the latest stable version. Also try the development version to see if your issue is fixed there. The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. Check `:version` to confirm the version.",
            "created_at": "2024-10-15T09:13:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/30822#issuecomment-2413336048",
            "id": 2413336048,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30822",
            "node_id": "IC_kwDOAPphoM6P2JXw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2413336048/reactions"
            },
            "updated_at": "2024-10-15T09:16:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2413336048",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I can't reproduce with  minimal which like you provide.. version of nvim is build from last commit.\n\n```lua\nvim.opt.rtp:append('~/workspace/nvim-lspconfig/')\nvim.diagnostic.config({\n  virtual_text = true, -- Show inline diagnostic messages\n  signs = true, -- Show signs in the gutter\n  underline = true, -- Underline problematic code\n  update_in_insert = false, -- Do not update diagnostics in insert mode\n  float = { border = 'rounded' },\n})\n\n-- Keymap for hover\nvim.api.nvim_set_keymap(\n  'n',\n  'K',\n  '<cmd>lua vim.lsp.buf.hover()<CR>',\n  { noremap = true, silent = true }\n)\n\n-- Enable diagnostics globally\nvim.diagnostic.enable(0)\n\n-- Optional: Highlight the line with diagnostics\nvim.cmd([[autocmd CursorHold * lua vim.diagnostic.open_float(nil, {focus=false})]])\n\n-- On attach function to print diagnostics on hover\nlocal on_attach = function(client, bufnr)\n  -- Hover documentation keymap\n  vim.api.nvim_buf_set_keymap(\n    bufnr,\n    'n',\n    'K',\n    '<cmd>lua vim.lsp.buf.hover()<CR>',\n    { noremap = true, silent = true }\n  )\n\n  -- Print diagnostics in floating window on cursor hold\n  vim.api.nvim_create_autocmd('CursorHold', {\n    buffer = bufnr,\n    callback = function()\n      vim.diagnostic.open_float(nil, { focus = false })\n    end,\n  })\nend\n\n-- Attach LSP servers\nrequire('lspconfig').pyright.setup({\n  on_attach = on_attach,\n})\n\n```\n\n![Image](https://github.com/user-attachments/assets/76081701-8615-43c0-aa8a-729859fe044d)\n\n",
            "created_at": "2024-10-15T10:14:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/30822#issuecomment-2413477268",
            "id": 2413477268,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30822",
            "node_id": "IC_kwDOAPphoM6P2r2U",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2413477268/reactions"
            },
            "updated_at": "2024-10-15T10:14:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2413477268",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "Thanks, I think this is in fact a `lazy.nvim` issue. asked [here](https://github.com/folke/lazy.nvim/issues/1778)",
            "created_at": "2024-10-15T23:03:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/30822#issuecomment-2415314292",
            "id": 2415314292,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/30822",
            "node_id": "IC_kwDOAPphoM6P9sV0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2415314292/reactions"
            },
            "updated_at": "2024-10-15T23:03:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2415314292",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/16491459?v=4",
                "events_url": "https://api.github.com/users/yangkev/events{/privacy}",
                "followers_url": "https://api.github.com/users/yangkev/followers",
                "following_url": "https://api.github.com/users/yangkev/following{/other_user}",
                "gists_url": "https://api.github.com/users/yangkev/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/yangkev",
                "id": 16491459,
                "login": "yangkev",
                "node_id": "MDQ6VXNlcjE2NDkxNDU5",
                "organizations_url": "https://api.github.com/users/yangkev/orgs",
                "received_events_url": "https://api.github.com/users/yangkev/received_events",
                "repos_url": "https://api.github.com/users/yangkev/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/yangkev/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/yangkev/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/yangkev",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/30822/comments",
    "created_at": "2024-10-15T08:15:18Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/30822/events",
    "html_url": "https://github.com/neovim/neovim/issues/30822",
    "id": 2587999243,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "e6e6e6",
            "default": false,
            "description": "Issues that are closed as \"invalid\"",
            "id": 77997477,
            "name": "closed:invalid",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Nw==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:invalid"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/30822/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6aQbwL",
    "number": 30822,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/30822/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/30822/timeline",
    "title": "vim.lsp.buf.hover() disables diagnostics",
    "updated_at": "2024-10-15T23:03:20Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/30822",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/16491459?v=4",
        "events_url": "https://api.github.com/users/yangkev/events{/privacy}",
        "followers_url": "https://api.github.com/users/yangkev/followers",
        "following_url": "https://api.github.com/users/yangkev/following{/other_user}",
        "gists_url": "https://api.github.com/users/yangkev/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/yangkev",
        "id": 16491459,
        "login": "yangkev",
        "node_id": "MDQ6VXNlcjE2NDkxNDU5",
        "organizations_url": "https://api.github.com/users/yangkev/orgs",
        "received_events_url": "https://api.github.com/users/yangkev/received_events",
        "repos_url": "https://api.github.com/users/yangkev/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/yangkev/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/yangkev/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/yangkev",
        "user_view_type": "public"
    }
}