{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\nPlease refer to the attached video\r\nhttps://github.com/neovim/neovim/assets/1681295/8fe6b0af-719c-49fa-8398-1ca33a6ea3ba\r\n\r\n\r\n\r\n### Steps to reproduce\r\n\r\ninstall nvim head with brew\r\nopen following 1.lua code\r\n```lua\r\nlocal ns = vim.api.nvim_create_namespace('test')\r\nvim.api.nvim_buf_set_extmark(0, ns, 0, 5, {\r\n              virt_text_pos = 'inline',\r\n              ephemeral = false,\r\n              virt_text = {{'[virtual text]'}},\r\n            })\r\n```\r\n\r\n```sh\r\nnvim -u NORC 1.lua\r\n```\r\n\r\nRun `1.lua`  with `luafile %`\r\nChange to insert mode, move cursor to `1:7` and press `<BS>`; \r\n`[virtual text]` shifted to right with space added.\r\nPress `<Right>` the cursor stops on next character after virtual text `[virtual text]n|`\r\n\r\n\r\n### Expected behavior\r\n\r\nTBH, I am not sure what is the expected behavior. But I would expected the virtual text remain it's initial position.\r\nAlso If my cursor is around virtual text when press `<left>` and `<right>` it should stop on virtual text boundary   `|[virtual text]|` (the `|` stands for expected cursor position) \r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-748eae6\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nI do not know as the API may be unique to nvim\r\n\r\n### Operating system/version\r\n\r\nmacOS 10.15.2\r\n\r\n### Terminal name/version\r\n\r\nkitty\r\n\r\n### $TERM environment variable\r\n\r\nkitty-256\r\n\r\n### Installation\r\n\r\nbrew install --HEAD",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Cannot reproduce",
            "created_at": "2023-12-04T14:39:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1838772959",
            "id": 1838772959,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tmXLf",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1838772959/reactions"
            },
            "updated_at": "2023-12-04T14:39:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1838772959",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Possible duplicate of #24075",
            "created_at": "2023-12-04T14:40:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1838773813",
            "id": 1838773813,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tmXY1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1838773813/reactions"
            },
            "updated_at": "2023-12-04T14:40:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1838773813",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "There are two problems with this issue\r\n1. `<BS>` was replaced with space, this is similar to https://github.com/neovim/neovim/issues/24075. But what I saw is the virtual text was shifted to the right. https://github.com/neovim/neovim/issues/24075 does not have this issue. If I press `<BS>` fast enough, I can delete the text before the virtual text. In my vimrc, `softtabstop` is 2 and in above step to reproduce, `softtabstop` is 0 (with NORC). But have similar issue.\r\n2. incorrect virtual text boundary when move cursor.  The boundary is the length of virtual text + 1\r\n ",
            "created_at": "2023-12-04T21:31:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1839512134",
            "id": 1839512134,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tpLpG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1839512134/reactions"
            },
            "updated_at": "2023-12-04T21:33:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1839512134",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1681295?v=4",
                "events_url": "https://api.github.com/users/ray-x/events{/privacy}",
                "followers_url": "https://api.github.com/users/ray-x/followers",
                "following_url": "https://api.github.com/users/ray-x/following{/other_user}",
                "gists_url": "https://api.github.com/users/ray-x/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ray-x",
                "id": 1681295,
                "login": "ray-x",
                "node_id": "MDQ6VXNlcjE2ODEyOTU=",
                "organizations_url": "https://api.github.com/users/ray-x/orgs",
                "received_events_url": "https://api.github.com/users/ray-x/received_events",
                "repos_url": "https://api.github.com/users/ray-x/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ray-x/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ray-x/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ray-x"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Please provide steps to reproduce with `nvim --clean`, not `nvim -u NORC`.",
            "created_at": "2023-12-06T01:17:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1841918752",
            "id": 1841918752,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tyXMg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841918752/reactions"
            },
            "updated_at": "2023-12-06T01:17:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841918752",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "It not reproducible  with `--clean` nor `-u NONE`. Only reproduce with `-u NORC`. \r\nBut I can not tell which plugin breaks the behavior.",
            "created_at": "2023-12-06T01:33:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1841932316",
            "id": 1841932316,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tyagc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841932316/reactions"
            },
            "updated_at": "2023-12-06T01:33:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841932316",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1681295?v=4",
                "events_url": "https://api.github.com/users/ray-x/events{/privacy}",
                "followers_url": "https://api.github.com/users/ray-x/followers",
                "following_url": "https://api.github.com/users/ray-x/following{/other_user}",
                "gists_url": "https://api.github.com/users/ray-x/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ray-x",
                "id": 1681295,
                "login": "ray-x",
                "node_id": "MDQ6VXNlcjE2ODEyOTU=",
                "organizations_url": "https://api.github.com/users/ray-x/orgs",
                "received_events_url": "https://api.github.com/users/ray-x/received_events",
                "repos_url": "https://api.github.com/users/ray-x/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ray-x/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ray-x/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ray-x"
            }
        },
        {
            "author_association": "NONE",
            "body": "repro\r\n```lua\r\n-- repro.lua\r\nlocal ns = vim.api.nvim_create_namespace('test')\r\nvim.opt.softtabstop = 3\r\nvim.api.nvim_buf_set_extmark(0, ns, 0, 5, {\r\n              virt_text_pos = 'inline',\r\n              ephemeral = false,\r\n              virt_text = {{'[virtual text]'}},\r\n            })\r\n```\r\nsource`repro.lua` then go to `1:7` then press backspace\r\n```\r\nnvim --clean repro.lua\r\n```\r\nthe issues seems to only happen if the inline virtual text is placed before a space",
            "created_at": "2023-12-06T02:36:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/26388#issuecomment-1841990034",
            "id": 1841990034,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26388",
            "node_id": "IC_kwDOAPphoM5tyomS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841990034/reactions"
            },
            "updated_at": "2023-12-06T10:23:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1841990034",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/130783534?v=4",
                "events_url": "https://api.github.com/users/Sam-programs/events{/privacy}",
                "followers_url": "https://api.github.com/users/Sam-programs/followers",
                "following_url": "https://api.github.com/users/Sam-programs/following{/other_user}",
                "gists_url": "https://api.github.com/users/Sam-programs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Sam-programs",
                "id": 130783534,
                "login": "Sam-programs",
                "node_id": "U_kgDOB8uZLg",
                "organizations_url": "https://api.github.com/users/Sam-programs/orgs",
                "received_events_url": "https://api.github.com/users/Sam-programs/received_events",
                "repos_url": "https://api.github.com/users/Sam-programs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Sam-programs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Sam-programs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Sam-programs"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26388/comments",
    "created_at": "2023-12-04T14:02:11Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26388/events",
    "html_url": "https://github.com/neovim/neovim/issues/26388",
    "id": 2023931649,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26388/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM54or8B",
    "number": 26388,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26388/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26388/timeline",
    "title": "Strange white space padding when using  nvim_buf_set_extmark for inlay virtual text",
    "updated_at": "2023-12-06T10:23:31Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26388",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/1681295?v=4",
        "events_url": "https://api.github.com/users/ray-x/events{/privacy}",
        "followers_url": "https://api.github.com/users/ray-x/followers",
        "following_url": "https://api.github.com/users/ray-x/following{/other_user}",
        "gists_url": "https://api.github.com/users/ray-x/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ray-x",
        "id": 1681295,
        "login": "ray-x",
        "node_id": "MDQ6VXNlcjE2ODEyOTU=",
        "organizations_url": "https://api.github.com/users/ray-x/orgs",
        "received_events_url": "https://api.github.com/users/ray-x/received_events",
        "repos_url": "https://api.github.com/users/ray-x/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ray-x/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ray-x/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ray-x"
    }
}