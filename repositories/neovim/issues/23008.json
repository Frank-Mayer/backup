{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe issue that inspired using `-O2` for Release builds ( #1410 ) is now nearly a decade old (5d97f3f).\r\n\r\nSince then, compilers have gotten more reliable `-O3` output.  Should we reconsider using `-O3` in release builds?\r\n\r\n```diff\r\ndiff --git a/CMakeLists.txt b/CMakeLists.txt\r\nindex bfc8a2283..a4b08d01f 100644\r\n--- a/CMakeLists.txt\r\n+++ b/CMakeLists.txt\r\n@@ -114,12 +114,6 @@ set(NVIM_API_LEVEL 11)        # Bump this after any API change.\r\n set(NVIM_API_LEVEL_COMPAT 0)  # Adjust this after a _breaking_ API change.\r\n set(NVIM_API_PRERELEASE false)\r\n \r\n-# Default to -O2 on release builds.\r\n-if(CMAKE_C_FLAGS_RELEASE MATCHES \"-O3\")\r\n-  message(STATUS \"Replacing -O3 in CMAKE_C_FLAGS_RELEASE with -O2\")\r\n-  string(REPLACE \"-O3\" \"-O2\" CMAKE_C_FLAGS_RELEASE \"${CMAKE_C_FLAGS_RELEASE}\")\r\n-endif()\r\n-\r\n # Build-type: RelWithDebInfo\r\n \r\n # /Og means something different in MSVC\r\n```\r\n\r\nFactors to consider:\r\n1. Reliability.  Does introducing `-O3` cause any bugs?\r\n2. Performance.  Will this make anything slower?  Specifically, is #1410 reintroduced?\r\n3. Build times for Release builds will take longer\r\n\r\n\r\n\r\nSome preliminary measurements:\r\n1. the same tests (with `make test`) pass with this patch\r\n2. Neovim has weak benchmarks, but nonetheless `make benchmark` showed no statistically significant difference\r\n3. I don't think build times for Release are a big concern.  Surprisingly the difference in build times were not statistically significant.  I must have done something wrong\r\n\r\n```sh\r\n# with -O2\r\n$ hyperfine --prepare=\"make deps\" --warmup=1 \"make -j CMAKE_BUILD_TYPE=Release && make clean\"\r\nBenchmark 1: make -j CMAKE_BUILD_TYPE=Release && make clean\r\n  Time (mean ± σ):     63.856 s ±  6.216 s    [User: 2.111 s, System: 1.915 s]\r\n  Range (min … max):   57.523 s … 78.254 s    10 runs\r\n```\r\n\r\n```sh\r\n# with -O3\r\n$ hyperfine --prepare=\"make deps\" --warmup=1 \"make -j CMAKE_BUILD_TYPE=Release && make clean\"\r\nBenchmark 1: make -j CMAKE_BUILD_TYPE=Release && make clean\r\n  Time (mean ± σ):     64.284 s ±  3.792 s    [User: 2.057 s, System: 1.823 s]\r\n  Range (min … max):   59.825 s … 71.872 s    10 runs\r\n```",
    "closed_at": "2023-04-11T19:25:25Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Bigger question: Does setting `-O3` have any _advantage_? I don't believe the differences to `-O2` on most compilers are particularly relevant to Neovim.",
            "created_at": "2023-04-11T07:42:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1502844934",
            "id": 1502844934,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5Zk5gG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502844934/reactions"
            },
            "updated_at": "2023-04-11T07:42:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502844934",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think we should \"enable\" (not actively disable O3). It will result in less cmake code and we will see some evidence of the claim that -O3 is horribly buggy.",
            "created_at": "2023-04-11T08:44:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1502923927",
            "id": 1502923927,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZlMyX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502923927/reactions"
            },
            "updated_at": "2023-04-11T08:44:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502923927",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33953936?v=4",
                "events_url": "https://api.github.com/users/dundargoc/events{/privacy}",
                "followers_url": "https://api.github.com/users/dundargoc/followers",
                "following_url": "https://api.github.com/users/dundargoc/following{/other_user}",
                "gists_url": "https://api.github.com/users/dundargoc/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dundargoc",
                "id": 33953936,
                "login": "dundargoc",
                "node_id": "MDQ6VXNlcjMzOTUzOTM2",
                "organizations_url": "https://api.github.com/users/dundargoc/orgs",
                "received_events_url": "https://api.github.com/users/dundargoc/received_events",
                "repos_url": "https://api.github.com/users/dundargoc/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dundargoc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dundargoc/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dundargoc"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Removing CMake code is indeed an advantage.",
            "created_at": "2023-04-11T09:53:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1503020107",
            "id": 1503020107,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZlkRL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503020107/reactions"
            },
            "updated_at": "2023-04-11T09:53:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503020107",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Bigger question: Does setting `-O3` have any _advantage_? I don't believe the differences to `-O2` on most compilers are particularly relevant to Neovim.\r\n\r\nthe obvious answer is \"measure it\".  I did run the benchmarks but they're _very_ sparse.  Do you know of any more comprehensive benchmarks for Neovim?",
            "created_at": "2023-04-11T17:37:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1503826228",
            "id": 1503826228,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZopE0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503826228/reactions"
            },
            "updated_at": "2023-04-11T17:37:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503826228",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5297725?v=4",
                "events_url": "https://api.github.com/users/vegerot/events{/privacy}",
                "followers_url": "https://api.github.com/users/vegerot/followers",
                "following_url": "https://api.github.com/users/vegerot/following{/other_user}",
                "gists_url": "https://api.github.com/users/vegerot/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vegerot",
                "id": 5297725,
                "login": "vegerot",
                "node_id": "MDQ6VXNlcjUyOTc3MjU=",
                "organizations_url": "https://api.github.com/users/vegerot/orgs",
                "received_events_url": "https://api.github.com/users/vegerot/received_events",
                "repos_url": "https://api.github.com/users/vegerot/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vegerot/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vegerot/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vegerot"
            }
        },
        {
            "author_association": "NONE",
            "body": "I did run some benchmark and could not find statically significant differences\r\nI run this script\r\n```bash\r\nfor d in nvim*/ ; do\r\n  hyperfine -r 100 \"$d/bin/nvim -c 'call feedkeys(\\\"10j ciw test\\\") | q' do_mounts.c\" -w 20\r\ndone\r\n```\r\ndo_mounts.c is a file from linux project (>500 lines)\r\n\r\n# 03 (Release mode) march=native\r\n\r\nTime (mean ± σ): 241.7 ms ± 13.2 ms [User: 270.6 ms, System: 55.2 ms]\r\n\r\n# O3 (Release mode)\r\n\r\nTime (mean ± σ): 239.3 ms ± 13.8 ms [User: 263.2 ms, System: 56.3 ms]\r\n\r\n# O2\r\n\r\nTime (mean ± σ): 240.4 ms ± 14.6 ms [User: 267.5 ms, System: 55.0 ms]\r\n\r\n# RelWIthDebInfo\r\n\r\nTime (mean ± σ): 248.2 ms ± 15.3 ms [User: 276.1 ms, System: 57.9 ms] \r\n\r\n> Bigger question: Does setting `-O3` have any _advantage_? I don't believe the differences to `-O2` on most compilers are particularly relevant to Neovim.\r\n\r\n",
            "created_at": "2024-04-14T20:36:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-2054178091",
            "id": 2054178091,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM56cEUr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054178091/reactions"
            },
            "updated_at": "2024-04-14T20:36:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054178091",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9869317?v=4",
                "events_url": "https://api.github.com/users/ilan-schemoul/events{/privacy}",
                "followers_url": "https://api.github.com/users/ilan-schemoul/followers",
                "following_url": "https://api.github.com/users/ilan-schemoul/following{/other_user}",
                "gists_url": "https://api.github.com/users/ilan-schemoul/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ilan-schemoul",
                "id": 9869317,
                "login": "ilan-schemoul",
                "node_id": "MDQ6VXNlcjk4NjkzMTc=",
                "organizations_url": "https://api.github.com/users/ilan-schemoul/orgs",
                "received_events_url": "https://api.github.com/users/ilan-schemoul/received_events",
                "repos_url": "https://api.github.com/users/ilan-schemoul/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ilan-schemoul/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ilan-schemoul/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ilan-schemoul"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I did run some benchmark and could not find statically significant differences\r\n\r\nNot surprising. Thanks for the reference. \r\n\r\nI assume we enabled O3 simply \"because we can\". If it causes any issues we will just revert.",
            "created_at": "2024-04-14T21:55:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-2054195720",
            "id": 2054195720,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM56cIoI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054195720/reactions"
            },
            "updated_at": "2024-04-14T21:56:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054195720",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "> because we can\r\n\r\nAgreed.  jooc @ilan-schemoul what do you get for `-O1` and `-O0`?",
            "created_at": "2024-04-14T22:10:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-2054199714",
            "id": 2054199714,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM56cJmi",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054199714/reactions"
            },
            "updated_at": "2024-04-14T22:10:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054199714",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5297725?v=4",
                "events_url": "https://api.github.com/users/vegerot/events{/privacy}",
                "followers_url": "https://api.github.com/users/vegerot/followers",
                "following_url": "https://api.github.com/users/vegerot/following{/other_user}",
                "gists_url": "https://api.github.com/users/vegerot/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vegerot",
                "id": 5297725,
                "login": "vegerot",
                "node_id": "MDQ6VXNlcjUyOTc3MjU=",
                "organizations_url": "https://api.github.com/users/vegerot/orgs",
                "received_events_url": "https://api.github.com/users/vegerot/received_events",
                "repos_url": "https://api.github.com/users/vegerot/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vegerot/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vegerot/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vegerot"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I assume we enabled O3 simply \"because we can\".\r\n\r\nWe *disabled* O3 in 5d97f3fc2c for \"reasons\". I reverted that to remove the workaround. The real reason was to have less cmake code and for people to forget about O3 as the conclusion inevitably always end in \"I guess it doesn't really matter lmao\".\r\n\r\n> If it causes any issues we will just revert.\r\n\r\nThat was basically my stance. If anyone actually finds a real bug and not just a snippet of Linus Torvalds raging against O3 as \"evidence\" as to why we shouldn't use it then that would be good enough for me.",
            "created_at": "2024-04-14T22:11:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-2054200000",
            "id": 2054200000,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM56cJrA",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 4,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 4,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054200000/reactions"
            },
            "updated_at": "2024-04-14T22:11:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054200000",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33953936?v=4",
                "events_url": "https://api.github.com/users/dundargoc/events{/privacy}",
                "followers_url": "https://api.github.com/users/dundargoc/followers",
                "following_url": "https://api.github.com/users/dundargoc/following{/other_user}",
                "gists_url": "https://api.github.com/users/dundargoc/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dundargoc",
                "id": 33953936,
                "login": "dundargoc",
                "node_id": "MDQ6VXNlcjMzOTUzOTM2",
                "organizations_url": "https://api.github.com/users/dundargoc/orgs",
                "received_events_url": "https://api.github.com/users/dundargoc/received_events",
                "repos_url": "https://api.github.com/users/dundargoc/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dundargoc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dundargoc/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dundargoc"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Agreed. jooc @ilan-schemoul what do you get for `-O1` and `-O0`?\r\n\r\n## Results\r\n\r\nOk. I did it again but this time I used --clean so my plugins don't interfere with the results (and don't slow down the process too much). Note that I check with \"diff\" command that the binaries were all indeed different from one another.\r\n\r\nBenchmark 1: nvim-O0//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):      10.2 ms ±   0.5 ms    [User: 7.0 ms, System: 2.7 ms]\r\n  Range (min … max):     9.2 ms …  12.9 ms    800 runs\r\n\r\nBenchmark 1: nvim-O1//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):       9.5 ms ±   0.5 ms    [User: 6.1 ms, System: 2.9 ms]\r\n  Range (min … max):     8.6 ms …  11.4 ms    800 runs\r\n\r\nBenchmark 1: nvim-O2//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):       9.6 ms ±   0.5 ms    [User: 6.1 ms, System: 3.0 ms]\r\n  Range (min … max):     8.5 ms …  11.7 ms    800 runs\r\n\r\nBenchmark 1: nvim-O3-native//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):       9.7 ms ±   0.5 ms    [User: 6.4 ms, System: 2.8 ms]\r\n  Range (min … max):     8.7 ms …  12.3 ms    800 runs\r\n\r\nBenchmark 1: nvim-O3//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):       9.8 ms ±   0.6 ms    [User: 6.4 ms, System: 2.9 ms]\r\n  Range (min … max):     8.7 ms …  13.0 ms    800 runs\r\n\r\nBenchmark 1: nvim-relwithdebinfo//bin/nvim --clean -c 'call feedkeys(\"10j ciw test\") | q' do_mounts.c\r\n  Time (mean ± σ):      10.4 ms ±   0.5 ms    [User: 7.3 ms, System: 2.6 ms]\r\n  Range (min … max):     9.3 ms …  12.3 ms    800 runs\r\n\r\n## Time (to understand how much CPU time is used vs I/O time)\r\n\r\nI also timed neovim with the arguments as above. It shows that most time is spent on I/O (makes sense for a text editor) and less than 10% is userland CPU time\r\nExecuted in  138.56 millis    fish           external\r\n   usr time   11.87 millis  315.00 micros   11.55 millis\r\n   sys time   30.66 millis  221.00 micros   30.44 millis\r\n\r\nIf I now time without \"--clean\" so it means neovim gets to load my 70 plugins I get 30% of user CPU time (but I guess it's mostly lua not compiled code so not much to optimize with -O3 there) : \r\nExecuted in  418.60 millis    fish           external\r\n   usr time  131.81 millis  348.00 micros  131.47 millis\r\n   sys time  109.02 millis  245.00 micros  108.78 millis\r\n\r\n## Strace\r\n\r\nStrace on nvim (both with and without --clean arg) shows that ~50-90% of time is spent on `wait4` despite the facts there is only 4 calls (including 1 error).\r\n\r\n## Warm up\r\nLess than 10% is CPU time without plugins so passing -O3 or whatever to the compiler doesn't do much. When CPU time becomes relevant it's when I get a lot of plugin so probably more lua than C code. So in short no need to worry about compiler flags when CPU waits for I/O results :)",
            "created_at": "2024-04-14T23:30:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-2054220392",
            "id": 2054220392,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM56cOpo",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 1,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054220392/reactions"
            },
            "updated_at": "2024-04-14T23:36:52Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2054220392",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9869317?v=4",
                "events_url": "https://api.github.com/users/ilan-schemoul/events{/privacy}",
                "followers_url": "https://api.github.com/users/ilan-schemoul/followers",
                "following_url": "https://api.github.com/users/ilan-schemoul/following{/other_user}",
                "gists_url": "https://api.github.com/users/ilan-schemoul/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ilan-schemoul",
                "id": 9869317,
                "login": "ilan-schemoul",
                "node_id": "MDQ6VXNlcjk4NjkzMTc=",
                "organizations_url": "https://api.github.com/users/ilan-schemoul/orgs",
                "received_events_url": "https://api.github.com/users/ilan-schemoul/received_events",
                "repos_url": "https://api.github.com/users/ilan-schemoul/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ilan-schemoul/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ilan-schemoul/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ilan-schemoul"
            }
        }
    ],
    "comments": 9,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23008/comments",
    "created_at": "2023-04-10T23:50:12Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23008/events",
    "html_url": "https://github.com/neovim/neovim/issues/23008",
    "id": 1661558515,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "issues reporting performance problems",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23008/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5jCV7z",
    "number": 23008,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 2,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23008/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23008/timeline",
    "title": "Consider enabling -O3 optimizations for Release builds",
    "updated_at": "2024-04-14T23:36:52Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23008",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5297725?v=4",
        "events_url": "https://api.github.com/users/vegerot/events{/privacy}",
        "followers_url": "https://api.github.com/users/vegerot/followers",
        "following_url": "https://api.github.com/users/vegerot/following{/other_user}",
        "gists_url": "https://api.github.com/users/vegerot/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vegerot",
        "id": 5297725,
        "login": "vegerot",
        "node_id": "MDQ6VXNlcjUyOTc3MjU=",
        "organizations_url": "https://api.github.com/users/vegerot/orgs",
        "received_events_url": "https://api.github.com/users/vegerot/received_events",
        "repos_url": "https://api.github.com/users/vegerot/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vegerot/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vegerot/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vegerot"
    }
}