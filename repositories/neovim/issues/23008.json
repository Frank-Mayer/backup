{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe issue that inspired using `-O2` for Release builds ( #1410 ) is now nearly a decade old (5d97f3f).\r\n\r\nSince then, compilers have gotten more reliable `-O3` output.  Should we reconsider using `-O3` in release builds?\r\n\r\n```diff\r\ndiff --git a/CMakeLists.txt b/CMakeLists.txt\r\nindex bfc8a2283..a4b08d01f 100644\r\n--- a/CMakeLists.txt\r\n+++ b/CMakeLists.txt\r\n@@ -114,12 +114,6 @@ set(NVIM_API_LEVEL 11)        # Bump this after any API change.\r\n set(NVIM_API_LEVEL_COMPAT 0)  # Adjust this after a _breaking_ API change.\r\n set(NVIM_API_PRERELEASE false)\r\n \r\n-# Default to -O2 on release builds.\r\n-if(CMAKE_C_FLAGS_RELEASE MATCHES \"-O3\")\r\n-  message(STATUS \"Replacing -O3 in CMAKE_C_FLAGS_RELEASE with -O2\")\r\n-  string(REPLACE \"-O3\" \"-O2\" CMAKE_C_FLAGS_RELEASE \"${CMAKE_C_FLAGS_RELEASE}\")\r\n-endif()\r\n-\r\n # Build-type: RelWithDebInfo\r\n \r\n # /Og means something different in MSVC\r\n```\r\n\r\nFactors to consider:\r\n1. Reliability.  Does introducing `-O3` cause any bugs?\r\n2. Performance.  Will this make anything slower?  Specifically, is #1410 reintroduced?\r\n3. Build times for Release builds will take longer\r\n\r\n\r\n\r\nSome preliminary measurements:\r\n1. the same tests (with `make test`) pass with this patch\r\n2. Neovim has weak benchmarks, but nonetheless `make benchmark` showed no statistically significant difference\r\n3. I don't think build times for Release are a big concern.  Surprisingly the difference in build times were not statistically significant.  I must have done something wrong\r\n\r\n```sh\r\n# with -O2\r\n$ hyperfine --prepare=\"make deps\" --warmup=1 \"make -j CMAKE_BUILD_TYPE=Release && make clean\"\r\nBenchmark 1: make -j CMAKE_BUILD_TYPE=Release && make clean\r\n  Time (mean ± σ):     63.856 s ±  6.216 s    [User: 2.111 s, System: 1.915 s]\r\n  Range (min … max):   57.523 s … 78.254 s    10 runs\r\n```\r\n\r\n```sh\r\n# with -O3\r\n$ hyperfine --prepare=\"make deps\" --warmup=1 \"make -j CMAKE_BUILD_TYPE=Release && make clean\"\r\nBenchmark 1: make -j CMAKE_BUILD_TYPE=Release && make clean\r\n  Time (mean ± σ):     64.284 s ±  3.792 s    [User: 2.057 s, System: 1.823 s]\r\n  Range (min … max):   59.825 s … 71.872 s    10 runs\r\n```",
    "closed_at": "2023-04-11T19:25:25Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Bigger question: Does setting `-O3` have any _advantage_? I don't believe the differences to `-O2` on most compilers are particularly relevant to Neovim.",
            "created_at": "2023-04-11T07:42:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1502844934",
            "id": 1502844934,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5Zk5gG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502844934/reactions"
            },
            "updated_at": "2023-04-11T07:42:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502844934",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I think we should \"enable\" (not actively disable O3). It will result in less cmake code and we will see some evidence of the claim that -O3 is horribly buggy.",
            "created_at": "2023-04-11T08:44:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1502923927",
            "id": 1502923927,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZlMyX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502923927/reactions"
            },
            "updated_at": "2023-04-11T08:44:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1502923927",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/33953936?v=4",
                "events_url": "https://api.github.com/users/dundargoc/events{/privacy}",
                "followers_url": "https://api.github.com/users/dundargoc/followers",
                "following_url": "https://api.github.com/users/dundargoc/following{/other_user}",
                "gists_url": "https://api.github.com/users/dundargoc/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dundargoc",
                "id": 33953936,
                "login": "dundargoc",
                "node_id": "MDQ6VXNlcjMzOTUzOTM2",
                "organizations_url": "https://api.github.com/users/dundargoc/orgs",
                "received_events_url": "https://api.github.com/users/dundargoc/received_events",
                "repos_url": "https://api.github.com/users/dundargoc/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dundargoc/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dundargoc/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dundargoc"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Removing CMake code is indeed an advantage.",
            "created_at": "2023-04-11T09:53:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1503020107",
            "id": 1503020107,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZlkRL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503020107/reactions"
            },
            "updated_at": "2023-04-11T09:53:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503020107",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Bigger question: Does setting `-O3` have any _advantage_? I don't believe the differences to `-O2` on most compilers are particularly relevant to Neovim.\r\n\r\nthe obvious answer is \"measure it\".  I did run the benchmarks but they're _very_ sparse.  Do you know of any more comprehensive benchmarks for Neovim?",
            "created_at": "2023-04-11T17:37:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/23008#issuecomment-1503826228",
            "id": 1503826228,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23008",
            "node_id": "IC_kwDOAPphoM5ZopE0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503826228/reactions"
            },
            "updated_at": "2023-04-11T17:37:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1503826228",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5297725?v=4",
                "events_url": "https://api.github.com/users/vegerot/events{/privacy}",
                "followers_url": "https://api.github.com/users/vegerot/followers",
                "following_url": "https://api.github.com/users/vegerot/following{/other_user}",
                "gists_url": "https://api.github.com/users/vegerot/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/vegerot",
                "id": 5297725,
                "login": "vegerot",
                "node_id": "MDQ6VXNlcjUyOTc3MjU=",
                "organizations_url": "https://api.github.com/users/vegerot/orgs",
                "received_events_url": "https://api.github.com/users/vegerot/received_events",
                "repos_url": "https://api.github.com/users/vegerot/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/vegerot/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/vegerot/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/vegerot"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23008/comments",
    "created_at": "2023-04-10T23:50:12Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23008/events",
    "html_url": "https://github.com/neovim/neovim/issues/23008",
    "id": 1661558515,
    "labels": [
        {
            "color": "c2e0c6",
            "default": true,
            "description": "feature request",
            "id": 77997476,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3Ng==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/enhancement"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "issues reporting performance problems",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23008/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5jCV7z",
    "number": 23008,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 1,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 1,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23008/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23008/timeline",
    "title": "Consider enabling -O3 optimizations for Release builds",
    "updated_at": "2023-07-16T12:12:45Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23008",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5297725?v=4",
        "events_url": "https://api.github.com/users/vegerot/events{/privacy}",
        "followers_url": "https://api.github.com/users/vegerot/followers",
        "following_url": "https://api.github.com/users/vegerot/following{/other_user}",
        "gists_url": "https://api.github.com/users/vegerot/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/vegerot",
        "id": 5297725,
        "login": "vegerot",
        "node_id": "MDQ6VXNlcjUyOTc3MjU=",
        "organizations_url": "https://api.github.com/users/vegerot/orgs",
        "received_events_url": "https://api.github.com/users/vegerot/received_events",
        "repos_url": "https://api.github.com/users/vegerot/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/vegerot/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/vegerot/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/vegerot"
    }
}