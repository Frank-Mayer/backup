{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\n`basedpyright` is an enhanced version of `pyright` language server which supports code actions which imports any module. The problem is, code actions are expanded incorrectly for imports. I can confirm that this language server works perfectly (even in this scenario) in emacs.\n\n### Steps to reproduce\n\nThis is the bare-minimal config which can reproduce this issue\n\n```lua\nlocal lazypath = vim.fn.stdpath(\"data\") .. \"/lazy/lazy.nvim\"\nif not vim.loop.fs_stat(lazypath) then\n\tvim.fn.system({\n\t\t\"git\",\n\t\t\"clone\",\n\t\t\"--filter=blob:none\",\n\t\t\"https://github.com/folke/lazy.nvim.git\",\n\t\t\"--branch=stable\", -- latest stable release\n\t\tlazypath,\n\t})\nend\n\nvim.opt.rtp:prepend(lazypath)\n\nrequire(\"lazy\").setup({\n\tspec = {\n\t\t{\n\t\t\t\"neovim/nvim-lspconfig\",\n\t\t\tconfig = function()\n\t\t\t\tlocal lspconfig = require(\"lspconfig\")\n\t\t\t\tlspconfig.basedpyright.setup({})\n\t\t\tend,\n\t\t},\n\t},\n})\n```\n\nwith this config, following the given steps will reproduce this issue...\n1. Install `basedpyright` from `pip`\n2. Open any test python file\n3. type `shlex.split(\"echo hi\")` or any other code segment which uses any module, but does not import it\n4. hover over the module name in the code segment and run command: `lua vim.lsp.buf.code_action()`. It will give a few code suggestions\n5. Select the code action with `import` in details (e.g: `import subprocess`, `import shlex`)\n\n### Expected behavior\n\nThe code action expands incorrectly and messes the import (typically the first line of code)\n\nbefore expansion:\n![Image](https://github.com/user-attachments/assets/e5717105-9f37-47cf-9f45-6b179678d41b)\n\nafter expansion:\n![Image](https://github.com/user-attachments/assets/7d6a59c4-8e2b-4535-969a-d755c3785213)\n\nexpected behavior:\n![Image](https://github.com/user-attachments/assets/fc42e6bb-aaac-4068-a783-78e81a4516e9)\n\n\n### Nvim version (nvim -v)\n\n0.10.2 Release\n\n### Language server name/version\n\nbasedpyright\n\n### Operating system/version\n\nFedora 41\n\n### Log file\n\nhttps://gist.github.com/Rid1FZ/6e4f9f8d419e142ac64e72444460e706",
    "closed_at": "2024-12-23T10:38:18Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
        "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
        "followers_url": "https://api.github.com/users/glepnir/followers",
        "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
        "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/glepnir",
        "id": 41671631,
        "login": "glepnir",
        "node_id": "MDQ6VXNlcjQxNjcxNjMx",
        "organizations_url": "https://api.github.com/users/glepnir/orgs",
        "received_events_url": "https://api.github.com/users/glepnir/received_events",
        "repos_url": "https://api.github.com/users/glepnir/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/glepnir",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "@glepnir `:PyrightOrganizeImports` works perfectly fine. If I already have some imports, this commands sorts them nicely...\n\nbefore `:PyrightOrganizeImports`:\n![Image](https://github.com/user-attachments/assets/b6507d89-8584-4e26-8504-d251a069e6b4)\n\nafter `:PyrightOrganizeImports`:\n![Image](https://github.com/user-attachments/assets/e3b32df2-9921-4473-94cb-672be3f190ba)\n\n\n",
            "created_at": "2024-12-21T09:55:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/31655#issuecomment-2558069614",
            "id": 2558069614,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31655",
            "node_id": "IC_kwDOAPphoM6YeQtu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2558069614/reactions"
            },
            "updated_at": "2024-12-21T09:55:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2558069614",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/92540820?v=4",
                "events_url": "https://api.github.com/users/Rid1FZ/events{/privacy}",
                "followers_url": "https://api.github.com/users/Rid1FZ/followers",
                "following_url": "https://api.github.com/users/Rid1FZ/following{/other_user}",
                "gists_url": "https://api.github.com/users/Rid1FZ/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Rid1FZ",
                "id": 92540820,
                "login": "Rid1FZ",
                "node_id": "U_kgDOBYQPlA",
                "organizations_url": "https://api.github.com/users/Rid1FZ/orgs",
                "received_events_url": "https://api.github.com/users/Rid1FZ/received_events",
                "repos_url": "https://api.github.com/users/Rid1FZ/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Rid1FZ/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Rid1FZ/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Rid1FZ",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "nvm i deleted comment.  this is reulst from server \n\n```\n  result = { {\n      edit = {\n        changes = {\n          [\"file:///Users/mw/workspace/neovim/test.py\"] = { {\n              newText = \"shlex\",\n              range = {\n                [\"end\"] = {\n                  character = 5,\n                  line = 0\n                },\n                start = {\n                  character = 0,\n                  line = 0\n                }\n              }\n            }, {\n              newText = \"import shlex\\n\\n\\n\",\n              range = {\n                [\"end\"] = {\n                  character = 0,\n                  line = 0\n                },\n                start = {\n                  character = 0,\n                  line = 0\n                }\n              }\n            } }\n        }\n      },\n      kind = \"quickfix\",\n      title = \"import shlex\"\n    }, {\n      edit = {\n        changes = {\n          [\"file:///Users/mw/workspace/neovim/test.py\"] = { {\n              newText = \"shlex\",\n              range = {\n                [\"end\"] = {\n                  character = 5,\n                  line = 0\n                },\n                start = {\n                  character = 0,\n                  line = 0\n                }\n              }\n            }, {\n              newText = \"from shlex import shlex\\n\\n\\n\",\n              range = {\n                [\"end\"] = {\n                  character = 0,\n                  line = 0\n                },\n                start = {\n                  character = 0,\n                  line = 0\n                }\n              }\n            } }\n        }\n      },\n      kind = \"quickfix\",\n      title = \"from shlex import shlex\"\n    } }\n\n```",
            "created_at": "2024-12-21T10:06:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/31655#issuecomment-2558072170",
            "id": 2558072170,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31655",
            "node_id": "IC_kwDOAPphoM6YeRVq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2558072170/reactions"
            },
            "updated_at": "2024-12-21T10:06:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2558072170",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "because the order of `apply_text_edits`  if change to this will solve problem. therre is revert by https://github.com/neovim/neovim/pull/29212 and relate  https://github.com/neovim/neovim/issues/29202 https://github.com/neovim/neovim/pull/29877 https://github.com/neovim/neovim/issues/29392\nI think you can continue publish comment on https://github.com/neovim/neovim/issues/29202 if anything still need discuss there we can reopen the old issue\n\n```diff\ndiff --git a/runtime/lua/vim/lsp/util.lua b/runtime/lua/vim/lsp/util.lua\nindex 6bee5bc31..593e11739 100644\n--- a/runtime/lua/vim/lsp/util.lua\n+++ b/runtime/lua/vim/lsp/util.lua\n@@ -338,7 +338,7 @@ function M.apply_text_edits(text_edits, bufnr, position_encoding)\n     if a.range.start.character ~= b.range.start.character then\n       return a.range.start.character > b.range.start.character\n     end\n-    return a._index > b._index\n+    return a._index < b._index\n   end)\n```",
            "created_at": "2024-12-23T10:32:07Z",
            "html_url": "https://github.com/neovim/neovim/issues/31655#issuecomment-2559396791",
            "id": 2559396791,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31655",
            "node_id": "IC_kwDOAPphoM6YjUu3",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2559396791/reactions"
            },
            "updated_at": "2024-12-23T10:38:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2559396791",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/41671631?v=4",
                "events_url": "https://api.github.com/users/glepnir/events{/privacy}",
                "followers_url": "https://api.github.com/users/glepnir/followers",
                "following_url": "https://api.github.com/users/glepnir/following{/other_user}",
                "gists_url": "https://api.github.com/users/glepnir/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/glepnir",
                "id": 41671631,
                "login": "glepnir",
                "node_id": "MDQ6VXNlcjQxNjcxNjMx",
                "organizations_url": "https://api.github.com/users/glepnir/orgs",
                "received_events_url": "https://api.github.com/users/glepnir/received_events",
                "repos_url": "https://api.github.com/users/glepnir/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/glepnir/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/glepnir/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/glepnir",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31655/comments",
    "created_at": "2024-12-20T13:41:25Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31655/events",
    "html_url": "https://github.com/neovim/neovim/issues/31655",
    "id": 2752768537,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as duplicates of other issues",
            "id": 3221613764,
            "name": "closed:duplicate",
            "node_id": "MDU6TGFiZWwzMjIxNjEzNzY0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31655/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6kE-oZ",
    "number": 31655,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31655/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31655/timeline",
    "title": "LSP: incorrect code action expansion for `basedpyright` language server",
    "updated_at": "2024-12-23T10:38:50Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31655",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/92540820?v=4",
        "events_url": "https://api.github.com/users/Rid1FZ/events{/privacy}",
        "followers_url": "https://api.github.com/users/Rid1FZ/followers",
        "following_url": "https://api.github.com/users/Rid1FZ/following{/other_user}",
        "gists_url": "https://api.github.com/users/Rid1FZ/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Rid1FZ",
        "id": 92540820,
        "login": "Rid1FZ",
        "node_id": "U_kgDOBYQPlA",
        "organizations_url": "https://api.github.com/users/Rid1FZ/orgs",
        "received_events_url": "https://api.github.com/users/Rid1FZ/received_events",
        "repos_url": "https://api.github.com/users/Rid1FZ/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Rid1FZ/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Rid1FZ/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Rid1FZ",
        "user_view_type": "public"
    }
}