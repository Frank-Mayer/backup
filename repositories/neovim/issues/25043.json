{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nUsing `vim.loop.walk` in any way results in nvim crashing with a segmentation fault.\n\n### Steps to reproduce\n\n```\r\n$ env -i vim -u DEFAULTS -es +'lua vim.loop.walk(function() print(\"ohai\") end)'\r\nvim: src/loop.c:85: luv_walk_cb: Assertion `data && data->ref < 0x1000000' failed.\r\nAborted (core dumped)\r\n```\r\n\r\nI got that particular message from v0.4.4. Newer versions crash silently (seems worse, to me).\n\n### Expected behavior\n\nPrint `ohai` a bunch of times.\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0-dev-1046+g3afbf4745, NVIM v0.9.1, NVIM v0.4.4\n\n### Vim (not Nvim) behaves the same?\n\nn/a\n\n### Operating system/version\n\n$ uname -a Linux penguin 5.15.117-19679-g172023e664f7 #1 SMP PREEMPT Fri Aug 18 18:07:47 PDT 2023 x86_64 GNU/Linux\n\n### Terminal name/version\n\nhterm\n\n### $TERM environment variable\n\nn/a\n\n### Installation\n\nsource, brew, debian (respectively)",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "All versions of neovim (that I have) have a `vim.loop.walk` but some newer versions also have a `vim.uv.walk`. The behavior is identical though regardless of which alias is used.",
            "created_at": "2023-09-07T22:03:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/25043#issuecomment-1710822295",
            "id": 1710822295,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25043",
            "node_id": "IC_kwDOAPphoM5l-ROX",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1710822295/reactions"
            },
            "updated_at": "2023-09-07T22:03:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1710822295",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/640328?v=4",
                "events_url": "https://api.github.com/users/bukzor/events{/privacy}",
                "followers_url": "https://api.github.com/users/bukzor/followers",
                "following_url": "https://api.github.com/users/bukzor/following{/other_user}",
                "gists_url": "https://api.github.com/users/bukzor/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bukzor",
                "id": 640328,
                "login": "bukzor",
                "node_id": "MDQ6VXNlcjY0MDMyOA==",
                "organizations_url": "https://api.github.com/users/bukzor/orgs",
                "received_events_url": "https://api.github.com/users/bukzor/received_events",
                "repos_url": "https://api.github.com/users/bukzor/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bukzor/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bukzor/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bukzor"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Libluvs wrapper around uv_walk assumes that libluv (the lua bindings) make exclusive use of the uv event loop. This leads to a crash in nvim as libluv then cannot understand handles that is owned by nvim core, not libluv.\r\n\r\nThis could be fixed in libluv at the price of making the implementation more complicated. Alternatively, we could change `vim.uv.walk` to just immediately throw an error.\r\n\r\nSo I am curious what the usecase of using `uv.walk()` is here. There might be another way to solve the underlying problem. ",
            "created_at": "2023-09-07T22:30:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/25043#issuecomment-1710842449",
            "id": 1710842449,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/25043",
            "node_id": "IC_kwDOAPphoM5l-WJR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1710842449/reactions"
            },
            "updated_at": "2023-09-07T22:30:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1710842449",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25043/comments",
    "created_at": "2023-09-07T20:51:40Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/25043/events",
    "html_url": "https://github.com/neovim/neovim/issues/25043",
    "id": 1886549227,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/25043/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5wcnTr",
    "number": 25043,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/25043/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/25043/timeline",
    "title": "segfault: vim.uv.walk",
    "updated_at": "2023-09-07T22:30:53Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/25043",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/640328?v=4",
        "events_url": "https://api.github.com/users/bukzor/events{/privacy}",
        "followers_url": "https://api.github.com/users/bukzor/followers",
        "following_url": "https://api.github.com/users/bukzor/following{/other_user}",
        "gists_url": "https://api.github.com/users/bukzor/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/bukzor",
        "id": 640328,
        "login": "bukzor",
        "node_id": "MDQ6VXNlcjY0MDMyOA==",
        "organizations_url": "https://api.github.com/users/bukzor/orgs",
        "received_events_url": "https://api.github.com/users/bukzor/received_events",
        "repos_url": "https://api.github.com/users/bukzor/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/bukzor/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bukzor/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/bukzor"
    }
}