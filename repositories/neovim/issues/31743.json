{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nHi, I encountered this problem with the trim.nvim plugin, which uses `:keeppatterns %s/...` under the hood. Every time I wrote a file with this plugin enabled, my last substitution was just an empty string. I reported this [here](https://github.com/cappyzawa/trim.nvim/issues/27). I have since replaced trim.nvim with conform.nvim, but in order to help the plugin author out, I wrote up repro steps for him and discovered, that the problem seems to come from neovim itself instead of the plugin.\n\nI did find multiple issues in the neovim repo that somewhat relate to this problem, but I got the impression that `:keeppatterns` should already work as I expected. Especially since `:help :keeppatterns` also already says it should preserve the substitution string.\n\n### Steps to reproduce\n\n1. Start neovim with `nvim --clean test.txt`\n2. Add these buffer contents:\n   ```\n   foo\n   foo\n   foo\n   ```\n2. Execute `:%s/foo/bar/`.\n3. Observe, that all \"foo\"s have been replaced by \"bar\"s.\n4. Press \"u\" to undo.\n5. Execute `:keeppatterns %s/bla//`\n6. Observe that nothing happened to the buffer.\n7. Execute `:%s/foo/~/`.\n8. Observe that all \"foo\"s have been replaced with an empty string. The expectation is that they would be replaced by \"bar\"s.\n9. Press \"u\" to undo.\n10. Execute `:%s/foo/bar/`.\n11. Press \"u\" to undo.\n12. Execute `%s/foo/~/`.\n13. Observe that all \"foo\"s have been replaced by \"bar\"s.\n\nNote that this can also be reproduced with the `g&` normal mode command.\n\n### Expected behavior\n\nThe substitution pattern should remain the one of the last substitute command called without `:keeppatterns`.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0-dev-1419+g46c7faa00b\n\n### Vim (not Nvim) behaves the same?\n\nyes, vim 9.1, patches 1-954\n\n### Operating system/version\n\nLinux 6.12.6-arch1-1\n\n### Terminal name/version\n\nwezterm 20240922-151228-2b76c63b\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nAUR: neovim-git",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "The `~` string is not a pattern",
            "created_at": "2024-12-27T08:55:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/31743#issuecomment-2563476630",
            "id": 2563476630,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31743",
            "node_id": "IC_kwDOAPphoM6Yy4yW",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2563476630/reactions"
            },
            "updated_at": "2024-12-27T08:55:15Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2563476630",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> The `~` string is not a pattern\n\nYes it is. Try `:help /~`. Or do you mean it is not a \"pattern\" and `:keeppatterns` should not apply?",
            "created_at": "2024-12-27T16:15:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/31743#issuecomment-2563841716",
            "id": 2563841716,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31743",
            "node_id": "IC_kwDOAPphoM6Y0R60",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2563841716/reactions"
            },
            "updated_at": "2024-12-27T16:20:31Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2563841716",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/9497302?v=4",
                "events_url": "https://api.github.com/users/kmoschcau/events{/privacy}",
                "followers_url": "https://api.github.com/users/kmoschcau/followers",
                "following_url": "https://api.github.com/users/kmoschcau/following{/other_user}",
                "gists_url": "https://api.github.com/users/kmoschcau/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/kmoschcau",
                "id": 9497302,
                "login": "kmoschcau",
                "node_id": "MDQ6VXNlcjk0OTczMDI=",
                "organizations_url": "https://api.github.com/users/kmoschcau/orgs",
                "received_events_url": "https://api.github.com/users/kmoschcau/received_events",
                "repos_url": "https://api.github.com/users/kmoschcau/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/kmoschcau/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/kmoschcau/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/kmoschcau",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31743/comments",
    "created_at": "2024-12-27T07:43:33Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31743/events",
    "html_url": "https://github.com/neovim/neovim/issues/31743",
    "id": 2760534230,
    "labels": [
        {
            "color": "FBCA04",
            "default": false,
            "description": "upstream issue that must be fixed in Vim first",
            "id": 2639399975,
            "name": "needs:vim-patch",
            "node_id": "MDU6TGFiZWwyNjM5Mzk5OTc1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:vim-patch"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31743/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 261,
        "created_at": "2014-11-26T22:13:11Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk",
            "user_view_type": "public"
        },
        "description": "We don't plan to work on this, but will accept high quality contributions from someone who will own the feature and follow up on bug reports.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/9",
        "id": 881978,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lODgxOTc4",
        "number": 9,
        "open_issues": 285,
        "state": "open",
        "title": "needs-owner",
        "updated_at": "2024-12-30T21:09:18Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/9"
    },
    "node_id": "I_kwDOAPphoM6kimjW",
    "number": 31743,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31743/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31743/timeline",
    "title": "`:keeppatterns` does not keep the last substitution string",
    "updated_at": "2024-12-30T21:09:18Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31743",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/9497302?v=4",
        "events_url": "https://api.github.com/users/kmoschcau/events{/privacy}",
        "followers_url": "https://api.github.com/users/kmoschcau/followers",
        "following_url": "https://api.github.com/users/kmoschcau/following{/other_user}",
        "gists_url": "https://api.github.com/users/kmoschcau/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/kmoschcau",
        "id": 9497302,
        "login": "kmoschcau",
        "node_id": "MDQ6VXNlcjk0OTczMDI=",
        "organizations_url": "https://api.github.com/users/kmoschcau/orgs",
        "received_events_url": "https://api.github.com/users/kmoschcau/received_events",
        "repos_url": "https://api.github.com/users/kmoschcau/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/kmoschcau/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/kmoschcau/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/kmoschcau",
        "user_view_type": "public"
    }
}