{
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/29580810?v=4",
        "events_url": "https://api.github.com/users/famiu/events{/privacy}",
        "followers_url": "https://api.github.com/users/famiu/followers",
        "following_url": "https://api.github.com/users/famiu/following{/other_user}",
        "gists_url": "https://api.github.com/users/famiu/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/famiu",
        "id": 29580810,
        "login": "famiu",
        "node_id": "MDQ6VXNlcjI5NTgwODEw",
        "organizations_url": "https://api.github.com/users/famiu/orgs",
        "received_events_url": "https://api.github.com/users/famiu/received_events",
        "repos_url": "https://api.github.com/users/famiu/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/famiu/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/famiu/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/famiu"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/29580810?v=4",
            "events_url": "https://api.github.com/users/famiu/events{/privacy}",
            "followers_url": "https://api.github.com/users/famiu/followers",
            "following_url": "https://api.github.com/users/famiu/following{/other_user}",
            "gists_url": "https://api.github.com/users/famiu/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/famiu",
            "id": 29580810,
            "login": "famiu",
            "node_id": "MDQ6VXNlcjI5NTgwODEw",
            "organizations_url": "https://api.github.com/users/famiu/orgs",
            "received_events_url": "https://api.github.com/users/famiu/received_events",
            "repos_url": "https://api.github.com/users/famiu/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/famiu/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/famiu/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/famiu"
        }
    ],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nWith the below plugin, while mid-search-and-replace, hitting `<C-E>` (to swap `'inccommand'` between `split` and `nosplit`) causes nvim to `exit(134)`.\r\n\r\nIt always seems to happen on the third toggle.\r\n<details>\r\n<summary>\r\nDespite having a `RelWithDebugInfo` build, I can't get a backtrace better than this on macOS\r\n</summary>\r\n\r\n```\r\n* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 2.4\r\n    frame #0: 0x00007ff801530ac6 libsystem_c.dylib`exit\r\n    frame #1: 0x000000010215ba0a nvim`os_exit + 202\r\n  * frame #2: 0x000000010227fda3 nvim`exit_event.llvm.6961691851166778423 + 99\r\n    frame #3: 0x00000001024ac945 nvim`ui_client_run + 293\r\n    frame #4: 0x0000000102158917 nvim`main + 10423\r\n    frame #5: 0x00007ff801307310 dyld`start + 2432\r\n```\r\n\r\nand I don't get breakpoint hits on either [`exit_from_channel`](https://github.com/neovim/neovim/blob/55d346fc2683a18256320eaae75eb4f3137dcced/src/nvim/event/process.c#L434-L434) or [`exit_delay_cb`](https://github.com/neovim/neovim/blob/55d346fc2683a18256320eaae75eb4f3137dcced/src/nvim/event/process.c#L409-L409)\r\n</details>\r\n\r\n<details>\r\n<summary>\r\n\r\nI get a much better backtrace on my raspberry pi, albeit with an older nvim, centered on [this `abort`](https://github.com/neovim/neovim/blob/d215dae0e0908d464d70e5645f3e2690bd9caf60/src/nvim/ex_getln.c#L2442-L2442)\r\n\r\n</summary>\r\n\r\n```\r\n(gdb) bt\r\n#0  __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50\r\n#1  0x76d50364 in __GI_abort () at abort.c:79\r\n#2  0x001fa5c0 in cmdpreview_may_show (s=s@entry=0x7edd5098) at /home/pi/src/neovim/src/nvim/ex_getln.c:2442\r\n#3  0x001fd054 in command_line_changed (s=s@entry=0x7edd5098) at /home/pi/src/neovim/src/nvim/ex_getln.c:2539\r\n#4  0x001fd82c in command_line_handle_key (s=s@entry=0x7edd5098) at /home/pi/src/neovim/src/nvim/ex_getln.c:1796\r\n#5  0x001fe1d0 in command_line_execute (state=0x7edd5098, key=<optimized out>) at /home/pi/src/neovim/src/nvim/ex_getln.c:1332\r\n#6  0x000b6df0 in state_enter (s=0x7edd5098) at /home/pi/src/neovim/src/nvim/state.c:99\r\n#7  0x001fb910 in command_line_enter (firstc=firstc@entry=58, count=count@entry=1, indent=indent@entry=0,\r\n    clear_ccline=clear_ccline@entry=true) at /home/pi/src/neovim/src/nvim/ex_getln.c:820\r\n#8  0x001fbe38 in getcmdline (firstc=firstc@entry=58, count=count@entry=1, indent=indent@entry=0, do_concat=do_concat@entry=true)\r\n    at /home/pi/src/neovim/src/nvim/ex_getln.c:2601\r\n#9  0x001fbe70 in getexline (c=58, cookie=<optimized out>, indent=0, do_concat=<optimized out>)\r\n    at /home/pi/src/neovim/src/nvim/ex_getln.c:2846\r\n#10 0x002106b4 in do_cmdline (cmdline=<optimized out>, fgetline=0x1fbe3c <getexline>, cookie=0x0, flags=0)\r\n    at /home/pi/src/neovim/src/nvim/ex_docmd.c:514\r\n#11 0x0015d104 in nv_colon (cap=0x7edd5790) at /home/pi/src/neovim/src/nvim/normal.c:3221\r\n#12 0x001704f8 in normal_execute (state=0x7edd572c, key=<optimized out>) at /home/pi/src/neovim/src/nvim/normal.c:1181\r\n#13 0x000b6df0 in state_enter (s=0x7edd572c) at /home/pi/src/neovim/src/nvim/state.c:99\r\n#14 0x001673a4 in normal_enter (cmdwin=<optimized out>, noexmode=<optimized out>) at /home/pi/src/neovim/src/nvim/normal.c:478\r\n#15 0x001b01a4 in main (argc=<optimized out>, argv=<optimized out>) at /home/pi/src/neovim/src/nvim/main.c:597\r\n(gdb) up\r\n#1  0x76d50364 in __GI_abort () at abort.c:79\r\n79      abort.c: No such file or directory.\r\n(gdb)\r\n#2  0x001fa5c0 in cmdpreview_may_show (s=s@entry=0x7edd5098) at /home/pi/src/neovim/src/nvim/ex_getln.c:2442\r\n2442        abort();\r\n(gdb)\r\n```\r\n</details>\r\n\r\n### OS\r\n\r\nObserved on:\r\n- macOS x86_64, nvim 0.10.0\r\n- raspbian (debian) armv7l, nvim 0.9.0\r\n\r\n### Theory\r\n\r\nI suspect it's the same issue on the pi as on macOS - I've debugged more on the pi and it seems [`rename_buffer()` fails](https://github.com/neovim/neovim/blob/55d346fc2683a18256320eaae75eb4f3137dcced/src/nvim/ex_getln.c#L2215-L2217), caused by [a buffer name conflict / `E95`](https://github.com/neovim/neovim/blob/55d346fc2683a18256320eaae75eb4f3137dcced/src/nvim/buffer.c#L2921-L2932).\r\n\r\nI can hack in the `BF_DUMMY` flag (on the preview buffer) to avoid this behaviour, but I end up with tons of windows open (as I toggle with `<C-E>`) and I don't believe that's a correct fix, since the buffer isn't for internal use only.\r\nIs there some buffer cleanup code that normally runs which I'd need to trigger, or possibly something else to avoid the buffer name conflict?\n\n### Steps to reproduce\n\nCreate this plugin:\r\n\r\n```vim\r\nfunction! IncCommandToggle()\r\n\tlet prev = &inccommand\r\n\r\n\tif &inccommand ==# 'split'\r\n\t\tset inccommand=nosplit\r\n\telseif &inccommand ==# 'nosplit'\r\n\t\tset inccommand=split\r\n\telseif &inccommand ==# ''\r\n\t\tset inccommand=nosplit\r\n\telse\r\n\t\tthrow 'unknown inccommand'\r\n\tendif\r\n\r\n\t\" return a change, to trigger redraw (:redraw doesn't work)\r\n\t\" (the bug occurs without this - empty string also works)\r\n\treturn \" \\<BS>\"\r\nendfunction\r\n\r\ncnoremap <expr> <C-E> IncCommandToggle()\r\n```\r\n\r\nEdit a file where you'll get a few search/replace hits.\r\nEnter: `:%s/candidate/abc<C-E><C-E><C-E>`\r\n\r\nNotice the first two `<C-E>` hits toggle the `inccommand` pane, and the third causes nvim to exit.\n\n### Expected behavior\n\nContinued `inccommand` pane toggling, no exit.\n\n### Neovim version (nvim -v)\n\n0.10.0 commit 55d346fc2 (macOS), 0.9.0 d215dae0e0 (raspbian)\n\n### Vim (not Nvim) behaves the same?\n\nn/a, no `inccommand` in vim\n\n### Operating system/version\n\nmacOS 13.1, raspbian 11\n\n### Terminal name/version\n\nalacritty 0.11.0 (8dbaa0b) / tmux 3.1c\n\n### $TERM environment variable\n\nscreen-256color (i.e. tmux)\n\n### Installation\n\nbuild from repo",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Changing 'inccommand' should be disallowed during command-preview.",
            "created_at": "2023-07-16T12:55:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/23136#issuecomment-1637077767",
            "id": 1637077767,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23136",
            "node_id": "IC_kwDOAPphoM5hk9MH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637077767/reactions"
            },
            "updated_at": "2023-07-16T12:55:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637077767",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23136/comments",
    "created_at": "2023-04-16T14:45:48Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23136/events",
    "html_url": "https://github.com/neovim/neovim/issues/23136",
    "id": 1670002650,
    "labels": [
        {
            "color": "C2E0C6",
            "default": false,
            "description": "community: issues for first-time contributors",
            "id": 98144774,
            "name": "good-first-issue",
            "node_id": "MDU6TGFiZWw5ODE0NDc3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/good-first-issue"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, unlikely to cause distant/indirect damage",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 4242493821,
            "name": "options",
            "node_id": "LA_kwDOAPphoM7831F9",
            "url": "https://api.github.com/repos/neovim/neovim/labels/options"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23136/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 562,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 411,
        "state": "open",
        "title": "backlog",
        "updated_at": "2023-07-17T20:06:10Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM5jijfa",
    "number": 23136,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23136/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23136/timeline",
    "title": "Toggling `inccommand` while mid-substitution causes a crash",
    "updated_at": "2023-07-16T12:55:42Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23136",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/205673?v=4",
        "events_url": "https://api.github.com/users/bobrippling/events{/privacy}",
        "followers_url": "https://api.github.com/users/bobrippling/followers",
        "following_url": "https://api.github.com/users/bobrippling/following{/other_user}",
        "gists_url": "https://api.github.com/users/bobrippling/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/bobrippling",
        "id": 205673,
        "login": "bobrippling",
        "node_id": "MDQ6VXNlcjIwNTY3Mw==",
        "organizations_url": "https://api.github.com/users/bobrippling/orgs",
        "received_events_url": "https://api.github.com/users/bobrippling/received_events",
        "repos_url": "https://api.github.com/users/bobrippling/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/bobrippling/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bobrippling/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/bobrippling"
    }
}