{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe `cterm=undercurl` command is not working in nvim. I searched for some solutions and had some progress.\r\n1. when setting `cterm=undercurl` in neovim, it will fall back to underline; but in vim, nothing is shown.\r\n2. set `let &t_Cs = \"\\e[4:3m\"` in neovim, it still fall back to underline; but in vim, **undercurl** occurs.\r\nwhat should I do to make undercurl occur in neovim. Thanks.\r\n\r\n### Steps to reproduce\r\n\r\n```\r\nnvim --clean\r\n# type `asdf`\r\n:se spell \r\n:let &t_Cs = \"\\e[4:3m\"\r\n:hi SpellBad     gui=undercurl guisp=red term=undercurl cterm=undercurl\r\n# underline is shown under `asdf`\r\n\r\nvim --clean\r\n# type `asdf`\r\n:se spell \r\n:let &t_Cs = \"\\e[4:3m\"\r\n:hi SpellBad     gui=undercurl guisp=red term=undercurl cterm=undercurl\r\n# **undercurl** is shown under `asdf`\r\n```\r\n\r\n\r\n### Expected behavior\r\n\r\nnvim shows undercurl\r\n\r\n### Neovim version (nvim -v)\r\n\r\n0.10.0-dev\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno, 8.1.3741\r\n\r\n### Operating system/version\r\n\r\n20.04.1-Ubuntu\r\n\r\n### Terminal name/version\r\n\r\nbash, version 5.0.17\r\n\r\n### $TERM environment variable\r\n\r\nxterm\r\n\r\n### Installation\r\n\r\nappimage",
    "closed_at": "2024-03-15T09:58:40Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "`t_Cs` is not supported",
            "created_at": "2024-03-10T10:09:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1987170957",
            "id": 1987170957,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52cdKN",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987170957/reactions"
            },
            "updated_at": "2024-03-10T10:09:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987170957",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "NONE",
            "body": "Is there a way to work around that do the `t_Cs` thing in neovim? Or what method should I try? change a terminal or something?",
            "created_at": "2024-03-10T11:04:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1987186620",
            "id": 1987186620,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52cg-8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987186620/reactions"
            },
            "updated_at": "2024-03-10T11:04:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987186620",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31755447?v=4",
                "events_url": "https://api.github.com/users/Jiyangson/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jiyangson/followers",
                "following_url": "https://api.github.com/users/Jiyangson/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jiyangson/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jiyangson",
                "id": 31755447,
                "login": "Jiyangson",
                "node_id": "MDQ6VXNlcjMxNzU1NDQ3",
                "organizations_url": "https://api.github.com/users/Jiyangson/orgs",
                "received_events_url": "https://api.github.com/users/Jiyangson/received_events",
                "repos_url": "https://api.github.com/users/Jiyangson/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jiyangson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jiyangson/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jiyangson"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "What terminal are you using? Bash is not a terminal and XTerm doesn't supoort undercurl.",
            "created_at": "2024-03-10T12:14:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1987206589",
            "id": 1987206589,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52cl29",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987206589/reactions"
            },
            "updated_at": "2024-03-10T12:14:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987206589",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "NONE",
            "body": "I use kitty and it works fine (it shows undercurl as usual). But when I open nvim in a docker container, it has this problem.",
            "created_at": "2024-03-10T12:51:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1987218161",
            "id": 1987218161,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52corx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987218161/reactions"
            },
            "updated_at": "2024-03-10T12:51:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987218161",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31755447?v=4",
                "events_url": "https://api.github.com/users/Jiyangson/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jiyangson/followers",
                "following_url": "https://api.github.com/users/Jiyangson/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jiyangson/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jiyangson",
                "id": 31755447,
                "login": "Jiyangson",
                "node_id": "MDQ6VXNlcjMxNzU1NDQ3",
                "organizations_url": "https://api.github.com/users/Jiyangson/orgs",
                "received_events_url": "https://api.github.com/users/Jiyangson/received_events",
                "repos_url": "https://api.github.com/users/Jiyangson/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jiyangson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jiyangson/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jiyangson"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Hmm, the value of `$TERM` should be `xterm-kitty` inside kitty, not `xterm`.",
            "created_at": "2024-03-10T12:53:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1987219036",
            "id": 1987219036,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52co5c",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987219036/reactions"
            },
            "updated_at": "2024-03-10T12:53:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1987219036",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "NONE",
            "body": "I have the same issue with st 0.9 (with undercurl patch) and tmux next-3.5 built from git head like a week ago. I have `TERM=screen-256color` inside of tmux (which I need to use for key compatibility with old terminfo databases shipped on servers I administer via ssh). Undercurl works fine outside of tmux (`TERM=st-256color`) in neovim, but shows only an underline inside tmux.\r\n\r\nI have the following overrides in tmux.conf just to ensure the feature is enabled.\r\n\r\n```\r\nset -as terminal-overrides ',*:Smulx=\\E[4::%p1%dm'  # undercurl support\r\nset -as terminal-overrides ',*:Setulc=\\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0\r\n```\r\n\r\nAnd outside of neovim undercurl is displayed correctly inside of tmux with, e.g., `printf '\\e[4:3mUndercurl\\e[0m\\n'`. But inside neovim running inside tmux I only get an underline.\r\n\r\nI assume there is some kind of feature detection based on the value of TERM? Is there any way to override that to force the feature to be enabled?",
            "created_at": "2024-03-12T04:00:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1990173338",
            "id": 1990173338,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM52n6Ka",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1990173338/reactions"
            },
            "updated_at": "2024-03-12T04:00:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1990173338",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/357363?v=4",
                "events_url": "https://api.github.com/users/JCallicoat/events{/privacy}",
                "followers_url": "https://api.github.com/users/JCallicoat/followers",
                "following_url": "https://api.github.com/users/JCallicoat/following{/other_user}",
                "gists_url": "https://api.github.com/users/JCallicoat/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/JCallicoat",
                "id": 357363,
                "login": "JCallicoat",
                "node_id": "MDQ6VXNlcjM1NzM2Mw==",
                "organizations_url": "https://api.github.com/users/JCallicoat/orgs",
                "received_events_url": "https://api.github.com/users/JCallicoat/received_events",
                "repos_url": "https://api.github.com/users/JCallicoat/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/JCallicoat/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/JCallicoat/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/JCallicoat"
            }
        },
        {
            "author_association": "NONE",
            "body": "For anyone who has a similar problem, I asked chatgpt and got a solution. Here is the answer from gpt\r\n\r\n> When you use `docker exec` to enter a Docker container, the `$TERM` environment variable is set to `xterm` by default because it is a widely recognized and compatible setting for most programs. This environment variable informs programs running on the terminal about the type and capabilities of the terminal so that they can adjust their behavior accordingly, such as how to interpret colors and handle cursor movements.\r\n`xterm-kitty` is specifically for the Kitty terminal emulator, and Kitty uses it to enable additional features that may not be available in other terminal environments. When you start a Docker container terminal from Kitty, you need to explicitly set the terminal type to retain some of the underlying features of Kitty.\r\nTo set the `$TERM` variable in the container to `xterm-kitty`, you can pass the environment variable when connecting to the container: \r\n```sh\r\ndocker exec -it -e TERM=xterm-kitty [container-id] /bin/bash\r\n```\r\n>Note that to fully utilize the features provided by `xterm-kitty`, your container needs to have the appropriate terminal information files (terminfo). If they are not present, some features specific to `xterm-kitty` may not work as expected. If the base image of the container does not include the Kitty terminfo file, you may need to copy this file from the host machine to the corresponding location in the container, which is usually `/usr/share/terminfo/x/xterm-kitty`.\r\n\r\nFor me, I just copy xterm-kitty in my kitty install path and it works.\r\n```sh\r\ndocker cp ~/.local/kitty.app/share/terminfo/x/xterm-kitty container_id:/usr/share/terminfo/x/\r\n```\r\n",
            "created_at": "2024-03-15T09:58:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/27801#issuecomment-1999313586",
            "id": 1999313586,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27801",
            "node_id": "IC_kwDOAPphoM53Kxqy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1999313586/reactions"
            },
            "updated_at": "2024-03-15T09:58:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1999313586",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31755447?v=4",
                "events_url": "https://api.github.com/users/Jiyangson/events{/privacy}",
                "followers_url": "https://api.github.com/users/Jiyangson/followers",
                "following_url": "https://api.github.com/users/Jiyangson/following{/other_user}",
                "gists_url": "https://api.github.com/users/Jiyangson/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Jiyangson",
                "id": 31755447,
                "login": "Jiyangson",
                "node_id": "MDQ6VXNlcjMxNzU1NDQ3",
                "organizations_url": "https://api.github.com/users/Jiyangson/orgs",
                "received_events_url": "https://api.github.com/users/Jiyangson/received_events",
                "repos_url": "https://api.github.com/users/Jiyangson/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Jiyangson/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Jiyangson/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Jiyangson"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27801/comments",
    "created_at": "2024-03-10T09:38:31Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27801/events",
    "html_url": "https://github.com/neovim/neovim/issues/27801",
    "id": 2177626424,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27801/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6By_E4",
    "number": 27801,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27801/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27801/timeline",
    "title": "using t_Cs to set undercurl works in vim but not neovim",
    "updated_at": "2024-03-15T09:58:40Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27801",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/31755447?v=4",
        "events_url": "https://api.github.com/users/Jiyangson/events{/privacy}",
        "followers_url": "https://api.github.com/users/Jiyangson/followers",
        "following_url": "https://api.github.com/users/Jiyangson/following{/other_user}",
        "gists_url": "https://api.github.com/users/Jiyangson/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Jiyangson",
        "id": 31755447,
        "login": "Jiyangson",
        "node_id": "MDQ6VXNlcjMxNzU1NDQ3",
        "organizations_url": "https://api.github.com/users/Jiyangson/orgs",
        "received_events_url": "https://api.github.com/users/Jiyangson/received_events",
        "repos_url": "https://api.github.com/users/Jiyangson/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Jiyangson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Jiyangson/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Jiyangson"
    }
}