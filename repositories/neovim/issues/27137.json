{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\r\n\r\n```cpp\r\n#0  0x000055e555c13954 in marktree_itr_next_skip (b=b@entry=0x55e557b567e0, itr=itr@entry=0x7ffda31ab570, skip=skip@entry=false, preload=preload@entry=false, oldbase=oldbase@entry=0x0, meta_filter=meta_filter@entry=0x0)\r\n    at .../src/nvim/marktree.c:1529\r\n1529          assert(itr->x->ptr[itr->i]->parent == itr->x);\r\n[Current thread is 1 (Thread 0x7f8b97563b80 (LWP 2287250))]\r\n(gdb) bt\r\n#0  0x000055e555c13954 in marktree_itr_next_skip (b=b@entry=0x55e557b567e0, itr=itr@entry=0x7ffda31ab570, skip=skip@entry=false, preload=preload@entry=false, oldbase=oldbase@entry=0x0, meta_filter=meta_filter@entry=0x0)\r\n    at .../src/nvim/marktree.c:1529\r\n#1  0x000055e555c16125 in marktree_itr_next (b=b@entry=0x55e557b567e0, itr=itr@entry=0x7ffda31ab570) at .../src/nvim/marktree.c:1479\r\n#2  0x000055e555c16167 in marktree_itr_step_out_filter (b=0x55e557b567e0, itr=0x7ffda31ab570, meta_filter=0x55e555e4d320 <sign_filter>) at .../src/nvim/marktree.c:1579\r\n#3  0x000055e555b3cd6c in decor_redraw_signs (wp=0x55e557b50be0, buf=0x55e557b53850, row=34, sattrs=0x7ffda31abb80, line_id=0x7ffda31ab7b0, cul_id=0x7ffda31ab7ac, num_id=0x7ffda31ab7a8)\r\n    at .../src/nvim/decoration.c:694\r\n#4  0x000055e555b47516 in win_line (wp=wp@entry=0x55e557b50be0, lnum=lnum@entry=35, startrow=startrow@entry=4, endrow=41, col_rows=col_rows@entry=0, spv=0x7ffda31acd10, foldinfo=...)\r\n    at .../src/nvim/drawline.c:1213\r\n#5  0x000055e555b4f1d9 in win_update (wp=wp@entry=0x55e557b50be0) at .../src/nvim/drawscreen.c:2291\r\n#6  0x000055e555b50098 in update_screen () at .../src/nvim/drawscreen.c:640\r\n#7  0x000055e555c445c5 in normal_redraw (s=s@entry=0x7ffda31ace40) at .../src/nvim/normal.c:1355\r\n#8  0x000055e555c46248 in normal_check (state=0x7ffda31ace40) at .../src/nvim/normal.c:1451\r\n#9  0x000055e555ce6e4e in state_enter (s=0x7ffda31ace40) at .../src/nvim/state.c:40\r\n#10 0x000055e555c43e24 in normal_enter (cmdwin=<optimized out>, noexmode=<optimized out>) at .../src/nvim/normal.c:516\r\n#11 0x000055e555c08cb1 in main (argc=3, argv=<optimized out>) at .../src/nvim/main.c:651\r\n```\r\n\r\n### Steps to reproduce\r\n\r\nAt the moment I have no idea how to reproduce it.\r\n\r\n### Expected behavior\r\n\r\nNo crash\r\n\r\n### Neovim version (nvim -v)\r\n\r\nv0.10.0-dev-2158+g13d50c3b1\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\n-\r\n\r\n### Operating system/version\r\n\r\nDebian Sid\r\n\r\n### Terminal name/version\r\n\r\nalacritty 0.13.1\r\n\r\n### $TERM environment variable\r\n\r\nalacritty\r\n\r\n### Installation\r\n\r\nfrom repo",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "@bfredl @luukvbaal ",
            "created_at": "2024-01-22T21:01:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/27137#issuecomment-1904810068",
            "id": 1904810068,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27137",
            "node_id": "IC_kwDOAPphoM5xiRhU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904810068/reactions"
            },
            "updated_at": "2024-01-22T21:01:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904810068",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Additional info: statuscol in branch 0.10 with\r\n\r\n```lua\r\nlocal builtin = require('statuscol.builtin')\r\nrequire('statuscol').setup({\r\n  relculright = true,\r\n  segments = {\r\n    {\r\n      text = {builtin.foldfunc},\r\n      condition = {true},\r\n      click = 'v:lua.ScFa',\r\n    },\r\n    {\r\n      sign = {namespace = {'gitsigns*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa',\r\n    },\r\n    {\r\n      sign = {namespace = {'arctgx.diagnostic.signs/diagnostic/signs'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {\r\n      sign = {name = {'Dap.*'}, maxwidth = 2, colwidth = 2, auto = true},\r\n      click = 'v:lua.ScLa'\r\n    },\r\n    {\r\n      sign = {name = {'.*'}, maxwidth = 1, colwidth = 1, auto = true},\r\n      click = 'v:lua.ScSa'\r\n    },\r\n    {text = {builtin.lnumfunc, ' '}, click = 'v:lua.ScLa',},\r\n  },\r\n  ft_ignore = {\r\n    'NvimTree',\r\n  },\r\n})\r\n```",
            "created_at": "2024-01-22T21:03:51Z",
            "html_url": "https://github.com/neovim/neovim/issues/27137#issuecomment-1904813291",
            "id": 1904813291,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27137",
            "node_id": "IC_kwDOAPphoM5xiSTr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904813291/reactions"
            },
            "updated_at": "2024-01-22T21:03:51Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904813291",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "This reproduces the crash @bfredl (`itr->x->s->i_ptr[itr->i] == NULL`):\r\n```lua\r\nlocal ns = vim.api.nvim_create_namespace('')\r\nvim.api.nvim_buf_set_lines(0, 0, 0, 0, {'a'})\r\nfor i = 0, 104 do\r\n  vim.api.nvim_buf_set_extmark(0, ns, 0, 0, {hl_group = 'Error', end_col = 1})\r\nend\r\nvim.api.nvim_buf_set_extmark(0, ns, 0, 0, {sign_text = 'S1'})\r\n```",
            "created_at": "2024-01-22T22:38:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/27137#issuecomment-1904952493",
            "id": 1904952493,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27137",
            "node_id": "IC_kwDOAPphoM5xi0St",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 3,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904952493/reactions"
            },
            "updated_at": "2024-01-22T23:02:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904952493",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> This reproduces the crash @bfredl (`itr->x->s->i_ptr[itr->i] == NULL`):\r\n> \r\n> ```lua\r\n> local ns = vim.api.nvim_create_namespace('')\r\n> vim.cmd.call(\"setline(1, ['aaa', 'bbb', 'ccc']->repeat(12))\")\r\n> for i = 0, 35 do\r\n>   vim.api.nvim_buf_set_extmark(0, ns, i, 0, {hl_group = 'Error', end_col = 1})\r\n>   vim.api.nvim_buf_set_extmark(0, ns, i, 1, {hl_group = 'Error', end_col = 2})\r\n>   vim.api.nvim_buf_set_extmark(0, ns, i, 2, {hl_group = 'Error', end_col = 3})\r\n> end\r\n> vim.api.nvim_buf_set_extmark(0, ns, 0, 0, {sign_text = 'S1'})\r\n> ```\r\nThat's it!",
            "created_at": "2024-01-22T23:10:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/27137#issuecomment-1904992130",
            "id": 1904992130,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27137",
            "node_id": "IC_kwDOAPphoM5xi9-C",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904992130/reactions"
            },
            "updated_at": "2024-01-22T23:10:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1904992130",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
                "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
                "followers_url": "https://api.github.com/users/przepompownia/followers",
                "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
                "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/przepompownia",
                "id": 11404453,
                "login": "przepompownia",
                "node_id": "MDQ6VXNlcjExNDA0NDUz",
                "organizations_url": "https://api.github.com/users/przepompownia/orgs",
                "received_events_url": "https://api.github.com/users/przepompownia/received_events",
                "repos_url": "https://api.github.com/users/przepompownia/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/przepompownia"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27137/comments",
    "created_at": "2024-01-22T21:00:39Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27137/events",
    "html_url": "https://github.com/neovim/neovim/issues/27137",
    "id": 2094743258,
    "labels": [
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "F9D0C4",
            "default": false,
            "description": "issue reporting a crash or segfault",
            "id": 435854234,
            "name": "bug-crash",
            "node_id": "MDU6TGFiZWw0MzU4NTQyMzQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-crash"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "extmarks, decorations, virtual text, namespaces",
            "id": 1680119719,
            "name": "extmarks",
            "node_id": "MDU6TGFiZWwxNjgwMTE5NzE5",
            "url": "https://api.github.com/repos/neovim/neovim/labels/extmarks"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27137/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM582z7a",
    "number": 27137,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 6,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 6,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27137/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27137/timeline",
    "title": "Crash after marktree changes (`assert(itr->x->ptr[itr->i]->parent == itr->x);`)",
    "updated_at": "2024-01-22T23:10:21Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27137",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11404453?v=4",
        "events_url": "https://api.github.com/users/przepompownia/events{/privacy}",
        "followers_url": "https://api.github.com/users/przepompownia/followers",
        "following_url": "https://api.github.com/users/przepompownia/following{/other_user}",
        "gists_url": "https://api.github.com/users/przepompownia/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/przepompownia",
        "id": 11404453,
        "login": "przepompownia",
        "node_id": "MDQ6VXNlcjExNDA0NDUz",
        "organizations_url": "https://api.github.com/users/przepompownia/orgs",
        "received_events_url": "https://api.github.com/users/przepompownia/received_events",
        "repos_url": "https://api.github.com/users/przepompownia/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/przepompownia/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/przepompownia/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/przepompownia"
    }
}