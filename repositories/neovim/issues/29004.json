{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nneovim has a bad startup time by default (no config) which can be improved 4x on my laptop just by disabling the python provider (see steps to reproduce).\r\n\r\nthe culprit is [this line of code](https://github.com/neovim/neovim/blob/b280d57db9845359186bfb5167e1559b6184f8d5/runtime/lua/vim/provider/python.lua#L29), which runs python to get its version and find importable `neovim` module.\r\n\r\nthe problem is that firing up python interpretator is just slow by itself even with no code:\r\n```fish\r\n~> time python -c \"\"\r\n\r\n________________________________________________________\r\nExecuted in   20.45 millis    fish           external\r\n   usr time   13.57 millis  167.00 micros   13.41 millis\r\n   sys time    6.79 millis   68.00 micros    6.72 millis\r\n```\r\n\r\nI believe it's not neccessary to do it. we can vastly improve performance by only checking what we actually care about here - whether `{prefix}/lib/python{version}/site-packages/neovim` exists in the filesystem (in fact, that's essentially what importlib does), where `prefix` can be defined as `$(which python{version})/../..` to account for various python installations - and we can also get python version right from the path without having to run `python`.\r\n\r\nI couldn't find any discussion on this, let me know if I missed anything.\r\n\r\n### Steps to reproduce\r\n\r\n```fish\r\n~> python -m timeit '__import__(\"os\").system(\"nvim +q\")'\r\n5 loops, best of 5: 83.3 msec per loop\r\n~> echo 'vim.g.loaded_python3_provider = 0' > .config/nvim/init.lua\r\n~> python -m timeit '__import__(\"os\").system(\"nvim +q\")'\r\n10 loops, best of 5: 19.3 msec per loop\r\n```\r\n\r\n### Expected behavior\r\n\r\nno python bottleneck in startup time\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.11.0-dev-85+g93c55c238\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Terminal name/version\r\n\r\nfoot 1.17.2\r\n\r\n### $TERM environment variable\r\n\r\nfoot\r\n\r\n### Installation\r\n\r\nAUR",
    "closed_at": "2024-05-25T17:24:53Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> rm ~/.config/nvim/init.lua\r\n\r\nHmm, python provider is supposed to only be loaded on demand, not with (really) empty config. You might have some plugin in your runtimepath which checks `has(\"python3\")` on startup.  This can be disabled with `nvim --clean +q` ",
            "created_at": "2024-05-25T16:34:40Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131351027",
            "id": 2131351027,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_CdXz",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131351027/reactions"
            },
            "updated_at": "2024-05-25T16:34:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131351027",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "NONE",
            "body": "> You might have some plugin in your runtimepath which checks `has(\"python3\")` on startup.\r\n\r\nyou're right, it seems that the AUR package `neovim-nightly-bin` which I use includes a bunch of vim plugins to runtimepath, including black.vim which triggers python provider, I may suggest them to fix it there. but I still think it's worth fixing the performance issue with calling python to check if pynvim is available so that it lowers startup time when using python plugins anyway.",
            "created_at": "2024-05-25T17:19:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131366447",
            "id": 2131366447,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_ChIv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131366447/reactions"
            },
            "updated_at": "2024-05-25T17:19:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131366447",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/94578451?v=4",
                "events_url": "https://api.github.com/users/arcxio/events{/privacy}",
                "followers_url": "https://api.github.com/users/arcxio/followers",
                "following_url": "https://api.github.com/users/arcxio/following{/other_user}",
                "gists_url": "https://api.github.com/users/arcxio/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/arcxio",
                "id": 94578451,
                "login": "arcxio",
                "node_id": "U_kgDOBaMnEw",
                "organizations_url": "https://api.github.com/users/arcxio/orgs",
                "received_events_url": "https://api.github.com/users/arcxio/received_events",
                "repos_url": "https://api.github.com/users/arcxio/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/arcxio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/arcxio/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/arcxio"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Has been discussed many time before. The search doesn't happen unless your config triggers it.",
            "created_at": "2024-05-25T17:24:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131367823",
            "id": 2131367823,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_CheP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131367823/reactions"
            },
            "updated_at": "2024-05-25T17:24:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131367823",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> it seems that the AUR package neovim-nightly-bin which I use includes a bunch of vim plugins to runtimepath\r\n\r\nWow. They should **not** do that. Please complain to them _very loudly_.",
            "created_at": "2024-05-25T17:24:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131367834",
            "id": 2131367834,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_Chea",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131367834/reactions"
            },
            "updated_at": "2024-05-25T17:25:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131367834",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "> The search doesn't happen unless your config triggers it\r\n\r\nthe issue is not really that the search happens, the issue is that the search is much slower that it has to be",
            "created_at": "2024-05-25T17:32:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131369628",
            "id": 2131369628,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_Ch6c",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131369628/reactions"
            },
            "updated_at": "2024-05-25T17:32:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131369628",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/94578451?v=4",
                "events_url": "https://api.github.com/users/arcxio/events{/privacy}",
                "followers_url": "https://api.github.com/users/arcxio/followers",
                "following_url": "https://api.github.com/users/arcxio/following{/other_user}",
                "gists_url": "https://api.github.com/users/arcxio/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/arcxio",
                "id": 94578451,
                "login": "arcxio",
                "node_id": "U_kgDOBaMnEw",
                "organizations_url": "https://api.github.com/users/arcxio/orgs",
                "received_events_url": "https://api.github.com/users/arcxio/received_events",
                "repos_url": "https://api.github.com/users/arcxio/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/arcxio/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/arcxio/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/arcxio"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The search is the way it is for a reason, though: robustness (venv, pip, etc.).",
            "created_at": "2024-05-25T17:34:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131370014",
            "id": 2131370014,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_CiAe",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131370014/reactions"
            },
            "updated_at": "2024-05-25T17:34:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131370014",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> but I still think it's worth fixing the performance issue with calling python to check if pynvim is available so that it lowers startup time when using python plugins anyway.\r\n\r\nsuch a check would just be an approximation. the only way to check if python can import a package is to invoke python and try to import the package. any external reimplementation of importlib/virtualenv/etc/etc is going to be out of date pretty much instantly given the frequent changes to the python tooling ecosystem. \r\n\r\nInstead, a _well-behaved_ python plugin should defer to check `has(\"python3\")` until it actually needs to know that, not haphazardly at neovim startup. ",
            "created_at": "2024-05-25T17:34:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/29004#issuecomment-2131370130",
            "id": 2131370130,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29004",
            "node_id": "IC_kwDOAPphoM5_CiCS",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131370130/reactions"
            },
            "updated_at": "2024-05-25T17:34:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2131370130",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        }
    ],
    "comments": 7,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29004/comments",
    "created_at": "2024-05-25T13:44:34Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29004/events",
    "html_url": "https://github.com/neovim/neovim/issues/29004",
    "id": 2317020369,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "issues reporting performance problems",
            "id": 101930601,
            "name": "performance",
            "node_id": "MDU6TGFiZWwxMDE5MzA2MDE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/performance"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 144672485,
            "name": "provider",
            "node_id": "MDU6TGFiZWwxNDQ2NzI0ODU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/provider"
        },
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as duplicates of other issues",
            "id": 3221613764,
            "name": "closed:duplicate",
            "node_id": "MDU6TGFiZWwzMjIxNjEzNzY0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29004/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6KGuzR",
    "number": 29004,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29004/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29004/timeline",
    "title": "speed up check for pynvim",
    "updated_at": "2024-05-25T17:34:49Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29004",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/94578451?v=4",
        "events_url": "https://api.github.com/users/arcxio/events{/privacy}",
        "followers_url": "https://api.github.com/users/arcxio/followers",
        "following_url": "https://api.github.com/users/arcxio/following{/other_user}",
        "gists_url": "https://api.github.com/users/arcxio/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/arcxio",
        "id": 94578451,
        "login": "arcxio",
        "node_id": "U_kgDOBaMnEw",
        "organizations_url": "https://api.github.com/users/arcxio/orgs",
        "received_events_url": "https://api.github.com/users/arcxio/received_events",
        "repos_url": "https://api.github.com/users/arcxio/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/arcxio/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/arcxio/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/arcxio"
    }
}