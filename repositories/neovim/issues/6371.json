{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "Current header files have the problem with implicit dependencies/blocks meaning that you must include headers in a specific order in some cases. In addition to this incremental compilation does not work well because when you include header because you need some specific type from it you also pull in function declarations which depend on the C file. The fix to the situation was discussed already, but I do not remember a separate issue. Thus suggestion: refactor header files in turns:\r\n\r\n1. Refactor header files:\r\n   1. Move all non-symbols to `_defs.h`. I.e. defs.h file is allowed to contain macros, static inline FUNC_ATTR_ALWAYS_INLINE functions, typedefs, enum constants, but neither regular function declarations nor `extern` global constants.\r\n   2. In process also create documentation when there is no.\r\n   3. And turn `#define` macros into anonymous (or not) enums if possible: this makes it easier to use constants in tests. Non-anonymous enums are expected if one needs to refer to the collection of values or if a collection of constants is exclusive and not a bunch of bitflags.\r\n   4. All headers are allowed to include only _defs.h files, system headers and generated declarations, regardless of whether they are _defs.h headers or regular headers.\r\n   5. `*.c` files are expected to include both _defs.h and regular headers, regular headers only if they need symbols and not types. This is needed to make incremental compilation really incremental.\r\n   6. What is a macros and not a function is supposed to be all-upper, with underscores. Functions are supposed to be all-lower, with underscores.\r\n2. Make clint check that headers depend only on _defs.h.\r\n3. Make IWYU check header files.\r\n\r\n---\r\n\r\nActual plan:\r\n\r\n- [ ] Document the above (in `:help develop` or `:help dev-style`)\r\n- [x] Add a way to test that that each header can be included separately (#6396).\r\n- [ ] PR which runs IWYU, with errors from all files ignored.\r\n- [ ] Per-header PR, new _defs.h headers must pass IWYU and check-single-includes. This part can be marked entry-level.\r\n     - [ ] src/nvim/api/buffer.h\r\n     - [ ] src/nvim/api/private/defs.h\r\n     - [ ] src/nvim/api/private/dispatch.h\r\n     - [ ] src/nvim/api/private/handle.h\r\n     - [ ] src/nvim/api/private/handler.c.h\r\n     - [ ] src/nvim/api/private/helpers.h\r\n     - [ ] src/nvim/api/tabpage.h\r\n     - [ ] src/nvim/api/ui.h\r\n     - [ ] src/nvim/api/vim.h\r\n     - [ ] src/nvim/api/window.h\r\n     - [ ] src/nvim/arabic.h\r\n     - [ ] src/nvim/ascii.h\r\n     - [ ] src/nvim/assert.h\r\n     - [ ] src/nvim/buffer_defs.h\r\n     - [ ] src/nvim/buffer.h\r\n     - [ ] src/nvim/bufhl_defs.h\r\n     - [ ] src/nvim/charset.h\r\n     - [ ] src/nvim/cursor.h\r\n     - [ ] src/nvim/cursor_shape.h\r\n     - [ ] src/nvim/diff.h\r\n     - [ ] src/nvim/digraph.h\r\n     - [ ] src/nvim/edit.h\r\n     - [ ] src/nvim/eval/decode.h\r\n     - [ ] src/nvim/eval/encode.h\r\n     - [ ] src/nvim/eval/executor.h\r\n     - [ ] src/nvim/eval/gc.h\r\n     - [ ] src/nvim/eval.h\r\n     - [ ] src/nvim/eval/typval_encode.c.h\r\n     - [ ] src/nvim/eval/typval_encode.h\r\n     - [ ] src/nvim/eval/typval.h\r\n     - [ ] src/nvim/event/defs.h\r\n     - [ ] src/nvim/event/libuv_process.h\r\n     - [ ] src/nvim/event/loop.h\r\n     - [ ] src/nvim/event/multiqueue.h\r\n     - [ ] src/nvim/event/process.h\r\n     - [ ] src/nvim/event/rstream.h\r\n     - [ ] src/nvim/event/signal.h\r\n     - [ ] src/nvim/event/socket.h\r\n     - [ ] src/nvim/event/stream.h\r\n     - [ ] src/nvim/event/time.h\r\n     - [ ] src/nvim/event/wstream.h\r\n     - [ ] src/nvim/ex_cmds2.h\r\n     - [ ] src/nvim/ex_cmds_defs.h\r\n     - [ ] src/nvim/ex_cmds.h\r\n     - [ ] src/nvim/ex_docmd.h\r\n     - [ ] src/nvim/ex_eval.h\r\n     - [ ] src/nvim/ex_getln.h\r\n     - [ ] src/nvim/farsi.h\r\n     - [ ] src/nvim/fileio.h\r\n     - [ ] src/nvim/file_search.h\r\n     - [ ] src/nvim/fold.h\r\n     - [ ] src/nvim/func_attr.h\r\n     - [ ] src/nvim/garray.h\r\n     - [ ] src/nvim/getchar.h\r\n     - [ ] src/nvim/gettext.h\r\n     - [ ] src/nvim/globals.h\r\n     - [ ] src/nvim/hardcopy.h\r\n     - [ ] src/nvim/hashtab.h\r\n     - [ ] src/nvim/iconv.h\r\n     - [ ] src/nvim/if_cscope_defs.h\r\n     - [ ] src/nvim/if_cscope.h\r\n     - [ ] src/nvim/indent_c.h\r\n     - [ ] src/nvim/indent.h\r\n     - [ ] src/nvim/keymap.h\r\n     - [ ] src/nvim/lib/khash.h\r\n     - [ ] src/nvim/lib/klist.h\r\n     - [ ] src/nvim/lib/kvec.h\r\n     - [ ] src/nvim/lib/queue.h\r\n     - [ ] src/nvim/lib/ringbuf.h\r\n     - [ ] src/nvim/log.h\r\n     - [ ] src/nvim/macros.h\r\n     - [ ] src/nvim/main.h\r\n     - [ ] src/nvim/map_defs.h\r\n     - [ ] src/nvim/map.h\r\n     - [ ] src/nvim/mark_defs.h\r\n     - [ ] src/nvim/mark.h\r\n     - [ ] src/nvim/mbyte.h\r\n     - [ ] src/nvim/memfile_defs.h\r\n     - [ ] src/nvim/memfile.h\r\n     - [ ] src/nvim/memline_defs.h\r\n     - [ ] src/nvim/memline.h\r\n     - [ ] src/nvim/memory.h\r\n     - [ ] src/nvim/menu.h\r\n     - [ ] src/nvim/message.h\r\n     - [ ] src/nvim/misc1.h\r\n     - [ ] src/nvim/mouse.h\r\n     - [ ] src/nvim/move.h\r\n     - [ ] src/nvim/msgpack_rpc/channel.h\r\n     - [ ] src/nvim/msgpack_rpc/helpers.h\r\n     - [ ] src/nvim/msgpack_rpc/server.h\r\n     - [ ] src/nvim/normal.h\r\n     - [ ] src/nvim/ops.h\r\n     - [ ] src/nvim/option_defs.h\r\n     - [ ] src/nvim/option.h\r\n     - [ ] src/nvim/os/dl.h\r\n     - [ ] src/nvim/os/fileio.h\r\n     - [ ] src/nvim/os/fs_defs.h\r\n     - [ ] src/nvim/os/input.h\r\n     - [ ] src/nvim/os/os_defs.h\r\n     - [ ] src/nvim/os/os.h\r\n     - [ ] src/nvim/os/pty_process.h\r\n     - [ ] src/nvim/os/pty_process_unix.h\r\n     - [ ] src/nvim/os/pty_process_win.h\r\n     - [ ] src/nvim/os/shell.h\r\n     - [ ] src/nvim/os/signal.h\r\n     - [ ] src/nvim/os/stdpaths_defs.h\r\n     - [ ] src/nvim/os/time.h\r\n     - [ ] src/nvim/os/unix_defs.h\r\n     - [ ] src/nvim/os_unix.h\r\n     - [ ] src/nvim/os/win_defs.h\r\n     - [ ] src/nvim/path.h\r\n     - [ ] src/nvim/popupmnu.h\r\n     - [ ] src/nvim/pos.h\r\n     - [ ] src/nvim/profile.h\r\n     - [ ] src/nvim/quickfix.h\r\n     - [ ] src/nvim/rbuffer.h\r\n     - [ ] src/nvim/regexp_defs.h\r\n     - [ ] src/nvim/regexp.h\r\n     - [ ] src/nvim/screen.h\r\n     - [ ] src/nvim/search.h\r\n     - [ ] src/nvim/sha256.h\r\n     - [ ] src/nvim/shada.h\r\n     - [ ] src/nvim/sign_defs.h\r\n     - [ ] src/nvim/spell_defs.h\r\n     - [ ] src/nvim/spellfile.h\r\n     - [ ] src/nvim/spell.h\r\n     - [ ] src/nvim/state.h\r\n     - [ ] src/nvim/strings.h\r\n     - [ ] src/nvim/syntax_defs.h\r\n     - [ ] src/nvim/syntax.h\r\n     - [ ] src/nvim/tag.h\r\n     - [ ] src/nvim/terminal.h\r\n     - [ ] src/nvim/tui/input.h\r\n     - [ ] src/nvim/tui/tui.h\r\n     - [ ] src/nvim/types.h\r\n     - [ ] src/nvim/ugrid.h\r\n     - [ ] src/nvim/ui_bridge.h\r\n     - [ ] src/nvim/ui.h\r\n     - [ ] src/nvim/undo_defs.h\r\n     - [ ] src/nvim/undo.h\r\n     - [ ] src/nvim/version.h\r\n     - [ ] src/nvim/vim.h\r\n     - [ ] src/nvim/window.h\r\n- [ ] Add clint checks.\r\n- [ ] Fix remaining clint checks, IWYU errors, errors from check-single-includes.",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/6371/comments",
    "created_at": "2017-03-26T20:49:52Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/6371/events",
    "html_url": "https://github.com/neovim/neovim/issues/6371",
    "id": 217088144,
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "changes that are not features or bugfixes",
            "id": 106949155,
            "name": "refactor",
            "node_id": "MDU6TGFiZWwxMDY5NDkxNTU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/refactor"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/6371/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 590,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 419,
        "state": "open",
        "title": "backlog",
        "updated_at": "2023-11-23T13:10:58Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "MDU6SXNzdWUyMTcwODgxNDQ=",
    "number": 6371,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 4,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 4,
        "url": "https://api.github.com/repos/neovim/neovim/issues/6371/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/6371/timeline",
    "title": "[Project] Headers refactoring, IWYU",
    "updated_at": "2023-11-27T14:54:11Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/6371",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/322097?v=4",
        "events_url": "https://api.github.com/users/ZyX-I/events{/privacy}",
        "followers_url": "https://api.github.com/users/ZyX-I/followers",
        "following_url": "https://api.github.com/users/ZyX-I/following{/other_user}",
        "gists_url": "https://api.github.com/users/ZyX-I/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ZyX-I",
        "id": 322097,
        "login": "ZyX-I",
        "node_id": "MDQ6VXNlcjMyMjA5Nw==",
        "organizations_url": "https://api.github.com/users/ZyX-I/orgs",
        "received_events_url": "https://api.github.com/users/ZyX-I/received_events",
        "repos_url": "https://api.github.com/users/ZyX-I/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ZyX-I/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ZyX-I/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ZyX-I"
    }
}