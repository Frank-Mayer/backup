{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nDeleting text when `highlight_current_scope` from [nvim-treesitter-refactor](https://github.com/nvim-treesitter/nvim-treesitter-refactor) is enabled causes Neovim to freeze. It is unresponsive to any key inputs when that happens.\n\nIt seems to only happen for some language files.\n\nI can reproduce this using `brew install --HEAD neovim` (`NVIM v0.11.0-dev-1131+g7906532e0-Homebrew`) and from the latest nightly (`NVIM v0.11.0-dev-1129+gadbffff5d0`).\n\nI cannot reproduce this using the latest stable release (`NVIM v0.10.2`, downloaded from [here](https://github.com/neovim/neovim/releases/tag/v0.10.2) for `macos-arm64`).\n\n### Steps to reproduce\n\nUse the following `minimal.lua`:\n```lua\nfor name, url in pairs {\n  ['nvim-treesitter'] = 'https://github.com/nvim-treesitter/nvim-treesitter.git',\n  ['nvim-treesitter-refactor'] = 'https://github.com/nvim-treesitter/nvim-treesitter-refactor.git',\n} do\n  local install_path = vim.fn.fnamemodify('nvim_issue/' .. name, ':p')\n  if vim.fn.isdirectory(install_path) == 0 then\n    vim.fn.system { 'git', 'clone', '--depth=1', url, install_path }\n  end\n  vim.opt.runtimepath:append(install_path)\nend\n\nrequire'nvim-treesitter.configs'.setup {\n  ensure_installed = { \"cpp\", },\n  refactor = {\n    highlight_current_scope = { enable = true },\n  },\n}\n```\nThen, using the following `test.cc`:\n```cpp\n#include <iostream>\n\nusing namespace std;\n\nint main() {\n  cout << \"hello, world!\" << '\\n';\n  return 0;\n}\n```\nrun:\n```\nnvim --clean -u minimal.lua test.cc\n6gg\ndd\n```\nNeovim will freeze before being able to delete the line.\n\n### Expected behavior\n\nNeovim should delete the line and continue to be responsive to inputs from the keyboard.\n\n### Nvim version (nvim -v)\n\nNVIM v0.11.0-dev-1131+g7906532e0-Homebrew\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nmacOS 15.1\n\n### Terminal name/version\n\ntmux next-3.6 inside wezterm 20240203-110809-5046fc22\n\n### $TERM environment variable\n\ntmux-256color\n\n### Installation\n\nHomebrew, but also affects nightly build from this repository",
    "closed_at": null,
    "closed_by": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Can you reproduce this with other languages, especially one of the bundled ones?",
            "created_at": "2024-11-11T08:22:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467512208",
            "id": 2467512208,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TEz-Q",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467512208/reactions"
            },
            "updated_at": "2024-11-11T08:22:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467512208",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "And can you attach a debugger to find out _where_ it hangs? (This is unlikely to be an issue in Neovim itself; nine times out of ten it's a misbehaving parser. The refactor plugin is also not exactly actively maintained...)",
            "created_at": "2024-11-11T08:23:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467514295",
            "id": 2467514295,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TE0e3",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467514295/reactions"
            },
            "updated_at": "2024-11-11T08:23:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467514295",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I cannot reproduce this using the latest stable release (NVIM v0.10.2, downloaded from [here](https://github.com/neovim/neovim/releases/tag/v0.10.2) for macos-arm64).\n\nIn this case, could you bisect? Prime suspect are the recent tree-sitter version bumps and (my first guess) https://github.com/neovim/neovim/pull/30964.",
            "created_at": "2024-11-11T08:25:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467518316",
            "id": 2467518316,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TE1ds",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467518316/reactions"
            },
            "updated_at": "2024-11-11T08:27:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467518316",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Can you reproduce this with other languages, especially one of the bundled ones?\n\nI've seen the freeze happen while editing a Lua file, but I haven't been able to get a consistent reproduction.\n\n> And can you attach a debugger to find out _where_ it hangs?\n\nWhich `nvim` process should I be attaching to?\n```\n❯ pgrep -alf nvim\n34314 nvim-macos-arm64/bin/nvim --clean -u minimal.lua test.cc\n34315 nvim-macos-arm64/bin/nvim --embed --clean -u minimal.lua test.cc\n```\n\n> (This is unlikely to be an issue in Neovim itself; nine times out of ten it's a misbehaving parser. The refactor plugin is also not exactly actively maintained...)\n\nI can sympathise with that, but I think the perspective to take here is that plugins/parsers are userland programs and Neovim is the kernel. Userland programs should not be able to cause kernel crashes, no matter how buggy or poorly written they are. Kernel crashes are kernel bugs. (But I'll admit that that might be too difficult a standard to maintain regularly.)",
            "created_at": "2024-11-11T08:29:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467525320",
            "id": 2467525320,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TE3LI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467525320/reactions"
            },
            "updated_at": "2024-11-11T08:31:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467525320",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Can you reproduce this with other languages, especially one of the bundled ones?\n\nHere's a reproducer for Lua (you may need to add `\"lua\"` to the `ensure_installed` table):\n```\nnvim-macos-arm64/bin/nvim --clean -u minimal.lua minimal.lua\n15gg\ndd\n```",
            "created_at": "2024-11-11T08:33:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467532968",
            "id": 2467532968,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TE5Co",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467532968/reactions"
            },
            "updated_at": "2024-11-11T08:36:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467532968",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Which nvim process should I be attaching to?\n\nThe second (the first is the \"TUI\" client).\n\n> I can sympathise with that, but I think the perspective to take here is that plugins/parsers are userland programs and Neovim is the kernel. Userland programs should not be able to cause kernel crashes, no matter how buggy or poorly written they are. Kernel crashes are kernel bugs. (But I'll admit that that might be too difficult a standard to maintain regularly.)\n\nYes, but what do you want us to do about it? We are attaching to these parsers through an embedded library that we don't control. At this point, I don't even have high hopes for wasm parsers to essentially change that.\n\nIn any case, the point still stands: before this can be fixed, we need to know _where_ it should be fixed.\n\n>  (you may need to add \"lua\" to the ensure_installed table):\n\nUnlikely, and worth testing; the Lua parser hasn't been updated in quite a while so we bundle the same version nvim-treesitter installs.",
            "created_at": "2024-11-11T08:36:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467538905",
            "id": 2467538905,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TE6fZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467538905/reactions"
            },
            "updated_at": "2024-11-11T08:38:14Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467538905",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Here's the backtrace after attaching a debugger:\n```\n❯ pgrep -alf nvim\n37005 nvim-macos-arm64/bin/nvim --clean -u minimal.lua minimal.lua\n37006 nvim-macos-arm64/bin/nvim --embed --clean -u minimal.lua minimal.lua\n❯ lldb --attach-pid 37006\n(lldb) process attach --pid 37006\nProcess 37006 stopped\n* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP\n    frame #0: 0x0000000102a9e5d0 nvim`ts_node_child_with_descendant + 96\nnvim`ts_node_child_with_descendant:\n->  0x102a9e5d0 <+96>:  ldr    x8, [x8]\n    0x102a9e5d4 <+100>: tbnz   w8, #0x0, 0x102a9e620 ; <+176>\n    0x102a9e5d8 <+104>: ldr    w9, [x8, #0x24]\n    0x102a9e5dc <+108>: cbz    w9, 0x102a9e620 ; <+176>\nExecutable module set to \"/private/var/folders/nj/9vfk4f0n377605jhxxmngd8h0000gn/T/tmp.ZUCFdCVe4i/nvim-macos-arm64/bin/nvim\".\nArchitecture set to: arm64-apple-macosx-.\n(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP\n  * frame #0: 0x0000000102a9e5d0 nvim`ts_node_child_with_descendant + 96\n    frame #1: 0x0000000102a9e6c0 nvim`ts_node_child_with_descendant + 336\n    frame #2: 0x0000000102a9e6c0 nvim`ts_node_child_with_descendant + 336\n    frame #3: 0x0000000102a9e6c0 nvim`ts_node_child_with_descendant + 336\n    frame #4: 0x0000000102a9e6c0 nvim`ts_node_child_with_descendant + 336\n    frame #5: 0x0000000102a9e2cc nvim`ts_node_child_containing_descendant + 336\n    frame #6: 0x0000000102a9e144 nvim`ts_node_parent + 84\n    frame #7: 0x0000000102d1b720 nvim`node_parent + 76\n    frame #8: 0x0000000102abd1ec nvim`lj_BC_FUNCC + 44\n    frame #9: 0x0000000102ad3760 nvim`lua_pcall + 228\n    frame #10: 0x0000000102d10b5c nvim`ex_lua + 640\n    frame #11: 0x0000000102c70794 nvim`execute_cmd0 + 256\n    frame #12: 0x0000000102c6bd7c nvim`do_cmdline + 10340\n    frame #13: 0x0000000102b8974c nvim`apply_autocmds_group + 1996\n    frame #14: 0x0000000102d99300 nvim`normal_check + 1072\n    frame #15: 0x0000000102e93c1c nvim`state_enter + 104\n    frame #16: 0x0000000102d21cfc nvim`main + 16296\n    frame #17: 0x000000019e810274 dyld`start + 2840\n```",
            "created_at": "2024-11-11T09:02:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467594616",
            "id": 2467594616,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TFIF4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467594616/reactions"
            },
            "updated_at": "2024-11-11T09:31:21Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467594616",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Thank you, that does indeed point to the linked commit -- can you try reverting that?\n\n@vanaigr ",
            "created_at": "2024-11-11T09:04:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467598363",
            "id": 2467598363,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TFJAb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467598363/reactions"
            },
            "updated_at": "2024-11-11T09:04:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467598363",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I tried reverting 7a20f93a929abda22f979e92fd75b92e447d1e2a but Neovim is still freezing (using the same reproducer [here](https://github.com/neovim/neovim/issues/31163#issuecomment-2467532968)).\n\nNew backtrace:\n```\n❯ pgrep -alf nvim\n72248 /tmp/nvim/bin/nvim -u minimal.lua minimal.lua\n72249 /tmp/nvim/bin/nvim --embed -u minimal.lua minimal.lua\n❯ lldb --attach-pid 72249\n(lldb) process attach --pid 72249\nProcess 72249 stopped\n* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP\n    frame #0: 0x0000000104b4f040 nvim`lj_vm_exit_interp + 68\nnvim`lj_vm_exit_interp:\n->  0x104b4f040 <+68>: str    w3, [x22, #0xb8]\n    0x104b4f044 <+72>: cmn    w0, #0x11\n    0x104b4f048 <+76>: b.eq   0x104b4f0b4    ; <+184>\n    0x104b4f04c <+80>: cmp    w17, #0x61\nExecutable module set to \"/private/tmp/nvim/bin/nvim\".\nArchitecture set to: arm64-apple-macosx-.\n(lldb) bt\n* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP\n  * frame #0: 0x0000000104b4f040 nvim`lj_vm_exit_interp + 68\n    frame #1: 0x0000000104b63eac nvim`lua_pcall(L=<unavailable>, nargs=<unavailable>, nresults=<unavailable>, errfunc=<unavailable>) at lj_api.c:1151:12 [opt]\n    frame #2: 0x0000000104866de4 nvim`nlua_pcall(lstate=0x0000000104f3c380, nargs=0, nresults=0) at executor.c:174:16\n    frame #3: 0x00000001048685ac nvim`nlua_typval_exec(lcmd=\"require'nvim-treesitter-refactor.highlight_current_scope'.highlight_current_scope(1)\", lcmd_len=84, name=\":lua\", args=0x0000000000000000, argcount=0, special=false, ret_tv=0x0000000000000000) at executor.c:1482:7\n    frame #4: 0x0000000104869520 nvim`ex_lua(eap=0x000000016b7a9118) at executor.c:1696:3\n    frame #5: 0x00000001047bbd58 nvim`execute_cmd0(retv=0x000000016b7a9114, eap=0x000000016b7a9118, errormsg=0x000000016b7a91d8, preview=false) at ex_docmd.c:1714:7\n    frame #6: 0x00000001047b6c78 nvim`do_one_cmd(cmdlinep=0x000000016b7a94e8, flags=7, cstack=0x000000016b7a94f0, fgetline=(nvim`getnextac at autocmd.c:2071), cookie=0x000000016b7a9b18) at ex_docmd.c:2358:7\n    frame #7: 0x00000001047b4510 nvim`do_cmdline(cmdline=0x0000000000000000, fgetline=(nvim`getnextac at autocmd.c:2071), cookie=0x000000016b7a9b18, flags=7) at ex_docmd.c:667:20\n    frame #8: 0x00000001046b5934 nvim`apply_autocmds_group(event=EVENT_CURSORMOVED, fname=\"/private/var/folders/nj/9vfk4f0n377605jhxxmngd8h0000gn/T/tmp.ZUCFdCVe4i/minimal.lua\", fname_io=0x0000000000000000, force=false, group=-3, buf=0x0000000138816000, eap=0x0000000000000000, data=0x0000000000000000) at autocmd.c:1842:5\n    frame #9: 0x00000001046b6e4c nvim`apply_autocmds(event=EVENT_CURSORMOVED, fname=0x0000000000000000, fname_io=0x0000000000000000, force=false, buf=0x0000000138816000) at autocmd.c:1499:10\n    frame #10: 0x00000001048fcfc4 nvim`normal_check_cursor_moved(s=0x000000016b7a9d90) at normal.c:1306:5\n    frame #11: 0x00000001048fcab8 nvim`normal_check(state=0x000000016b7a9d90) at normal.c:1447:5\n    frame #12: 0x0000000104a0ab68 nvim`state_enter(s=0x000000016b7a9d90) at state.c:40:35\n    frame #13: 0x00000001048ea88c nvim`normal_enter(cmdwin=false, noexmode=false) at normal.c:521:3\n    frame #14: 0x00000001048785b0 nvim`main(argc=5, argv=0x000000016b7aa390) at main.c:660:3\n    frame #15: 0x000000019e810274 dyld`start + 2840\n```\n\nGoing to give bisecting a try later.",
            "created_at": "2024-11-11T10:16:06Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467768770",
            "id": 2467768770,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TFynC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467768770/reactions"
            },
            "updated_at": "2024-11-11T10:23:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467768770",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Bisected, looks like a `tree-sitter` bug:\n```\n❯ killall nvim; gbsb\nf59aeb5a9ae80f6f0e12ae52330f3f4e0e7e03e0 is the first bad commit\ncommit f59aeb5a9ae80f6f0e12ae52330f3f4e0e7e03e0 (HEAD)\nAuthor: Christian Clason <c.clason@uni-graz.at>\nDate:   Sun Nov 10 11:10:01 2024 +0100\n\n    build(deps): bump tree-sitter to v0.24.4\n\n cmake.deps/deps.txt | 4 ++--\n 1 file changed, 2 insertions(+), 2 deletions(-)\n```",
            "created_at": "2024-11-11T10:39:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467832326",
            "id": 2467832326,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TGCIG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467832326/reactions"
            },
            "updated_at": "2024-11-11T10:39:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467832326",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yep, reverting the `tree-sitter` bump (f59aeb5a9ae80f6f0e12ae52330f3f4e0e7e03e0) makes the freeze go away.",
            "created_at": "2024-11-11T10:42:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467840315",
            "id": 2467840315,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TGEE7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467840315/reactions"
            },
            "updated_at": "2024-11-11T10:42:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467840315",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Reported upstream at tree-sitter/tree-sitter#3930.",
            "created_at": "2024-11-11T10:59:49Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2467889123",
            "id": 2467889123,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TGP_j",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467889123/reactions"
            },
            "updated_at": "2024-11-11T10:59:49Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2467889123",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
                "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
                "followers_url": "https://api.github.com/users/carlocab/followers",
                "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
                "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/carlocab",
                "id": 30379873,
                "login": "carlocab",
                "node_id": "MDQ6VXNlcjMwMzc5ODcz",
                "organizations_url": "https://api.github.com/users/carlocab/orgs",
                "received_events_url": "https://api.github.com/users/carlocab/received_events",
                "repos_url": "https://api.github.com/users/carlocab/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/carlocab",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "NONE",
            "body": "@carlocab how do you revert tree-sitter? My neovim installation is via brew and the latest treesitter version is a dependency of neovim that I haven't figured out how to downgrade.\n\nMy neovim is now unusable as it freezes almost instantly.",
            "created_at": "2024-11-11T18:18:31Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2468777259",
            "id": 2468777259,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TJo0r",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468777259/reactions"
            },
            "updated_at": "2024-11-11T18:21:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468777259",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/12768642?v=4",
                "events_url": "https://api.github.com/users/davidmdm/events{/privacy}",
                "followers_url": "https://api.github.com/users/davidmdm/followers",
                "following_url": "https://api.github.com/users/davidmdm/following{/other_user}",
                "gists_url": "https://api.github.com/users/davidmdm/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/davidmdm",
                "id": 12768642,
                "login": "davidmdm",
                "node_id": "MDQ6VXNlcjEyNzY4NjQy",
                "organizations_url": "https://api.github.com/users/davidmdm/orgs",
                "received_events_url": "https://api.github.com/users/davidmdm/received_events",
                "repos_url": "https://api.github.com/users/davidmdm/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/davidmdm/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/davidmdm/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/davidmdm",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Use a stable release.",
            "created_at": "2024-11-11T18:21:28Z",
            "html_url": "https://github.com/neovim/neovim/issues/31163#issuecomment-2468782099",
            "id": 2468782099,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31163",
            "node_id": "IC_kwDOAPphoM6TJqAT",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468782099/reactions"
            },
            "updated_at": "2024-11-11T18:21:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2468782099",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 14,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31163/comments",
    "created_at": "2024-11-11T08:20:19Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31163/events",
    "html_url": "https://github.com/neovim/neovim/issues/31163",
    "id": 2648541126,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "FEF2C0",
            "default": false,
            "description": "Needs a third-party / external change or fix",
            "id": 101945532,
            "name": "status:blocked-external",
            "node_id": "MDU6TGFiZWwxMDE5NDU1MzI=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/status:blocked-external"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue contains a stacktrace/ASAN log",
            "id": 435854079,
            "name": "has:backtrace",
            "node_id": "MDU6TGFiZWw0MzU4NTQwNzk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:backtrace"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue has been tracked to a specific commit",
            "id": 1481421490,
            "name": "has:bisected",
            "node_id": "MDU6TGFiZWwxNDgxNDIxNDkw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:bisected"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 1799626557,
            "name": "treesitter",
            "node_id": "MDU6TGFiZWwxNzk5NjI2NTU3",
            "url": "https://api.github.com/repos/neovim/neovim/labels/treesitter"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31163/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6d3YfG",
    "number": 31163,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31163/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31163/timeline",
    "title": "nvim freezes when deleting text when `highlight_current_scope` is enabled",
    "updated_at": "2024-11-11T18:21:38Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31163",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/30379873?v=4",
        "events_url": "https://api.github.com/users/carlocab/events{/privacy}",
        "followers_url": "https://api.github.com/users/carlocab/followers",
        "following_url": "https://api.github.com/users/carlocab/following{/other_user}",
        "gists_url": "https://api.github.com/users/carlocab/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/carlocab",
        "id": 30379873,
        "login": "carlocab",
        "node_id": "MDQ6VXNlcjMwMzc5ODcz",
        "organizations_url": "https://api.github.com/users/carlocab/orgs",
        "received_events_url": "https://api.github.com/users/carlocab/received_events",
        "repos_url": "https://api.github.com/users/carlocab/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/carlocab/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/carlocab/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/carlocab",
        "user_view_type": "public"
    }
}