{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nHi there!\r\nI'm sometimes using nvim inside tmux that runs inside tmux, which runs in Konsole.\r\n(In some cases I even pass KONSOLE_* variables over ssh to make some nvim-irrelevant things to work).\r\n\r\nAs far as I understand, `nvim` detects whether it runs in `konsole`/`yakuake` by checking `KONSOLE_DBUS_SESSION` variable.\r\nAnd, it seems, that check has higher priority over checking for tmux (although, I failed to find an evidence in `src/nvim/tui/tui.c`).\r\n\r\nAnyway, the problem is that nvim doestn't change cursor shape when it runs inside tmux (where I have set up overriding of `Se`/`Ss` to `Konsole`'s code) and there is `KONSOLE_DBUS_SESSION` variable in the environment.\r\n\r\nIf I unset it, it works like a charm.\r\n\r\n\r\nAlso, previously I had following in the config, but it stoped working since one of the last updates:\r\n```Lua\r\n-- hack to stop nvim to detect Konsole when in tmux\r\n-- (I made cursor management stuff in tmux instead).    \r\nif os.getenv(\"TERM\"):match\"^tmux*\" then    \r\n  cmd([[unlet $KONSOLE_DBUS_SERVICE | unlet $KONSOLE_DBUS_SESSION | ]]    \r\n    .. [[unlet $KONSOLE_PROFILE_NAME | unlet $KONSOLE_VERSION]])    \r\nend\r\n```\r\n\r\nLooks like now nvim checks cursor shaping things before reading the config :shrug: \r\n\r\nAnyway, I don't know how to resolve that issue, as I need those variables to be set for other things to work, so I can't unset them in the shell.\r\nAnd, it seems, there is no way to unset them within nvim anymore.\r\n\r\n\r\nMaybe nvim need a special handle for that situation (konsole+tmux)?\r\nOr, at least, prioritize check for tmux over check for konsole? :shrug: \n\n### Steps to reproduce\n\n1. Run Konsole or Yakuake\r\n2. run nvim (even `nvim --clean`) and see it changes cursor shapes between normal and insert modes\r\n4. exit nvim, run tmux (with terminal-overriding set up properly and `KONSOLE_*`-variables in `update-environment`)\r\n5. run nvim (even clean) and see it don't change cursor shape at all\r\n6. exit nvim, unset `KONSOLE_*` variables in the shell\r\n7. run nvim again and see, it changes cursor shapes again pretty well\n\n### Expected behavior\n\n Cursor shape changing works even without unsetting `KONSOLE_*` vars\n\n### Neovim version (nvim -v)\n\nv0.10.0-dev-729+g74bd4aba5-dirty\n\n### Vim (not Nvim) behaves the same?\n\nirrelevant\n\n### Operating system/version\n\nGentoo\n\n### Terminal name/version\n\nKonsole 23.04.2\n\n### $TERM environment variable\n\nxterm-256color and konsole-256color\n\n### Installation\n\nOfficial Gentoo package",
    "closed_at": "2023-08-04T11:14:56Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> where I have set up overriding of Se/Ss to Konsole's code\r\n\r\nWhat does this mean?",
            "created_at": "2023-08-04T07:26:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665136473",
            "id": 1665136473,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jP_dZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665136473/reactions"
            },
            "updated_at": "2023-08-04T07:26:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665136473",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> What does this mean?\r\n\r\n```tmux                                                                                                                            \r\n# Konsole\r\n# Cursor shape: Ss=set, Se=reset\r\nset -gas terminal-overrides ',konsole*:Ss=\\E]50;CursorShape=%?%p1%{3}%<%t%{0}%e%p1%{5}%<%t%{2}%e%{1}%;%d;BlinkingCursorEnabled=%?%p1%{1}%<%t%{1}%e%p1%{1}%&%;%d\\007:Se=\\E]50;CursorShape=1;BlinkingCursorEnabled=1\\007'\r\n# Cursor colors: Cs=set, Cr=reset\r\nset -gas terminal-overrides ',konsole*:Cs=\\E]50;UseCustomCursorColor=1;CustomCursorColor=%p1%s\\007:Cr=\\E]50;UseCustomCursorColor=0\\007'\r\n```",
            "created_at": "2023-08-04T08:58:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665274293",
            "id": 1665274293,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jQhG1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665274293/reactions"
            },
            "updated_at": "2023-08-04T08:58:47Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665274293",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "well, although, current Konsole version annyway supports XTerm's codes, so this is not even needed, and it is enough to just\r\n```tmux\r\nset -gas terminal-overrides ',xterm*:Ss=\\E[%p1%d q:Se=\\E[2 q'\r\n```\r\n\r\nAnyway, it works fine with both ways, if remove `KONSOLE_*` vars",
            "created_at": "2023-08-04T09:01:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665277411",
            "id": 1665277411,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jQh3j",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665277411/reactions"
            },
            "updated_at": "2023-08-04T09:01:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665277411",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Wait... Why is `$TERM` set to `xterm-256color` or `konsole-256color` inside tmux? It should be `tmux-256color`.",
            "created_at": "2023-08-04T09:16:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665297872",
            "id": 1665297872,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jQm3Q",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665297872/reactions"
            },
            "updated_at": "2023-08-04T09:16:27Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665297872",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Cannot reproduce. When using the tmux configs mentioned below, cursor shape either works both inside and outside Nvim, or neither.",
            "created_at": "2023-08-04T09:23:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665306585",
            "id": 1665306585,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jQo_Z",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665306585/reactions"
            },
            "updated_at": "2023-08-04T09:23:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665306585",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> current Konsole version annyway supports XTerm's codes,\r\n\r\nAh right. And we aren't going to spend time supporting the old konsole if we can avoid it.\r\n\r\nIt turns out when you add a bunch of junk to 3+ layers of terminals, things get weird.",
            "created_at": "2023-08-04T11:14:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665443504",
            "id": 1665443504,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRKaw",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665443504/reactions"
            },
            "updated_at": "2023-08-04T11:14:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665443504",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > current Konsole version annyway supports XTerm's codes,\r\n> \r\n> Ah right. And we aren't going to spend time supporting the old konsole if we can avoid it.\r\n\r\nYeah, but now nvim somewhy still trying to detect the Konsole and handle it separately (I guess, it tries to use Konsole's `Ss` inside tmux, while tmux waits for the ones described in it's terminfo (actually, it is xterm's ones), and that is why this issue appears.\r\n\r\nBecause when nvim don't detect Konsole (after unsetting KONSOLE variables), all works fine (I guess, nvim uses codes from tmux terminfo (which are identical to xterm ones))",
            "created_at": "2023-08-04T12:49:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665557121",
            "id": 1665557121,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRmKB",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665557121/reactions"
            },
            "updated_at": "2023-08-04T12:56:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665557121",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Wait... Why is `$TERM` set to `xterm-256color` or `konsole-256color` inside tmux? It should be `tmux-256color`.\r\n\r\nIIRC, no: that terms in `set` commands belongs to the TERM outside of `tmux`. And, AFAIU, it is \"which code tmux should send outside, when it receive corresponding codes from application.\r\n\r\nSo, when nvim doesn't recognize Konsole because of variables, it sends correct `Ss` codes to change the shape, and it works.\r\nBut when it thinks it runs in Konsole (while actually in tmux, which is in Konsole), and it, I guess, sends Konsole's codes, which tmux doesn't recognize, so don't proxy them outside.\r\n\r\nAt least, how I imagine the situation.",
            "created_at": "2023-08-04T12:54:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665562905",
            "id": 1665562905,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRnkZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665562905/reactions"
            },
            "updated_at": "2023-08-04T12:54:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665562905",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "That's what I thought you were trying to mean as well, and I cannot reproduce this.",
            "created_at": "2023-08-04T12:58:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665568350",
            "id": 1665568350,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRo5e",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665568350/reactions"
            },
            "updated_at": "2023-08-04T12:58:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665568350",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> > current Konsole version annyway supports XTerm's codes,\r\n\r\nBy the way, it only applicable to cursor shape changing codes.\r\n\r\nIt still doesn't suppor cursor color change (`Cs`/`Cr`) sequences of xterm and still requires custom ones.\r\n",
            "created_at": "2023-08-04T12:59:45Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665570336",
            "id": 1665570336,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRpYg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665570336/reactions"
            },
            "updated_at": "2023-08-04T12:59:45Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665570336",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Ok what about this patch:\r\n\r\n```diff\r\ndiff --git a/src/nvim/tui/tui.c b/src/nvim/tui/tui.c\r\nindex 0983667695c2..da1173cd9e25 100644\r\n--- a/src/nvim/tui/tui.c\r\n+++ b/src/nvim/tui/tui.c\r\n@@ -289,12 +289,9 @@ static void terminfo_start(TUIData *tui)\r\n   bool iterm_env = termprg && strstr(termprg, \"iTerm.app\");\r\n   bool nsterm = (termprg && strstr(termprg, \"Apple_Terminal\"))\r\n                 || terminfo_is_term_family(term, \"nsterm\");\r\n-  bool konsole = terminfo_is_term_family(term, \"konsole\")\r\n-                 || os_getenv(\"KONSOLE_PROFILE_NAME\")\r\n-                 || os_getenv(\"KONSOLE_DBUS_SESSION\");\r\n+  bool konsole = terminfo_is_term_family(term, \"konsole\");\r\n   const char *konsolev_env = os_getenv(\"KONSOLE_VERSION\");\r\n-  long konsolev = konsolev_env ? strtol(konsolev_env, NULL, 10)\r\n-                               : (konsole ? 1 : 0);\r\n+  long konsolev = (konsole && konsolev_env) ? strtol(konsolev_env, NULL, 10) : 0;\r\n \r\n   patch_terminfo_bugs(tui, term, colorterm, vtev, konsolev, iterm_env, nsterm);\r\n   augment_terminfo(tui, term, vtev, konsolev, iterm_env, nsterm);\r\n```\r\n\r\nThat changes our \"is this konsole\" decision to _require_ `TERM=*konsole*`, which makes the logic more intentional and simpler. And removes the sloppy guessing [from 2015](https://github.com/neovim/neovim/commit/5fc4c2d442f01ab53fa95c7732c834950d283190) based on `KONSOLE_XX` env vars.",
            "created_at": "2023-08-04T13:01:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665573788",
            "id": 1665573788,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRqOc",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665573788/reactions"
            },
            "updated_at": "2023-08-04T13:02:37Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665573788",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Ok what about this patch:\r\n\r\nOn the on hand, it is LGTM, and it would be the right way, imho.\r\n\r\n\r\nBut on the other, that will shoot in the legs of the users that set `TERM=xterm-{256color,direct256}` in Konsole for some reasons (starting from `ssh`'ing on devices with old tetminfos, to reasons of avoiding some bugs in some apps (for example, before I faced a bug in new ncurses (which made some terminfos become broken), and before I read that it is not neccessary to use \"-direct\" terminfos for truecolor anymore, I used `TERM=xterm-direct256` in Konsole settings for years).\r\n\r\n// And by the way, that was the reason I switched back to `konsole-*` TERM, and faced that neighbour bug triggered by `st`'s `TERMINFO_DIRS`\r\n\r\n\r\nSo, I dunno :shrug: \r\n\r\nOn the other hand we have a clean and right way, and on the other by doing this we definitelly brake the behaviour some users rely on.\r\n\r\n\r\nWill it be hard to make some \"backup\" way to signal that \"Actually, this is konsole\" for people, that can't use `TERM=konsole*` for some reason?\r\n\r\nMaybe look for `ACTUALLY_I_USE_KONSOLE` variable? :grin: ",
            "created_at": "2023-08-04T13:14:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665590830",
            "id": 1665590830,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRuYu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665590830/reactions"
            },
            "updated_at": "2023-08-04T13:19:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665590830",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Maybe look for `ACTUALLY_I_USE_KONSOLE` variable?\r\n\r\nThat just never works because the layers just pile up.\r\n\r\n> But on the other, that will shoot in the legs of the users that set `TERM=xterm-{256color,direct256}` in Konsole for some reasons\r\n\r\nThe worst case is that their cursor shape might not work? And we gain easier-to-reason-about behavior.",
            "created_at": "2023-08-04T13:19:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665597891",
            "id": 1665597891,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRwHD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665597891/reactions"
            },
            "updated_at": "2023-08-04T13:19:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665597891",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Doesn't Konsole set `$TERM` to `xterm-256color` by default?",
            "created_at": "2023-08-04T13:20:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665599668",
            "id": 1665599668,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRwi0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665599668/reactions"
            },
            "updated_at": "2023-08-04T13:20:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665599668",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "\r\n> The worst case is that their cursor shape might not work? And we gain easier-to-reason-about behavior.\r\n\r\nYeah. Well, I think, they will anyway be able to find this issue and read the reasoning, if any, so, yes, maybe it is not worth to bothering of supporting that kludges",
            "created_at": "2023-08-04T13:22:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665601349",
            "id": 1665601349,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRw9F",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665601349/reactions"
            },
            "updated_at": "2023-08-04T13:22:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665601349",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> Doesn't Konsole set `$TERM` to `xterm-256color` by default?\r\n\r\nThanks for the point...\r\n\r\nIt seems, it is: https://github.com/search?q=repo%3AKDE%2Fkonsole+xterm-256color&type=code",
            "created_at": "2023-08-04T13:27:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665608404",
            "id": 1665608404,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRyrU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665608404/reactions"
            },
            "updated_at": "2023-08-04T13:27:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665608404",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "although, again, I think, it will be enough to add a paragraph mentioning that in the documentation, like it was done for tmux (`:h tui-cursor-tmux`). So, we can add `tui-cursor-konsole` and suggest user to setup TERM to `konsole-256color` :shrug:",
            "created_at": "2023-08-04T13:30:15Z",
            "html_url": "https://github.com/neovim/neovim/issues/24546#issuecomment-1665611706",
            "id": 1665611706,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24546",
            "node_id": "IC_kwDOAPphoM5jRze6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665611706/reactions"
            },
            "updated_at": "2023-08-04T13:49:57Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1665611706",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
                "events_url": "https://api.github.com/users/msva/events{/privacy}",
                "followers_url": "https://api.github.com/users/msva/followers",
                "following_url": "https://api.github.com/users/msva/following{/other_user}",
                "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/msva",
                "id": 268102,
                "login": "msva",
                "node_id": "MDQ6VXNlcjI2ODEwMg==",
                "organizations_url": "https://api.github.com/users/msva/orgs",
                "received_events_url": "https://api.github.com/users/msva/received_events",
                "repos_url": "https://api.github.com/users/msva/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/msva"
            }
        }
    ],
    "comments": 17,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24546/comments",
    "created_at": "2023-08-03T18:58:15Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24546/events",
    "html_url": "https://github.com/neovim/neovim/issues/24546",
    "id": 1835571502,
    "labels": [
        {
            "color": "c5def5",
            "default": false,
            "description": "user system environment (terminal, shell, tmux)",
            "id": 147354524,
            "name": "environment",
            "node_id": "MDU6TGFiZWwxNDczNTQ1MjQ=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/environment"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "",
            "id": 197254545,
            "name": "tui",
            "node_id": "MDU6TGFiZWwxOTcyNTQ1NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/tui"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24546/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 570,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 417,
        "state": "open",
        "title": "backlog",
        "updated_at": "2023-08-04T21:11:41Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM5taJku",
    "number": 24546,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24546/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24546/timeline",
    "title": "Cursor shape inside tmux that runs in Konsole (with KONSOLE_DBUS_SESSION variable)",
    "updated_at": "2023-08-04T13:49:57Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24546",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/268102?v=4",
        "events_url": "https://api.github.com/users/msva/events{/privacy}",
        "followers_url": "https://api.github.com/users/msva/followers",
        "following_url": "https://api.github.com/users/msva/following{/other_user}",
        "gists_url": "https://api.github.com/users/msva/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/msva",
        "id": 268102,
        "login": "msva",
        "node_id": "MDQ6VXNlcjI2ODEwMg==",
        "organizations_url": "https://api.github.com/users/msva/orgs",
        "received_events_url": "https://api.github.com/users/msva/received_events",
        "repos_url": "https://api.github.com/users/msva/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/msva/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/msva/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/msva"
    }
}