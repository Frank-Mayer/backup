{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nMy workflow is having a buffer open with my project in it, and in a vsplit buffer next to it having a term://zsh buffer to manually run commands in. I also have a normal mode mapping for ```<Space>ev``` to edit my init.lua in a new tab (using tab drop as to not create unnecessary tabs). Currently, when I have my workspace open and go to edit my vimrc with my mapping it will open the tab as expected, but it starts me out in insert mode.\r\n\r\nThis has been bothering me for months, and I finally decided to do some digging to see what might be causing it, and it seems to only happen in somewhat specific circumstances.\r\n\r\n### Steps to reproduce\r\n\r\n1. Open a file (doesn't work with an empty buffer) using the minimal init.lua attached below.\r\n2. Use ```<Space>t``` to open a terminal in a vertical split to the right of the main buffer.\r\n3. Use ```<C-h>``` to return to normal mode and move to the text buffer.\r\n4. Type ```<Space>ev``` to be brought to a new tab with the nvim config, just to find that it is in insert mode instead of normal mode.\r\n\r\n```\r\nvim.g.mapleader = \" \"\r\n\r\nvim.opt.splitright = true\r\n\r\nlocal keyset = vim.keymap.set\r\nkeyset(\"n\", \"<leader>t\", \":vsplit term://zsh<CR>\")\r\nkeyset(\"n\", \"<leader>ev\", (\":tab drop ~/.config/nvim/init.lua<CR>\"))\r\nkeyset(\"t\", \"<C-h>\", \"<C-\\\\><C-N><C-w>h\")\r\n\r\nvim.api.nvim_create_augroup(\"myterm\", {})\r\nvim.api.nvim_create_autocmd(\"BufEnter\", { group = \"myterm\", command = \"if &buftype ==# 'terminal' | startinsert | endif\" })\r\n```\r\n\r\n### Expected behavior\r\n\r\nWhat I expect is for my init.lua to open in a new tab and be in normal mode. From my testing it appears that when ```splitright``` is enabled and a terminal is opened, ```BufEnter``` autocommands run on the new tab will act as if their ```buftype``` is \"terminal\".\r\n\r\nThis works as expected if any of the following is true:\r\n```splitright``` is set to false\r\n```tab new``` is used in place of ```tab drop``` on line 8 of the vimrc\r\nyou manually type ```:tab drop ~/.config/nvim/init2.lua<CR>``` instead of using the mapping\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.10.0-dev-2191+g4e59422e1-Homebrew\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nno, vim 9.0.2018 (vim can't use lua configuration)\r\n\r\n### Operating system/version\r\n\r\nmacOS 14.2.1\r\n\r\n### Terminal name/version\r\n\r\niTerm2 3.4.20\r\n\r\n### $TERM environment variable\r\n\r\nxterm-256color\r\n\r\n### Installation\r\n\r\nHomebrew",
    "closed_at": "2024-03-07T00:01:49Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "As mentioned in https://github.com/vim/vim/issues/12087#issuecomment-1509735990 this is the intended behavior:\r\n\r\n> What happens is that Vim goes over\r\nall the windows and might close some, those that are not in the updated\r\nargument list.\r\n\r\n> However, if we would leave out the autocommands in this\r\nspecific situation, and still trigger them for the \"tab all\" command, it\r\ngets inconsistent.",
            "created_at": "2024-03-07T00:01:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/27758#issuecomment-1982070887",
            "id": 1982070887,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27758",
            "node_id": "IC_kwDOAPphoM52JABn",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1982070887/reactions"
            },
            "updated_at": "2024-03-07T00:01:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1982070887",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "And this can be considered a duplicate of #14567 or #17126",
            "created_at": "2024-03-07T00:02:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/27758#issuecomment-1982071386",
            "id": 1982071386,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/27758",
            "node_id": "IC_kwDOAPphoM52JAJa",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1982071386/reactions"
            },
            "updated_at": "2024-03-07T00:17:06Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1982071386",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/27758/comments",
    "created_at": "2024-03-06T22:35:45Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/27758/events",
    "html_url": "https://github.com/neovim/neovim/issues/27758",
    "id": 2172562747,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as usage questions",
            "id": 77997478,
            "name": "closed:question",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3OA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:question"
        },
        {
            "color": "e6e6e6",
            "default": false,
            "description": "issues that are closed as duplicates of other issues",
            "id": 3221613764,
            "name": "closed:duplicate",
            "node_id": "MDU6TGFiZWwzMjIxNjEzNzY0",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:duplicate"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/27758/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6Bfq07",
    "number": 27758,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/27758/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/27758/timeline",
    "title": "buftype variable not cleared for tab drop when splitright is true",
    "updated_at": "2024-03-07T00:17:06Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/27758",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/20823837?v=4",
        "events_url": "https://api.github.com/users/ilovehans10/events{/privacy}",
        "followers_url": "https://api.github.com/users/ilovehans10/followers",
        "following_url": "https://api.github.com/users/ilovehans10/following{/other_user}",
        "gists_url": "https://api.github.com/users/ilovehans10/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ilovehans10",
        "id": 20823837,
        "login": "ilovehans10",
        "node_id": "MDQ6VXNlcjIwODIzODM3",
        "organizations_url": "https://api.github.com/users/ilovehans10/orgs",
        "received_events_url": "https://api.github.com/users/ilovehans10/received_events",
        "repos_url": "https://api.github.com/users/ilovehans10/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ilovehans10/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ilovehans10/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ilovehans10"
    }
}