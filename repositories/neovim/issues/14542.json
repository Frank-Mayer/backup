{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "<!-- \r\nBefore reporting: search existing issues and check the FAQ. Usage questions\r\nsuch as \"How do I...?\" or \"Why isn't X language server/feature working?\" belong \r\non the [Neovim Discourse](https://neovim.discourse.group/c/7-category/7) and will\r\nbe closed.\r\n-->\r\n\r\n- `nvim --version`:\r\n```\r\nNVIM v0.5.0-dev+1318-g61aefaf29\r\nBuild type: RelWithDebInfo\r\nLuaJIT 2.0.5\r\n```\r\n- language server name/version: rust-analyzer 9a431c26f 2021-05-12 dev\r\n- Operating system/version: Linux coorie 5.10.34-1-MANJARO #1 SMP Sun May 2 11:29:56 UTC 2021 x86_64 GNU/Linux\r\n\r\n<details>\r\n<summary>nvim -c \":checkhealth nvim lspconfig\"</summary>\r\n\r\n<!-- Paste the results from `nvim -c \":checkhealth nvim lspconfig\"` here. -->\r\n\r\n```vim\r\nhealth#nvim#check\r\n========================================================================\r\n## Configuration\r\n  - OK: no issues found\r\n\r\n## Performance\r\n  - OK: Build type: RelWithDebInfo\r\n\r\n## Remote Plugins\r\n  - OK: Up to date\r\n\r\n## terminal\r\n  - INFO: key_backspace (kbs) terminfo entry: key_backspace=^H\r\n  - INFO: key_dc (kdch1) terminfo entry: key_dc=\\E[3~\r\n  - INFO: $TERM_PROGRAM='tmux'\r\n  - INFO: $COLORTERM='truecolor'\r\n\r\n## tmux\r\n  - OK: escape-time: 1\r\n  - INFO: Checking stuff\r\n  - OK: focus-events: on\r\n  - INFO: $TERM: tmux-256color\r\n\r\nhealth#lspconfig#check\r\n========================================================================\r\n## Checking language server protocol configuration\r\n  - INFO: pyls: configuration checked.\r\n  - INFO: texlab: configuration checked.\r\n  - INFO: bashls: configuration checked.\r\n  - INFO: clangd: configuration checked.\r\n  - INFO: rust_analyzer: configuration checked.\r\n  - INFO: tsserver: configuration checked.\r\n```\r\n\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>lsp.log</summary>\r\n\r\n<!--\r\nPlease paste the lsp log before and after the problem.\r\n\r\nYou can set log level like this.\r\n`:lua vim.lsp.set_log_level(\"debug\")`\r\n\r\nYou can find the location of the log with the following command.\r\n`:lua print(vim.lsp.get_log_path())`\r\n-->\r\nbefore blank file\r\nafter attached lsp.log\r\n[lsp.log](https://github.com/neovim/neovim/files/6466465/lsp.log)\r\n\r\n</details>\r\n\r\n\r\n### Steps to reproduce using nvim -u minimal_init.lua\r\n<!-- \r\n  Note, if the issue is with an autocompletion or other LSP plugin, please\r\n  report to the upstream tracker.  Download the minmal config with \r\n  wget https://raw.githubusercontent.com/neovim/nvim-lspconfig/master/test/minimal_init.lua\r\n  and modify it to include any specific commands or servers pertaining to your issues.\r\n-->\r\n\r\n<details>\r\n<summary>minimal_init.vim</summary>\r\n\r\n```\r\nset runtimepath+=~/.config/nvim/dein/repos/github.com/neovim/nvim-lspconfig\r\nlua require'lspconfig'.rust_analyzer.setup {}\r\n\r\nlua vim.lsp.set_log_level('debug')\r\n\r\nlet g:signature = ''\r\n\r\nfunction! s:fetch_cursor_signature_and_store() abort\r\n  \" Request without blocking and use the response next time.\r\n  lua <<EOF\r\n  do\r\n    local cur = vim.lsp.util.make_position_params()\r\n    vim.lsp.buf_request(0, \"textDocument/signatureHelp\", cur,\r\n      function(err, _method, result, _client_id, _bufnr, _config)\r\n        if type(result) ~= \"table\" or type(result.signatures) ~= \"table\" then\r\n          return\r\n        end\r\n        local signature = result.signatures[1]\r\n        if not signature then return end\r\n        -- Discard signature.parameters\r\n        vim.g['signature'] = signature.label\r\n      end)\r\n  end\r\nEOF\r\nendfunction\r\n\r\nfunction! s:on_event() abort\r\n  call s:fetch_cursor_signature_and_store()\r\n  \" use g:signature\r\nendfunction\r\n\r\nautocmd CursorMovedI * call s:on_event()\r\n\r\nlua print(vim.lsp.get_log_path())\r\n```\r\n\r\nlspconfig HEAD is\r\n```\r\n*   commit 0a921bf2be74d293c8a8d6dd70122c1d01151a30 (HEAD -> master, origin/master, origin/HEAD): e808cea 7a3e0d1\r\n| | Author: Michael Lingelbach <m.j.lbach@gmail.com>\r\n| | Date:   Fri May 7 15:19:53 2021 -0700\r\n```\r\n\r\n</details>\r\n\r\n\r\n1. Open file\r\n```sh\r\ncargo new hello\r\ncd hello\r\nsed 's/\"Hello, world!\"/\"Hello, world! に対応\"/' -i src/main.rs\r\nnvim -u ../minimal_init.vim src/main.rs\r\n```\r\n2. Move cursor on 'に' \\u306b\r\n3. Type xcl to remove two chars and insert mode\r\n4. IME On\r\n5. Type \"対応\" \\u5bfe\\u5fdc. The line has string \"Hello, World! 対応応\".\r\n6. I got the client-sided serialization error and was blocked with \"Press ENTER or type command to continue\"\r\n```\r\nError executing vim.schedule lua callback: /usr/share/nvim/runtime/lua/vim/lsp/rpc.lua:394: Vim:E474: String \"<af><be><e5>\" contains byte that does not start any UTF-8 character\r\n続けるにはENTERを押すかコマンドを入力してください\r\n```\r\n7. Enter\r\n8. IME Off\r\n9. Esc\r\n10. :q\r\n\r\n\r\n### Actual behaviour\r\nWhen sending a signature request, the client tries to notify `textDocument/didChange` just before it. Then the error occurs asynchronously in json_encode and blocks the user interface.\r\n\r\n### Expected behaviour\r\nThe file you are in the middle of editing is not necessarily valid utf-8. LSP can only send utf-8, but it is not desirable to block the user interface when an error occurs asynchronously and there is no way to catch it.\r\n",
    "closed_at": "2021-11-09T22:37:48Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "Hi, I'm having an exact same problem, but I have an even smaller reproduction method which does not involve IME:\r\n\r\n1. minimal_init.vim\r\n   ```vim\r\n   set runtimepath+=~/nvim-lspconfig\r\n   lua require('lspconfig').pyright.setup {}\r\n   ```\r\n2. something.py\r\n   ```\r\n   print('└─')\r\n   ```\r\n3. `nvim -u minimal_init.vim something.py`\r\n4. Go to the character `└` (`8|`, `gg7l` etc), press `x`\r\n5. Pressing `u` triggers the error.\r\n\r\nI believe that neither the choice of a language server (Pyright) nor the HEAD of nvim-lspconfig (neovim/nvim-lspconfig@4f72377143fc0961391fb0e42e751b9f677fca4e) should matter. What's interesting though is that both of the characters in the string are 3-byte when UTF-8-encoded, and the error happens if you try undoing deletion of a 3-byte character followed by another 3-byte character. In other words, if you repeat the same sequence of steps, but with the character `─` at column 9, the bug doesn't occur.\r\n\r\n**EDIT:** It should be mentioned that the bug occurs with 2-byte characters as well, e.g. Cyrillic ones.",
            "created_at": "2021-07-27T12:34:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887473995",
            "id": 887473995,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM405cdL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887473995/reactions"
            },
            "updated_at": "2021-07-27T12:36:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887473995",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Also I believe that interface blocking is not the main aspect of this bug, as it occurs just because the error message is wrapped into two or more lines on a smaller screen. And I don't think it has something to do with invalid UTF-8 either. I found that disabling incremental text syncing (`setup {flags = {allow_incremental_sync = false}}`) prevents the bug from happening (technically a workaround, but I don't like it), so there must be bug in handling of multibyte characters in incremental syncs.",
            "created_at": "2021-07-27T12:44:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887480413",
            "id": 887480413,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM405eBd",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887480413/reactions"
            },
            "updated_at": "2021-07-27T12:44:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887480413",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I did some further digging: it definitely happens in my reproduction case, but not with every other multibyte character (though the repro should be reliable enough), but also the order of encoded bytes, displayed in the error message, is messed up: for Cyrillic characters it is reversed, for example, resulting in invalid UTF-8.",
            "created_at": "2021-07-27T12:54:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887487323",
            "id": 887487323,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM405ftb",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887487323/reactions"
            },
            "updated_at": "2021-07-27T12:54:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887487323",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Okay, I have an exact idea of what's wrong. The bug is in the following two functions:\r\n\r\nhttps://github.com/neovim/neovim/blob/a5ac2f45ff84a688a09479f357a9909d5b914294/runtime/lua/vim/lsp/util.lua#L297-L369\r\n\r\nThe problem? They iterate UTF-8 encoded strings, received from the current buffer, byte-by-byte and not character-by-character. So indeed, the rest of the algorithm works as expected, but it finds sub-character differences, thus breaking UTF-8 encoding. I'm trying to figure out a solution and will submit a PR.",
            "created_at": "2021-07-27T16:30:59Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887658414",
            "id": 887658414,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406Jeu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887658414/reactions"
            },
            "updated_at": "2021-07-27T16:30:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887658414",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Getting proper multibyte UTF-8 handling (e.g., by exposing neovim's `mbyte.c`) into the Lua API is an urgent need -- otherwise we'll need to keep papering over these problems again and again...",
            "created_at": "2021-07-27T16:35:05Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887661174",
            "id": 887661174,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406KJ2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887661174/reactions"
            },
            "updated_at": "2021-07-27T16:35:05Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887661174",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Maybe vendoring https://github.com/meepen/Lua-5.1-UTF-8/blob/master/utf8.lua for the nonce can help until then?",
            "created_at": "2021-07-27T16:39:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887663939",
            "id": 887663939,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406K1D",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887663939/reactions"
            },
            "updated_at": "2021-07-27T16:39:12Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887663939",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I actually have a few other patches (i.e. monkey-patches, nothing too serious) to LSP-related functions fixing handling of multibyte characters in my WIP configs. Those might be good sources of related PRs.",
            "created_at": "2021-07-27T16:39:53Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887664414",
            "id": 887664414,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406K8e",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887664414/reactions"
            },
            "updated_at": "2021-07-27T16:39:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887664414",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "About this PR in particular: `vim.str_byteindex` will suffice even though there is no built-in function for iterating over characters of a string. Although I think #14281 is more appropriate for such discussions.",
            "created_at": "2021-07-27T16:41:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887665684",
            "id": 887665684,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406LQU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887665684/reactions"
            },
            "updated_at": "2021-07-27T16:42:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887665684",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Although I think #14281 is more appropriate for such discussions.\r\n\r\nYes, and fixing incremental sync is high priority -- but any fix that goes towards ameliorating the general multi-byte mess in Lua is even more welcome.\r\n\r\n(The big bonus of the `mbyte.c` exposure is that we are sure to have the same idea of length as vim core -- which might get dicey for composed characters and such... But maybe we need a short-term fix in the mean time.)",
            "created_at": "2021-07-27T16:49:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887670599",
            "id": 887670599,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406MdH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887670599/reactions"
            },
            "updated_at": "2021-07-27T16:49:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887670599",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Got it. Beware that I am a newcomer to the Nvim codebase. :sweat_smile: ",
            "created_at": "2021-07-27T16:52:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887672427",
            "id": 887672427,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406M5r",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887672427/reactions"
            },
            "updated_at": "2021-07-27T16:52:32Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887672427",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "You gotta start _somewhere_ ;)",
            "created_at": "2021-07-27T16:55:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887674225",
            "id": 887674225,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406NVx",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887674225/reactions"
            },
            "updated_at": "2021-07-27T16:55:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887674225",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Wait, the heck? `vim.str_byteindex` and `vim.str_utfindex` stop at NULs? Does this mean that literally all LSP-related stuff is broken if the line contains a NUL byte?",
            "created_at": "2021-07-27T17:16:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887688374",
            "id": 887688374,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406Qy2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887688374/reactions"
            },
            "updated_at": "2021-07-27T17:16:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887688374",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It shouldn't (contain NUL); there's a translation layer that converts to `vim.NIL` where that occurs (and is not a terminator anyway). At least that's my understanding.",
            "created_at": "2021-07-27T17:33:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887699525",
            "id": 887699525,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406ThF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887699525/reactions"
            },
            "updated_at": "2021-07-27T17:33:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887699525",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "```lua\r\nprint(vim.str_byteindex('привет', 4))  -- prints 8\r\nprint(vim.str_byteindex('пр\\0ивет', 4))  -- errors with \"index out of range\"\r\n```",
            "created_at": "2021-07-27T17:36:43Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887701378",
            "id": 887701378,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406T-C",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887701378/reactions"
            },
            "updated_at": "2021-07-27T17:36:43Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887701378",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> It shouldn't (contain NUL); there's a translation layer that converts to vim.NIL where that occurs (and is not a terminator anyway). At least that's my understanding.\r\n\r\nNo, that's for `null`, not `NUL`. We should fix `str_byteindex` (lua functions not interacting with internal vim state should be 8-bit safe, not 7.9943534 bit safe).",
            "created_at": "2021-07-27T17:40:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887703563",
            "id": 887703563,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406UgL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 2,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887703563/reactions"
            },
            "updated_at": "2021-07-27T17:40:08Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887703563",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Silly mathematician, thinking that there's a unique null ;)",
            "created_at": "2021-07-27T17:57:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887714629",
            "id": 887714629,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406XNF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887714629/reactions"
            },
            "updated_at": "2021-07-27T17:57:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887714629",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Anyway, regarding this ticket: I made an interesting performance observation. So, I needed a way of iterating characters in a string, and I wrote these two functions:\r\n\r\n```lua\r\nfunction str_to_chars_1(str, utf16)\r\n  -- vim.validate{\r\n  --   str = {str, 'string'},\r\n  --   utf16 = {utf16, 'boolean', true},\r\n  -- }\r\n  local chars = {}\r\n  local char_idx = 1\r\n  while true do\r\n    local ok, char_len = true, 1\r\n    if string.byte(str, 1) ~= 0 then\r\n      ok, char_len = pcall(vim.str_byteindex, str, 1, utf16)\r\n      if not ok then break end\r\n    end\r\n    chars[char_idx] = string.sub(str, 1, char_len)\r\n    char_idx = char_idx + 1\r\n    str = string.sub(str, char_len + 1)\r\n  end\r\n  return chars\r\nend\r\n\r\n\r\nfunction str_to_chars_2(str, utf16)\r\n  -- vim.validate{\r\n  --   str = {str, 'string'},\r\n  --   utf16 = {utf16, 'boolean', true},\r\n  -- }\r\n  local chars = {}\r\n  local char_idx = 1\r\n  local byte_idx = 1\r\n  while true do\r\n    local ok, next_byte_idx = pcall(vim.str_byteindex, str, char_idx, utf16)\r\n    if not ok then break end\r\n    chars[char_idx] = string.sub(str, byte_idx, next_byte_idx)\r\n    byte_idx = next_byte_idx + 1\r\n    char_idx = char_idx + 1\r\n  end\r\n  return chars\r\nend\r\n```\r\n\r\nBoth do essentially the same thing, take a string and return a list with the characters. Now, you'd think that the second one would be slower because it essentially has to iterate the entire string over and over again to reach further characters (the complexity of this would be `O(n*(n+1)/2)`, I guess), and the first one jumps over just a single character on each step, but you'd be wrong. They actually have roughly the same speed, and the second one is a bit slower! (...on a dumb benchmark of running the function many times) Perhaps this is an indication of the fact that string slicing is not as fast in Lua as I expected it to be...\r\n\r\nIn any case, there is an important difference: the first function can be made to handle NUL bytes correctly (see the `if`), the second one depends on a patch to `vim.str_byteindex` for obvious reasons. _But, because the performance is effectively the same, we can go with either one._ I'd obviously say that we take the first one because handling NULs is better than not. Oh, and I'm not talking about the exact functions, but the methods of iteration for characters.",
            "created_at": "2021-07-27T18:24:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887732686",
            "id": 887732686,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406bnO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887732686/reactions"
            },
            "updated_at": "2021-07-27T18:24:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887732686",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "well, the cost of switching between c and lua contexts is much higher than iterating over a short string already in cache. if we want to speed this operation up, we want a c function that does more work before it returns (i e return an _array_ of byte indices where chars start).",
            "created_at": "2021-07-27T18:30:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887736765",
            "id": 887736765,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406cm9",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887736765/reactions"
            },
            "updated_at": "2021-07-27T18:30:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887736765",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Oh, I also have to ask about handling of invalid UTF-8. Am I understanding it correctly: does Neovim convert files of all encodings to UTF-8 for usage in-memory, in Vimscript and through API (e.g. `nvim_buf_get_lines`)?",
            "created_at": "2021-07-27T18:39:55Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887743023",
            "id": 887743023,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406eIv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887743023/reactions"
            },
            "updated_at": "2021-07-27T18:39:55Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887743023",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15367354?v=4",
                "events_url": "https://api.github.com/users/dmitmel/events{/privacy}",
                "followers_url": "https://api.github.com/users/dmitmel/followers",
                "following_url": "https://api.github.com/users/dmitmel/following{/other_user}",
                "gists_url": "https://api.github.com/users/dmitmel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dmitmel",
                "id": 15367354,
                "login": "dmitmel",
                "node_id": "MDQ6VXNlcjE1MzY3MzU0",
                "organizations_url": "https://api.github.com/users/dmitmel/orgs",
                "received_events_url": "https://api.github.com/users/dmitmel/received_events",
                "repos_url": "https://api.github.com/users/dmitmel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dmitmel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dmitmel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dmitmel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "@dmitmel well, when you read a file, this is what happens by default: neovim attempts to detect the encoding, and convert it to valid UTF-8 internally. However there's no guarantee that the buffer actually contains valid UTF-8. you can add invalid utf-8 text using set_lines, by pasting it, etc, and then `get_lines` will give you the unmodified bytes back. You can ask neovim to read a file as `++binary` data, which will preserve invalid UTF-8 as such. In particular, NUL bytes are allowed as part of a buffer, but this causes all sort of weirdness with _vim script_ functions as vim script doesn't allow NUL in strings. \r\n\r\nHowever, as lua has no problem with NUL inside strings, our goal is that lua _should_ handle this situation without much extra heavy lifting (from the point of view of the the lua plugin, that is). As such, I would consider the existing behaviour of `str_byteindex` (which I wrote) as a bug, and changing it to handle NUL a bugfix.",
            "created_at": "2021-07-27T19:52:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-887790510",
            "id": 887790510,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM406puu",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887790510/reactions"
            },
            "updated_at": "2021-07-27T20:06:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/887790510",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Can you all test https://github.com/neovim/neovim/pull/16121?",
            "created_at": "2021-10-23T18:21:25Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-950192696",
            "id": 950192696,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM44oso4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/950192696/reactions"
            },
            "updated_at": "2021-10-23T18:21:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/950192696",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "NONE",
            "body": "I can't seen to be able to hit a bug anymore on arch's `neovim-git`. ",
            "created_at": "2021-10-28T06:17:56Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-953535608",
            "id": 953535608,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM441cx4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/953535608/reactions"
            },
            "updated_at": "2021-10-28T06:17:56Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/953535608",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6597974?v=4",
                "events_url": "https://api.github.com/users/khokho/events{/privacy}",
                "followers_url": "https://api.github.com/users/khokho/followers",
                "following_url": "https://api.github.com/users/khokho/following{/other_user}",
                "gists_url": "https://api.github.com/users/khokho/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/khokho",
                "id": 6597974,
                "login": "khokho",
                "node_id": "MDQ6VXNlcjY1OTc5NzQ=",
                "organizations_url": "https://api.github.com/users/khokho/orgs",
                "received_events_url": "https://api.github.com/users/khokho/received_events",
                "repos_url": "https://api.github.com/users/khokho/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/khokho/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/khokho/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/khokho"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "The bug is not fixed on master, you can test the above PR. The easy trigger is operations which delete a multibyte char.",
            "created_at": "2021-10-31T03:41:26Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-955631052",
            "id": 955631052,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM449cXM",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/955631052/reactions"
            },
            "updated_at": "2021-10-31T03:41:26Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/955631052",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "NONE",
            "body": "I actually can't trigger the bug on `neovim-git` but can do on 0.5.1 :man_shrugging: ",
            "created_at": "2021-11-01T08:30:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-956035087",
            "id": 956035087,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM44-_AP",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956035087/reactions"
            },
            "updated_at": "2021-11-01T08:30:00Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956035087",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6597974?v=4",
                "events_url": "https://api.github.com/users/khokho/events{/privacy}",
                "followers_url": "https://api.github.com/users/khokho/followers",
                "following_url": "https://api.github.com/users/khokho/following{/other_user}",
                "gists_url": "https://api.github.com/users/khokho/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/khokho",
                "id": 6597974,
                "login": "khokho",
                "node_id": "MDQ6VXNlcjY1OTc5NzQ=",
                "organizations_url": "https://api.github.com/users/khokho/orgs",
                "received_events_url": "https://api.github.com/users/khokho/received_events",
                "repos_url": "https://api.github.com/users/khokho/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/khokho/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/khokho/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/khokho"
            }
        },
        {
            "author_association": "NONE",
            "body": "I tried the first reproduction method with head.\r\n```\r\nNVIM v0.6.0-dev+544-g7ae86c1d4\r\nBuild type: RelWithDebInfo\r\nLuaJIT 2.0.5\r\n```\r\nI don't get any error messages in nvim anymore, but according to the logs, the client is dead.\r\n[lsp.log](https://github.com/neovim/neovim/files/7452109/lsp.log)\r\n",
            "created_at": "2021-11-01T09:26:16Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-956071163",
            "id": 956071163,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM44_Hz7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956071163/reactions"
            },
            "updated_at": "2021-11-01T09:26:16Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956071163",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7942952?v=4",
                "events_url": "https://api.github.com/users/octaltree/events{/privacy}",
                "followers_url": "https://api.github.com/users/octaltree/followers",
                "following_url": "https://api.github.com/users/octaltree/following{/other_user}",
                "gists_url": "https://api.github.com/users/octaltree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/octaltree",
                "id": 7942952,
                "login": "octaltree",
                "node_id": "MDQ6VXNlcjc5NDI5NTI=",
                "organizations_url": "https://api.github.com/users/octaltree/orgs",
                "received_events_url": "https://api.github.com/users/octaltree/received_events",
                "repos_url": "https://api.github.com/users/octaltree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/octaltree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/octaltree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/octaltree"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "There have been no fixes yet so I'm not surprised that's happening. You can try my linked PR ",
            "created_at": "2021-11-01T09:27:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-956072043",
            "id": 956072043,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM44_IBr",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956072043/reactions"
            },
            "updated_at": "2021-11-01T09:27:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/956072043",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "NONE",
            "body": "I tried with 1dbbaf89. Incremental sync is done without error.\r\n[lsp.log](https://github.com/neovim/neovim/files/7459410/lsp.log)\r\n",
            "created_at": "2021-11-02T09:30:39Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-957263590",
            "id": 957263590,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM45Dq7m",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/957263590/reactions"
            },
            "updated_at": "2021-11-02T09:30:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/957263590",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7942952?v=4",
                "events_url": "https://api.github.com/users/octaltree/events{/privacy}",
                "followers_url": "https://api.github.com/users/octaltree/followers",
                "following_url": "https://api.github.com/users/octaltree/following{/other_user}",
                "gists_url": "https://api.github.com/users/octaltree/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/octaltree",
                "id": 7942952,
                "login": "octaltree",
                "node_id": "MDQ6VXNlcjc5NDI5NTI=",
                "organizations_url": "https://api.github.com/users/octaltree/orgs",
                "received_events_url": "https://api.github.com/users/octaltree/received_events",
                "repos_url": "https://api.github.com/users/octaltree/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/octaltree/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/octaltree/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/octaltree"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Ok, great! I'll try to get that merged next weekend. We found that even though rangeLength is deprecated, we still need to compute it for some servers (jdtls particularly)",
            "created_at": "2021-11-02T16:40:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-957929900",
            "id": 957929900,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM45GNms",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/957929900/reactions"
            },
            "updated_at": "2021-11-02T16:40:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/957929900",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "I went down a rabbit hole after filing that PR, there are some things that are broken in our current implementation are endline/multiline handling, some of the variable names are inscrutable/I didn't comment things well, etc. I'm rewriting everything in this repo:\r\n\r\nhttps://github.com/mjlbach/incremental.nvim\r\n\r\nNote, I've dramatically simplified some of the code, and improved performance (thanks to some tips from @dmitmel). I'm having a bit of trouble reliably getting end_range working, but hopefully will have some time to hack on it soon. I'm verifying the range changes with vscode, and set up a plenary testing suite against the current implementation (which, sadly, is wrong in many of these cases). I'm also planning on adding these tests when I merge this into core, which will be extremely useful for the on_lines -> on_bytes conversion when that is ready (which should hopefully remove all of this lua code too in favor of the internal diffing mechanism used by treesitter :)).\r\n\r\nIf anyone here is interested on hacking on it together please file PRs (or help me fill out the tests!) or comment. I tried to comment everything. \r\n\r\nSorry this is taking so long I added some C utilities in core to help with the positioning, and I had to refamiliarize myself with the diffs, and there were several differences in vscode vim emulation notion of deletions/insertions that threw me off for a bit... I'm pretty sure at least start_range is now consistently correct :)\r\n\r\nI am still confident this will get done by 0.6",
            "created_at": "2021-11-05T05:53:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-961644783",
            "id": 961644783,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM45UYjv",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/961644783/reactions"
            },
            "updated_at": "2021-11-05T05:54:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/961644783",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Can you all test #16252, I think this fixes everything...",
            "created_at": "2021-11-06T05:46:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-962399316",
            "id": 962399316,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM45XQxU",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/962399316/reactions"
            },
            "updated_at": "2021-11-06T05:46:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/962399316",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/13316262?v=4",
                "events_url": "https://api.github.com/users/mjlbach/events{/privacy}",
                "followers_url": "https://api.github.com/users/mjlbach/followers",
                "following_url": "https://api.github.com/users/mjlbach/following{/other_user}",
                "gists_url": "https://api.github.com/users/mjlbach/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mjlbach",
                "id": 13316262,
                "login": "mjlbach",
                "node_id": "MDQ6VXNlcjEzMzE2MjYy",
                "organizations_url": "https://api.github.com/users/mjlbach/orgs",
                "received_events_url": "https://api.github.com/users/mjlbach/received_events",
                "repos_url": "https://api.github.com/users/mjlbach/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mjlbach/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mjlbach/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mjlbach"
            }
        },
        {
            "author_association": "NONE",
            "body": "Please take a look at https://github.com/Feel-ix-343/markdown-oxide/issues/156 - I belive this is still an issue, just more racy and harder to trigger.\r\n\r\nIt happens for me while paste several dozens of Russian text lines: Neovim sends to LSP server JSON-RPC request which ends (in the middle of pasted lines) with \"\\xD0\" byte instead of two bytes \"\\xD0\\xB0\" (which is https://unicodeplus.com/U+0430).\r\n\r\nBecause of race it's hard to reproduce, so I don't have a small `repro.lua` for this issue - I've tried to make one but without success so far.\r\n\r\n```\r\nNVIM v0.10.0\r\nBuild type: Release\r\nLuaJIT 2.1.1716656478\r\nRun \"nvim -V1 -v\" for more info\r\n```",
            "created_at": "2024-07-26T20:51:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-2253490626",
            "id": 2253490626,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM6GUYnC",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2253490626/reactions"
            },
            "updated_at": "2024-07-26T20:51:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2253490626",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1354301?v=4",
                "events_url": "https://api.github.com/users/powerman/events{/privacy}",
                "followers_url": "https://api.github.com/users/powerman/followers",
                "following_url": "https://api.github.com/users/powerman/following{/other_user}",
                "gists_url": "https://api.github.com/users/powerman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/powerman",
                "id": 1354301,
                "login": "powerman",
                "node_id": "MDQ6VXNlcjEzNTQzMDE=",
                "organizations_url": "https://api.github.com/users/powerman/orgs",
                "received_events_url": "https://api.github.com/users/powerman/received_events",
                "repos_url": "https://api.github.com/users/powerman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/powerman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/powerman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/powerman"
            }
        },
        {
            "author_association": "NONE",
            "body": "BTW, is this can happens because of OS clipboard manager? Any chance it sends pasted text to Neovim byte-by-byte and thus Neovim does not have complete UTF-8 at the moment of preparing LSP request?\r\nJust in case I'm using Gentoo Linux with https://sourceforge.net/projects/parcellite/ 1.2.1 (just to sync PRIMARY and CLIPBOARD for Xorg).",
            "created_at": "2024-07-26T20:57:23Z",
            "html_url": "https://github.com/neovim/neovim/issues/14542#issuecomment-2253496337",
            "id": 2253496337,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/14542",
            "node_id": "IC_kwDOAPphoM6GUaAR",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2253496337/reactions"
            },
            "updated_at": "2024-07-26T20:57:23Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2253496337",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1354301?v=4",
                "events_url": "https://api.github.com/users/powerman/events{/privacy}",
                "followers_url": "https://api.github.com/users/powerman/followers",
                "following_url": "https://api.github.com/users/powerman/following{/other_user}",
                "gists_url": "https://api.github.com/users/powerman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/powerman",
                "id": 1354301,
                "login": "powerman",
                "node_id": "MDQ6VXNlcjEzNTQzMDE=",
                "organizations_url": "https://api.github.com/users/powerman/orgs",
                "received_events_url": "https://api.github.com/users/powerman/received_events",
                "repos_url": "https://api.github.com/users/powerman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/powerman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/powerman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/powerman"
            }
        }
    ],
    "comments": 32,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/14542/comments",
    "created_at": "2021-05-12T13:34:45Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/14542/events",
    "html_url": "https://github.com/neovim/neovim/issues/14542",
    "id": 890097285,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "stdlib",
            "id": 573222693,
            "name": "lua",
            "node_id": "MDU6TGFiZWw1NzMyMjI2OTM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lua"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "(multibyte) unicode characters",
            "id": 2882115256,
            "name": "unicode  💩",
            "node_id": "MDU6TGFiZWwyODgyMTE1MjU2",
            "url": "https://api.github.com/repos/neovim/neovim/labels/unicode%20%20%F0%9F%92%A9"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/14542/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU4OTAwOTcyODU=",
    "number": 14542,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 5,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 5,
        "url": "https://api.github.com/repos/neovim/neovim/issues/14542/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/14542/timeline",
    "title": "lsp: incremental sync breaks with certain multibyte character operations ",
    "updated_at": "2024-07-26T20:57:24Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/14542",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7942952?v=4",
        "events_url": "https://api.github.com/users/octaltree/events{/privacy}",
        "followers_url": "https://api.github.com/users/octaltree/followers",
        "following_url": "https://api.github.com/users/octaltree/following{/other_user}",
        "gists_url": "https://api.github.com/users/octaltree/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/octaltree",
        "id": 7942952,
        "login": "octaltree",
        "node_id": "MDQ6VXNlcjc5NDI5NTI=",
        "organizations_url": "https://api.github.com/users/octaltree/orgs",
        "received_events_url": "https://api.github.com/users/octaltree/received_events",
        "repos_url": "https://api.github.com/users/octaltree/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/octaltree/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/octaltree/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/octaltree"
    }
}