{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nThe lsp client doesn't send `<TAB>` character correctly in the `textDocument/didChange` event when using `softtabstop = -1`.\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n``` lua\r\nvim.o.shiftwidth = 0\r\nvim.o.softtabstop = -1\r\n\r\nvim.cmd.packadd(\"nvim-lspconfig\")\r\n\r\nvim.lsp.set_log_level(\"debug\")\r\n\r\nrequire('lspconfig').gopls.setup({})\r\n```\r\n\r\nI've created a repo with a minimal `init.lua` and steps to reproduce. https://github.com/icholy/nvim-lsp-bug\r\n\r\n![tty](https://github.com/neovim/neovim/assets/943597/9289ead4-0159-4fab-9c9b-ea1f4fd98f3e)\r\n\r\n**Note**: I've been able to reproduce this with several lsp servers.\r\n\r\n### Expected behavior\r\n\r\nSend a single tab character in `textDocument/didChange`\r\n\r\n``` lua\r\n{\r\n    jsonrpc = \"2.0\",\r\n    method = \"textDocument/didChange\",\r\n    params = {\r\n        contentChanges = {\r\n            {\r\n                range = {[\"end\"] = {character = 0, line = 0}, start = {character = 0, line = 0}},\r\n                rangeLength = 0,\r\n                text = \"\\t\"\r\n            }\r\n        },\r\n        textDocument = {uri = \"file:///home/icholy/src/github.com/icholy/nvim-lsp-bug/main.go\", version = 4}\r\n    }\r\n}\r\n```\r\n\r\n### Neovim version (nvim -v)\r\n\r\nv0.10.0-dev\r\n\r\n### Language server name/version\r\n\r\ngopls v0.13.2\r\n\r\n### Operating system/version\r\n\r\nUbuntu 22.04\r\n\r\n### Log file\r\n\r\nhttps://gist.github.com/icholy/b3216e005787bf39c250ada7a2b6a88a\r\n\r\nRelevant section:\r\n```\r\n{\r\n    jsonrpc = \"2.0\",\r\n    method = \"textDocument/didChange\",\r\n    params = {\r\n        contentChanges = {\r\n            {\r\n                range = {[\"end\"] = {character = 0, line = 0}, start = {character = 0, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 1, line = 0}, start = {character = 1, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 2, line = 0}, start = {character = 2, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 3, line = 0}, start = {character = 3, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 4, line = 0}, start = {character = 4, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 5, line = 0}, start = {character = 5, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 6, line = 0}, start = {character = 6, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            },\r\n            {\r\n                range = {[\"end\"] = {character = 7, line = 0}, start = {character = 7, line = 0}},\r\n                rangeLength = 0,\r\n                text = \" \"\r\n            }\r\n        },\r\n        textDocument = {uri = \"file:///home/icholy/src/github.com/icholy/nvim-lsp-bug/main.go\", version = 11}\r\n    }\r\n}\r\n```",
    "closed_at": null,
    "comment_data": [],
    "comments": 0,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/25092/comments",
    "created_at": "2023-09-11T00:48:09Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/25092/events",
    "html_url": "https://github.com/neovim/neovim/issues/25092",
    "id": 1889420929,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/25092/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5wnkaB",
    "number": 25092,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/25092/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/25092/timeline",
    "title": "LSP: incremental sync breaks with softtabstop=-1",
    "updated_at": "2023-09-11T01:21:06Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/25092",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/943597?v=4",
        "events_url": "https://api.github.com/users/icholy/events{/privacy}",
        "followers_url": "https://api.github.com/users/icholy/followers",
        "following_url": "https://api.github.com/users/icholy/following{/other_user}",
        "gists_url": "https://api.github.com/users/icholy/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/icholy",
        "id": 943597,
        "login": "icholy",
        "node_id": "MDQ6VXNlcjk0MzU5Nw==",
        "organizations_url": "https://api.github.com/users/icholy/orgs",
        "received_events_url": "https://api.github.com/users/icholy/received_events",
        "repos_url": "https://api.github.com/users/icholy/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/icholy/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/icholy/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/icholy"
    }
}