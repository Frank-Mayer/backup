{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nOn Windows, when the path of the Python virtualenv you have activated contains spaces, :checkhealth provider on Python Virtualenv gives the next warning:\r\n\r\n```\r\nPython virtualenv ~\r\n- WARNING $VIRTUAL_ENV is set to: D:\\Users\\My User\\.pyenv-win-venv\\envs\\adventofcode\r\n  And its /Scripts directory contains: python.exe, pythonw.exe\r\n  But $PATH yields this python.exe executable: \"D:/Users/My/\" is not recognized as an internal or external command operable program or batch file.\r\n  \r\n  And $PATH yields this pythonw.exe executable: \"D:/Users/My/\" is not recognized as an internal or external command operable program or batch file.\r\n  \r\n  So invoking Python may lead to unexpected results.\r\n  - ADVICE:\r\n    - $PATH ambiguities arise if the virtualenv is not properly activated prior to launching Nvim. Close Nvim, activate the virtualenv, check that invoking Python from the command line launches the correct one, then relaunch Nvim.\r\n```\r\n\r\nAfter some debugging, I found the problem is on this line: https://github.com/neovim/neovim/blob/d772f697a281ce9c58bf933997b87c7f27428a60/runtime/autoload/health/provider.vim#L469\r\n\r\nThe code for check_virtualenv contains the next line: https://github.com/neovim/neovim/blob/d772f697a281ce9c58bf933997b87c7f27428a60/runtime/autoload/health/provider.vim#L495 \r\n\r\nThe result of `exepath(py_bin_basename)` is `D:\\Users\\My User\\.pyenv-win-venv\\envs\\adventofcode\\Scripts\\python.exe`\r\n\r\nWhen it calls `s:python_exepath()`, because of the use of `fnameespace()`, when it finds the space, it escapes it like it would on a UNIX-like system: `D:\\Users\\My\\ User\\.pyenv-win-venv\\envs\\adventofcode\\Scripts\\python.exe`.\r\n\r\nThe problem is that on Windows, that means neovim is looking for a folder 'My'  with a subfolder ' User'. And so, when it executes `system()` it returns the CMD error when the command to execute doesn't exist.\r\n\n\n### Steps to reproduce\n\n- Create a python virtualenv with a path with spaces. Example, if on 3.11.4 and if in your home folder:\r\n  - CMD: `mkdir \"test venv\"` then `python -m venv \".\\test venv\\test-venv\"`\r\n  - Powershell: `mkdir 'test venv'` then `python -m venv '.\\test venv\\test-venv'`\r\n- Activate said virtualenv:\r\n  - CMD: `\".\\test venv\\test-venv\\Scripts\\activate.bat\"`\r\n  - PowerShell: `'.\\test venv\\test-venv\\Scripts\\Activate.ps1'`\r\n- `nvim` (or the exec name for Neovim)\r\n- `:checkhealth provider`\n\n### Expected behavior\n\nThe Python Virtualenv check should report the next:\r\n```\r\nPython virtualenv ~\r\n- $VIRTUAL_ENV is set to: D:\\Users\\My User\\.pyenv-win-venv\\envs\\adventofcode\r\n- Python version: 3.11.4\r\n- OK $VIRTUAL_ENV provides :!python.\r\n```\r\n\r\nOn Linux (Ubuntu 22.04.3 on WSL2) with the AppImage version of 0.9.4 it works because `\\ ` is a valid escape character for a path with spaces:\r\n\r\n```\r\nPython virtualenv ~\r\n- $VIRTUAL_ENV is set to: /home/myuser/test venv/test-venv\r\n- Python version: 3.11.4\r\n- OK $VIRTUAL_ENV provides :!python.\r\n```\r\n\r\nIf I change `fnameescape()` with `shellescape()` it works as expected at least on Windows, not sure how I could test the change on WSL2 with the AppImage version to check if it breaks anything on Linux:\r\n```diff\r\nfunction! s:python_exepath(invocation) abort\r\n--  return s:normalize_path(system(fnameescape(a:invocation)\r\n++  return s:normalize_path(system(shellescape(a:invocation)\r\n    \\ . ' -c \"import sys; sys.stdout.write(sys.executable)\"'))\r\nendfunction\r\n\r\n``` \n\n### Neovim version (nvim -v)\n\n0.9.4\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nWindows 10 Home 22H2 19045.3803\n\n### Terminal name/version\n\nN/A or Windows Terminal 1.18.3181.0\n\n### $TERM environment variable\n\nN/A\n\n### Installation\n\nCan't recall if installed with .msi on a non-default install dir or extracted the .zip",
    "closed_at": "2024-02-17T20:22:23Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Thanks for the report. Can you try the development version? \r\n\r\n- The [Releases](https://github.com/neovim/neovim/releases/tag/nightly) page has pre-built archives for Linux/Windows/macOS. \r\n- Check `:version` to confirm that you are using the latest version.",
            "created_at": "2024-02-15T12:47:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/26610#issuecomment-1946032285",
            "id": 1946032285,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26610",
            "node_id": "IC_kwDOAPphoM5z_hid",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1946032285/reactions"
            },
            "updated_at": "2024-02-15T12:47:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1946032285",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "NONE",
            "body": "On development version, it works as expected:\r\n\r\n![imagen](https://github.com/neovim/neovim/assets/14891772/c6d95b35-cf58-46c8-aeb9-1a01497f9463)\r\n",
            "created_at": "2024-02-17T19:58:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/26610#issuecomment-1950295461",
            "id": 1950295461,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26610",
            "node_id": "IC_kwDOAPphoM50PyWl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 3,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 3,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1950295461/reactions"
            },
            "updated_at": "2024-02-17T19:58:41Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1950295461",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/14891772?v=4",
                "events_url": "https://api.github.com/users/starkythefox/events{/privacy}",
                "followers_url": "https://api.github.com/users/starkythefox/followers",
                "following_url": "https://api.github.com/users/starkythefox/following{/other_user}",
                "gists_url": "https://api.github.com/users/starkythefox/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/starkythefox",
                "id": 14891772,
                "login": "starkythefox",
                "node_id": "MDQ6VXNlcjE0ODkxNzcy",
                "organizations_url": "https://api.github.com/users/starkythefox/orgs",
                "received_events_url": "https://api.github.com/users/starkythefox/received_events",
                "repos_url": "https://api.github.com/users/starkythefox/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/starkythefox/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/starkythefox/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/starkythefox"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26610/comments",
    "created_at": "2023-12-16T18:33:15Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26610/events",
    "html_url": "https://github.com/neovim/neovim/issues/26610",
    "id": 2044897095,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "d4c5f9",
            "default": false,
            "description": null,
            "id": 109461219,
            "name": "platform:windows",
            "node_id": "MDU6TGFiZWwxMDk0NjEyMTk=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:windows"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 144672485,
            "name": "provider",
            "node_id": "MDU6TGFiZWwxNDQ2NzI0ODU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/provider"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26610/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM554qdH",
    "number": 26610,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26610/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26610/timeline",
    "title": ":checkhealth provider on Python Virtualenv gives warning on Windows for paths with spaces",
    "updated_at": "2024-02-17T20:22:23Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26610",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/14891772?v=4",
        "events_url": "https://api.github.com/users/starkythefox/events{/privacy}",
        "followers_url": "https://api.github.com/users/starkythefox/followers",
        "following_url": "https://api.github.com/users/starkythefox/following{/other_user}",
        "gists_url": "https://api.github.com/users/starkythefox/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/starkythefox",
        "id": 14891772,
        "login": "starkythefox",
        "node_id": "MDQ6VXNlcjE0ODkxNzcy",
        "organizations_url": "https://api.github.com/users/starkythefox/orgs",
        "received_events_url": "https://api.github.com/users/starkythefox/received_events",
        "repos_url": "https://api.github.com/users/starkythefox/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/starkythefox/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/starkythefox/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/starkythefox"
    }
}