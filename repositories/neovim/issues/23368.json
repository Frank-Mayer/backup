{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "#23256 introduced a subtle breaking change.\r\n\r\nWhen triggering an event, the last autocmd is marked as such and the execution of autocmds\r\nstops once it's reached, to prevent infinite loops when creating new autocmds from inside\r\nautocmds. It can be thought of as saving current autocmds so they can't be changed during\r\ntheir execution (they can be still deleted though).\r\n\r\nBefore #23256 last autocmd was marked globally. This means that nested event can add new\r\nautocmds to the event that triggered it, during its execution. #23256 fixes that by\r\nkeeping track of the last autocmd per executed event. It is a breaking change though and\r\nreportedly broke some code.\r\n\r\n```lua\r\nlocal skip = false\r\nlocal level = 0\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = 'test',\r\n  callback = function()\r\n    level = level + 1\r\n    print(('  '):rep(level) .. 'autocmd 1')\r\n\r\n    -- only define autocmd 2 and trigger the event once\r\n    if not skip then\r\n      skip = true\r\n\r\n      vim.api.nvim_create_autocmd('FileType', {\r\n        pattern = 'test',\r\n        callback = function()\r\n          level = level + 1\r\n          print(('  '):rep(level) .. 'autocmd 2')\r\n          level = level - 1\r\n        end,\r\n      })\r\n\r\n      print(('  '):rep(level) .. 'EVENT 2')\r\n      vim.api.nvim_exec_autocmds('FileType', { pattern = 'test', modeline = false })\r\n    end\r\n\r\n    level = level - 1\r\n  end,\r\n})\r\n\r\nprint(('  '):rep(level) .. 'EVENT 1')\r\nvim.api.nvim_exec_autocmds('FileType', { pattern = 'test', modeline = false })\r\n```\r\n\r\nAnnotated output before #23256:\r\n```\r\nEVENT 1         - internally sets autocmd 1 as the last autocmd\r\n  autocmd 1     - creates autocmd 2\r\n  EVENT 2       - internally sets autocmd 2 as the last autocmd\r\n    autocmd 1   - skipped\r\n    autocmd 2\r\n  autocmd 2     - autocmd 2 is now executed by event 1. wouldn't happen if event 2 was not triggered\r\n```\r\n\r\nAnnotated output after #23256:\r\n```\r\nEVENT 1         - internally sets autocmd 1 as the last autocmd for event 1 only\r\n  autocmd 1     - creates autocmd 2\r\n  EVENT 2       - internally sets autocmd 2 as the last autocmd for event 2 only, doesn't affect event 1 at all\r\n    autocmd 1   - skipped\r\n    autocmd 2\r\n```\r\n\r\nWhat do we do about it? I think the new behavior is better and that seemed to be the\r\nintention in the first place, but it is a breaking change.",
    "closed_at": "2023-07-16T11:36:36Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Do you have a link to an issue about this breaking a plugin in the wild (so we can estimate the actual impact)?\r\n\r\n",
            "created_at": "2023-04-28T10:55:11Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1527383412",
            "id": 1527383412,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5bCgV0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527383412/reactions"
            },
            "updated_at": "2023-04-28T10:55:11Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527383412",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "For now just this: https://github.com/folke/lazy.nvim/issues/228\r\nI think it should be mostly user code that can be easily fixed. In my opinion you shouldn't rely on something like this anyway.",
            "created_at": "2023-04-28T11:00:54Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1527390083",
            "id": 1527390083,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5bCh-D",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527390083/reactions"
            },
            "updated_at": "2023-04-28T11:00:54Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527390083",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/59243201?v=4",
                "events_url": "https://api.github.com/users/ii14/events{/privacy}",
                "followers_url": "https://api.github.com/users/ii14/followers",
                "following_url": "https://api.github.com/users/ii14/following{/other_user}",
                "gists_url": "https://api.github.com/users/ii14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ii14",
                "id": 59243201,
                "login": "ii14",
                "node_id": "MDQ6VXNlcjU5MjQzMjAx",
                "organizations_url": "https://api.github.com/users/ii14/orgs",
                "received_events_url": "https://api.github.com/users/ii14/received_events",
                "repos_url": "https://api.github.com/users/ii14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ii14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ii14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ii14"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes. You should not lazy-load filetype plugins, period. (I mean, \"you do you, whatever sparks joy for you\" and all that, but that's not something we need to officially support.)",
            "created_at": "2023-04-28T11:04:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1527394986",
            "id": 1527394986,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5bCjKq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527394986/reactions"
            },
            "updated_at": "2023-04-28T11:04:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527394986",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "There is another inconsistent behavior that was fixed.\r\n\r\n```lua\r\nlocal pat1 = 'test'\r\nlocal pat2 = '*'\r\n\r\nvim.api.nvim_create_autocmd('User', {\r\n  pattern = pat1,\r\n  callback = function()\r\n    print('autocmd 1')\r\n\r\n    vim.api.nvim_create_autocmd('User', {\r\n      pattern = pat2, -- different pattern!\r\n      callback = function() print('autocmd 3') end,\r\n    })\r\n  end,\r\n})\r\n\r\nvim.api.nvim_create_autocmd('User', {\r\n  pattern = pat2, -- different pattern!\r\n  callback = function() print('autocmd 2') end,\r\n})\r\n\r\nvim.api.nvim_exec_autocmds('User', { pattern = 'test', modeline = false })\r\n```\r\n\r\nBefore #23256 autocmd 3 was executed only if autocmd 2 is defined and autocmd 1 has a different pattern than 2 and 3.\r\nThis doesn't make any sense whatsoever unless you're familiar with the implementation.\r\n\r\nBefore:\r\n```\r\nautocmd 1\r\nautocmd 2\r\nautocmd 3\r\n```\r\nAfter #23256 or if `local pat2 = pat1` (!):\r\n```\r\nautocmd 1\r\nautocmd 2\r\n```",
            "created_at": "2023-04-28T11:56:46Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1527457068",
            "id": 1527457068,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5bCyUs",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 1,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527457068/reactions"
            },
            "updated_at": "2023-04-28T12:01:40Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1527457068",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/59243201?v=4",
                "events_url": "https://api.github.com/users/ii14/events{/privacy}",
                "followers_url": "https://api.github.com/users/ii14/followers",
                "following_url": "https://api.github.com/users/ii14/following{/other_user}",
                "gists_url": "https://api.github.com/users/ii14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ii14",
                "id": 59243201,
                "login": "ii14",
                "node_id": "MDQ6VXNlcjU5MjQzMjAx",
                "organizations_url": "https://api.github.com/users/ii14/orgs",
                "received_events_url": "https://api.github.com/users/ii14/received_events",
                "repos_url": "https://api.github.com/users/ii14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ii14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ii14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ii14"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It's good that this is documented here, but looks like `wontfix`. Is there a 2-line explanation we can mention in `:help nvim-changed` ?",
            "created_at": "2023-07-16T11:36:36Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1637060384",
            "id": 1637060384,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5hk48g",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637060384/reactions"
            },
            "updated_at": "2023-07-16T11:36:36Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637060384",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Not sure how to summarize it in a short description, can we just say something like \"fixed inconsistent behavior in nested autocommands\" and link to this issue?",
            "created_at": "2023-07-16T11:49:34Z",
            "html_url": "https://github.com/neovim/neovim/issues/23368#issuecomment-1637063238",
            "id": 1637063238,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23368",
            "node_id": "IC_kwDOAPphoM5hk5pG",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637063238/reactions"
            },
            "updated_at": "2023-07-16T11:50:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1637063238",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/59243201?v=4",
                "events_url": "https://api.github.com/users/ii14/events{/privacy}",
                "followers_url": "https://api.github.com/users/ii14/followers",
                "following_url": "https://api.github.com/users/ii14/following{/other_user}",
                "gists_url": "https://api.github.com/users/ii14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ii14",
                "id": 59243201,
                "login": "ii14",
                "node_id": "MDQ6VXNlcjU5MjQzMjAx",
                "organizations_url": "https://api.github.com/users/ii14/orgs",
                "received_events_url": "https://api.github.com/users/ii14/received_events",
                "repos_url": "https://api.github.com/users/ii14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ii14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ii14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ii14"
            }
        }
    ],
    "comments": 6,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23368/comments",
    "created_at": "2023-04-28T10:51:01Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23368/events",
    "html_url": "https://github.com/neovim/neovim/issues/23368",
    "id": 1688341545,
    "labels": [
        {
            "color": "e6e6e6",
            "default": false,
            "description": "current behavior is by design, and change is not desired",
            "id": 77997479,
            "name": "closed:wontfix",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3OQ==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/closed:wontfix"
        },
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "events, autocommands",
            "id": 3341085842,
            "name": "events",
            "node_id": "MDU6TGFiZWwzMzQxMDg1ODQy",
            "url": "https://api.github.com/repos/neovim/neovim/labels/events"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23368/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5kogwp",
    "number": 23368,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 1,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 1,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 2,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23368/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23368/timeline",
    "title": "Breaking change in nested autocmds in #23256",
    "updated_at": "2023-07-16T11:50:19Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23368",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/59243201?v=4",
        "events_url": "https://api.github.com/users/ii14/events{/privacy}",
        "followers_url": "https://api.github.com/users/ii14/followers",
        "following_url": "https://api.github.com/users/ii14/following{/other_user}",
        "gists_url": "https://api.github.com/users/ii14/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/ii14",
        "id": 59243201,
        "login": "ii14",
        "node_id": "MDQ6VXNlcjU5MjQzMjAx",
        "organizations_url": "https://api.github.com/users/ii14/orgs",
        "received_events_url": "https://api.github.com/users/ii14/received_events",
        "repos_url": "https://api.github.com/users/ii14/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/ii14/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ii14/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/ii14"
    }
}