{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nIncorrect comma (,) position when using autoimports, if the imports already exist from the module(multiline formatting).\r\nI made bisect and for me the problem was in https://github.com/neovim/neovim/commit/2ce4a4d91e4abee0aab8b98c47eea9fbd4849ba6\r\n\r\nSo the problem:\r\n\r\nhttps://github.com/neovim/neovim/assets/62308020/2243dca7-1835-49ab-b7a5-f4038568865a\r\n\r\nCould be duplicate of https://github.com/neovim/neovim/issues/29284\r\n\r\n### Steps to reproduce\r\n\r\nSorry, I don't want to figure out, how can I provide it to you :). Maybe somebody from your team has already installed tsserver and has projects with typescript, and can reproduce it.\r\n\r\n\r\n### Expected behavior\r\n\r\nWorks fine on https://github.com/neovim/neovim/commit/6e45cd7f0026ee33b8c397b810dcfe5b4678bbd8 (commit before)\r\n\r\nhttps://github.com/neovim/neovim/assets/62308020/10bbab32-ee7d-4d9e-989f-b3b609111dad\r\n\r\n\r\n\r\n### Neovim version (nvim -v)\r\n\r\nabove\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nn/a\r\n\r\n### Operating system/version\r\n\r\nfc 39\r\n\r\n### Terminal name/version\r\n\r\nkitty\r\n\r\n### $TERM environment variable\r\n\r\nxterm-kitty\r\n\r\n### Installation\r\n\r\nbuild from repo",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "@alcolmenar ",
            "created_at": "2024-06-12T11:06:04Z",
            "html_url": "https://github.com/neovim/neovim/issues/29286#issuecomment-2162731561",
            "id": 2162731561,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29286",
            "node_id": "IC_kwDOAPphoM6A6Kop",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162731561/reactions"
            },
            "updated_at": "2024-06-12T11:06:04Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2162731561",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
                "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
                "followers_url": "https://api.github.com/users/justinmk/followers",
                "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
                "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/justinmk",
                "id": 1359421,
                "login": "justinmk",
                "node_id": "MDQ6VXNlcjEzNTk0MjE=",
                "organizations_url": "https://api.github.com/users/justinmk/orgs",
                "received_events_url": "https://api.github.com/users/justinmk/received_events",
                "repos_url": "https://api.github.com/users/justinmk/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/justinmk"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Yea I was afraid that other LSPs might be providing the textEdits in a way just to make it work with Neovim. However, I wasn't able to reproduce this using `vtsls`. Which tsserver wrapper are you using?\r\n\r\nIt's possible that the LSP would need to be updated to account for the fix. The fix was made to match closer to VSCode's implementation here https://github.com/microsoft/vscode-languageserver-node/blob/main/textDocument/src/main.ts#L371\r\n\r\nIn regards to #29284 though, it appears unrelated since that seems like more of an issue with what autocomplete options are provided, but I may be totally wrong there. I'm new to the codebase",
            "created_at": "2024-06-13T22:51:20Z",
            "html_url": "https://github.com/neovim/neovim/issues/29286#issuecomment-2166918263",
            "id": 2166918263,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29286",
            "node_id": "IC_kwDOAPphoM6BKIx3",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2166918263/reactions"
            },
            "updated_at": "2024-06-13T22:51:20Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2166918263",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/57642956?v=4",
                "events_url": "https://api.github.com/users/alcolmenar/events{/privacy}",
                "followers_url": "https://api.github.com/users/alcolmenar/followers",
                "following_url": "https://api.github.com/users/alcolmenar/following{/other_user}",
                "gists_url": "https://api.github.com/users/alcolmenar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alcolmenar",
                "id": 57642956,
                "login": "alcolmenar",
                "node_id": "MDQ6VXNlcjU3NjQyOTU2",
                "organizations_url": "https://api.github.com/users/alcolmenar/orgs",
                "received_events_url": "https://api.github.com/users/alcolmenar/received_events",
                "repos_url": "https://api.github.com/users/alcolmenar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alcolmenar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alcolmenar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alcolmenar"
            }
        },
        {
            "author_association": "NONE",
            "body": "Could you try the following? Don't forget to use latest nvim dev.\r\n1. Create `/tmp/repro` folder. If you want to change this folder, you also need to change `root` path in `repro.lua` as well.\r\n2. Create `/tmp/repro/repro.lua` with the following content:\r\n```lua\r\nlocal root = vim.fn.fnamemodify(\"/tmp/repro/.repro\", \":p\") -- it will download modules in /tmp/repro/.repro\r\n\r\n-- set stdpaths to use .repro\r\nfor _, name in ipairs({ \"config\", \"data\", \"state\", \"cache\" }) do\r\n\tvim.env[(\"XDG_%s_HOME\"):format(name:upper())] = root .. \"/\" .. name\r\nend\r\n\r\n-- bootstrap lazy\r\nlocal lazypath = root .. \"/plugins/lazy.nvim\"\r\nif not vim.loop.fs_stat(lazypath) then\r\n\tvim.fn.system({\r\n\t\t\"git\",\r\n\t\t\"clone\",\r\n\t\t\"--filter=blob:none\",\r\n\t\t\"--single-branch\",\r\n\t\t\"https://github.com/folke/lazy.nvim.git\",\r\n\t\tlazypath,\r\n\t})\r\nend\r\nvim.opt.runtimepath:prepend(lazypath)\r\n\r\n-- install plugins\r\nlocal plugins = {\r\n\t{\r\n\t\t\"neovim/nvim-lspconfig\",\r\n\t\tconfig = function()\r\n\t\t\tlocal on_attach = function(client, bufnr)\r\n\t\t\t\tvim.lsp.completion.enable(true, client.id, bufnr, { autotrigger = false })\r\n\t\t\tend\r\n\r\n\t\t\tlocal lspconfig = require(\"lspconfig\")\r\n\t\t\tlocal capabilities = require(\"cmp_nvim_lsp\").default_capabilities()\r\n\r\n\t\t\tlspconfig.tsserver.setup({\r\n\t\t\t\ton_attach = on_attach,\r\n\t\t\t\tcapabilities = capabilities,\r\n\t\t\t})\r\n\t\tend,\r\n\t},\r\n\t{\r\n\t\t\"hrsh7th/nvim-cmp\",\r\n\t\tdependencies = {\r\n\t\t\t\"hrsh7th/cmp-nvim-lsp\",\r\n\t\t},\r\n\t\tconfig = function()\r\n\t\t\tlocal cmp = require(\"cmp\")\r\n\r\n\t\t\tcmp.setup({\r\n\t\t\t\tmapping = cmp.mapping.preset.insert({\r\n\t\t\t\t\t[\"<C-b>\"] = cmp.mapping.scroll_docs(-4),\r\n\t\t\t\t\t[\"<C-f>\"] = cmp.mapping.scroll_docs(4),\r\n\t\t\t\t\t[\"<C-Space>\"] = cmp.mapping.complete(),\r\n\t\t\t\t\t[\"<C-e>\"] = cmp.mapping.abort(),\r\n\t\t\t\t\t[\"<CR>\"] = cmp.mapping.confirm({ select = true }), -- Accept currently selected item. Set `select` to `false` to only confirm explicitly selected items.\r\n\t\t\t\t}),\r\n\t\t\t\tsources = cmp.config.sources({\r\n\t\t\t\t\t{ name = \"nvim_lsp\" },\r\n\t\t\t\t}, {\r\n\t\t\t\t\t{ name = \"buffer\" },\r\n\t\t\t\t}),\r\n\t\t\t})\r\n\t\tend,\r\n\t},\r\n}\r\n\r\nrequire(\"lazy\").setup(plugins, {\r\n\troot = root .. \"/plugins\",\r\n})\r\n```\r\n3. `npm install -g typescript typescript-language-server`\r\n4. `mkdir /tmp/repro-test`\r\n5. `cd /tmp/repro-test`\r\n6. `npm install @types/node -D`\r\n7. Create `/tmp/repro-test/main.ts` file with the following content:\r\n```typescript\r\nimport {\r\n  sep,\r\n  join,\r\n  parse,\r\n  posix,\r\n  win32,\r\n  format,\r\n  dirname,\r\n  extname,\r\n  resolve,\r\n  basename,\r\n} from \"path\";\r\n\r\n```\r\n8. `nvim . -nu /tmp/repro/repro.lua`\r\n9. Open `main.ts`. Try to auto import `normalize` with completion.\r\n\r\nhttps://github.com/neovim/neovim/assets/62308020/d6e8be85-29a9-4936-a2d4-b9524b7e70da\r\n\r\nAlso you can try `vtsls`, for me they have the same issue.",
            "created_at": "2024-06-14T08:15:35Z",
            "html_url": "https://github.com/neovim/neovim/issues/29286#issuecomment-2167499785",
            "id": 2167499785,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29286",
            "node_id": "IC_kwDOAPphoM6BMWwJ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167499785/reactions"
            },
            "updated_at": "2024-06-14T08:25:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167499785",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62308020?v=4",
                "events_url": "https://api.github.com/users/geril2207/events{/privacy}",
                "followers_url": "https://api.github.com/users/geril2207/followers",
                "following_url": "https://api.github.com/users/geril2207/following{/other_user}",
                "gists_url": "https://api.github.com/users/geril2207/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/geril2207",
                "id": 62308020,
                "login": "geril2207",
                "node_id": "MDQ6VXNlcjYyMzA4MDIw",
                "organizations_url": "https://api.github.com/users/geril2207/orgs",
                "received_events_url": "https://api.github.com/users/geril2207/received_events",
                "repos_url": "https://api.github.com/users/geril2207/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/geril2207/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/geril2207/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/geril2207"
            }
        },
        {
            "author_association": "NONE",
            "body": "See https://github.com/pmizio/typescript-tools.nvim/blob/master/lua/typescript-tools/protocol/text_document/did_change.lua#L11\n\nAlso, vscode's typescript server doesn't comply with the spec (not sure what the state of tsserver/vtsls is; if vtsls just bundles the vscode package, I expect it to need the same patch as above).",
            "created_at": "2024-06-14T09:16:32Z",
            "html_url": "https://github.com/neovim/neovim/issues/29286#issuecomment-2167608392",
            "id": 2167608392,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29286",
            "node_id": "IC_kwDOAPphoM6BMxRI",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167608392/reactions"
            },
            "updated_at": "2024-06-14T09:20:53Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167608392",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/20242530?v=4",
                "events_url": "https://api.github.com/users/iurimateus/events{/privacy}",
                "followers_url": "https://api.github.com/users/iurimateus/followers",
                "following_url": "https://api.github.com/users/iurimateus/following{/other_user}",
                "gists_url": "https://api.github.com/users/iurimateus/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iurimateus",
                "id": 20242530,
                "login": "iurimateus",
                "node_id": "MDQ6VXNlcjIwMjQyNTMw",
                "organizations_url": "https://api.github.com/users/iurimateus/orgs",
                "received_events_url": "https://api.github.com/users/iurimateus/received_events",
                "repos_url": "https://api.github.com/users/iurimateus/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iurimateus/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iurimateus/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iurimateus"
            }
        },
        {
            "author_association": "NONE",
            "body": "> I expect it to need the same patch as above).\r\n\r\nDo you mean patch from `typescript-tools`? If so, `typescript-tools` have the same issue",
            "created_at": "2024-06-14T10:09:00Z",
            "html_url": "https://github.com/neovim/neovim/issues/29286#issuecomment-2167700186",
            "id": 2167700186,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29286",
            "node_id": "IC_kwDOAPphoM6BNHra",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167700186/reactions"
            },
            "updated_at": "2024-06-14T10:42:46Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2167700186",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62308020?v=4",
                "events_url": "https://api.github.com/users/geril2207/events{/privacy}",
                "followers_url": "https://api.github.com/users/geril2207/followers",
                "following_url": "https://api.github.com/users/geril2207/following{/other_user}",
                "gists_url": "https://api.github.com/users/geril2207/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/geril2207",
                "id": 62308020,
                "login": "geril2207",
                "node_id": "MDQ6VXNlcjYyMzA4MDIw",
                "organizations_url": "https://api.github.com/users/geril2207/orgs",
                "received_events_url": "https://api.github.com/users/geril2207/received_events",
                "repos_url": "https://api.github.com/users/geril2207/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/geril2207/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/geril2207/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/geril2207"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29286/comments",
    "created_at": "2024-06-11T14:19:50Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29286/events",
    "html_url": "https://github.com/neovim/neovim/issues/29286",
    "id": 2346566134,
    "labels": [
        {
            "color": "f9d0c4",
            "default": false,
            "description": "wrong behavior that was introduced in a previous commit (please bisect)",
            "id": 619474658,
            "name": "bug-regression",
            "node_id": "MDU6TGFiZWw2MTk0NzQ2NTg=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug-regression"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue has been tracked to a specific commit",
            "id": 1481421490,
            "name": "has:bisected",
            "node_id": "MDU6TGFiZWwxNDgxNDIxNDkw",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:bisected"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29286/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6L3cH2",
    "number": 29286,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29286/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29286/timeline",
    "title": "tsserver wrong autoimports with multiline imports",
    "updated_at": "2024-06-19T09:21:39Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29286",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/62308020?v=4",
        "events_url": "https://api.github.com/users/geril2207/events{/privacy}",
        "followers_url": "https://api.github.com/users/geril2207/followers",
        "following_url": "https://api.github.com/users/geril2207/following{/other_user}",
        "gists_url": "https://api.github.com/users/geril2207/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/geril2207",
        "id": 62308020,
        "login": "geril2207",
        "node_id": "MDQ6VXNlcjYyMzA4MDIw",
        "organizations_url": "https://api.github.com/users/geril2207/orgs",
        "received_events_url": "https://api.github.com/users/geril2207/received_events",
        "repos_url": "https://api.github.com/users/geril2207/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/geril2207/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/geril2207/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/geril2207"
    }
}