{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nUsing `<cmd>` in the right hand side of a mapping used to result in the status line being subsequently updated when changing e.g., `formatoptions`. This is no longer the case. I am not sure if this is intended behavior, so I thought I'd report it here in case it's not intended. A workaround is to use `:` in a mapping instead of `<cmd>`.\r\n\r\nThis started in fe11079. Cc: @luukvbaal \n\n### Steps to reproduce\n\n```\r\nnvim /tmp/tmpfile --clean\r\n```\r\n\r\nAdd the following content:\r\n\r\n```vim\r\nfunction! StatusLine() abort\r\n  return &formatoptions\r\nendfunction\r\n\r\nnoremap <space>t <cmd>set formatoptions+=t<cr>\r\nnoremap <space>T <cmd>set formatoptions-=t<cr>\r\n\r\nset statusline=%{StatusLine()}\r\n```\r\n\r\nSource the script.\r\n\r\n```\r\n:source %\r\n```\r\n\r\nType `<space>t` to add `t` to `formatoptions`.\n\n### Expected behavior\n\nI expected the status line would be updated to reflect the new value for `formatoptions`, which now includes `t`.\r\n\r\nHowever, it's not updated until I e.g., move the cursor or press `<ctrl-l>`.\n\n### Neovim version (nvim -v)\n\nv0.9.0\n\n### Vim (not Nvim) behaves the same?\n\nNo, 9.0.1189\n\n### Operating system/version\n\nKubuntu 23.04\n\n### Terminal name/version\n\nKonsole 22.12.3\n\n### $TERM environment variable\n\nxterm-256color\n\n### Installation\n\nappimage",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "The workaround of using `:` instead of `<cmd>` does not work when the mapping has `<silent>`.\r\n\r\n```vim\r\nnoremap <silent> <space>t :set formatoptions+=t<cr>\r\n```",
            "created_at": "2023-05-14T02:34:47Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1546792468",
            "id": 1546792468,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cMi4U",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546792468/reactions"
            },
            "updated_at": "2023-05-14T02:34:59Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546792468",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/541289?v=4",
                "events_url": "https://api.github.com/users/dstein64/events{/privacy}",
                "followers_url": "https://api.github.com/users/dstein64/followers",
                "following_url": "https://api.github.com/users/dstein64/following{/other_user}",
                "gists_url": "https://api.github.com/users/dstein64/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dstein64",
                "id": 541289,
                "login": "dstein64",
                "node_id": "MDQ6VXNlcjU0MTI4OQ==",
                "organizations_url": "https://api.github.com/users/dstein64/orgs",
                "received_events_url": "https://api.github.com/users/dstein64/received_events",
                "repos_url": "https://api.github.com/users/dstein64/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dstein64/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dstein64/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dstein64"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I'm inclined to say that it is expected behavior now that your repro does not result in a statusline update. We try to avoid unnecessary statusline updates since that commit.\r\n\r\nThe fact that an option value changed also does not seem to warrant a statusline update. Do you actually want to show option values in your statusline or do you have a different repro that made you open this issue?\r\n\r\nWorkaround that should always work:\r\n\r\n```vim\r\nnoremap <silent> <space>t :set formatoptions+=t<cr>:redrawstatus<cr>\r\nnoremap <silent> <space>T :set formatoptions-=t<cr>:redrawstatus<cr>\r\n```\r\n\r\n",
            "created_at": "2023-05-14T09:45:08Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1546857578",
            "id": 1546857578,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cMyxq",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546857578/reactions"
            },
            "updated_at": "2023-05-14T12:38:34Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546857578",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "`src/nvim/options.lua` contains specifications for what options needs redrawing, including drawing of statuslines. It is possible some entries are missing as the past behavior was to redraw on any `:silent set whatever<cr>` anyway, so a missing entry would hardly be noticeable.\r\n\r\nHowever, in this case I assume the option value is only needed because it is used as an explicit expression in 'statusline' ? In general, some usages of expressions are gonna need more `:redrawstatus` calls, which is an intentional tradeoff as @luukvbaal noted .\r\n\r\nWe could of course be pragmatic like \"here is 3-4 options that all the big statusline plugins rely on, let's mark those as redraw=statuslines\" if that happen to be the case, but regardless, we need to draw the line somewhere.",
            "created_at": "2023-05-14T12:21:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1546887498",
            "id": 1546887498,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cM6FK",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546887498/reactions"
            },
            "updated_at": "2023-05-14T12:21:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546887498",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1363104?v=4",
                "events_url": "https://api.github.com/users/bfredl/events{/privacy}",
                "followers_url": "https://api.github.com/users/bfredl/followers",
                "following_url": "https://api.github.com/users/bfredl/following{/other_user}",
                "gists_url": "https://api.github.com/users/bfredl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bfredl",
                "id": 1363104,
                "login": "bfredl",
                "node_id": "MDQ6VXNlcjEzNjMxMDQ=",
                "organizations_url": "https://api.github.com/users/bfredl/orgs",
                "received_events_url": "https://api.github.com/users/bfredl/received_events",
                "repos_url": "https://api.github.com/users/bfredl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bfredl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bfredl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bfredl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "> \"Do you actually want to show option values in your statusline or do you have a different repro that made you open this issue?\"\r\n\r\nMy status line shows the value of various options and I have mappings that I use to change the options. I noticed that in the latest release of Neovim (v0.9) that the status line wasn't updating to reflect the new option values that I was changing through mappings. The example in this ticket is a minimal reproducible example extracted from that scenario.\r\n\r\nI worked around the issue by calling `:redrawstatus`, but since I wasn't sure if the behavior was intended, I thought I'd open this ticket.\r\n\r\nI noticed that the issue could be resolved by adding `:redrawstatus` to the `StatusLine` function in the example above.\r\n\r\n```vim\r\nfunction! StatusLine() abort\r\n  let result = &formatoptions\r\n  redrawstatus\r\n  return result\r\nendfunction\r\n```\r\n\r\n~This seems to suggest that the text for the status line is being generated even in cases where there won't be a status line update. Would it be feasible to redraw the status line if the generated status line text has changed from its existing value (assuming it's generated by the time the check is executed, which is what appears to be the case)?~ (edited to strike through since my interpretation was wrong; thanks @zeertzjq for the correct information below)",
            "created_at": "2023-05-14T16:20:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1546937269",
            "id": 1546937269,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cNGO1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546937269/reactions"
            },
            "updated_at": "2023-05-15T01:16:13Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1546937269",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/541289?v=4",
                "events_url": "https://api.github.com/users/dstein64/events{/privacy}",
                "followers_url": "https://api.github.com/users/dstein64/followers",
                "following_url": "https://api.github.com/users/dstein64/following{/other_user}",
                "gists_url": "https://api.github.com/users/dstein64/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dstein64",
                "id": 541289,
                "login": "dstein64",
                "node_id": "MDQ6VXNlcjU0MTI4OQ==",
                "organizations_url": "https://api.github.com/users/dstein64/orgs",
                "received_events_url": "https://api.github.com/users/dstein64/received_events",
                "repos_url": "https://api.github.com/users/dstein64/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dstein64/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dstein64/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dstein64"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "See if this works:\r\n```vim\r\nautocmd OptionSet formatoptions redrawstatus\r\n```",
            "created_at": "2023-05-14T21:56:27Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1547009761",
            "id": 1547009761,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cNX7h",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547009761/reactions"
            },
            "updated_at": "2023-05-14T21:57:35Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547009761",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/59243201?v=4",
                "events_url": "https://api.github.com/users/ii14/events{/privacy}",
                "followers_url": "https://api.github.com/users/ii14/followers",
                "following_url": "https://api.github.com/users/ii14/following{/other_user}",
                "gists_url": "https://api.github.com/users/ii14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ii14",
                "id": 59243201,
                "login": "ii14",
                "node_id": "MDQ6VXNlcjU5MjQzMjAx",
                "organizations_url": "https://api.github.com/users/ii14/orgs",
                "received_events_url": "https://api.github.com/users/ii14/received_events",
                "repos_url": "https://api.github.com/users/ii14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ii14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ii14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ii14"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "That resolves the issue and is similar to the workaround I'm currently using:\r\nhttps://github.com/dstein64/dotfiles/blob/0d3ad937f0c1958ee68fad43d2864f7a71dc25f3/packages/vim/.vimrc#L665-L667\r\n",
            "created_at": "2023-05-14T22:41:38Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1547017470",
            "id": 1547017470,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cNZz-",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547017470/reactions"
            },
            "updated_at": "2023-05-14T22:41:38Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547017470",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/541289?v=4",
                "events_url": "https://api.github.com/users/dstein64/events{/privacy}",
                "followers_url": "https://api.github.com/users/dstein64/followers",
                "following_url": "https://api.github.com/users/dstein64/following{/other_user}",
                "gists_url": "https://api.github.com/users/dstein64/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/dstein64",
                "id": 541289,
                "login": "dstein64",
                "node_id": "MDQ6VXNlcjU0MTI4OQ==",
                "organizations_url": "https://api.github.com/users/dstein64/orgs",
                "received_events_url": "https://api.github.com/users/dstein64/received_events",
                "repos_url": "https://api.github.com/users/dstein64/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/dstein64/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/dstein64/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/dstein64"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> This seems to suggest that the text for the status line is being generated even in cases where there won't be a status line update. Would it be feasible to redraw the status line if the generated status line text has changed from its existing value (assuming it's generated by the time the check is executed, which is what appears to be the case)?\r\n\r\nIt's generated when you redraw the statusline.",
            "created_at": "2023-05-15T00:12:50Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1547040217",
            "id": 1547040217,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cNfXZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547040217/reactions"
            },
            "updated_at": "2023-05-15T00:12:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547040217",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> I noticed that the issue could be resolved by adding :redrawstatus to the StatusLine function in the example above.\r\n\r\nThis actually imitates the old behavior: redraw the statusline on every main loop iteration.",
            "created_at": "2023-05-15T01:04:03Z",
            "html_url": "https://github.com/neovim/neovim/issues/23621#issuecomment-1547057678",
            "id": 1547057678,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23621",
            "node_id": "IC_kwDOAPphoM5cNjoO",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547057678/reactions"
            },
            "updated_at": "2023-05-15T01:04:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1547057678",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/35768171?v=4",
                "events_url": "https://api.github.com/users/zeertzjq/events{/privacy}",
                "followers_url": "https://api.github.com/users/zeertzjq/followers",
                "following_url": "https://api.github.com/users/zeertzjq/following{/other_user}",
                "gists_url": "https://api.github.com/users/zeertzjq/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zeertzjq",
                "id": 35768171,
                "login": "zeertzjq",
                "node_id": "MDQ6VXNlcjM1NzY4MTcx",
                "organizations_url": "https://api.github.com/users/zeertzjq/orgs",
                "received_events_url": "https://api.github.com/users/zeertzjq/received_events",
                "repos_url": "https://api.github.com/users/zeertzjq/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zeertzjq/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zeertzjq/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zeertzjq"
            }
        }
    ],
    "comments": 8,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23621/comments",
    "created_at": "2023-05-14T02:25:54Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23621/events",
    "html_url": "https://github.com/neovim/neovim/issues/23621",
    "id": 1708794304,
    "labels": [
        {
            "color": "FBCA04",
            "default": false,
            "description": "For PRs that propose significant changes to some part of the architecture or API",
            "id": 212680983,
            "name": "needs:discussion",
            "node_id": "MDU6TGFiZWwyMTI2ODA5ODM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:discussion"
        },
        {
            "color": "0E8A16",
            "default": false,
            "description": "issue is not fixed but can be circumvented until then",
            "id": 435850181,
            "name": "has:workaround",
            "node_id": "MDU6TGFiZWw0MzU4NTAxODE=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/has:workaround"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "tabline, winbar, statuscolumn",
            "id": 3385615828,
            "name": "statusline",
            "node_id": "LA_kwDOAPphoM7JzGXU",
            "url": "https://api.github.com/repos/neovim/neovim/labels/statusline"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23621/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5l2iHA",
    "number": 23621,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23621/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23621/timeline",
    "title": "<cmd> mappings don't result in statusline update",
    "updated_at": "2023-09-16T02:48:47Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23621",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/541289?v=4",
        "events_url": "https://api.github.com/users/dstein64/events{/privacy}",
        "followers_url": "https://api.github.com/users/dstein64/followers",
        "following_url": "https://api.github.com/users/dstein64/following{/other_user}",
        "gists_url": "https://api.github.com/users/dstein64/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/dstein64",
        "id": 541289,
        "login": "dstein64",
        "node_id": "MDQ6VXNlcjU0MTI4OQ==",
        "organizations_url": "https://api.github.com/users/dstein64/orgs",
        "received_events_url": "https://api.github.com/users/dstein64/received_events",
        "repos_url": "https://api.github.com/users/dstein64/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/dstein64/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/dstein64/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/dstein64"
    }
}