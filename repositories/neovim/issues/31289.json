{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nI was trying to create a command that changes its behavior based on whether hover information is already displayed in a floating window.\n\nI tried to check if such a floating window exists by verifying whether the buffer-local variable `lsp_floating_preview` is defined, but it didn't work. This is because this variable is not unset after the floating window is closed. It works the first time, but on the second and subsequent attempts, it doesn't work because the variable exists even when a floating window is not present.\n\nI ran into this problem when dealing with `textDocument/hover`, but all functions that use `vim.lsp.util.open_floating_preview(...)` (which declares `lsp_floating_preview`) should have the same problem.\n\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\n\nminimal_init.lua:\n\n```lua\nlocal pattern = \"rust\"\nlocal cmd = { \"rust-analyzer\" }\nlocal root_markers = { \"Cargo.toml\" }\nlocal settings = vim.empty_dict()\n\nvim.api.nvim_create_autocmd(\n    \"FileType\", {\n        pattern = pattern,\n        callback = function(args)\n            local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\n            local root_dir = match and vim.fn.fnamemodify(match, \":p:h\") or nil\n            vim.lsp.start {\n                name = \"rust-analyzer\",\n                cmd = cmd,\n                root_dir = root_dir,\n                settings = settings,\n            }\n        end,\n    }\n)\n```\n\nsrc/main.rs:\n\n```rust\nfn main() {\n    println!(\"Hello, world!\");\n}\n```\n\n1. Create a new rust project: `cargo new sample; cd sample`\n    This will create `src/main.rs` shown above.\n    I used a Rust project, but it should be reproducible with a project in another programming language as long as it has an LSP server that supports `textDocument/hover`.\n2. Start a Neovim session: `nvim -u <path to minimal_init.lua> src/main.rs`\n3. Run `:lua vim.lsp.buf.hover()`.\n    The cursor can be located anywhere that has hover information. \n    I didn't move the cursor at all in my case.\n4. Wait until indexing is complete and a floating window appears.\n5. Run `:only` to close the floating window.\n6. Check if `b:lsp_floating_preview` exists: `:echo b:lsp_floating_preview`\n    - expected: `Undefined variable: b:lsp_floating_preview`\n    - actual: `1002`\n\n### Expected behavior\n\n`b:lsp_floating_preview` should be unset after the window created by `vim.lsp.util.open_floating_preview()` is closed.\n\n### Nvim version (nvim -v)\n\nv0.10.2\n\n### Language server name/version\n\nrust-analyzer 1.82.0\n\n### Operating system/version\n\nUbuntu 22.04\n\n### Log file\n\n_No response_",
    "closed_at": "2024-11-22T10:16:42Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7904185?v=4",
        "events_url": "https://api.github.com/users/lewis6991/events{/privacy}",
        "followers_url": "https://api.github.com/users/lewis6991/followers",
        "following_url": "https://api.github.com/users/lewis6991/following{/other_user}",
        "gists_url": "https://api.github.com/users/lewis6991/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lewis6991",
        "id": 7904185,
        "login": "lewis6991",
        "node_id": "MDQ6VXNlcjc5MDQxODU=",
        "organizations_url": "https://api.github.com/users/lewis6991/orgs",
        "received_events_url": "https://api.github.com/users/lewis6991/received_events",
        "repos_url": "https://api.github.com/users/lewis6991/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lewis6991/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lewis6991/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lewis6991",
        "user_view_type": "public"
    },
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I appreciate your help.\n\nI ran the steps to reproduce after applying the PR and found some bugs.\nI'll open a PR to fix them.\n\nOpened PR: https://github.com/neovim/neovim/pull/31310",
            "created_at": "2024-11-22T12:51:12Z",
            "html_url": "https://github.com/neovim/neovim/issues/31289#issuecomment-2493691269",
            "id": 2493691269,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/31289",
            "node_id": "IC_kwDOAPphoM6UorWF",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2493691269/reactions"
            },
            "updated_at": "2024-11-22T13:05:09Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2493691269",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/86554319?v=4",
                "events_url": "https://api.github.com/users/mamekoro/events{/privacy}",
                "followers_url": "https://api.github.com/users/mamekoro/followers",
                "following_url": "https://api.github.com/users/mamekoro/following{/other_user}",
                "gists_url": "https://api.github.com/users/mamekoro/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mamekoro",
                "id": 86554319,
                "login": "mamekoro",
                "node_id": "MDQ6VXNlcjg2NTU0MzE5",
                "organizations_url": "https://api.github.com/users/mamekoro/orgs",
                "received_events_url": "https://api.github.com/users/mamekoro/received_events",
                "repos_url": "https://api.github.com/users/mamekoro/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mamekoro/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mamekoro/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mamekoro",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/31289/comments",
    "created_at": "2024-11-21T15:32:29Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/31289/events",
    "html_url": "https://github.com/neovim/neovim/issues/31289",
    "id": 2679907292,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/31289/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6fvCPc",
    "number": 31289,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/31289/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "sub_issues_summary": {
        "completed": 0,
        "percent_completed": 0,
        "total": 0
    },
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/31289/timeline",
    "title": "LSP: `b:lsp_floating_preview` should be unset after closing the associated floating window",
    "updated_at": "2024-11-22T13:05:09Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/31289",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/86554319?v=4",
        "events_url": "https://api.github.com/users/mamekoro/events{/privacy}",
        "followers_url": "https://api.github.com/users/mamekoro/followers",
        "following_url": "https://api.github.com/users/mamekoro/following{/other_user}",
        "gists_url": "https://api.github.com/users/mamekoro/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/mamekoro",
        "id": 86554319,
        "login": "mamekoro",
        "node_id": "MDQ6VXNlcjg2NTU0MzE5",
        "organizations_url": "https://api.github.com/users/mamekoro/orgs",
        "received_events_url": "https://api.github.com/users/mamekoro/received_events",
        "repos_url": "https://api.github.com/users/mamekoro/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/mamekoro/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/mamekoro/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/mamekoro",
        "user_view_type": "public"
    }
}