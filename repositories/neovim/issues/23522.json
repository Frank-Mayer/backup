{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nHello,\r\n\r\nThis is most probably a PEBKAC but as I did not found any issue or post related to this behavior, I am opening this issue as a last resort.\r\n\r\nI have the following line in my `init.lua`:\r\n\r\n```lua\r\nvim.filetype.add({ extension = { nosj = \"json\" } })\r\n```\r\n\r\nSo I am expecting `neovim` to display all files with a `.nosj` extension as a JSON file.\r\n\r\nCurrently it does not (at least on my workstation).\r\nFor instance, opening a file named `file.nosj` and issuing `:echo &filetype` shows nothing (issuing the same command on a file named `file.json` shows `json`).\r\n\r\nBut issuing `:lua print(vim.filetype.match({ filename = 'file.nosj' }))` shows `json nil` which is the same result as `:lua print(vim.filetype.match({ filename = 'file.json' }))` so `filetype.lua` seems to detect the extension as expected.\r\n\r\n### Steps to reproduce\r\n\r\nHere is the minimal configuration reproducing the issue (`issue.lua`):\r\n```lua\r\nvim.filetype.add({ extension = { nosj = \"json\" } })\r\n```\r\n\r\n```sh\r\nnvim --clean -u issue.lua\r\n:lua print(vim.filetype.match({ filename = 'file.nosj' })) # shows \"json nil\"\r\n:e file.nosj\r\n:echo &filetype # shows nothing\r\n:e file.json\r\n:echo &filetype # shows \"json\"\r\n```\r\n\r\n### Expected behavior\r\n\r\n```sh\r\nnvim --clean -u issue.lua\r\n:e file.nosj\r\n:echo &filetype # shows \"json\"\r\n```\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.9.0\r\n\r\n### Vim (not Nvim) behaves the same?\r\n\r\nNo, filetype.lua is nvim specific\r\n\r\n### Operating system/version\r\n\r\nLinux hepao 6.1.27 NixOS SMP PREEMPT_DYNAMIC Sun Apr 30 23:26:28 UTC 2023 x86_64 GNU/Linux\r\n\r\n### Terminal name/version\r\n\r\nalacritty 0.12.0\r\n\r\n### $TERM environment variable\r\n\r\ntmux-256color\r\n\r\n### Installation\r\n\r\nNix Home Manager",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Works for me. Can you try the latest nightly, just to be sure?",
            "created_at": "2023-05-07T14:31:19Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1537455781",
            "id": 1537455781,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5bo7al",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537455781/reactions"
            },
            "updated_at": "2023-05-07T14:31:19Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537455781",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hello @clason, I have just tried with the latest sources (commit `1cbfed03c249e7f9e67d59566fbabe46f7f7f1f9`, `nvim -v` reports `NVIM v0.10.0-dev`).\r\n\r\nI still have the same behavior...\r\nShould `vim.filetype.add({ extension = { nosj = \"json\" } })` be enough for the filetype to be set accordingly?",
            "created_at": "2023-05-07T15:22:44Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1537467442",
            "id": 1537467442,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5bo-Qy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537467442/reactions"
            },
            "updated_at": "2023-05-07T15:22:44Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537467442",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11046232?v=4",
                "events_url": "https://api.github.com/users/gautaz/events{/privacy}",
                "followers_url": "https://api.github.com/users/gautaz/followers",
                "following_url": "https://api.github.com/users/gautaz/following{/other_user}",
                "gists_url": "https://api.github.com/users/gautaz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gautaz",
                "id": 11046232,
                "login": "gautaz",
                "node_id": "MDQ6VXNlcjExMDQ2MjMy",
                "organizations_url": "https://api.github.com/users/gautaz/orgs",
                "received_events_url": "https://api.github.com/users/gautaz/received_events",
                "repos_url": "https://api.github.com/users/gautaz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gautaz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gautaz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gautaz"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "It is, for me.\r\n",
            "created_at": "2023-05-07T15:25:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1537468278",
            "id": 1537468278,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5bo-d2",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537468278/reactions"
            },
            "updated_at": "2023-05-07T15:25:17Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537468278",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2361214?v=4",
                "events_url": "https://api.github.com/users/clason/events{/privacy}",
                "followers_url": "https://api.github.com/users/clason/followers",
                "following_url": "https://api.github.com/users/clason/following{/other_user}",
                "gists_url": "https://api.github.com/users/clason/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/clason",
                "id": 2361214,
                "login": "clason",
                "node_id": "MDQ6VXNlcjIzNjEyMTQ=",
                "organizations_url": "https://api.github.com/users/clason/orgs",
                "received_events_url": "https://api.github.com/users/clason/received_events",
                "repos_url": "https://api.github.com/users/clason/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/clason/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/clason/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/clason"
            }
        },
        {
            "author_association": "NONE",
            "body": "Just for the record, I have tried with the latest sources but still by using a Nix generation based on `pkgs.neovim-unwrapped` (see https://github.com/NixOS/nixpkgs/blob/7b6d5d41582ccb225bc0468573cae77f7f75b215/nixos/modules/programs/neovim.nix#L91).\r\n\r\nTrying to build directly from a `git clone` without relying on a Nix recipe can be quite painful under NixOS (I tried but I almost immediately stumbled over issues for finding libs scattered all over the Nix store).",
            "created_at": "2023-05-07T15:38:13Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1537471811",
            "id": 1537471811,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5bo_VD",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537471811/reactions"
            },
            "updated_at": "2023-05-07T15:42:39Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1537471811",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11046232?v=4",
                "events_url": "https://api.github.com/users/gautaz/events{/privacy}",
                "followers_url": "https://api.github.com/users/gautaz/followers",
                "following_url": "https://api.github.com/users/gautaz/following{/other_user}",
                "gists_url": "https://api.github.com/users/gautaz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gautaz",
                "id": 11046232,
                "login": "gautaz",
                "node_id": "MDQ6VXNlcjExMDQ2MjMy",
                "organizations_url": "https://api.github.com/users/gautaz/orgs",
                "received_events_url": "https://api.github.com/users/gautaz/received_events",
                "repos_url": "https://api.github.com/users/gautaz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gautaz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gautaz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gautaz"
            }
        },
        {
            "author_association": "NONE",
            "body": "As the initial analysis seems to point a `nixpkgs` specific issue, I have opened a new issue on `NisOS/nixpkgs` related to this issue.",
            "created_at": "2023-05-08T10:21:24Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1538132282",
            "id": 1538132282,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5brgk6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1538132282/reactions"
            },
            "updated_at": "2023-05-08T10:21:24Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1538132282",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/11046232?v=4",
                "events_url": "https://api.github.com/users/gautaz/events{/privacy}",
                "followers_url": "https://api.github.com/users/gautaz/followers",
                "following_url": "https://api.github.com/users/gautaz/following{/other_user}",
                "gists_url": "https://api.github.com/users/gautaz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/gautaz",
                "id": 11046232,
                "login": "gautaz",
                "node_id": "MDQ6VXNlcjExMDQ2MjMy",
                "organizations_url": "https://api.github.com/users/gautaz/orgs",
                "received_events_url": "https://api.github.com/users/gautaz/received_events",
                "repos_url": "https://api.github.com/users/gautaz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/gautaz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/gautaz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/gautaz"
            }
        },
        {
            "author_association": "NONE",
            "body": "I'm seeing a similar thing on Windows (0.9.0, installed via scoop): I have\r\n\r\n```\r\nlua vim.filetype.add { extension = { jsonschema = 'json' } }\r\n```\r\n\r\nin my `init.vim`, but my `<whatever>.jsonschema` files are not getting json highlighting (but if I run `:setf json` in the buffer, that works).",
            "created_at": "2023-05-19T11:09:29Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1554414133",
            "id": 1554414133,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5cpno1",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1554414133/reactions"
            },
            "updated_at": "2023-05-19T11:09:29Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1554414133",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8223327?v=4",
                "events_url": "https://api.github.com/users/amerry/events{/privacy}",
                "followers_url": "https://api.github.com/users/amerry/followers",
                "following_url": "https://api.github.com/users/amerry/following{/other_user}",
                "gists_url": "https://api.github.com/users/amerry/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/amerry",
                "id": 8223327,
                "login": "amerry",
                "node_id": "MDQ6VXNlcjgyMjMzMjc=",
                "organizations_url": "https://api.github.com/users/amerry/orgs",
                "received_events_url": "https://api.github.com/users/amerry/received_events",
                "repos_url": "https://api.github.com/users/amerry/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/amerry/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/amerry/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/amerry"
            }
        },
        {
            "author_association": "NONE",
            "body": "_adding my case very similar to this issue (probably the same)_\r\n\r\nI also experience the same kind of issue ever since sometime after 0.9. Also not only `vim.filetype.add` doesn't work but also the traditional way as well, https://github.com/ryuheechul/dotfiles/blob/master/nvim/ftdetect/detect.vim.\r\n\r\nI do install neovim via nixpkgs (via home-manager) and this issue occurs both on NixOS and macOS.\r\n\r\nOnly the file detection is the issue not highlighting and such.\r\n(`set ft?` result in `filetype=`)\r\n\r\nCurrently working around this by adding a comment on the top of each file `// vim: set ft=kdl:`.\r\n",
            "created_at": "2023-08-23T20:56:48Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1690628066",
            "id": 1690628066,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5kxO_i",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1690628066/reactions"
            },
            "updated_at": "2023-08-23T20:56:48Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1690628066",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2637709?v=4",
                "events_url": "https://api.github.com/users/ryuheechul/events{/privacy}",
                "followers_url": "https://api.github.com/users/ryuheechul/followers",
                "following_url": "https://api.github.com/users/ryuheechul/following{/other_user}",
                "gists_url": "https://api.github.com/users/ryuheechul/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ryuheechul",
                "id": 2637709,
                "login": "ryuheechul",
                "node_id": "MDQ6VXNlcjI2Mzc3MDk=",
                "organizations_url": "https://api.github.com/users/ryuheechul/orgs",
                "received_events_url": "https://api.github.com/users/ryuheechul/received_events",
                "repos_url": "https://api.github.com/users/ryuheechul/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ryuheechul/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ryuheechul/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ryuheechul"
            }
        },
        {
            "author_association": "NONE",
            "body": "Seeing this with Neovim 0.9.4, both the Homebrew and the Nixpkgs versions. In the meantime, I'm using an autocommand for filetype detection:\r\n\r\n`ftdetect/snippets.lua`:\r\n```lua\r\nvim.api.nvim_create_autocmd({ \"BufRead\", \"BufNewFile\" }, {\r\n  pattern = \"*.snippets\",\r\n  command = \"setfiletype snippets\",\r\n})\r\n```",
            "created_at": "2023-10-15T00:24:17Z",
            "html_url": "https://github.com/neovim/neovim/issues/23522#issuecomment-1763218684",
            "id": 1763218684,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/23522",
            "node_id": "IC_kwDOAPphoM5pGJT8",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763218684/reactions"
            },
            "updated_at": "2023-10-15T00:28:25Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1763218684",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/15312184?v=4",
                "events_url": "https://api.github.com/users/9999years/events{/privacy}",
                "followers_url": "https://api.github.com/users/9999years/followers",
                "following_url": "https://api.github.com/users/9999years/following{/other_user}",
                "gists_url": "https://api.github.com/users/9999years/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/9999years",
                "id": 15312184,
                "login": "9999years",
                "node_id": "MDQ6VXNlcjE1MzEyMTg0",
                "organizations_url": "https://api.github.com/users/9999years/orgs",
                "received_events_url": "https://api.github.com/users/9999years/received_events",
                "repos_url": "https://api.github.com/users/9999years/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/9999years/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/9999years/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/9999years"
            }
        }
    ],
    "comments": 8,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/23522/comments",
    "created_at": "2023-05-07T14:16:23Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/23522/events",
    "html_url": "https://github.com/neovim/neovim/issues/23522",
    "id": 1699084510,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "FBCA04",
            "default": false,
            "description": "We need minimal steps to reproduce the issue",
            "id": 298863445,
            "name": "needs:repro",
            "node_id": "MDU6TGFiZWwyOTg4NjM0NDU=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/needs:repro"
        },
        {
            "color": "C5DEF5",
            "default": false,
            "description": "filetype detection, filetype.lua",
            "id": 3708202139,
            "name": "filetype",
            "node_id": "LA_kwDOAPphoM7dBqyb",
            "url": "https://api.github.com/repos/neovim/neovim/labels/filetype"
        },
        {
            "color": "d4c5f9",
            "default": false,
            "description": "",
            "id": 4952459982,
            "name": "platform:nix",
            "node_id": "LA_kwDOAPphoM8AAAABJzCKzg",
            "url": "https://api.github.com/repos/neovim/neovim/labels/platform:nix"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/23522/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM5lRfje",
    "number": 23522,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/23522/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/23522/timeline",
    "title": "Filetype seems detected by filetype.lua but is not applied",
    "updated_at": "2023-10-15T00:28:25Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/23522",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/11046232?v=4",
        "events_url": "https://api.github.com/users/gautaz/events{/privacy}",
        "followers_url": "https://api.github.com/users/gautaz/followers",
        "following_url": "https://api.github.com/users/gautaz/following{/other_user}",
        "gists_url": "https://api.github.com/users/gautaz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/gautaz",
        "id": 11046232,
        "login": "gautaz",
        "node_id": "MDQ6VXNlcjExMDQ2MjMy",
        "organizations_url": "https://api.github.com/users/gautaz/orgs",
        "received_events_url": "https://api.github.com/users/gautaz/received_events",
        "repos_url": "https://api.github.com/users/gautaz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/gautaz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/gautaz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/gautaz"
    }
}