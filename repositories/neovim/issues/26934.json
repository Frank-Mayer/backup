{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\n\nDescribed along with the reproduction steps.\n\n### Steps to reproduce\n\n`nvim --clean -c 'let &statuscolumn=\\'%{v:relnum}\\''`\r\nAdd some lines, press escape and move between the lines.\r\n\r\nI would expect the relative line numbers to update as you move between lines, but they are only updated when you add new lines.\r\nThe relative line numbers in the `statuscolumn` start updating if you turn relative line numbers on via `set relativenumber`.\r\n\r\nEven when `relativenumber` is set, the relative line numbers only update for the first visual line of a wrapped line.\r\nSetting `relativenumber` or `number` also appears to add `numberwidth` padding after the status column, but while unexpected this is pretty useful.\r\n\n\n### Expected behavior\n\nThe relative line numbers in the `statuscolumn` to update in the scenarios described above.\n\n### Neovim version (nvim -v)\n\nNVIM v0.10.0-dev-2042+g28c183b38c Build type: RelWithDebInfo LuaJIT 2.1.1702233742\n\n### Vim (not Nvim) behaves the same?\n\nN/A\n\n### Operating system/version\n\nLinux archlinux 6.6.7-arch1-1\n\n### Terminal name/version\n\nkitty 0.31.0\n\n### $TERM environment variable\n\nxterm-kitty\n\n### Installation\n\nArch User Repository",
    "closed_at": "2024-01-16T12:08:48Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "> I would expect the relative line numbers to update as you move between lines, but they are only updated when you add new lines.\r\nThe relative line numbers in the statuscolumn start updating if you turn relative line numbers on via set relativenumber.\r\n\r\nWithout `'relativenumber'` set, moving the cursor will not redraw any lines, and thus the status column doesn't update. I don't think that should change. The user should set `'relativenumber'` if they want it to update on cursor movement, perhaps that should be documented under `:h statuscolumn`.\r\n\r\n> Even when relativenumber is set, the relative line numbers only update for the first visual line of a wrapped line.\r\n\r\nThis may be considered a bug. But here again the problem is not that `v:relnum` doesn't update, but that only the first line is actually being redrawn. Here is a naive patch that changes that:\r\n```diff\r\n@@ -1551,6 +1551,11 @@ int win_line(win_T *wp, linenr_T lnum, int startrow, int endrow, bool number_onl\r\n       }\r\n       // don't clear anything after wlv.col\r\n       win_put_linebuf(wp, wlv.row, 0, wlv.col, wlv.col, bg_attr, false);\r\n+      if (statuscol.draw && number_only\r\n+          && wlv.row - wlv.startrow < wp->w_lines[wlv.lnum - wp->w_topline].wl_size - 1) {\r\n+        wlv.row++;\r\n+        continue;\r\n+      }\r\n       // Pretend we have finished updating the window.  Except when\r\n       // 'cursorcolumn' is set.\r\n       if (wp->w_p_cuc) {\r\n```\r\n\r\n> Setting relativenumber or number also appears to add numberwidth padding after the status column, but while unexpected this is pretty useful. \r\n\r\nNot after the status column, but the status column width follows the 'numberwidth' option indeed. This was documented recently: https://github.com/neovim/neovim/pull/26845.",
            "created_at": "2024-01-07T00:45:21Z",
            "html_url": "https://github.com/neovim/neovim/issues/26934#issuecomment-1879897040",
            "id": 1879897040,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26934",
            "node_id": "IC_kwDOAPphoM5wDPPQ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879897040/reactions"
            },
            "updated_at": "2024-01-07T01:17:07Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879897040",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        },
        {
            "author_association": "NONE",
            "body": "> Without `'relativenumber'` set, moving the cursor will not redraw any lines, and thus the status column doesn't update. I don't think that should change. The user should set `'relativenumber'` if they want it to update on cursor movement, perhaps that should be documented under `:h statuscolumn`.\r\n\r\nDoes this mean that `statuscolumn` doesn't initiate redraws itself, something else has to trigger a redraw for the `statuscolumn` to be redisplayed?",
            "created_at": "2024-01-07T01:45:33Z",
            "html_url": "https://github.com/neovim/neovim/issues/26934#issuecomment-1879909592",
            "id": 1879909592,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26934",
            "node_id": "IC_kwDOAPphoM5wDSTY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879909592/reactions"
            },
            "updated_at": "2024-01-07T01:45:33Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879909592",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/133965?v=4",
                "events_url": "https://api.github.com/users/blankname/events{/privacy}",
                "followers_url": "https://api.github.com/users/blankname/followers",
                "following_url": "https://api.github.com/users/blankname/following{/other_user}",
                "gists_url": "https://api.github.com/users/blankname/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/blankname",
                "id": 133965,
                "login": "blankname",
                "node_id": "MDQ6VXNlcjEzMzk2NQ==",
                "organizations_url": "https://api.github.com/users/blankname/orgs",
                "received_events_url": "https://api.github.com/users/blankname/received_events",
                "repos_url": "https://api.github.com/users/blankname/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/blankname/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/blankname/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/blankname"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Yes, the status column is drawn as part of the buffer text in the window. Anything that causes a redraw for a buffer line, will also redraw the status column for that row. The only exception to that is cursor movement with `'relativenumber'` enabled, which causes the columns to be redrawn for the entire window, without redrawing the buffer text.",
            "created_at": "2024-01-07T02:30:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/26934#issuecomment-1879918177",
            "id": 1879918177,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/26934",
            "node_id": "IC_kwDOAPphoM5wDUZh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879918177/reactions"
            },
            "updated_at": "2024-01-07T02:32:03Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1879918177",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/31730729?v=4",
                "events_url": "https://api.github.com/users/luukvbaal/events{/privacy}",
                "followers_url": "https://api.github.com/users/luukvbaal/followers",
                "following_url": "https://api.github.com/users/luukvbaal/following{/other_user}",
                "gists_url": "https://api.github.com/users/luukvbaal/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/luukvbaal",
                "id": 31730729,
                "login": "luukvbaal",
                "node_id": "MDQ6VXNlcjMxNzMwNzI5",
                "organizations_url": "https://api.github.com/users/luukvbaal/orgs",
                "received_events_url": "https://api.github.com/users/luukvbaal/received_events",
                "repos_url": "https://api.github.com/users/luukvbaal/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/luukvbaal/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/luukvbaal/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/luukvbaal"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/26934/comments",
    "created_at": "2024-01-07T00:27:45Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/26934/events",
    "html_url": "https://github.com/neovim/neovim/issues/26934",
    "id": 2068903958,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": true,
            "description": "",
            "id": 84744038,
            "name": "documentation",
            "node_id": "MDU6TGFiZWw4NDc0NDAzOA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/documentation"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": "sign/number column",
            "id": 2962322085,
            "name": "column",
            "node_id": "MDU6TGFiZWwyOTYyMzIyMDg1",
            "url": "https://api.github.com/repos/neovim/neovim/labels/column"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/26934/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM57UPgW",
    "number": 26934,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/26934/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/26934/timeline",
    "title": "When v:relnum is used in statuscolumn it doesn't update as often as expected",
    "updated_at": "2024-01-16T12:08:48Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/26934",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/133965?v=4",
        "events_url": "https://api.github.com/users/blankname/events{/privacy}",
        "followers_url": "https://api.github.com/users/blankname/followers",
        "following_url": "https://api.github.com/users/blankname/following{/other_user}",
        "gists_url": "https://api.github.com/users/blankname/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/blankname",
        "id": 133965,
        "login": "blankname",
        "node_id": "MDQ6VXNlcjEzMzk2NQ==",
        "organizations_url": "https://api.github.com/users/blankname/orgs",
        "received_events_url": "https://api.github.com/users/blankname/received_events",
        "repos_url": "https://api.github.com/users/blankname/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/blankname/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/blankname/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/blankname"
    }
}