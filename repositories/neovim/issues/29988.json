{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nIt's not clear (to me) whose fault it is, but recent versions of OmniSharp (the C# language server) are not compatible with Neovim. After starting up nvim, OmniSharp LSP gets started, and seconds later, I see this, at the bottom of nvim window. Neovim and OmniSharp otherwise seem to behave normally, and the error doesn't appear to reoccur after startup.\r\n\r\n```\r\nLSP[bugged-ls]: Error INVALID_SERVER_MESSAGE: nil\r\n```\r\n\r\nThe occurrence of this error seems to correlate with the size of the project. With a test project of a single file, I never saw the error. With 2 files, it is rare. With 100 files, it almost always occurred.\r\n\r\nThere is a bug report in OmniSharp repo, about the same thing: https://github.com/OmniSharp/omnisharp-roslyn/issues/2574 - but it's not apparent that either anyone is working or it, or that it's even OmniSharp's problem.\r\n\r\nCould it be that OmniSharp is behaving according to LSP spec, but nvim fails to understand its valid messages? After all, this issue doesn't appear to happen on Helix or VSCode.\r\n\r\nOr else, if OmniSharp is not behaving by the spec, then we should point out what exactly nvim dislikes about OmniSharp's messages.\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n1. Create a new C# application: `mkdir omnitest; cd omnitest; dotnet new console; touch .editorconfig`\r\n2. Add some files with Bash: `for i in $(seq 1 100); do echo -e \"namespace Test;\\nclass Stuff$i { public static int Add(int x, int y) => $i + x - y; }\" > Stuff$i.cs ; done`\r\n3. Start `nvim -u ~/minimal_init.lua Program.cs`, wait for < 10 seconds, and observe the error down where the `:` commands of Vim normally are.\r\n\r\n```lua\r\n--- CHANGE THESE\r\nlocal pattern = 'cs'\r\n\r\n-- Follow this guide to build a working version of OmniSharp:\r\n-- https://github.com/OmniSharp/omnisharp-roslyn/issues/2574#issuecomment-2246390939\r\n-- local cmd = {'/path/to/omnisharp-roslyn/bin/Release/OmniSharp.Stdio.Driver/net6.0/OmniSharp', '--languageserver', '-v'}\r\nlocal cmd = {'OmniSharp', '--languageserver', '-v'} -- the default one is failing\r\n\r\n-- Add files/folders here that indicate the root of a project\r\nlocal root_markers = {'.git', '.editorconfig'}\r\n-- Change to table with settings if required\r\nlocal settings = vim.empty_dict()\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'bugged-ls',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings\r\n    })\r\n  end\r\n})\r\n\r\nvim.lsp.set_log_level(\"debug\")\r\n```\r\n\r\n### Expected behavior\r\n\r\nAs written in https://github.com/OmniSharp/omnisharp-roslyn/issues/2574#issuecomment-2246390939\r\none can \"fix\" the problem by reverting a single file in OmniSharp repository. When I do, the error disappears.\r\nI've attached a log of the \"reverted\" case, for comparison.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nNVIM v0.11.0-dev-578+gb04b263e1f\r\n\r\n### Language server name/version\r\n\r\nOmniSharp, newer than b2e64c6\r\n\r\n### Operating system/version\r\n\r\nArch Linux\r\n\r\n### Log file\r\n\r\nhttps://gist.github.com/cizra/e0b5b1c019bd56cd6d2304c547cd53d4",
    "closed_at": "2024-08-06T17:58:49Z",
    "comment_data": [
        {
            "author_association": "MEMBER",
            "body": "Looks like a duplicate of #27395",
            "created_at": "2024-08-06T17:50:22Z",
            "html_url": "https://github.com/neovim/neovim/issues/29988#issuecomment-2271829640",
            "id": 2271829640,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29988",
            "node_id": "IC_kwDOAPphoM6HaV6I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 2,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 2,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2271829640/reactions"
            },
            "updated_at": "2024-08-06T17:50:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2271829640",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/62502207?v=4",
                "events_url": "https://api.github.com/users/MariaSolOs/events{/privacy}",
                "followers_url": "https://api.github.com/users/MariaSolOs/followers",
                "following_url": "https://api.github.com/users/MariaSolOs/following{/other_user}",
                "gists_url": "https://api.github.com/users/MariaSolOs/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/MariaSolOs",
                "id": 62502207,
                "login": "MariaSolOs",
                "node_id": "MDQ6VXNlcjYyNTAyMjA3",
                "organizations_url": "https://api.github.com/users/MariaSolOs/orgs",
                "received_events_url": "https://api.github.com/users/MariaSolOs/received_events",
                "repos_url": "https://api.github.com/users/MariaSolOs/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/MariaSolOs/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/MariaSolOs/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/MariaSolOs"
            }
        }
    ],
    "comments": 1,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29988/comments",
    "created_at": "2024-08-06T08:03:37Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29988/events",
    "html_url": "https://github.com/neovim/neovim/issues/29988",
    "id": 2450221650,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29988/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6SC2pS",
    "number": 29988,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29988/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "not_planned",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29988/timeline",
    "title": "Recent versions of OmniSharp cause `LSP[bugged-ls]: Error INVALID_SERVER_MESSAGE: nil`",
    "updated_at": "2024-08-06T21:44:21Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29988",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/2131991?v=4",
        "events_url": "https://api.github.com/users/cizra/events{/privacy}",
        "followers_url": "https://api.github.com/users/cizra/followers",
        "following_url": "https://api.github.com/users/cizra/following{/other_user}",
        "gists_url": "https://api.github.com/users/cizra/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/cizra",
        "id": 2131991,
        "login": "cizra",
        "node_id": "MDQ6VXNlcjIxMzE5OTE=",
        "organizations_url": "https://api.github.com/users/cizra/orgs",
        "received_events_url": "https://api.github.com/users/cizra/received_events",
        "repos_url": "https://api.github.com/users/cizra/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/cizra/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/cizra/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/cizra"
    }
}