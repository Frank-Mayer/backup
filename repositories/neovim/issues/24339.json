{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "### Problem\r\n\r\nIf a file does not have a newline at end of file then inlay hints are not working and rust-analyzer sends an error\r\nmessage: `rust-analyzer: -32603: Invalid offset`\r\n\r\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\r\n\r\n<details>\r\n\r\n<summary>Minimal configuration</summary>\r\n\r\n```lua\r\nlocal pattern = 'rust'\r\nlocal cmd = {'rust-analyzer'}\r\nlocal root_markers = {'.git', '.editorconfig', 'Cargo.toml'}\r\nlocal settings = vim.empty_dict()\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'rust-analyzer',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings\r\n    })\r\n  end\r\n})\r\n\r\nvim.api.nvim_create_autocmd('LspAttach', {\r\n    group = vim.api.nvim_create_augroup('InlayHintsAttach', {}),\r\n    callback = function(args)\r\n      local buf = args.buf\r\n      vim.lsp.inlay_hint(buf, true)\r\n    end,\r\n})\r\n```\r\n\r\n</details>\r\n\r\n1. Create an executable crate: `cargo new hints`\r\n2. Write some code that should display inlay hints, e.g. `let x = 12;`\r\n3. Delete the newline somehow, I did that using `vscode`\r\n4. Open `main.rs`\r\n5. Observe an error and no inlay hints\r\n\r\n\r\n### Expected behavior\r\n\r\nWorking inlay hints and no error message.\r\n\r\n### Neovim version (nvim -v)\r\n\r\nv0.10.0-dev-664+g0ce391086\r\n\r\n### Language server name/version\r\n\r\nrust-analyzer 0.3.1583-standalone (2023-07-10)\r\n\r\n### Operating system/version\r\n\r\nWindows 11, WSL2\r\n\r\n### Log file\r\n\r\nNo log messages produced",
    "closed_at": null,
    "comment_data": [
        {
            "author_association": "NONE",
            "body": "I just did some little tests, this problem seems to be specific to `rust-analyzer`, `clangd`, `gopls` and `tsserver` all show no error and display inlay hints correctly after deleting the `0x0A` at the end of a file (at least in my side).",
            "created_at": "2023-07-14T08:47:09Z",
            "html_url": "https://github.com/neovim/neovim/issues/24339#issuecomment-1635521466",
            "id": 1635521466,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24339",
            "node_id": "IC_kwDOAPphoM5hfBO6",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1635521466/reactions"
            },
            "updated_at": "2023-07-14T09:01:30Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1635521466",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/57218218?v=4",
                "events_url": "https://api.github.com/users/TinusgragLin/events{/privacy}",
                "followers_url": "https://api.github.com/users/TinusgragLin/followers",
                "following_url": "https://api.github.com/users/TinusgragLin/following{/other_user}",
                "gists_url": "https://api.github.com/users/TinusgragLin/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TinusgragLin",
                "id": 57218218,
                "login": "TinusgragLin",
                "node_id": "MDQ6VXNlcjU3MjE4MjE4",
                "organizations_url": "https://api.github.com/users/TinusgragLin/orgs",
                "received_events_url": "https://api.github.com/users/TinusgragLin/received_events",
                "repos_url": "https://api.github.com/users/TinusgragLin/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TinusgragLin/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TinusgragLin/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/TinusgragLin"
            }
        },
        {
            "author_association": "NONE",
            "body": "When I deleted the entire content of the rs file using `ggdG`, I encountered the same error, possibly due to the same reason.",
            "created_at": "2023-08-01T09:37:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/24339#issuecomment-1659944971",
            "id": 1659944971,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/24339",
            "node_id": "IC_kwDOAPphoM5i8MAL",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1659944971/reactions"
            },
            "updated_at": "2023-08-01T09:37:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/1659944971",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/59051928?v=4",
                "events_url": "https://api.github.com/users/ifyuhj/events{/privacy}",
                "followers_url": "https://api.github.com/users/ifyuhj/followers",
                "following_url": "https://api.github.com/users/ifyuhj/following{/other_user}",
                "gists_url": "https://api.github.com/users/ifyuhj/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/ifyuhj",
                "id": 59051928,
                "login": "ifyuhj",
                "node_id": "MDQ6VXNlcjU5MDUxOTI4",
                "organizations_url": "https://api.github.com/users/ifyuhj/orgs",
                "received_events_url": "https://api.github.com/users/ifyuhj/received_events",
                "repos_url": "https://api.github.com/users/ifyuhj/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/ifyuhj/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/ifyuhj/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/ifyuhj"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/24339/comments",
    "created_at": "2023-07-13T15:14:01Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/24339/events",
    "html_url": "https://github.com/neovim/neovim/issues/24339",
    "id": 1803244624,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "BFDADC",
            "default": false,
            "description": "Low-risk, unlikely to cause distant/indirect damage",
            "id": 407246773,
            "name": "complexity:low",
            "node_id": "MDU6TGFiZWw0MDcyNDY3NzM=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/complexity:low"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/24339/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": null,
        "closed_issues": 569,
        "created_at": "2014-05-10T20:43:04Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/1359421?v=4",
            "events_url": "https://api.github.com/users/justinmk/events{/privacy}",
            "followers_url": "https://api.github.com/users/justinmk/followers",
            "following_url": "https://api.github.com/users/justinmk/following{/other_user}",
            "gists_url": "https://api.github.com/users/justinmk/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/justinmk",
            "id": 1359421,
            "login": "justinmk",
            "node_id": "MDQ6VXNlcjEzNTk0MjE=",
            "organizations_url": "https://api.github.com/users/justinmk/orgs",
            "received_events_url": "https://api.github.com/users/justinmk/received_events",
            "repos_url": "https://api.github.com/users/justinmk/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/justinmk/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/justinmk/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/justinmk"
        },
        "description": "Low priority. Not planned for the current target, may be reassigned.",
        "due_on": null,
        "html_url": "https://github.com/neovim/neovim/milestone/6",
        "id": 655037,
        "labels_url": "https://api.github.com/repos/neovim/neovim/milestones/6/labels",
        "node_id": "MDk6TWlsZXN0b25lNjU1MDM3",
        "number": 6,
        "open_issues": 411,
        "state": "open",
        "title": "backlog",
        "updated_at": "2023-08-01T09:59:58Z",
        "url": "https://api.github.com/repos/neovim/neovim/milestones/6"
    },
    "node_id": "I_kwDOAPphoM5re1RQ",
    "number": 24339,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/24339/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "open",
    "state_reason": null,
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/24339/timeline",
    "title": "Inlay hints not working if a file does not have a newline at end of file",
    "updated_at": "2023-08-01T10:00:02Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/24339",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/61948252?v=4",
        "events_url": "https://api.github.com/users/lostl1ght/events{/privacy}",
        "followers_url": "https://api.github.com/users/lostl1ght/followers",
        "following_url": "https://api.github.com/users/lostl1ght/following{/other_user}",
        "gists_url": "https://api.github.com/users/lostl1ght/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/lostl1ght",
        "id": 61948252,
        "login": "lostl1ght",
        "node_id": "MDQ6VXNlcjYxOTQ4MjUy",
        "organizations_url": "https://api.github.com/users/lostl1ght/orgs",
        "received_events_url": "https://api.github.com/users/lostl1ght/received_events",
        "repos_url": "https://api.github.com/users/lostl1ght/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/lostl1ght/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/lostl1ght/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/lostl1ght"
    }
}