{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "body": "### Problem\n\nText edits returned from the LSP that have the same start position are being applied in reverse. For example:\r\n\r\nFor the following dummy text,\r\n```elixir\r\ndefmodule Dummy do\r\n  alias B\r\n  alias A\r\n\r\n  def hello do\r\n  end\r\nend\r\n```\r\n\r\nand following edits:\r\n```\r\n[DEBUG][2024-06-02 08:39:45] .../vim/lsp/rpc.lua:387\t\"rpc.receive\"\t{\r\n  id = 10,\r\n  jsonrpc = \"2.0\",\r\n  result = { {\r\n      edit = {\r\n        changes = {\r\n          [\"file:///Users/scottming/Code/dummy/lib/dummy.ex\"] = { {\r\n              newText = \"\",\r\n              range = {\r\n                [\"end\"] = {\r\n                  character = 0,\r\n                  line = 3\r\n                },\r\n                start = {\r\n                  character = 0,\r\n                  line = 2\r\n                }\r\n              }\r\n            }, {\r\n              newText = \"\\n\",\r\n              range = {\r\n                [\"end\"] = {\r\n                  character = 0,\r\n                  line = 2\r\n                },\r\n                start = {\r\n                  character = 0,\r\n                  line = 1\r\n                }\r\n              }\r\n            }, {\r\n              newText = \"  alias A\\n  alias B\",\r\n              range = {\r\n                [\"end\"] = {\r\n                  character = 0,\r\n                  line = 1\r\n                },\r\n                start = {\r\n                  character = 0,\r\n                  line = 1\r\n                }\r\n              }\r\n            } }\r\n        }\r\n      },\r\n      kind = \"source.organizeImports\",\r\n      title = \"Organize aliases\"\r\n    } }\r\n}\r\n```\r\n\r\nResults in the following:\r\n```elixir\r\ndefmodule Dummy do\r\n\r\n  alias B  alias B\r\n\r\n  def hello do\r\n  end\r\nend\r\n```\r\n\r\nAccording to the [spec](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textEditArray), text edits with the same start position should be applied in the order received.\r\n\r\nAlso, in the [vscode implementation](https://github.com/microsoft/vscode-languageserver-node/blob/main/textDocument/src/main.ts#L371), similar start position text edits aren't sorted in reverse order\r\n\r\nAdditional context can be found on an issue filed on the lexical repo\r\nhttps://github.com/lexical-lsp/lexical/issues/765\r\n\n\n### Steps to reproduce using \"nvim -u minimal_init.lua\"\n\nUsing this minimal init,\r\n```lua\r\n--- CHANGE THESE\r\nlocal pattern = { 'elixir', 'eelixir' }\r\nlocal cmd = { '/path/to/lexical/_build/dev/package/lexical/bin/start_lexical.sh' }\r\n-- Add files/folders here that indicate the root of a project\r\nlocal root_markers = { '.git', '.editorconfig' }\r\n-- Change to table with settings if required\r\nlocal settings = vim.empty_dict()\r\n\r\nvim.api.nvim_create_autocmd('FileType', {\r\n  pattern = pattern,\r\n  callback = function(args)\r\n    local match = vim.fs.find(root_markers, { path = args.file, upward = true })[1]\r\n    local root_dir = match and vim.fn.fnamemodify(match, ':p:h') or nil\r\n    vim.lsp.start({\r\n      name = 'bugged-ls',\r\n      cmd = cmd,\r\n      root_dir = root_dir,\r\n      settings = settings,\r\n    })\r\n  end,\r\n})\r\n```\r\n\r\nand this dummy file:\r\n```elixir\r\n# dummy.exs\r\ndefmodule Dummy do\r\n  alias B\r\n  alias A\r\n\r\n  def hello do\r\n  end\r\nend\r\n```\r\n\r\n1. Open up the dummy file with the command `nvim -u minimal_init.lua dummy.exs`\r\n2. Navigate to the first alias and run the command `:lua vim.lsp.buf.code_action()`\r\n3. Run the `Organize aliases` code action to sort the aliases\r\n\n\n### Expected behavior\n\nThe code action should result in the file:\r\n```elixir\r\n# dummy.exs\r\ndefmodule Dummy do\r\n  alias A\r\n  alias B\r\n\r\n  def hello do\r\n  end\r\nend\r\n```\r\n\n\n### Neovim version (nvim -v)\n\nv0.10.0 release\n\n### Language server name/version\n\nlexical v0.6.1\n\n### Operating system/version\n\nmacos 14.4.1\n\n### Log file\n\nhttps://gist.github.com/alcolmenar/fd784a80a8f91c6a254e74cb3c1ed3b6",
    "closed_at": "2024-06-07T09:54:44Z",
    "comment_data": [
        {
            "author_association": "CONTRIBUTOR",
            "body": "If possible, I'd like to take this issue on if the team decides that it should be fixed.",
            "created_at": "2024-06-05T07:46:41Z",
            "html_url": "https://github.com/neovim/neovim/issues/29202#issuecomment-2149111609",
            "id": 2149111609,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29202",
            "node_id": "IC_kwDOAPphoM6AGNc5",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2149111609/reactions"
            },
            "updated_at": "2024-06-05T07:47:22Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2149111609",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/57642956?v=4",
                "events_url": "https://api.github.com/users/alcolmenar/events{/privacy}",
                "followers_url": "https://api.github.com/users/alcolmenar/followers",
                "following_url": "https://api.github.com/users/alcolmenar/following{/other_user}",
                "gists_url": "https://api.github.com/users/alcolmenar/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/alcolmenar",
                "id": 57642956,
                "login": "alcolmenar",
                "node_id": "MDQ6VXNlcjU3NjQyOTU2",
                "organizations_url": "https://api.github.com/users/alcolmenar/orgs",
                "received_events_url": "https://api.github.com/users/alcolmenar/received_events",
                "repos_url": "https://api.github.com/users/alcolmenar/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/alcolmenar/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/alcolmenar/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/alcolmenar"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> If possible, I'd like to take this issue on if the team decides that it should be fixed.\r\n\r\nSounds like a bug so yes, a PR with a fix and a test case would be great",
            "created_at": "2024-06-05T10:49:42Z",
            "html_url": "https://github.com/neovim/neovim/issues/29202#issuecomment-2149489304",
            "id": 2149489304,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29202",
            "node_id": "IC_kwDOAPphoM6AHpqY",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2149489304/reactions"
            },
            "updated_at": "2024-06-05T10:49:42Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2149489304",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/38700?v=4",
                "events_url": "https://api.github.com/users/mfussenegger/events{/privacy}",
                "followers_url": "https://api.github.com/users/mfussenegger/followers",
                "following_url": "https://api.github.com/users/mfussenegger/following{/other_user}",
                "gists_url": "https://api.github.com/users/mfussenegger/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mfussenegger",
                "id": 38700,
                "login": "mfussenegger",
                "node_id": "MDQ6VXNlcjM4NzAw",
                "organizations_url": "https://api.github.com/users/mfussenegger/orgs",
                "received_events_url": "https://api.github.com/users/mfussenegger/received_events",
                "repos_url": "https://api.github.com/users/mfussenegger/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mfussenegger/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mfussenegger/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mfussenegger"
            }
        },
        {
            "author_association": "NONE",
            "body": "Hi there, I'm the author of an LS for elixir, and I'm actually wondering why you're sorting the edits at all, since the spec declares that the order of the edits can be important.  Sorting the text edits seems incorrect to me, since language servers are putting them in the order they send them for a reason. ",
            "created_at": "2024-06-06T15:47:37Z",
            "html_url": "https://github.com/neovim/neovim/issues/29202#issuecomment-2152858969",
            "id": 2152858969,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29202",
            "node_id": "IC_kwDOAPphoM6AUgVZ",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2152858969/reactions"
            },
            "updated_at": "2024-06-06T15:47:50Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2152858969",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/55809?v=4",
                "events_url": "https://api.github.com/users/scohen/events{/privacy}",
                "followers_url": "https://api.github.com/users/scohen/followers",
                "following_url": "https://api.github.com/users/scohen/following{/other_user}",
                "gists_url": "https://api.github.com/users/scohen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scohen",
                "id": 55809,
                "login": "scohen",
                "node_id": "MDQ6VXNlcjU1ODA5",
                "organizations_url": "https://api.github.com/users/scohen/orgs",
                "received_events_url": "https://api.github.com/users/scohen/received_events",
                "repos_url": "https://api.github.com/users/scohen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scohen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scohen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scohen"
            }
        },
        {
            "author_association": "NONE",
            "body": "@mfussenegger Can you please explain the thinking behind reordering the list of changes the language servers send you?",
            "created_at": "2024-06-07T23:33:18Z",
            "html_url": "https://github.com/neovim/neovim/issues/29202#issuecomment-2155694824",
            "id": 2155694824,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29202",
            "node_id": "IC_kwDOAPphoM6AfUro",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2155694824/reactions"
            },
            "updated_at": "2024-06-07T23:33:18Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2155694824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/55809?v=4",
                "events_url": "https://api.github.com/users/scohen/events{/privacy}",
                "followers_url": "https://api.github.com/users/scohen/followers",
                "following_url": "https://api.github.com/users/scohen/following{/other_user}",
                "gists_url": "https://api.github.com/users/scohen/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/scohen",
                "id": 55809,
                "login": "scohen",
                "node_id": "MDQ6VXNlcjU1ODA5",
                "organizations_url": "https://api.github.com/users/scohen/orgs",
                "received_events_url": "https://api.github.com/users/scohen/received_events",
                "repos_url": "https://api.github.com/users/scohen/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/scohen/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/scohen/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/scohen"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Thank you. @alcolmenar \r\nIt seems that was my mistake.\r\n\r\nAs far as I know, neovim has a policy of complying with the LSP specifications, but TextEdit is implemented based on the behavior of VSCode.",
            "created_at": "2024-06-08T07:05:10Z",
            "html_url": "https://github.com/neovim/neovim/issues/29202#issuecomment-2155847000",
            "id": 2155847000,
            "issue_url": "https://api.github.com/repos/neovim/neovim/issues/29202",
            "node_id": "IC_kwDOAPphoM6Af51Y",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2155847000/reactions"
            },
            "updated_at": "2024-06-08T07:05:10Z",
            "url": "https://api.github.com/repos/neovim/neovim/issues/comments/2155847000",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/629908?v=4",
                "events_url": "https://api.github.com/users/hrsh7th/events{/privacy}",
                "followers_url": "https://api.github.com/users/hrsh7th/followers",
                "following_url": "https://api.github.com/users/hrsh7th/following{/other_user}",
                "gists_url": "https://api.github.com/users/hrsh7th/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/hrsh7th",
                "id": 629908,
                "login": "hrsh7th",
                "node_id": "MDQ6VXNlcjYyOTkwOA==",
                "organizations_url": "https://api.github.com/users/hrsh7th/orgs",
                "received_events_url": "https://api.github.com/users/hrsh7th/received_events",
                "repos_url": "https://api.github.com/users/hrsh7th/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/hrsh7th/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/hrsh7th/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/hrsh7th"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/neovim/neovim/issues/29202/comments",
    "created_at": "2024-06-05T07:43:03Z",
    "events_url": "https://api.github.com/repos/neovim/neovim/issues/29202/events",
    "html_url": "https://github.com/neovim/neovim/issues/29202",
    "id": 2335147478,
    "labels": [
        {
            "color": "f9d0c4",
            "default": true,
            "description": "issues reporting wrong behavior",
            "id": 77997474,
            "name": "bug",
            "node_id": "MDU6TGFiZWw3Nzk5NzQ3NA==",
            "url": "https://api.github.com/repos/neovim/neovim/labels/bug"
        },
        {
            "color": "c5def5",
            "default": false,
            "description": null,
            "id": 662566370,
            "name": "lsp",
            "node_id": "MDU6TGFiZWw2NjI1NjYzNzA=",
            "url": "https://api.github.com/repos/neovim/neovim/labels/lsp"
        }
    ],
    "labels_url": "https://api.github.com/repos/neovim/neovim/issues/29202/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOAPphoM6LL4XW",
    "number": 29202,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/neovim/neovim/issues/29202/reactions"
    },
    "repository_url": "https://api.github.com/repos/neovim/neovim",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/neovim/neovim/issues/29202/timeline",
    "title": "Text edits with the same start position are applied in reverse",
    "updated_at": "2024-06-08T07:05:11Z",
    "url": "https://api.github.com/repos/neovim/neovim/issues/29202",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/57642956?v=4",
        "events_url": "https://api.github.com/users/alcolmenar/events{/privacy}",
        "followers_url": "https://api.github.com/users/alcolmenar/followers",
        "following_url": "https://api.github.com/users/alcolmenar/following{/other_user}",
        "gists_url": "https://api.github.com/users/alcolmenar/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/alcolmenar",
        "id": 57642956,
        "login": "alcolmenar",
        "node_id": "MDQ6VXNlcjU3NjQyOTU2",
        "organizations_url": "https://api.github.com/users/alcolmenar/orgs",
        "received_events_url": "https://api.github.com/users/alcolmenar/received_events",
        "repos_url": "https://api.github.com/users/alcolmenar/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/alcolmenar/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/alcolmenar/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/alcolmenar"
    }
}