{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/neovim/go-client/issues/95/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/neovim/go-client/pulls/95/commits"
        },
        "html": {
            "href": "https://github.com/neovim/go-client/pull/95"
        },
        "issue": {
            "href": "https://api.github.com/repos/neovim/go-client/issues/95"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/neovim/go-client/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/neovim/go-client/pulls/95/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
        },
        "statuses": {
            "href": "https://api.github.com/repos/neovim/go-client/statuses/2732b5d58f09a87c89084d5f12ab3469d9cb28d9"
        }
    },
    "active_lock_reason": null,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6366270?v=4",
        "events_url": "https://api.github.com/users/zchee/events{/privacy}",
        "followers_url": "https://api.github.com/users/zchee/followers",
        "following_url": "https://api.github.com/users/zchee/following{/other_user}",
        "gists_url": "https://api.github.com/users/zchee/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zchee",
        "id": 6366270,
        "login": "zchee",
        "node_id": "MDQ6VXNlcjYzNjYyNzA=",
        "organizations_url": "https://api.github.com/users/zchee/orgs",
        "received_events_url": "https://api.github.com/users/zchee/received_events",
        "repos_url": "https://api.github.com/users/zchee/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zchee/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zchee/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zchee"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/6366270?v=4",
            "events_url": "https://api.github.com/users/zchee/events{/privacy}",
            "followers_url": "https://api.github.com/users/zchee/followers",
            "following_url": "https://api.github.com/users/zchee/following{/other_user}",
            "gists_url": "https://api.github.com/users/zchee/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zchee",
            "id": 6366270,
            "login": "zchee",
            "node_id": "MDQ6VXNlcjYzNjYyNzA=",
            "organizations_url": "https://api.github.com/users/zchee/orgs",
            "received_events_url": "https://api.github.com/users/zchee/received_events",
            "repos_url": "https://api.github.com/users/zchee/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zchee/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zchee/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zchee"
        }
    ],
    "author_association": "MEMBER",
    "auto_merge": null,
    "base": {
        "label": "neovim:main",
        "ref": "main",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/go-client/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/go-client/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/go-client/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/go-client/branches{/branch}",
            "clone_url": "https://github.com/neovim/go-client.git",
            "collaborators_url": "https://api.github.com/repos/neovim/go-client/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/go-client/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/go-client/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/go-client/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/go-client/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/go-client/contributors",
            "created_at": "2014-11-13T12:30:33Z",
            "default_branch": "main",
            "deployments_url": "https://api.github.com/repos/neovim/go-client/deployments",
            "description": "Nvim Go client",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/go-client/downloads",
            "events_url": "https://api.github.com/repos/neovim/go-client/events",
            "fork": false,
            "forks": 37,
            "forks_count": 37,
            "forks_url": "https://api.github.com/repos/neovim/go-client/forks",
            "full_name": "neovim/go-client",
            "git_commits_url": "https://api.github.com/repos/neovim/go-client/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/go-client/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/go-client/git/tags{/sha}",
            "git_url": "git://github.com/neovim/go-client.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": false,
            "has_wiki": false,
            "homepage": "https://pkg.go.dev/github.com/neovim/go-client",
            "hooks_url": "https://api.github.com/repos/neovim/go-client/hooks",
            "html_url": "https://github.com/neovim/go-client",
            "id": 26586823,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/go-client/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/go-client/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/go-client/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/go-client/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/go-client/labels{/name}",
            "language": "Go",
            "languages_url": "https://api.github.com/repos/neovim/go-client/languages",
            "license": {
                "key": "apache-2.0",
                "name": "Apache License 2.0",
                "node_id": "MDc6TGljZW5zZTI=",
                "spdx_id": "Apache-2.0",
                "url": "https://api.github.com/licenses/apache-2.0"
            },
            "merges_url": "https://api.github.com/repos/neovim/go-client/merges",
            "milestones_url": "https://api.github.com/repos/neovim/go-client/milestones{/number}",
            "mirror_url": null,
            "name": "go-client",
            "node_id": "MDEwOlJlcG9zaXRvcnkyNjU4NjgyMw==",
            "notifications_url": "https://api.github.com/repos/neovim/go-client/notifications{?since,all,participating}",
            "open_issues": 15,
            "open_issues_count": 15,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/go-client/pulls{/number}",
            "pushed_at": "2024-05-13T21:25:19Z",
            "releases_url": "https://api.github.com/repos/neovim/go-client/releases{/id}",
            "size": 1000,
            "ssh_url": "git@github.com:neovim/go-client.git",
            "stargazers_count": 546,
            "stargazers_url": "https://api.github.com/repos/neovim/go-client/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/go-client/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/go-client/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/go-client/subscription",
            "svn_url": "https://github.com/neovim/go-client",
            "tags_url": "https://api.github.com/repos/neovim/go-client/tags",
            "teams_url": "https://api.github.com/repos/neovim/go-client/teams",
            "topics": [
                "go",
                "go-client",
                "msgpack",
                "neovim",
                "neovim-plugin"
            ],
            "trees_url": "https://api.github.com/repos/neovim/go-client/git/trees{/sha}",
            "updated_at": "2024-05-13T11:50:37Z",
            "url": "https://api.github.com/repos/neovim/go-client",
            "visibility": "public",
            "watchers": 546,
            "watchers_count": 546,
            "web_commit_signoff_required": false
        },
        "sha": "7c85d516f28cd3ef8209a6630ee42f3712be01c8",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "body": "Optimize `msgpack` package.",
    "closed_at": null,
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/go-client/pull/95#discussion_r972425387"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/comments/972425387"
                }
            },
            "author_association": "NONE",
            "body": "Can you elaborate on that? I've seen bounds checks (namely the std lib) to guard a specific length of a slice, but not ever like this",
            "commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "created_at": "2022-09-15T21:14:16Z",
            "diff_hunk": "@@ -74,6 +74,8 @@ func collectFields(fields []*field, t reflect.Type, visited map[reflect.Type]boo\n \t\t}\n \n \t\tif len(index) == d {\n+\t\t\t_ = fields[len(fields)-1] // bounds check hint to compiler",
            "html_url": "https://github.com/neovim/go-client/pull/95#discussion_r972425387",
            "id": 972425387,
            "line": 77,
            "node_id": "PRRC_kwDOAZWux8459gir",
            "original_commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "original_line": 77,
            "original_position": 4,
            "original_start_line": null,
            "path": "msgpack/field.go",
            "position": 4,
            "pull_request_review_id": 1109842858,
            "pull_request_url": "https://api.github.com/repos/neovim/go-client/pulls/95",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/972425387/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-09-15T21:14:17Z",
            "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/972425387",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48822818?v=4",
                "events_url": "https://api.github.com/users/nieomylnieja/events{/privacy}",
                "followers_url": "https://api.github.com/users/nieomylnieja/followers",
                "following_url": "https://api.github.com/users/nieomylnieja/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieomylnieja/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nieomylnieja",
                "id": 48822818,
                "login": "nieomylnieja",
                "node_id": "MDQ6VXNlcjQ4ODIyODE4",
                "organizations_url": "https://api.github.com/users/nieomylnieja/orgs",
                "received_events_url": "https://api.github.com/users/nieomylnieja/received_events",
                "repos_url": "https://api.github.com/users/nieomylnieja/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nieomylnieja/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieomylnieja/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nieomylnieja"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/go-client/pull/95#discussion_r972429447"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/comments/972429447"
                }
            },
            "author_association": "MEMBER",
            "body": "This commit is very old so I don't remember that, but IIRC scope is `for i := 0; i < len(fields); i++`.",
            "commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "created_at": "2022-09-15T21:20:35Z",
            "diff_hunk": "@@ -74,6 +74,8 @@ func collectFields(fields []*field, t reflect.Type, visited map[reflect.Type]boo\n \t\t}\n \n \t\tif len(index) == d {\n+\t\t\t_ = fields[len(fields)-1] // bounds check hint to compiler",
            "html_url": "https://github.com/neovim/go-client/pull/95#discussion_r972429447",
            "id": 972429447,
            "in_reply_to_id": 972425387,
            "line": 77,
            "node_id": "PRRC_kwDOAZWux8459hiH",
            "original_commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "original_line": 77,
            "original_position": 4,
            "original_start_line": null,
            "path": "msgpack/field.go",
            "position": 4,
            "pull_request_review_id": 1109848519,
            "pull_request_url": "https://api.github.com/repos/neovim/go-client/pulls/95",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/972429447/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-09-15T21:20:35Z",
            "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/972429447",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6366270?v=4",
                "events_url": "https://api.github.com/users/zchee/events{/privacy}",
                "followers_url": "https://api.github.com/users/zchee/followers",
                "following_url": "https://api.github.com/users/zchee/following{/other_user}",
                "gists_url": "https://api.github.com/users/zchee/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zchee",
                "id": 6366270,
                "login": "zchee",
                "node_id": "MDQ6VXNlcjYzNjYyNzA=",
                "organizations_url": "https://api.github.com/users/zchee/orgs",
                "received_events_url": "https://api.github.com/users/zchee/received_events",
                "repos_url": "https://api.github.com/users/zchee/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zchee/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zchee/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zchee"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/go-client/pull/95#discussion_r973008323"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/comments/973008323"
                }
            },
            "author_association": "NONE",
            "body": "yeah, but when do you expect `len(fields)` to go out of bounds? Usually I've seen bound checks like these guard a slice of unknown length when we're explicitly accessing certain indexes like this:\r\n\r\n```go\r\nfunc someFunc(s []string) {\r\n  _ = s[1]\r\n  s[0] = \"hey\"\r\n  s[1] = \"test!\"\r\n}\r\n```\r\n\r\nWhile what you've done here is you're not guarding an explicit length like: `_ = fields[3]` but guarding the size which is restricted by the language itself, that is: the last index has to be `len(slice)-1`, there's no other way. It seems completely redundant to me and confusing.\r\n\r\nAm I missing something? :) ",
            "commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "created_at": "2022-09-16T13:10:33Z",
            "diff_hunk": "@@ -74,6 +74,8 @@ func collectFields(fields []*field, t reflect.Type, visited map[reflect.Type]boo\n \t\t}\n \n \t\tif len(index) == d {\n+\t\t\t_ = fields[len(fields)-1] // bounds check hint to compiler",
            "html_url": "https://github.com/neovim/go-client/pull/95#discussion_r973008323",
            "id": 973008323,
            "in_reply_to_id": 972425387,
            "line": 77,
            "node_id": "PRRC_kwDOAZWux845_u3D",
            "original_commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "original_line": 77,
            "original_position": 4,
            "original_start_line": null,
            "path": "msgpack/field.go",
            "position": 4,
            "pull_request_review_id": 1110660876,
            "pull_request_url": "https://api.github.com/repos/neovim/go-client/pulls/95",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973008323/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-09-16T13:10:33Z",
            "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973008323",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48822818?v=4",
                "events_url": "https://api.github.com/users/nieomylnieja/events{/privacy}",
                "followers_url": "https://api.github.com/users/nieomylnieja/followers",
                "following_url": "https://api.github.com/users/nieomylnieja/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieomylnieja/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nieomylnieja",
                "id": 48822818,
                "login": "nieomylnieja",
                "node_id": "MDQ6VXNlcjQ4ODIyODE4",
                "organizations_url": "https://api.github.com/users/nieomylnieja/orgs",
                "received_events_url": "https://api.github.com/users/nieomylnieja/received_events",
                "repos_url": "https://api.github.com/users/nieomylnieja/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nieomylnieja/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieomylnieja/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nieomylnieja"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/go-client/pull/95#discussion_r973116164"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/comments/973116164"
                }
            },
            "author_association": "MEMBER",
            "body": "I'll re-detect where is BCE optimized using `-gcflags='-d=ssa/check_bce/debug=3'`.\r\n\r\nBut in context of language specifications, the `fields` value is not array, actual type is slice. It means, the gc compiler (still can't optimization? I don't know) might be imagine will growing slice. And actually we also can grow `fields` slice after the BCE'ed place.\r\n\r\ne.g., `encoding/binary` package is `return` byte slice immediately after the BCE place, but this msgpack packages logic is used `for` loop (and etc) after the BCE place, therefore works BCE optimization. (above is my current imagine. I'll verify again that the BCE is working properly when I have time anyway.)",
            "commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "created_at": "2022-09-16T14:55:10Z",
            "diff_hunk": "@@ -74,6 +74,8 @@ func collectFields(fields []*field, t reflect.Type, visited map[reflect.Type]boo\n \t\t}\n \n \t\tif len(index) == d {\n+\t\t\t_ = fields[len(fields)-1] // bounds check hint to compiler",
            "html_url": "https://github.com/neovim/go-client/pull/95#discussion_r973116164",
            "id": 973116164,
            "in_reply_to_id": 972425387,
            "line": 77,
            "node_id": "PRRC_kwDOAZWux846AJME",
            "original_commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "original_line": 77,
            "original_position": 4,
            "original_start_line": null,
            "path": "msgpack/field.go",
            "position": 4,
            "pull_request_review_id": 1110823393,
            "pull_request_url": "https://api.github.com/repos/neovim/go-client/pulls/95",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973116164/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-09-16T14:56:30Z",
            "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973116164",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6366270?v=4",
                "events_url": "https://api.github.com/users/zchee/events{/privacy}",
                "followers_url": "https://api.github.com/users/zchee/followers",
                "following_url": "https://api.github.com/users/zchee/following{/other_user}",
                "gists_url": "https://api.github.com/users/zchee/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zchee",
                "id": 6366270,
                "login": "zchee",
                "node_id": "MDQ6VXNlcjYzNjYyNzA=",
                "organizations_url": "https://api.github.com/users/zchee/orgs",
                "received_events_url": "https://api.github.com/users/zchee/received_events",
                "repos_url": "https://api.github.com/users/zchee/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zchee/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zchee/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zchee"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/neovim/go-client/pull/95#discussion_r973747824"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/95"
                },
                "self": {
                    "href": "https://api.github.com/repos/neovim/go-client/pulls/comments/973747824"
                }
            },
            "author_association": "NONE",
            "body": "interesting!\r\n\r\nStill, `fields` is not local to the `collect` function and might be manipulated after you do the bounds check so you won't really eliminate the BCE done on `fields[j] = fields[i]`, I've verified that with this whole file:\r\n\r\n- before manual bounds check:\r\n\r\n```shell\r\n$ go run -gcflags=\"-d=ssa/check_bce/debug=1\" field.go\r\n# command-line-arguments\r\n./field.go:83:12: Found IsInBounds\r\n./field.go:87:19: Found IsSliceInBounds\r\n./field.go:100:10: Found IsInBounds\r\n```\r\n\r\n- after:\r\n\r\n```shell\r\n└> go run -gcflags=\"-d=ssa/check_bce/debug=1\" field.go\r\n# command-line-arguments\r\n./field.go:78:17: Found IsInBounds\r\n./field.go:84:12: Found IsInBounds\r\n./field.go:88:19: Found IsSliceInBounds\r\n./field.go:101:10: Found IsInBounds\r\n```\r\n\r\nYou can see you've just introduced an extra check there and haven't got rid of the ones performed in the loop.\r\n\r\nCorrect me If I'm wrong and thanks a lot for answering, this is quiet interesting! :)",
            "commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "created_at": "2022-09-18T16:50:11Z",
            "diff_hunk": "@@ -74,6 +74,8 @@ func collectFields(fields []*field, t reflect.Type, visited map[reflect.Type]boo\n \t\t}\n \n \t\tif len(index) == d {\n+\t\t\t_ = fields[len(fields)-1] // bounds check hint to compiler",
            "html_url": "https://github.com/neovim/go-client/pull/95#discussion_r973747824",
            "id": 973747824,
            "in_reply_to_id": 972425387,
            "line": 77,
            "node_id": "PRRC_kwDOAZWux846CjZw",
            "original_commit_id": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
            "original_line": 77,
            "original_position": 4,
            "original_start_line": null,
            "path": "msgpack/field.go",
            "position": 4,
            "pull_request_review_id": 1111566036,
            "pull_request_url": "https://api.github.com/repos/neovim/go-client/pulls/95",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973747824/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-09-18T16:50:12Z",
            "url": "https://api.github.com/repos/neovim/go-client/pulls/comments/973747824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48822818?v=4",
                "events_url": "https://api.github.com/users/nieomylnieja/events{/privacy}",
                "followers_url": "https://api.github.com/users/nieomylnieja/followers",
                "following_url": "https://api.github.com/users/nieomylnieja/following{/other_user}",
                "gists_url": "https://api.github.com/users/nieomylnieja/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/nieomylnieja",
                "id": 48822818,
                "login": "nieomylnieja",
                "node_id": "MDQ6VXNlcjQ4ODIyODE4",
                "organizations_url": "https://api.github.com/users/nieomylnieja/orgs",
                "received_events_url": "https://api.github.com/users/nieomylnieja/received_events",
                "repos_url": "https://api.github.com/users/nieomylnieja/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/nieomylnieja/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/nieomylnieja/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/nieomylnieja"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "NONE",
            "body": "# [Codecov](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim) Report\n> Merging [#95](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim) (2732b5d) into [master](https://codecov.io/gh/neovim/go-client/commit/7c85d516f28cd3ef8209a6630ee42f3712be01c8?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim) (7c85d51) will **decrease** coverage by `0.0%`.\n> The diff coverage is `91.4%`.\n\n[![Impacted file tree graph](https://codecov.io/gh/neovim/go-client/pull/95/graphs/tree.svg?width=650&height=150&src=pr&token=hLNAnxbEWr&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim)](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim)\n\n```diff\n@@           Coverage Diff            @@\n##           master     #95     +/-   ##\n========================================\n- Coverage    80.6%   80.6%   -0.1%     \n========================================\n  Files          14      14             \n  Lines        3044    3048      +4     \n========================================\n+ Hits         2456    2457      +1     \n- Misses        588     591      +3     \n```\n\n| Flag | Coverage Δ | |\n|---|---|---|\n| linux-1.15-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| linux-1.15-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| linux-1.16-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| linux-1.16-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| linux-1.17-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| linux-1.17-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.15-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.15-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.16-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.16-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.17-nightly | `80.5% <91.4%> (-0.1%)` | :arrow_down: |\n| macos-1.17-stable | `79.8% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.15-nightly | `79.7% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.15-stable | `78.9% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.16-nightly | `79.7% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.16-stable | `78.9% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.17-nightly | `79.7% <91.4%> (-0.1%)` | :arrow_down: |\n| windows-1.17-stable | `78.9% <91.4%> (-0.1%)` | :arrow_down: |\n\n| [Impacted Files](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim) | Coverage Δ | |\n|---|---|---|\n| [msgpack/field.go](https://codecov.io/gh/neovim/go-client/pull/95/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim#diff-bXNncGFjay9maWVsZC5nbw==) | `76.5% <70.0%> (-1.9%)` | :arrow_down: |\n| [msgpack/unpack.go](https://codecov.io/gh/neovim/go-client/pull/95/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim#diff-bXNncGFjay91bnBhY2suZ28=) | `94.3% <100.0%> (ø)` | |\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim). Last update [7c85d51...2732b5d](https://codecov.io/gh/neovim/go-client/pull/95?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=neovim).\n",
            "created_at": "2021-01-11T13:18:16Z",
            "html_url": "https://github.com/neovim/go-client/pull/95#issuecomment-757945538",
            "id": 757945538,
            "issue_url": "https://api.github.com/repos/neovim/go-client/issues/95",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc1Nzk0NTUzOA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/neovim/go-client/issues/comments/757945538/reactions"
            },
            "updated_at": "2022-02-24T06:04:20Z",
            "url": "https://api.github.com/repos/neovim/go-client/issues/comments/757945538",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/in/254?v=4",
                "events_url": "https://api.github.com/users/codecov%5Bbot%5D/events{/privacy}",
                "followers_url": "https://api.github.com/users/codecov%5Bbot%5D/followers",
                "following_url": "https://api.github.com/users/codecov%5Bbot%5D/following{/other_user}",
                "gists_url": "https://api.github.com/users/codecov%5Bbot%5D/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/apps/codecov",
                "id": 22429695,
                "login": "codecov[bot]",
                "node_id": "MDM6Qm90MjI0Mjk2OTU=",
                "organizations_url": "https://api.github.com/users/codecov%5Bbot%5D/orgs",
                "received_events_url": "https://api.github.com/users/codecov%5Bbot%5D/received_events",
                "repos_url": "https://api.github.com/users/codecov%5Bbot%5D/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codecov%5Bbot%5D/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codecov%5Bbot%5D/subscriptions",
                "type": "Bot",
                "url": "https://api.github.com/users/codecov%5Bbot%5D"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/neovim/go-client/issues/95/comments",
    "commits_url": "https://api.github.com/repos/neovim/go-client/pulls/95/commits",
    "created_at": "2021-01-11T13:17:25Z",
    "diff_url": "https://github.com/neovim/go-client/pull/95.diff",
    "draft": true,
    "head": {
        "label": "neovim:msgpack/optimize",
        "ref": "msgpack/optimize",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/neovim/go-client/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/neovim/go-client/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/neovim/go-client/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/neovim/go-client/branches{/branch}",
            "clone_url": "https://github.com/neovim/go-client.git",
            "collaborators_url": "https://api.github.com/repos/neovim/go-client/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/neovim/go-client/comments{/number}",
            "commits_url": "https://api.github.com/repos/neovim/go-client/commits{/sha}",
            "compare_url": "https://api.github.com/repos/neovim/go-client/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/neovim/go-client/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/neovim/go-client/contributors",
            "created_at": "2014-11-13T12:30:33Z",
            "default_branch": "main",
            "deployments_url": "https://api.github.com/repos/neovim/go-client/deployments",
            "description": "Nvim Go client",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/neovim/go-client/downloads",
            "events_url": "https://api.github.com/repos/neovim/go-client/events",
            "fork": false,
            "forks": 37,
            "forks_count": 37,
            "forks_url": "https://api.github.com/repos/neovim/go-client/forks",
            "full_name": "neovim/go-client",
            "git_commits_url": "https://api.github.com/repos/neovim/go-client/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/neovim/go-client/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/neovim/go-client/git/tags{/sha}",
            "git_url": "git://github.com/neovim/go-client.git",
            "has_discussions": true,
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_projects": false,
            "has_wiki": false,
            "homepage": "https://pkg.go.dev/github.com/neovim/go-client",
            "hooks_url": "https://api.github.com/repos/neovim/go-client/hooks",
            "html_url": "https://github.com/neovim/go-client",
            "id": 26586823,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/neovim/go-client/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/neovim/go-client/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/neovim/go-client/issues{/number}",
            "keys_url": "https://api.github.com/repos/neovim/go-client/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/neovim/go-client/labels{/name}",
            "language": "Go",
            "languages_url": "https://api.github.com/repos/neovim/go-client/languages",
            "license": {
                "key": "apache-2.0",
                "name": "Apache License 2.0",
                "node_id": "MDc6TGljZW5zZTI=",
                "spdx_id": "Apache-2.0",
                "url": "https://api.github.com/licenses/apache-2.0"
            },
            "merges_url": "https://api.github.com/repos/neovim/go-client/merges",
            "milestones_url": "https://api.github.com/repos/neovim/go-client/milestones{/number}",
            "mirror_url": null,
            "name": "go-client",
            "node_id": "MDEwOlJlcG9zaXRvcnkyNjU4NjgyMw==",
            "notifications_url": "https://api.github.com/repos/neovim/go-client/notifications{?since,all,participating}",
            "open_issues": 15,
            "open_issues_count": 15,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
                "events_url": "https://api.github.com/users/neovim/events{/privacy}",
                "followers_url": "https://api.github.com/users/neovim/followers",
                "following_url": "https://api.github.com/users/neovim/following{/other_user}",
                "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/neovim",
                "id": 6471485,
                "login": "neovim",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
                "organizations_url": "https://api.github.com/users/neovim/orgs",
                "received_events_url": "https://api.github.com/users/neovim/received_events",
                "repos_url": "https://api.github.com/users/neovim/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/neovim"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/neovim/go-client/pulls{/number}",
            "pushed_at": "2024-05-13T21:25:19Z",
            "releases_url": "https://api.github.com/repos/neovim/go-client/releases{/id}",
            "size": 1000,
            "ssh_url": "git@github.com:neovim/go-client.git",
            "stargazers_count": 546,
            "stargazers_url": "https://api.github.com/repos/neovim/go-client/stargazers",
            "statuses_url": "https://api.github.com/repos/neovim/go-client/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/neovim/go-client/subscribers",
            "subscription_url": "https://api.github.com/repos/neovim/go-client/subscription",
            "svn_url": "https://github.com/neovim/go-client",
            "tags_url": "https://api.github.com/repos/neovim/go-client/tags",
            "teams_url": "https://api.github.com/repos/neovim/go-client/teams",
            "topics": [
                "go",
                "go-client",
                "msgpack",
                "neovim",
                "neovim-plugin"
            ],
            "trees_url": "https://api.github.com/repos/neovim/go-client/git/trees{/sha}",
            "updated_at": "2024-05-13T11:50:37Z",
            "url": "https://api.github.com/repos/neovim/go-client",
            "visibility": "public",
            "watchers": 546,
            "watchers_count": 546,
            "web_commit_signoff_required": false
        },
        "sha": "2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/6471485?v=4",
            "events_url": "https://api.github.com/users/neovim/events{/privacy}",
            "followers_url": "https://api.github.com/users/neovim/followers",
            "following_url": "https://api.github.com/users/neovim/following{/other_user}",
            "gists_url": "https://api.github.com/users/neovim/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/neovim",
            "id": 6471485,
            "login": "neovim",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjY0NzE0ODU=",
            "organizations_url": "https://api.github.com/users/neovim/orgs",
            "received_events_url": "https://api.github.com/users/neovim/received_events",
            "repos_url": "https://api.github.com/users/neovim/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/neovim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/neovim/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/neovim"
        }
    },
    "html_url": "https://github.com/neovim/go-client/pull/95",
    "id": 552735393,
    "issue_url": "https://api.github.com/repos/neovim/go-client/issues/95",
    "labels": [
        {
            "color": "C5DEF5",
            "default": false,
            "description": "",
            "id": 1146384662,
            "name": "area/msgpack",
            "node_id": "MDU6TGFiZWwxMTQ2Mzg0NjYy",
            "url": "https://api.github.com/repos/neovim/go-client/labels/area/msgpack"
        },
        {
            "color": "C2E0C6",
            "default": false,
            "description": "",
            "id": 2648754537,
            "name": "optimization",
            "node_id": "MDU6TGFiZWwyNjQ4NzU0NTM3",
            "url": "https://api.github.com/repos/neovim/go-client/labels/optimization"
        }
    ],
    "locked": false,
    "merge_commit_sha": "67a12d288f3dc02c80711e12ac4df751895d083a",
    "merged_at": null,
    "milestone": null,
    "node_id": "MDExOlB1bGxSZXF1ZXN0NTUyNzM1Mzkz",
    "number": 95,
    "patch_url": "https://github.com/neovim/go-client/pull/95.patch",
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/neovim/go-client/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/neovim/go-client/pulls/95/comments",
    "state": "open",
    "statuses_url": "https://api.github.com/repos/neovim/go-client/statuses/2732b5d58f09a87c89084d5f12ab3469d9cb28d9",
    "title": "msgpack: optimize",
    "updated_at": "2024-05-08T11:02:44Z",
    "url": "https://api.github.com/repos/neovim/go-client/pulls/95",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/6366270?v=4",
        "events_url": "https://api.github.com/users/zchee/events{/privacy}",
        "followers_url": "https://api.github.com/users/zchee/followers",
        "following_url": "https://api.github.com/users/zchee/following{/other_user}",
        "gists_url": "https://api.github.com/users/zchee/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zchee",
        "id": 6366270,
        "login": "zchee",
        "node_id": "MDQ6VXNlcjYzNjYyNzA=",
        "organizations_url": "https://api.github.com/users/zchee/orgs",
        "received_events_url": "https://api.github.com/users/zchee/received_events",
        "repos_url": "https://api.github.com/users/zchee/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zchee/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zchee/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zchee"
    }
}